<!doctype html>
<!--
  StakTrakr - Main Application Interface
  
  A comprehensive client-side web application for tracking precious metal investments
  including silver, gold, platinum, and palladium. Features include spot price management,
  premium calculations, collectable item handling, and multi-format data import/export.
  
  All data is stored locally using localStorage - no server required.
  Application version is managed dynamically via constants.js
-->
<html lang="en">
  <head>
    <!--
    Content Security Policy is intentionally relaxed to ensure test
    local file execution when opening this tool with the file:// protocol.
    The previous strict policy blocked external scripts and prevented
    the interface from rendering. The simplified policy below permits
    all sources while keeping inline execution restrictions.
  -->
    <meta
      http-equiv="Content-Security-Policy"
      content="default-src * 'unsafe-inline' 'unsafe-eval' data: blob:;"
    />
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1, minimum-scale=1, user-scalable=yes"
      name="viewport"
    />

    <title>StakTrakr â€” Precious Metals Inventory Tracker</title>
    <meta name="description" content="Track your silver, gold, platinum, and palladium portfolio. Live spot prices, melt values, gain/loss tracking. Free, open source, no data collected." />
    <meta property="og:title" content="StakTrakr â€” Precious Metals Inventory Tracker" />
    <meta property="og:description" content="Track your silver, gold, platinum, and palladium portfolio. Live spot prices, melt values, gain/loss tracking. Free, open source, no data collected." />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://www.staktrakr.com" />
    <!-- FILE PROTOCOL COMPATIBILITY - MUST LOAD FIRST -->
    <script src="./js/file-protocol-fix.js"></script>

    <!-- External libraries for data import/export functionality -->
    <script
      defer=""
      src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"
    ></script>
    <script
      defer=""
      src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"
    ></script>
    <script
      defer=""
      src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"
    ></script>
    <!-- Chart.js for pie charts -->
    <script
      defer=""
      src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"
    ></script>
    <!-- JSZip for backup functionality -->
    <script
      defer=""
      src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"
    ></script>
    <!-- forge.js for encryption fallback on file:// protocol -->
    <script
      defer=""
      src="https://cdnjs.cloudflare.com/ajax/libs/forge/0.10.0/forge.min.js"
    ></script>

    <link rel="stylesheet" href="./css/styles.css" />
    <link rel="icon" type="image/svg+xml" href="./images/safe-favicon.svg" />
  </head>
  <body>
    <!-- Application Header -->
    <div class="app-header">
      <div>
        <h1 class="app-logo" id="appLogo" aria-label="StakTrakr">
          <svg class="stackr-logo" viewBox="0 0 480 200" xmlns="http://www.w3.org/2000/svg" width="100%" style="max-width: 666px;">
            <defs>
              <!-- Light Mode Gradients -->
              <linearGradient id="goldLight" x1="0%" y1="0%" x2="0%" y2="100%">
                <stop offset="0%" stop-color="#FFD700"/>
                <stop offset="30%" stop-color="#FFA500"/>
                <stop offset="70%" stop-color="#B8860B"/>
                <stop offset="100%" stop-color="#8B6914"/>
              </linearGradient>
              
              <linearGradient id="silverLight" x1="0%" y1="0%" x2="0%" y2="100%">
                <stop offset="0%" stop-color="#F8F8FF"/>
                <stop offset="30%" stop-color="#E5E5E5"/>
                <stop offset="70%" stop-color="#C0C0C0"/>
                <stop offset="100%" stop-color="#A0A0A0"/>
              </linearGradient>
              
              <!-- Dark Mode Gradients -->
              <linearGradient id="goldDark" x1="0%" y1="0%" x2="0%" y2="100%">
                <stop offset="0%" stop-color="#FFED4E"/>
                <stop offset="30%" stop-color="#FFD700"/>
                <stop offset="70%" stop-color="#FFA500"/>
                <stop offset="100%" stop-color="#CC8400"/>
              </linearGradient>
              
              <linearGradient id="silverDark" x1="0%" y1="0%" x2="0%" y2="100%">
                <stop offset="0%" stop-color="#FFFFFF"/>
                <stop offset="30%" stop-color="#F5F5F5"/>
                <stop offset="70%" stop-color="#E0E0E0"/>
                <stop offset="100%" stop-color="#C0C0C0"/>
              </linearGradient>
              
              <!-- Sepia Mode Gradients -->
              <linearGradient id="goldSepia" x1="0%" y1="0%" x2="0%" y2="100%">
                <stop offset="0%" stop-color="#D4A574"/>
                <stop offset="30%" stop-color="#B58900"/>
                <stop offset="70%" stop-color="#8B6914"/>
                <stop offset="100%" stop-color="#6B5416"/>
              </linearGradient>
              
              <linearGradient id="silverSepia" x1="0%" y1="0%" x2="0%" y2="100%">
                <stop offset="0%" stop-color="#F2E7D5"/>
                <stop offset="30%" stop-color="#D1C2A5"/>
                <stop offset="70%" stop-color="#A8A29E"/>
                <stop offset="100%" stop-color="#8D8D8D"/>
              </linearGradient>
            </defs>
            
            <!-- Light Mode Group -->
            <g class="light-mode">
              <!-- Shadow layer for light mode -->
              <text x="53" y="83" font-family="Arial, sans-serif" font-size="72" font-weight="bold" fill="rgba(0,0,0,0.3)">
                <tspan class="logo-silver">Stak</tspan><tspan class="logo-gold">Trakr</tspan>
              </text>
              <!-- Main title -->
              <text x="50" y="80" font-family="Arial, sans-serif" font-size="72" font-weight="bold">
                <tspan class="logo-silver" fill="url(#silverLight)">Stak</tspan><tspan class="logo-gold" fill="url(#goldLight)">Trakr</tspan>
              </text>

              <!-- Tagline shadow -->
              <text x="52" y="132" font-family="Arial, sans-serif" font-size="32" fill="rgba(0,0,0,0.2)">
                Track Your Stack. Your Way.
              </text>
              <!-- Tagline -->
              <text x="50" y="130" font-family="Arial, sans-serif" font-size="32" fill="#666666">
                Track Your Stack. Your Way.
              </text>
            </g>
            
            <!-- Dark Mode Group -->
            <g class="dark-mode">
              <!-- Shadow layer for dark mode -->
              <text x="53" y="83" font-family="Arial, sans-serif" font-size="72" font-weight="bold" fill="rgba(0,0,0,0.5)">
                <tspan class="logo-silver">Stak</tspan><tspan class="logo-gold">Trakr</tspan>
              </text>
              <!-- Main title -->
              <text x="50" y="80" font-family="Arial, sans-serif" font-size="72" font-weight="bold">
                <tspan class="logo-silver" fill="url(#silverDark)">Stak</tspan><tspan class="logo-gold" fill="url(#goldDark)">Trakr</tspan>
              </text>

              <!-- Tagline shadow -->
              <text x="52" y="132" font-family="Arial, sans-serif" font-size="32" fill="rgba(0,0,0,0.3)">
                Track Your Stack. Your Way.
              </text>
              <!-- Tagline -->
              <text x="50" y="130" font-family="Arial, sans-serif" font-size="32" fill="#E0E0E0">
                Track Your Stack. Your Way.
              </text>
            </g>
            
            <!-- Sepia Mode Group -->
            <g class="sepia-mode">
              <!-- Shadow layer for sepia mode -->
              <text x="53" y="83" font-family="Arial, sans-serif" font-size="72" font-weight="bold" fill="rgba(62,47,30,0.4)">
                <tspan class="logo-silver">Stak</tspan><tspan class="logo-gold">Trakr</tspan>
              </text>
              <!-- Main title -->
              <text x="50" y="80" font-family="Arial, sans-serif" font-size="72" font-weight="bold">
                <tspan class="logo-silver" fill="url(#silverSepia)">Stak</tspan><tspan class="logo-gold" fill="url(#goldSepia)">Trakr</tspan>
              </text>

              <!-- Tagline shadow -->
              <text x="52" y="132" font-family="Arial, sans-serif" font-size="32" fill="rgba(62,47,30,0.3)">
                Track Your Stack. Your Way.
              </text>
              <!-- Tagline -->
              <text x="50" y="130" font-family="Arial, sans-serif" font-size="32" fill="#6F604E">
                Track Your Stack. Your Way.
              </text>
            </g>
          </svg>
        </h1>
      </div>
      <div style="margin-left: auto; display: flex; gap: 0.5rem">
        <button class="btn theme-btn" id="aboutBtn" title="About" aria-label="About">ðŸ“–</button>
        <button class="btn theme-btn" id="settingsBtn" title="Settings" aria-label="Settings">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
        </button>
      </div>
    </div>
    <div class="container">
      <!-- =============================================================================
         SPOT PRICES SECTION
         
         Displays current spot prices for all four supported metals and provides
         manual input controls for setting custom spot prices. Each metal has:
         - Display card showing current spot price
         - Input field for setting new spot price
         - Save and Reset buttons for price management
         
         Spot prices are used for premium calculations and profit/loss analysis
         ============================================================================= -->
      <section class="spot-prices">
        <div
          class="grid"
          style="
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 1rem;
          "
        >
          <!-- Silver spot price card -->
          <div class="spot-input silver">
            <div class="spot-card" data-metal="silver">
              <canvas class="spot-sparkline" id="sparklineSilver" aria-hidden="true"></canvas>
              <div class="spot-card-header">
                <div class="spot-card-label">Silver Spot Price</div>
                <div class="spot-card-controls">
                  <select class="spot-range-select" id="spotRangeSilver" title="Trend period">
                    <option value="7">7d</option>
                    <option value="30">30d</option>
                    <option value="60">60d</option>
                    <option value="90" selected>90d</option>
                  </select>
                  <button class="spot-sync-icon" id="syncIconSilver" title="Sync from API" disabled>
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21.5 2v6h-6"/><path d="M2.5 22v-6h6"/><path d="M2.5 11.5a10 10 0 0 1 18.4-4.5"/><path d="M21.5 12.5a10 10 0 0 1-18.4 4.5"/></svg>
                  </button>
                </div>
              </div>
              <div class="spot-card-value" id="spotPriceDisplaySilver" title="Shift+click to edit">$ -</div>
              <div class="spot-card-timestamp" id="spotTimestampSilver">No data</div>
            </div>
          </div>
          <!-- Gold spot price card -->
          <div class="spot-input gold">
            <div class="spot-card" data-metal="gold">
              <canvas class="spot-sparkline" id="sparklineGold" aria-hidden="true"></canvas>
              <div class="spot-card-header">
                <div class="spot-card-label">Gold Spot Price</div>
                <div class="spot-card-controls">
                  <select class="spot-range-select" id="spotRangeGold" title="Trend period">
                    <option value="7">7d</option>
                    <option value="30">30d</option>
                    <option value="60">60d</option>
                    <option value="90" selected>90d</option>
                  </select>
                  <button class="spot-sync-icon" id="syncIconGold" title="Sync from API" disabled>
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21.5 2v6h-6"/><path d="M2.5 22v-6h6"/><path d="M2.5 11.5a10 10 0 0 1 18.4-4.5"/><path d="M21.5 12.5a10 10 0 0 1-18.4 4.5"/></svg>
                  </button>
                </div>
              </div>
              <div class="spot-card-value" id="spotPriceDisplayGold" title="Shift+click to edit">$ -</div>
              <div class="spot-card-timestamp" id="spotTimestampGold">No data</div>
            </div>
          </div>
          <!-- Platinum spot price card -->
          <div class="spot-input platinum">
            <div class="spot-card" data-metal="platinum">
              <canvas class="spot-sparkline" id="sparklinePlatinum" aria-hidden="true"></canvas>
              <div class="spot-card-header">
                <div class="spot-card-label">Platinum Spot Price</div>
                <div class="spot-card-controls">
                  <select class="spot-range-select" id="spotRangePlatinum" title="Trend period">
                    <option value="7">7d</option>
                    <option value="30">30d</option>
                    <option value="60">60d</option>
                    <option value="90" selected>90d</option>
                  </select>
                  <button class="spot-sync-icon" id="syncIconPlatinum" title="Sync from API" disabled>
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21.5 2v6h-6"/><path d="M2.5 22v-6h6"/><path d="M2.5 11.5a10 10 0 0 1 18.4-4.5"/><path d="M21.5 12.5a10 10 0 0 1-18.4 4.5"/></svg>
                  </button>
                </div>
              </div>
              <div class="spot-card-value" id="spotPriceDisplayPlatinum" title="Shift+click to edit">$ -</div>
              <div class="spot-card-timestamp" id="spotTimestampPlatinum">No data</div>
            </div>
          </div>
          <!-- Palladium spot price card -->
          <div class="spot-input palladium">
            <div class="spot-card" data-metal="palladium">
              <canvas class="spot-sparkline" id="sparklinePalladium" aria-hidden="true"></canvas>
              <div class="spot-card-header">
                <div class="spot-card-label">Palladium Spot Price</div>
                <div class="spot-card-controls">
                  <select class="spot-range-select" id="spotRangePalladium" title="Trend period">
                    <option value="7">7d</option>
                    <option value="30">30d</option>
                    <option value="60">60d</option>
                    <option value="90" selected>90d</option>
                  </select>
                  <button class="spot-sync-icon" id="syncIconPalladium" title="Sync from API" disabled>
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21.5 2v6h-6"/><path d="M2.5 22v-6h6"/><path d="M2.5 11.5a10 10 0 0 1 18.4-4.5"/><path d="M21.5 12.5a10 10 0 0 1-18.4 4.5"/></svg>
                  </button>
                </div>
              </div>
              <div class="spot-card-value" id="spotPriceDisplayPalladium" title="Shift+click to edit">$ -</div>
              <div class="spot-card-timestamp" id="spotTimestampPalladium">No data</div>
            </div>
          </div>
        </div>
      </section><!-- =============================================================================
         TOTALS SECTION

         Comprehensive financial summary cards for each metal type showing:
         - Total items and weight in inventory
         - Purchase price vs current value calculations
         - Average prices (overall, collectable, non-collectable)
         - Premium analysis and profit/loss calculations
         - Clickable totals titles opening analytics modals with pie charts

         All calculations are performed by updateSummary() in inventory.js
         Values are updated automatically when inventory changes
         ============================================================================= -->
      <section class="totals-section">
        <div class="totals">
          <!-- Silver totals card -->
          <div class="total-card silver">
            <div class="total-title" data-metal="Silver">Silver</div>
            <div class="total-group">
              <div class="total-item">
                <span class="total-label">Items:</span>
                <span class="total-value" id="totalItemsSilver">0</span>
              </div>
              <div class="total-item">
                <span class="total-label">Weight (oz):</span>
                <span class="total-value" id="totalWeightSilver">0.00</span>
              </div>
              <div class="total-item">
                <span class="total-label">Avg Cost/oz:</span>
                <span class="total-value" id="avgCostPerOzSilver">$0.00</span>
              </div>
            </div>
            <div class="total-group">
              <div class="total-item">
                <span class="total-label">Purchase Price:</span>
                <span class="total-value" id="totalPurchasedSilver">$0.00</span>
              </div>
              <div class="total-item">
                <span class="total-label">Melt Value:</span>
                <span class="total-value" id="currentValueSilver">$0.00</span>
              </div>
              <div class="total-item">
                <span class="total-label">Retail Value:</span>
                <span class="total-value" id="retailValueSilver">$0.00</span>
              </div>
              <div class="total-item total-item-bottom-line">
                <span class="total-label">Gain/Loss:</span>
                <span class="total-value" id="lossProfitSilver">$0.00</span>
              </div>
            </div>
          </div>
          <!-- Gold totals card -->
          <div class="total-card gold">
            <div class="total-title" data-metal="Gold">Gold</div>
            <div class="total-group">
              <div class="total-item">
                <span class="total-label">Items:</span>
                <span class="total-value" id="totalItemsGold">0</span>
              </div>
              <div class="total-item">
                <span class="total-label">Weight (oz):</span>
                <span class="total-value" id="totalWeightGold">0.00</span>
              </div>
              <div class="total-item">
                <span class="total-label">Avg Cost/oz:</span>
                <span class="total-value" id="avgCostPerOzGold">$0.00</span>
              </div>
            </div>
            <div class="total-group">
              <div class="total-item">
                <span class="total-label">Purchase Price:</span>
                <span class="total-value" id="totalPurchasedGold">$0.00</span>
              </div>
              <div class="total-item">
                <span class="total-label">Melt Value:</span>
                <span class="total-value" id="currentValueGold">$0.00</span>
              </div>
              <div class="total-item">
                <span class="total-label">Retail Value:</span>
                <span class="total-value" id="retailValueGold">$0.00</span>
              </div>
              <div class="total-item total-item-bottom-line">
                <span class="total-label">Gain/Loss:</span>
                <span class="total-value" id="lossProfitGold">$0.00</span>
              </div>
            </div>
          </div>
          <!-- Platinum totals card -->
          <div class="total-card platinum">
            <div class="total-title" data-metal="Platinum">Platinum</div>
            <div class="total-group">
              <div class="total-item">
                <span class="total-label">Items:</span>
                <span class="total-value" id="totalItemsPlatinum">0</span>
              </div>
              <div class="total-item">
                <span class="total-label">Weight (oz):</span>
                <span class="total-value" id="totalWeightPlatinum">0.00</span>
              </div>
              <div class="total-item">
                <span class="total-label">Avg Cost/oz:</span>
                <span class="total-value" id="avgCostPerOzPlatinum">$0.00</span>
              </div>
            </div>
            <div class="total-group">
              <div class="total-item">
                <span class="total-label">Purchase Price:</span>
                <span class="total-value" id="totalPurchasedPlatinum">$0.00</span>
              </div>
              <div class="total-item">
                <span class="total-label">Melt Value:</span>
                <span class="total-value" id="currentValuePlatinum">$0.00</span>
              </div>
              <div class="total-item">
                <span class="total-label">Retail Value:</span>
                <span class="total-value" id="retailValuePlatinum">$0.00</span>
              </div>
              <div class="total-item total-item-bottom-line">
                <span class="total-label">Gain/Loss:</span>
                <span class="total-value" id="lossProfitPlatinum">$0.00</span>
              </div>
            </div>
          </div>
          <!-- Palladium totals card -->
          <div class="total-card palladium">
            <div class="total-title" data-metal="Palladium">Palladium</div>
            <div class="total-group">
              <div class="total-item">
                <span class="total-label">Items:</span>
                <span class="total-value" id="totalItemsPalladium">0</span>
              </div>
              <div class="total-item">
                <span class="total-label">Weight (oz):</span>
                <span class="total-value" id="totalWeightPalladium">0.00</span>
              </div>
              <div class="total-item">
                <span class="total-label">Avg Cost/oz:</span>
                <span class="total-value" id="avgCostPerOzPalladium">$0.00</span>
              </div>
            </div>
            <div class="total-group">
              <div class="total-item">
                <span class="total-label">Purchase Price:</span>
                <span class="total-value" id="totalPurchasedPalladium">$0.00</span>
              </div>
              <div class="total-item">
                <span class="total-label">Melt Value:</span>
                <span class="total-value" id="currentValuePalladium">$0.00</span>
              </div>
              <div class="total-item">
                <span class="total-label">Retail Value:</span>
                <span class="total-value" id="retailValuePalladium">$0.00</span>
              </div>
              <div class="total-item total-item-bottom-line">
                <span class="total-label">Gain/Loss:</span>
                <span class="total-value" id="lossProfitPalladium">$0.00</span>
              </div>
            </div>
          </div>
          <!-- All metals combined totals card -->
          <div class="total-card total-card-all">
            <div class="total-title" data-metal="All">All Metals</div>
            <div class="total-group">
              <div class="total-item">
                <span class="total-label">Items:</span>
                <span class="total-value" id="totalItemsAll">0</span>
              </div>
              <div class="total-item">
                <span class="total-label">Weight (oz):</span>
                <span class="total-value" id="totalWeightAll">0.00</span>
              </div>
              <div class="total-item">
                <span class="total-label">Avg Cost/oz:</span>
                <span class="total-value" id="avgCostPerOzAll">$0.00</span>
              </div>
            </div>
            <div class="total-group">
              <div class="total-item">
                <span class="total-label">Purchase Price:</span>
                <span class="total-value" id="totalPurchasedAll">$0.00</span>
              </div>
              <div class="total-item">
                <span class="total-label">Melt Value:</span>
                <span class="total-value" id="currentValueAll">$0.00</span>
              </div>
              <div class="total-item">
                <span class="total-label">Retail Value:</span>
                <span class="total-value" id="retailValueAll">$0.00</span>
              </div>
              <div class="total-item total-item-bottom-line">
                <span class="total-label">Gain/Loss:</span>
                <span class="total-value" id="lossProfitAll">$0.00</span>
              </div>
            </div>
          </div>
        </div>
      </section>
      <!-- =============================================================================
         INVENTORY FORM SECTION
         
         Primary data entry form for adding new inventory items. Includes fields for:
         - Metal type selection (Silver, Gold, Platinum, Palladium)
         - Item details (name, type, quantity, weight)
         - Purchase information (price, location, storage location, date)
         
         Form submission is handled by events.js with validation and automatic
         premium calculation based on current spot prices
         ============================================================================= -->
      <!--
        Legacy add item form - commented out pending removal after
        verifying new modal workflow.
      <section class="form-section">
        ...
      </section>
      -->
      <!-- =============================================================================
         INVENTORY

         Wrapper containing search and inventory table
         ============================================================================= -->
      <section class="inventory-section">
        <!-- =============================================================================
           SEARCH FUNCTIONALITY

           Live search interface that filters inventory table in real-time.
           Searches across all relevant fields including:
           - Metal type, name, type, purchase/storage locations, date
           - Quantity, weight, price values
           - Collectable status (yes/no)

           Search is case-insensitive and supports partial matches
           Implementation in search.js with filterInventory() function
           ============================================================================= -->
        <section class="search-section">
          <div class="search-container">
            <button
              class="btn search-action-btn add-btn"
              id="newItemBtn"
              title="Add new item"
              aria-label="Add new item"
            >
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="10"/>
                <line x1="12" y1="8" x2="12" y2="16"/>
                <line x1="8" y1="12" x2="16" y2="12"/>
              </svg>
              <span>Add Item</span>
            </button>
            <input
              id="searchInput"
              placeholder="Search inventory by metal, name, type, purchase location, storage location, notes, date..."
              type="text"
            />
            <button
              class="btn search-action-btn clear-btn"
              id="clearBtn"
              title="Clear search"
              aria-label="Clear search"
            >
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="18" y1="6" x2="6" y2="18"/>
                <line x1="6" y1="6" x2="18" y2="18"/>
              </svg>
              <span>Clear</span>
            </button>
            <button
              class="btn search-action-btn log-btn" id="changeLogBtn" title="Change log" aria-label="Change log">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                <polyline points="14,2 14,8 20,8"/>
                <line x1="16" y1="13" x2="8" y2="13"/>
                <line x1="16" y1="17" x2="8" y2="17"/>
                <polyline points="10,9 9,9 8,9"/>
              </svg>
              <span>Log</span>
            </button>
          </div>
          
          <!-- Integrated Filters -->
          <div class="search-filters">
            <div class="filter-controls">
              <div class="control-group">
                <label for="chipMinCount" class="control-label">Filter Chips:</label>
                <select id="chipMinCount" class="control-select" title="Minimum number of items before showing a filter chip">
                  <option value="2">2+</option>
                  <option value="3" selected>3+</option>
                  <option value="5">5+</option>
                  <option value="10">10+</option>
                  <option value="100">100+</option>
                </select>
              </div>
              <div class="control-group">
                <span class="control-label">Smart Grouping:</span>
                <div class="chip-sort-toggle" id="groupNameChips" title="Group similar item names (e.g., 'American Silver Eagle (3)' instead of separate year chips)">
                  <button type="button" class="chip-sort-btn active" data-val="yes">On</button>
                  <button type="button" class="chip-sort-btn" data-val="no">Off</button>
                </div>
              </div>
              <div class="control-group">
                <span class="control-label">Chip Sort:</span>
                <div class="chip-sort-toggle" id="chipSortOrder" title="Sort chips within each category">
                  <button type="button" class="chip-sort-btn active" data-sort="alpha">A-Z</button>
                  <button type="button" class="chip-sort-btn" data-sort="count">Qty</button>
                </div>
              </div>
            </div>
            <div class="filter-row">
              <div class="active-filters" id="activeFilters"></div>
              <div class="search-results-info" id="searchResultsInfo"></div>
            </div>
          </div>
        </section>
        <!-- =============================================================================
           INVENTORY TABLE SECTION

           Main data display table showing all inventory items with:
           - Sortable columns (click headers to sort ascending/descending)
           - Clickable item names for editing (opens edit modal)
           - Collectable status checkboxes for quick toggle
           - Delete buttons with confirmation
           - Responsive design with column resizing capability

        Table rendering handled by renderTable() in inventory.js
         Portal view shows all items in a scrollable table with sticky headers
         ============================================================================= -->
        <section class="table-section">
          <div class="portal-scroll">
          <table id="inventoryTable">
          <thead>
            <tr>
              <th class="shrink" data-column="date">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="header-icon">
                  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                  <line x1="16" y1="2" x2="16" y2="6"/>
                  <line x1="8" y1="2" x2="8" y2="6"/>
                  <line x1="3" y1="10" x2="21" y2="10"/>
                </svg>
                <span class="header-text">Date</span>
              </th>
              <th class="shrink" data-column="metal">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="header-icon">
                  <circle cx="12" cy="12" r="10"/>
                  <circle cx="12" cy="12" r="6"/>
                  <circle cx="12" cy="12" r="2"/>
                </svg>
                <span class="header-text">Metal</span>
              </th>
              <th class="shrink" data-column="type">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="header-icon">
                  <polygon points="12,2 22,8.5 22,15.5 12,22 2,15.5 2,8.5"/>
                </svg>
                <span class="header-text">Type</span>
              </th>
              <th class="expand" data-column="name">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="header-icon">
                  <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                  <circle cx="12" cy="7" r="4"/>
                </svg>
                <span class="header-text">Name</span>
              </th>
              <th class="shrink center-align" data-column="qty">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="header-icon">
                  <line x1="8" y1="6" x2="21" y2="6"/>
                  <line x1="8" y1="12" x2="21" y2="12"/>
                  <line x1="8" y1="18" x2="21" y2="18"/>
                  <line x1="3" y1="6" x2="3.01" y2="6"/>
                  <line x1="3" y1="12" x2="3.01" y2="12"/>
                  <line x1="3" y1="18" x2="3.01" y2="18"/>
                </svg>
                <span class="header-text">Qty</span>
              </th>
              <th class="shrink" data-column="weight">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="header-icon">
                  <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                </svg>
                <span class="header-text">Weight</span>
              </th>
              <th class="shrink" data-column="purchasePrice" title="USD">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="header-icon">
                  <line x1="12" y1="1" x2="12" y2="23"/>
                  <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                </svg>
                <span class="header-text">Purchase</span>
              </th>
              <th class="shrink" data-column="meltValue" title="USD">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="header-icon">
                  <path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10 10-4.5 10-10S17.5 2 12 2z"/>
                  <path d="M12 6v6l4 2"/>
                </svg>
                <span class="header-text">Melt</span>
              </th>
              <th class="shrink" data-column="retailPrice" title="USD">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="header-icon">
                  <path d="M22 12h-4l-3 9L9 3l-3 9H2"/>
                </svg>
                <span class="header-text">Retail</span>
              </th>
              <th class="shrink" data-column="gainLoss" title="USD">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="header-icon">
                  <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/>
                  <polyline points="17 6 23 6 23 12"/>
                </svg>
                <span class="header-text">Gain/Loss</span>
              </th>
              <th class="shrink" data-column="purchaseLocation">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="header-icon">
                  <path d="M3 9l1.5-5h15L21 9"/>
                  <path d="M3 9v11a1 1 0 0 0 1 1h16a1 1 0 0 0 1-1V9"/>
                  <path d="M9 21V13h6v8"/>
                </svg>
                <span class="header-text">Source</span>
              </th>
              <th class="icon-col actions-col" data-column="actions" aria-label="Actions" title="Actions">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="header-icon">
                  <circle cx="12" cy="5" r="1.5"/>
                  <circle cx="12" cy="12" r="1.5"/>
                  <circle cx="12" cy="19" r="1.5"/>
                </svg>
                <span class="header-text">Actions</span>
              </th>
            </tr>
          </thead>
          <tbody></tbody>
          </table>
          </div>
          <div class="table-footer-controls">
            <div class="table-item-count"><strong id="itemCount"></strong></div>
            <select id="itemsPerPage" class="control-select" title="Visible rows">
              <option value="10">10</option>
              <option value="15">15</option>
              <option value="25" selected>25</option>
              <option value="50">50</option>
              <option value="100">100</option>
            </select>
          </div>
          
          <!-- Bulk Edit Control Panel -->
          <div class="bulk-edit-panel" id="bulkEditPanel" style="display: none;">
            <div class="bulk-edit-controls">
              <button class="bulk-edit-btn toggle-all-btn" id="bulkToggleAll" title="Toggle all items edit mode">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="bulk-edit-icon">
                  <path d="M14.06,9L15,9.94L5.92,19H5V18.08L14.06,9M17.66,3C17.41,3 17.15,3.1 16.96,3.29L15.13,5.12L18.88,8.87L20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18.17,3.09 17.92,3 17.66,3M14.06,6.19L3,17.25V21H6.75L17.81,9.94L14.06,6.19Z"/>
                </svg>
              </button>
              <button class="bulk-edit-btn save-all-btn" id="bulkSaveAll" title="Save all changes">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="bulk-edit-icon">
                  <path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"/>
                </svg>
              </button>
              <button class="bulk-edit-btn cancel-all-btn" id="bulkCancelAll" title="Cancel all changes">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="bulk-edit-icon">
                  <path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"/>
                </svg>
              </button>
            </div>
          </div>
        </section>
    </section>
      <!-- =============================================================================
         IMPORT/EXPORT SECTION
         
         Comprehensive data management with support for multiple formats:
         
         IMPORT OPTIONS:
         - CSV: Standard comma-separated values with automatic field mapping
         - JSON: Native application format preserving all data
         
         EXPORT OPTIONS:
         - CSV: Compatible with spreadsheet applications
         - JSON: Full data backup with metadata
         - PDF: Print-ready report with totals and formatting
         - HTML: Standalone web page with embedded styles
         
         All import/export functions include data validation and error handling
         Implementation in inventory.js with format-specific parsing
      ============================================================================= -->
    </div>
    <!-- UNIFIED ITEM MODAL (Add / Edit) -->
    <div class="modal" id="itemModal" style="display: none">
      <div class="modal-content">
        <div class="modal-header">
          <h2 id="itemModalTitle">Add Inventory Item</h2>
          <button aria-label="Close modal" class="modal-close" id="itemCloseBtn">Ã—</button>
        </div>
        <div class="modal-body">
          <form id="inventoryForm">
            <!-- Hidden fields -->
            <input type="hidden" id="itemSerial" value="" />
            <input type="hidden" id="itemCollectable" value="false" />
            <input type="hidden" id="itemSpotPrice" value="" />
            <!-- First row of form fields -->
            <div class="grid grid-2">
              <div>
                <label for="itemMetal">Metal</label>
                <select id="itemMetal">
                  <option value="Silver">Silver</option>
                  <option value="Gold">Gold</option>
                  <option value="Platinum">Platinum</option>
                  <option value="Palladium">Palladium</option>
                </select>
              </div>
              <div>
                <label for="itemType">Type</label>
                <select id="itemType">
                  <option value="Coin">Coin</option>
                  <option value="Bar">Bar</option>
                  <option value="Round">Round</option>
                  <option value="Note">Note</option>
                  <option value="Aurum">Aurum</option>
                  <option value="Set">Set</option>
                  <option value="Other">Other</option>
                </select>
              </div>
              <div>
                <label for="itemQty">Quantity</label>
                <input id="itemQty" min="1" required step="1" type="number" />
              </div>
              <div>
                <label for="itemWeight">Weight</label>
                <div style="display:flex;align-items:center;gap:var(--spacing);">
                  <input id="itemWeight" inputmode="decimal" placeholder="e.g. 1, 0.5, 1/10" required type="text" />
                  <select id="itemWeightUnit">
                    <option value="oz">oz</option>
                    <option value="g">g</option>
                  </select>
                </div>
              </div>
            </div>
            <!-- Row: Name & Year (Name wider) -->
            <div class="grid grid-name-year">
              <div>
                <label for="itemName">Name</label>
                <input id="itemName" required type="text" />
              </div>
              <div>
                <label for="itemYear">Year <span style="font-weight:normal;opacity:0.6;">(optional)</span></label>
                <input id="itemYear" type="text" placeholder="e.g. 2024" />
              </div>
            </div>
            <!-- Row: Grade, Authority & Cert # -->
            <div class="grid grid-grade">
              <div>
                <label for="itemGrade">Grade <span style="font-weight:normal;opacity:0.6;">(optional)</span></label>
                <select id="itemGrade">
                  <option value="">-- None --</option>
                  <optgroup label="Standard">
                    <option value="AG">AG - About Good</option>
                    <option value="G">G - Good</option>
                    <option value="VG">VG - Very Good</option>
                    <option value="F">F - Fine</option>
                    <option value="VF">VF - Very Fine</option>
                    <option value="XF">XF - Extremely Fine</option>
                    <option value="AU">AU - About Uncirculated</option>
                    <option value="UNC">UNC - Uncirculated</option>
                    <option value="BU">BU - Brilliant Uncirculated</option>
                  </optgroup>
                  <optgroup label="Mint State">
                    <option value="MS-60">MS-60</option>
                    <option value="MS-61">MS-61</option>
                    <option value="MS-62">MS-62</option>
                    <option value="MS-63">MS-63</option>
                    <option value="MS-64">MS-64</option>
                    <option value="MS-65">MS-65</option>
                    <option value="MS-66">MS-66</option>
                    <option value="MS-67">MS-67</option>
                    <option value="MS-68">MS-68</option>
                    <option value="MS-69">MS-69</option>
                    <option value="MS-70">MS-70</option>
                  </optgroup>
                  <optgroup label="Proof">
                    <option value="PF-60">PF-60</option>
                    <option value="PF-61">PF-61</option>
                    <option value="PF-62">PF-62</option>
                    <option value="PF-63">PF-63</option>
                    <option value="PF-64">PF-64</option>
                    <option value="PF-65">PF-65</option>
                    <option value="PF-66">PF-66</option>
                    <option value="PF-67">PF-67</option>
                    <option value="PF-68">PF-68</option>
                    <option value="PF-69">PF-69</option>
                    <option value="PF-70">PF-70</option>
                  </optgroup>
                </select>
              </div>
              <div>
                <label for="itemGradingAuthority">Authority <span style="font-weight:normal;opacity:0.6;">(optional)</span></label>
                <select id="itemGradingAuthority">
                  <option value="">-- None --</option>
                  <option value="PCGS">PCGS</option>
                  <option value="NGC">NGC</option>
                  <option value="ANACS">ANACS</option>
                  <option value="ICG">ICG</option>
                </select>
              </div>
              <div>
                <label for="itemCertNumber">Cert # <span style="font-weight:normal;opacity:0.6;">(optional)</span></label>
                <input id="itemCertNumber" type="text" placeholder="e.g. 12345678" />
              </div>
            </div>
            <!-- Row: Storage Location & Serial # -->
            <div class="grid grid-2">
              <div>
                <label for="storageLocation">Storage Location</label>
                <input id="storageLocation" type="text" placeholder="Vault A, Safe B, etc..." />
              </div>
              <div>
                <label for="itemSerialNumber">Serial # <span style="font-weight:normal;opacity:0.6;">(optional)</span></label>
                <input id="itemSerialNumber" type="text" placeholder="Bar or note serial number" />
              </div>
            </div>
            <!-- Row: Purchase Date & Purchase Price -->
            <div class="grid grid-2">
              <div id="dateField">
                <label for="itemDate">Purchase Date</label>
                <input id="itemDate" required type="date" />
              </div>
              <div>
                <label for="itemPrice">Purchase Price ($)</label>
                <div class="currency-input">
                  <input id="itemPrice" min="0" step="0.01" type="number" />
                </div>
              </div>
            </div>
            <!-- Row: Purchase Location & Retail Price -->
            <div class="grid grid-2">
              <div>
                <label for="purchaseLocation">Purchase Location</label>
                <input id="purchaseLocation" type="text" />
              </div>
              <div id="marketValueField">
                <label for="itemMarketValue">Retail Price ($) <span style="font-weight:normal;opacity:0.6;">(optional)</span></label>
                <div class="currency-input">
                  <input id="itemMarketValue" min="0" step="0.01" type="number" placeholder="Defaults to melt value" />
                </div>
              </div>
            </div>
            <!-- Row: Catalog N# & Notes -->
            <div class="grid grid-2">
              <div>
                <label for="itemCatalog">Catalog (N#)</label>
                <input id="itemCatalog" type="text" placeholder="Numista catalog #" />
              </div>
              <div>
                <label for="itemNotes">Notes</label>
                <input id="itemNotes" type="text" placeholder="Additional notes or comments..." />
              </div>
            </div>
            <!-- Form action buttons -->
            <div class="item-modal-actions">
              <button class="btn secondary" id="searchNumistaBtn" type="button"
                      title="Search Numista catalog using the Name or N# field">
                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none"
                     stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"
                     style="vertical-align: -2px; margin-right: 0.3rem;">
                  <circle cx="11" cy="11" r="7"/><line x1="16.5" y1="16.5" x2="21" y2="21"/>
                </svg>Search Numista
              </button>
              <div class="item-modal-actions-right">
                <button class="btn" id="undoChangeBtn" type="button" style="display:none">Undo</button>
                <button class="btn" id="cancelItem" type="button">Cancel</button>
                <button class="btn premium" id="itemModalSubmit" type="submit">Add to Inventory</button>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- =============================================================================
       NOTES MODAL

       Simple modal for viewing and editing item notes. Opens when the Notes
       button is clicked in the inventory table. Allows users to update the
       notes field without opening the full edit form.
       ============================================================================= -->
    <div class="modal" id="notesModal" style="display: none">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Item Notes</h2>
          <button aria-label="Close modal" class="modal-close" id="notesCloseBtn">Ã—</button>
        </div>
        <div class="modal-body">
          <textarea id="notesTextarea" rows="6" style="width: 100%"></textarea>
          <div style="margin-top: 1rem; text-align: right">
            <button class="btn" id="cancelNotes" type="button">Cancel</button>
            <button class="btn premium" id="saveNotes" type="button">Save</button>
          </div>
        </div>
      </div>
    </div>

    <!-- =============================================================================
       CHANGE LOG MODAL

       Displays the 10 most recent inventory cell changes tracked by the system.
       Data is populated dynamically from localStorage and rendered as a table.
       ============================================================================= -->
    <div class="modal" id="changeLogModal" style="display: none">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Change Log</h2>
          <button aria-label="Close modal" class="modal-close" id="changeLogCloseBtn">Ã—</button>
        </div>
        <div class="modal-body">
          <table id="changeLogTable">
            <thead>
              <tr>
                <th>Date</th>
                <th>Item</th>
                <th>Field</th>
                <th>Old Value</th>
                <th>New Value</th>
                <th>Undo</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
        <div class="modal-footer">
          <button
            class="btn secondary icon-btn"
            id="changeLogClearBtn"
            title="Clear log"
            aria-label="Clear log"
          >â†º</button>
        </div>
      </div>
    </div>
  </div>

    <!-- =============================================================================
       STORAGE REPORT MODAL

       Displays the generated storage report inside an iframe for in-app viewing.
       ============================================================================= -->
    <div class="modal" id="storageReportModal" style="display: none">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Storage Report</h2>
          <button
            aria-label="Close modal"
            class="modal-close"
            id="storageReportCloseBtn"
          >
            Ã—
          </button>
        </div>
        <div class="modal-body">
          <iframe
            id="storageReportFrame"
            style="width: 100%; height: 100%; border: none"
          ></iframe>
        </div>
      </div>
    </div>
    
    
    <!-- =============================================================================
       DETAILS MODAL WITH PIE CHARTS
       
       Advanced analytics modal opened by clicking totals titles.
       Provides in-depth analysis for selected metal including:
       
       VISUAL ANALYTICS:
       - Pie chart breakdown by item type (rounds, bars, coins, etc.)
       - Pie chart breakdown by purchase location
       - Interactive Chart.js visualizations with hover details
       
       DATA BREAKDOWNS:
       - Type details: count, weight, and value by item type
       - Location details: count, weight, and value by purchase location
       - Formatted currency and weight displays
       
       Modal implementation in detailsModal.js with Chart.js integration
       Data preparation and chart rendering handled by charts.js
       ============================================================================= -->
    <div class="modal" id="detailsModal" style="display: none">
      <div class="modal-content">
        <div class="modal-header">
          <h2 id="detailsModalTitle"></h2>
          <button aria-label="Close modal" class="modal-close" id="detailsCloseBtn">Ã—</button>
        </div>
        <div class="modal-body">
          <div class="details-grid">
            <div class="details-panel">
              <h3 class="details-panel-title" id="typePanelTitle">Breakdown by Type</h3>
              <div class="chart-canvas-container">
                <canvas class="chart-canvas" id="typeChart"></canvas>
              </div>
              <div class="details-breakdown" id="typeBreakdown">
                <!-- Content will be populated by JavaScript -->
              </div>
            </div>
            <div class="details-panel">
              <h3 class="details-panel-title" id="locationPanelTitle">Breakdown by Purchase Location</h3>
              <div class="chart-canvas-container">
                <canvas class="chart-canvas" id="locationChart"></canvas>
              </div>
              <div class="details-breakdown" id="locationBreakdown">
                <!-- Content will be populated by JavaScript -->
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <footer class="app-footer">
      <div class="storage-line">Storage: <span id="storageUsage"></span> <progress id="storageUsageBar" max="5120" value="0"></progress> <a href="#" id="storageReportLink">Storage report</a></div>
      <div class="footer-meta">
        <span>Thank you for using <span id="footerBrand">StakTrakr</span> (<span id="footerVersion"></span>). &copy; 2025-2026 <span id="footerDomain">staktrakr.com</span>. Created with love on Apple Silicon.<br>If you are having issues, report them on <a href="https://github.com/lbruton/StackTrackr/issues" target="_blank" rel="noopener">GitHub</a> or join our <a href="https://www.reddit.com/r/stackrtrackr/" target="_blank" rel="noopener">community</a>. This project is <a href="https://github.com/lbruton/StackTrackr" target="_blank" rel="noopener">open source</a>. MIT License.</span>
      </div>
    </footer>
    <!-- =============================================================================
       ABOUT & DISCLAIMER MODAL
       Comprehensive application information and disclaimer modal similar to the
       original splash page design with enhanced features and detailed information.
       ============================================================================= -->
    <div class="modal" id="ackModal" style="display: none">
      <div class="modal-content about-modal-content">
        <div class="modal-header about-modal-header">
          <h1 class="about-title">
            <span id="ackAppName">StakTrakr</span> <span id="ackVersion"></span>
          </h1>
          <button aria-label="Close modal" class="modal-close" id="ackCloseBtn">
            Ã—
          </button>
        </div>
        <div class="modal-body about-modal-body">
          <!-- Application Description -->
          <div class="about-description">
            A free, open-source precious metals portfolio tracker. Monitor live
            spot prices, track purchase cost vs melt value, and compute gain/loss
            across Silver, Gold, Platinum, and Palladium. All data stays in your
            browser â€” nothing is ever sent to a server.
          </div>

          <!-- Important Notice -->
          <div class="about-alert">
            <div class="alert-header">
              <span class="alert-icon">âš ï¸</span>
              <strong>Important Privacy & Data Notice</strong>
            </div>
            <div class="alert-content">
              <p>
                <strong>Your Privacy is Protected:</strong> All data is stored
                locally in your browser using localStorage and
                <em>never transmitted to any server</em>. Your precious metals
                inventory information remains completely private and under your
                control.
              </p>

              <p>
                <strong>Data Backup Responsibility:</strong> Since data is
                stored locally, it will be lost if you clear browser history,
                reset browser data, or use private browsing mode. Remember to
                export your data regularly to keep a copy.
              </p>

              <p>
                <strong>Use at Your Own Risk:</strong> This tool is provided for
                informational and organizational purposes only. The developer
                assumes no responsibility for any financial decisions,
                investment choices, or data loss. Always verify spot prices and
                calculations independently.
              </p>

              <p>
                <strong>Spot Price Accuracy:</strong> Prices displayed are for
                reference only and may not reflect real-time market conditions.
                Always confirm current pricing with your dealer or official
                market sources before making transactions.
              </p>
            </div>
          </div>
          <div class="alert-actions">
            <button class="btn btn-primary about-accept-btn" id="ackAcceptBtn">
              âœ… I Understand - Continue to Application
            </button>
          </div>
          <div class="acceptance-text">
            By continuing, you acknowledge that you understand this tool stores
            data locally, you are responsible for backing up your data, and you
            use this application at your own risk.
          </div>
        </div>
      </div>
    </div>
    <div class="modal" id="aboutModal" style="display: none">
      <div class="modal-content about-modal-content">
        <div class="modal-header about-modal-header">
          <h1>About</h1>
          <button
            aria-label="Close modal"
            class="modal-close"
            id="aboutCloseBtn"
          >
            Ã—
          </button>
        </div>
        <div class="modal-body about-modal-body">
          <h2 class="about-title" id="aboutTitle">
            <span id="aboutAppName">StakTrakr</span>
            <span id="aboutVersion"></span>
          </h2>
          <div class="about-description">
            A free, open-source precious metals portfolio tracker. Monitor live
            spot prices, track purchase cost vs melt value, and compute gain/loss
            across Silver, Gold, Platinum, and Palladium. All data stays in your
            browser â€” nothing is ever sent to a server. Export to CSV, JSON, PDF,
            or HTML backup at any time.
            <div class="about-badges">
              <a id="aboutSiteLink" href="https://www.staktrakr.com" target="_blank" rel="noopener" class="about-badge">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M2 12h20"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg>
                <span id="aboutSiteDomain">staktrakr.com</span>
              </a>
              <a href="https://github.com/lbruton/StackTrackr" target="_blank" rel="noopener" class="about-badge">
                <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0 0 24 12c0-6.63-5.37-12-12-12z"/></svg>
                Source
              </a>
              <a href="https://www.reddit.com/r/stackrtrackr/" target="_blank" rel="noopener" class="about-badge">
                <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0zm5.01 4.744c.688 0 1.25.561 1.25 1.249a1.25 1.25 0 0 1-2.498.056l-2.597-.547-.8 3.747c1.824.07 3.48.632 4.674 1.488.308-.309.73-.491 1.207-.491.968 0 1.754.786 1.754 1.754 0 .716-.435 1.333-1.01 1.614a3.111 3.111 0 0 1 .042.52c0 2.694-3.13 4.87-7.004 4.87-3.874 0-7.004-2.176-7.004-4.87 0-.183.015-.366.043-.534A1.748 1.748 0 0 1 4.028 12c0-.968.786-1.754 1.754-1.754.463 0 .898.196 1.207.49 1.207-.883 2.878-1.43 4.744-1.487l.885-4.182a.342.342 0 0 1 .14-.197.35.35 0 0 1 .238-.042l2.906.617a1.214 1.214 0 0 1 1.108-.701zM9.25 12C8.561 12 8 12.562 8 13.25c0 .687.561 1.248 1.25 1.248.687 0 1.248-.561 1.248-1.249 0-.688-.561-1.249-1.249-1.249zm5.5 0c-.687 0-1.248.561-1.248 1.25 0 .687.561 1.248 1.249 1.248.688 0 1.249-.561 1.249-1.249 0-.687-.562-1.249-1.25-1.249zm-5.466 3.99a.327.327 0 0 0-.231.094.33.33 0 0 0 0 .463c.842.842 2.484.913 2.961.913.477 0 2.105-.056 2.961-.913a.361.361 0 0 0 .029-.463.33.33 0 0 0-.464 0c-.547.533-1.684.73-2.512.73-.828 0-1.979-.196-2.512-.73a.326.326 0 0 0-.232-.095z"/></svg>
                Community
              </a>
              <a href="https://github.com/lbruton/StackTrackr/blob/main/LICENSE" target="_blank" rel="noopener noreferrer" class="about-badge">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
                MIT License
              </a>
            </div>
          </div>

          <div class="about-alert">
            <div class="alert-header">
              <span class="alert-icon">âš ï¸</span>
              <strong>Important Privacy &amp; Data Notice</strong>
            </div>
            <div class="alert-content">
              <p>
                <strong>Your Privacy is Protected:</strong> All data is stored
                locally in your browser using localStorage and
                <em>never transmitted to any server</em>. Your precious metals
                inventory information remains completely private and under your
                control.
              </p>

              <p>
                <strong>Data Backup Responsibility:</strong> Since data is
                stored locally, it will be lost if you clear browser history,
                reset browser data, or use private browsing mode. Remember to
                export your data regularly to keep a copy.
              </p>

              <p>
                <strong>Use at Your Own Risk:</strong> This tool is provided for
                informational and organizational purposes only. The developer
                assumes no responsibility for any financial decisions,
                investment choices, or data loss. Always verify spot prices and
                calculations independently.
              </p>

              <p>
                <strong>Spot Price Accuracy:</strong> Prices displayed are for
                reference only and may not reflect real-time market conditions.
                Always confirm current pricing with your dealer or official
                market sources before making transactions.
              </p>
            </div>
          </div>
          <!-- What's New and Roadmap -->
          <div class="about-info-grid">
            <div class="about-section">
              <div class="section-title">ðŸš€ What's New in <span id="aboutCurrentVersion"></span></div>
              <ul id="aboutChangelogLatest" class="changelog-list"></ul>
            </div>

            <div class="about-section" id="aboutRoadmapSection">
              <div class="section-title">ðŸ—ºï¸ Development Roadmap</div>
              <ul id="aboutRoadmapList" class="changelog-list"></ul>
            </div>
          </div>

          <!-- Resources Section -->
          <div class="about-section">
            <div class="section-title">ðŸ“„ Resources & Links</div>
            <div class="resources-grid">
              <a class="resource-btn" href="sample.csv" download="sample.csv">
                ðŸ“„ Download Sample Data
              </a>
              <a
                class="resource-btn"
                href="https://github.com/lbruton/StackTrackr"
                target="_blank"
                rel="noopener"
              >
                ðŸ“ View Source Code
              </a>
              <button class="resource-btn" id="aboutShowChangelogBtn">
                ðŸ“œ View Full Changelog
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="modal" id="versionModal" style="display: none">
      <div class="modal-content about-modal-content">
        <div class="modal-header about-modal-header">
          <h1 class="about-title">What's New <span id="versionModalVersion"></span></h1>
          <button aria-label="Close modal" class="modal-close" id="versionCloseBtn">Ã—</button>
        </div>
        <div class="modal-body about-modal-body">
          <div class="about-info-grid">
            <div class="about-section">
              <div class="section-title">ðŸš€ What's New</div>
              <ul id="versionChanges" class="changelog-list"></ul>
            </div>

            <div class="about-section">
              <div class="section-title">ðŸ—ºï¸ Development Roadmap</div>
              <ul id="versionRoadmapList" class="changelog-list"></ul>
            </div>
          </div>

          <div class="about-section">
            <div class="section-title">ðŸ“„ Resources &amp; Links</div>
            <div class="resources-grid">
              <a class="resource-btn" href="sample.csv" download="sample.csv">
                ðŸ“„ Download Sample Data
              </a>
              <a
                class="resource-btn"
                href="https://github.com/lbruton/StackTrackr"
                target="_blank"
                rel="noopener"
              >
                ðŸ“ View Source Code
              </a>
              <button class="resource-btn" id="versionShowChangelogBtn">ðŸ“œ View Full Changelog</button>
            </div>
          </div>

          <div class="alert-actions">
            <button class="btn btn-primary" id="versionAcceptBtn">Accept and continue</button>
          </div>
        </div>
      </div>
    </div>
    <!-- =============================================================================
       ============================================================================= -->

    <!-- =============================================================================
       UNIFIED SETTINGS MODAL
       Consolidates API, Files, and Appearance into a single sidebar-navigated modal.
       Sub-modals (apiInfoModal, apiHistoryModal, catalogHistoryModal, apiQuotaModal)
       remain as stacking overlays.
       ============================================================================= -->
    <div class="modal" id="settingsModal" style="display: none">
      <div class="modal-content settings-modal-content">
        <div class="modal-header">
          <h2>Settings</h2>
          <button aria-label="Close modal" class="modal-close" id="settingsCloseBtn">&times;</button>
        </div>
        <div class="settings-modal-layout">
          <!-- Sidebar Navigation -->
          <nav class="settings-sidebar">
            <button class="settings-nav-item active" data-section="site">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="13.5" cy="6.5" r="2.5"/><circle cx="19" cy="13" r="2.5"/><circle cx="16" cy="20" r="2.5"/><circle cx="7" cy="20" r="2.5"/><circle cx="4" cy="13" r="2.5"/><circle cx="12" cy="13" r="3"/></svg>
              Theme
            </button>
            <button class="settings-nav-item" data-section="table">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2"/><line x1="3" y1="9" x2="21" y2="9"/><line x1="3" y1="15" x2="21" y2="15"/><line x1="9" y1="3" x2="9" y2="21"/></svg>
              Table
            </button>
            <button class="settings-nav-item" data-section="grouping">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/></svg>
              Chips
            </button>
            <button class="settings-nav-item" data-section="api">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2v4m0 12v4M4.93 4.93l2.83 2.83m8.48 8.48l2.83 2.83M2 12h4m12 0h4M4.93 19.07l2.83-2.83m8.48-8.48l2.83-2.83"/></svg>
              API
            </button>
            <button class="settings-nav-item" data-section="files">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
              Files
            </button>
            <button class="settings-nav-item" data-section="cloud">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z"/></svg>
              Cloud
            </button>
            <button class="settings-nav-item" data-section="tools">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/></svg>
              Tools
            </button>
            <button class="settings-nav-item" data-section="changelog">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 8v4l3 3"/><circle cx="12" cy="12" r="10"/></svg>
              Log
            </button>
          </nav>

          <!-- Content Area -->
          <div class="settings-content-area">

            <!-- ===== THEME SETTINGS ===== -->
            <div class="settings-section-panel" id="settingsPanel_site" style="display: block">
              <h3>Theme</h3>

              <div class="settings-group">
                <div class="settings-group-label">Color scheme</div>
                <div class="theme-picker">
                  <button class="theme-option" data-theme="light" title="Light">&#9728;&#65039; Light</button>
                  <button class="theme-option" data-theme="dark" title="Dark">&#127769; Dark</button>
                  <button class="theme-option" data-theme="sepia" title="Sepia">&#128220; Sepia</button>
                </div>
              </div>

              <div class="settings-placeholder" style="margin-top: 1.5rem;">
                <svg width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" style="opacity:0.3"><circle cx="13.5" cy="6.5" r="2.5"/><circle cx="19" cy="13" r="2.5"/><circle cx="16" cy="20" r="2.5"/><circle cx="7" cy="20" r="2.5"/><circle cx="4" cy="13" r="2.5"/><circle cx="12" cy="13" r="3"/></svg>
                <p>Custom themes coming soon.</p>
              </div>

            </div>

            <!-- ===== TABLE SETTINGS ===== -->
            <div class="settings-section-panel" id="settingsPanel_table" style="display: none">
              <h3>Table Display</h3>

              <div class="settings-group">
                <div class="settings-group-label">Visible rows</div>
                <select id="settingsItemsPerPage">
                  <option value="10">10</option>
                  <option value="15">15</option>
                  <option value="25">25</option>
                  <option value="50">50</option>
                  <option value="100">100</option>
                </select>
              </div>

              <div class="settings-group">
                <div class="settings-group-label">Inline Name chips</div>
                <p class="settings-subtext">Choose which badges appear next to item names in the table.</p>
                <div class="chip-grouping-table-container" id="inlineChipConfigContainer">
                  <div class="chip-grouping-empty">Loading...</div>
                </div>
              </div>
            </div>

            <!-- ===== CHIPS ===== -->
            <div class="settings-section-panel" id="settingsPanel_grouping" style="display: none">
              <h3>Filter Chips</h3>

              <div class="settings-group">
                <div class="settings-group-label">Filter chip threshold</div>
                <p class="settings-subtext">Minimum item count for a filter chip to appear.</p>
                <select id="settingsChipMinCount">
                  <option value="2">2+</option>
                  <option value="3">3+</option>
                  <option value="5">5+</option>
                  <option value="10">10+</option>
                  <option value="100">100+ (off)</option>
                </select>
              </div>

              <div class="settings-group">
                <div class="settings-group-label">Smart name grouping</div>
                <p class="settings-subtext">Group item names by base name (e.g., "American Silver Eagle (3)").</p>
                <div class="chip-sort-toggle" id="settingsGroupNameChips">
                  <button type="button" class="chip-sort-btn active" data-val="yes">On</button>
                  <button type="button" class="chip-sort-btn" data-val="no">Off</button>
                </div>
              </div>

              <div class="settings-group">
                <div class="settings-group-label">Dynamic name chips</div>
                <p class="settings-subtext">Auto-extract text from parentheses and quotes in item names as additional filter chips.</p>
                <select id="settingsDynamicChips">
                  <option value="yes">Enabled</option>
                  <option value="no">Disabled</option>
                </select>
              </div>

              <div class="settings-group">
                <div class="settings-group-label">Filter chip categories</div>
                <p class="settings-subtext">Enable, disable, and reorder chip categories. Assign the same Group letter to merge categories so their chips sort together.</p>
                <div class="chip-grouping-table-container" id="filterChipCategoryContainer">
                  <div class="chip-grouping-empty">Loadingâ€¦</div>
                </div>
              </div>

              <div class="settings-group">
                <div class="settings-group-label">Chip sort order</div>
                <p class="settings-subtext">Sort chips within each category by name or quantity.</p>
                <div class="chip-sort-toggle" id="settingsChipSortOrder">
                  <button type="button" class="chip-sort-btn active" data-sort="alpha">A-Z</button>
                  <button type="button" class="chip-sort-btn" data-sort="count">Qty</button>
                </div>
              </div>

              <div class="settings-group">
                <div class="settings-group-label">Chip blacklist</div>
                <p class="settings-subtext">Suppressed auto-generated chips. Right-click any name chip to add it here.</p>
                <div class="chip-grouping-controls">
                  <select id="blacklistInput" class="chip-grouping-input">
                    <option value="">Select a chip to suppressâ€¦</option>
                  </select>
                  <button type="button" class="btn" id="addBlacklistBtn">Add</button>
                </div>
                <div class="chip-grouping-table-container" id="blacklistTableContainer">
                  <div class="chip-grouping-empty">No blacklisted chips</div>
                </div>
              </div>

              <div class="settings-group">
                <div class="settings-group-label">Custom grouping rules</div>
                <p class="settings-subtext">Define chip labels with comma or semicolon-separated name patterns.</p>
                <div class="chip-grouping-controls">
                  <input type="text" id="customGroupLabelInput" class="chip-grouping-input" placeholder="Chip label">
                  <input type="text" id="customGroupPatternsInput" class="chip-grouping-input-wide" placeholder="Patterns (comma-separated)">
                  <button type="button" class="btn" id="addCustomGroupBtn">Add Rule</button>
                </div>
                <div class="chip-grouping-table-container" id="customGroupTableContainer">
                  <div class="chip-grouping-empty">No custom grouping rules</div>
                </div>
              </div>
            </div>

            <!-- ===== API ===== -->
            <div class="settings-section-panel" id="settingsPanel_api" style="display: none">
              <h3>API Configuration</h3>

              <div class="settings-actions">
                <button type="button" class="btn success" id="syncAllBtn">Sync Metals</button>
                <button type="button" class="btn danger" id="flushCacheBtn">Flush Metals Cache</button>
                <button type="button" class="btn" id="apiHistoryBtn">Metals History</button>
                <button type="button" class="btn" id="catalogHistoryBtn">Numista History</button>
              </div>

              <div class="api-header-status-row" id="apiHeaderStatusRow"></div>

              <!-- Provider Tabs â€” Numista pinned, metals draggable -->
              <div class="settings-provider-tabs">
                <button class="settings-provider-tab pinned active" data-provider="NUMISTA">Numista</button>
                <button class="settings-provider-tab" data-provider="METALS_DEV" draggable="true">Metals.dev</button>
                <button class="settings-provider-tab" data-provider="METALS_API" draggable="true">Metals-API</button>
                <button class="settings-provider-tab" data-provider="METAL_PRICE_API" draggable="true">MetalPriceAPI</button>
                <button class="settings-provider-tab" data-provider="CUSTOM" draggable="true">Custom Spot API</button>
              </div>

              <!-- Numista Provider Panel -->
              <div class="settings-provider-panel" id="providerPanel_NUMISTA" style="display: block">
                <div class="api-provider" data-provider="NUMISTA">
                  <div class="provider-header">
                    <span class="provider-name">Numista Catalog API</span>
                  </div>
                  <div class="api-key-row">
                    <label for="numistaApiKey">API Key:</label>
                    <input type="password" id="numistaApiKey" placeholder="Enter your Numista API key" />
                  </div>
                  <div class="api-key-note">
                    <p>Get a free API key at <a href="https://en.numista.com/api/" target="_blank" rel="noopener">numista.com/api</a> (2,000 requests/month free tier). Your key is stored locally in your browser.</p>
                  </div>
                  <div id="numistaUsageBar" class="api-usage" style="margin-top: 0.75rem;"></div>
                  <div class="provider-info">
                    <div class="provider-status" id="numistaProviderStatus"><span class="status-dot"></span><span class="status-text">Disconnected</span></div>
                  </div>
                  <div class="provider-footer">
                    <div class="provider-actions">
                      <button class="btn api-save-btn success" id="saveNumistaBtn" data-provider="NUMISTA">Save Key</button>
                      <button class="btn api-sync-btn info" id="testNumistaBtn" data-provider="NUMISTA">Test Connection</button>
                      <button class="btn api-clear-btn warning" id="clearNumistaBtn" data-provider="NUMISTA">Clear Key</button>
                    </div>
                  </div>
                  <div id="numistaStatus" class="api-status" style="margin-top: 0.5rem;"></div>
                </div>
              </div>

              <!-- Metals.dev Provider Panel -->
              <div class="settings-provider-panel" id="providerPanel_METALS_DEV" style="display: none">
                <div class="api-provider" data-provider="METALS_DEV">
                  <div class="provider-header">
                    <span class="provider-name">Metals.dev</span>
                  </div>
                  <div class="api-key-row">
                    <label for="apiKey_METALS_DEV">API Key:</label>
                    <input type="password" id="apiKey_METALS_DEV" placeholder="Enter your API key" />
                  </div>
                  <div class="provider-settings">
                    <h4>Provider Settings</h4>
                    <div class="provider-setting-row">
                      <label for="cacheTimeout_METALS_DEV">Cache Timeout:</label>
                      <select id="cacheTimeout_METALS_DEV" class="provider-cache-select">
                        <option value="0">No Cache</option>
                        <option value="1">1 hour</option>
                        <option value="6">6 hours</option>
                        <option value="12">12 hours</option>
                        <option value="24" selected>24 hours</option>
                      </select>
                    </div>
                    <div class="provider-setting-row">
                      <label for="historyDays_METALS_DEV">History Days:</label>
                      <input type="number" id="historyDays_METALS_DEV" class="provider-history-input" min="1" max="30" value="29" placeholder="1-30">
                    </div>
                    <div class="provider-setting-row">
                      <label for="historyTimes_METALS_DEV">Times per Day:</label>
                      <input type="text" id="historyTimes_METALS_DEV" class="provider-history-input" placeholder="08:00,20:00">
                    </div>
                    <div class="metal-selection">
                      <label>Select Metals to Track:</label>
                      <div class="metal-checkboxes">
                        <label class="metal-checkbox"><input type="checkbox" class="provider-metal" data-provider="METALS_DEV" data-metal="silver" checked><span class="metal-name">Silver (AG)</span></label>
                        <label class="metal-checkbox"><input type="checkbox" class="provider-metal" data-provider="METALS_DEV" data-metal="gold" checked><span class="metal-name">Gold (AU)</span></label>
                        <label class="metal-checkbox"><input type="checkbox" class="provider-metal" data-provider="METALS_DEV" data-metal="platinum" checked><span class="metal-name">Platinum (PT)</span></label>
                        <label class="metal-checkbox"><input type="checkbox" class="provider-metal" data-provider="METALS_DEV" data-metal="palladium" checked><span class="metal-name">Palladium (PD)</span></label>
                      </div>
                    </div>
                    <div class="provider-info">
                      <div class="api-key-note">Your API key is stored locally and never shared.</div>
                      <div class="provider-status"><span class="status-dot"></span><span class="status-text">Disconnected</span><span class="status-last-used"></span></div>
                      <div class="provider-history"></div>
                    </div>
                  </div>
                  <div class="provider-footer">
                    <div class="provider-actions">
                      <button type="button" class="btn api-save-btn" data-provider="METALS_DEV">Save</button>
                      <button type="button" class="btn api-sync-btn success" data-provider="METALS_DEV">Save and Test</button>
                      <button type="button" class="btn api-clear-btn warning" data-provider="METALS_DEV">Clear Key</button>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Metals-API Provider Panel -->
              <div class="settings-provider-panel" id="providerPanel_METALS_API" style="display: none">
                <div class="api-provider" data-provider="METALS_API">
                  <div class="provider-header">
                    <span class="provider-name">Metals-API.com</span>
                  </div>
                  <div class="api-key-row">
                    <label for="apiKey_METALS_API">API Key:</label>
                    <input type="password" id="apiKey_METALS_API" placeholder="Enter your API key" />
                  </div>
                  <div class="provider-settings">
                    <h4>Provider Settings</h4>
                    <div class="provider-setting-row">
                      <label for="cacheTimeout_METALS_API">Cache Timeout:</label>
                      <select id="cacheTimeout_METALS_API" class="provider-cache-select">
                        <option value="0">No Cache</option>
                        <option value="1">1 hour</option>
                        <option value="6">6 hours</option>
                        <option value="12">12 hours</option>
                        <option value="24" selected>24 hours</option>
                      </select>
                    </div>
                    <div class="provider-setting-row">
                      <label for="historyDays_METALS_API">History Days:</label>
                      <input type="number" id="historyDays_METALS_API" class="provider-history-input" min="1" max="365" value="30" placeholder="1-365">
                    </div>
                    <div class="provider-setting-row">
                      <label for="historyTimes_METALS_API">Times per Day:</label>
                      <input type="text" id="historyTimes_METALS_API" class="provider-history-input" placeholder="08:00,20:00">
                    </div>
                    <div class="metal-selection">
                      <label>Select Metals to Track:</label>
                      <div class="metal-checkboxes">
                        <label class="metal-checkbox"><input type="checkbox" class="provider-metal" data-provider="METALS_API" data-metal="silver" checked><span class="metal-name">Silver (AG)</span></label>
                        <label class="metal-checkbox"><input type="checkbox" class="provider-metal" data-provider="METALS_API" data-metal="gold" checked><span class="metal-name">Gold (AU)</span></label>
                        <label class="metal-checkbox"><input type="checkbox" class="provider-metal" data-provider="METALS_API" data-metal="platinum" checked><span class="metal-name">Platinum (PT)</span></label>
                        <label class="metal-checkbox"><input type="checkbox" class="provider-metal" data-provider="METALS_API" data-metal="palladium" checked><span class="metal-name">Palladium (PD)</span></label>
                      </div>
                    </div>
                    <div class="provider-info">
                      <div class="api-key-note">Your API key is stored locally and never shared.</div>
                      <div class="provider-status"><span class="status-dot"></span><span class="status-text">Disconnected</span><span class="status-last-used"></span></div>
                      <div class="provider-history"></div>
                    </div>
                  </div>
                  <div class="provider-footer">
                    <div class="provider-actions">
                      <button type="button" class="btn api-save-btn" data-provider="METALS_API">Save</button>
                      <button type="button" class="btn api-sync-btn success" data-provider="METALS_API">Save and Test</button>
                      <button type="button" class="btn api-clear-btn warning" data-provider="METALS_API">Clear Key</button>
                    </div>
                  </div>
                </div>
              </div>

              <!-- MetalPriceAPI Provider Panel -->
              <div class="settings-provider-panel" id="providerPanel_METAL_PRICE_API" style="display: none">
                <div class="api-provider" data-provider="METAL_PRICE_API">
                  <div class="provider-header">
                    <span class="provider-name">MetalPriceAPI.com</span>
                  </div>
                  <div class="api-key-row">
                    <label for="apiKey_METAL_PRICE_API">API Key:</label>
                    <input type="password" id="apiKey_METAL_PRICE_API" placeholder="Enter your API key" />
                  </div>
                  <div class="provider-settings">
                    <h4>Provider Settings</h4>
                    <div class="provider-setting-row">
                      <label for="cacheTimeout_METAL_PRICE_API">Cache Timeout:</label>
                      <select id="cacheTimeout_METAL_PRICE_API" class="provider-cache-select">
                        <option value="0">No Cache</option>
                        <option value="1">1 hour</option>
                        <option value="6">6 hours</option>
                        <option value="12">12 hours</option>
                        <option value="24" selected>24 hours</option>
                      </select>
                    </div>
                    <div class="provider-setting-row">
                      <label for="historyDays_METAL_PRICE_API">History Days:</label>
                      <input type="number" id="historyDays_METAL_PRICE_API" class="provider-history-input" min="1" max="365" value="30" placeholder="1-365">
                    </div>
                    <div class="provider-setting-row">
                      <label for="historyTimes_METAL_PRICE_API">Times per Day:</label>
                      <input type="text" id="historyTimes_METAL_PRICE_API" class="provider-history-input" placeholder="08:00,20:00">
                    </div>
                    <div class="metal-selection">
                      <label>Select Metals to Track:</label>
                      <div class="metal-checkboxes">
                        <label class="metal-checkbox"><input type="checkbox" class="provider-metal" data-provider="METAL_PRICE_API" data-metal="silver" checked><span class="metal-name">Silver (AG)</span></label>
                        <label class="metal-checkbox"><input type="checkbox" class="provider-metal" data-provider="METAL_PRICE_API" data-metal="gold" checked><span class="metal-name">Gold (AU)</span></label>
                        <label class="metal-checkbox"><input type="checkbox" class="provider-metal" data-provider="METAL_PRICE_API" data-metal="platinum" checked><span class="metal-name">Platinum (PT)</span></label>
                        <label class="metal-checkbox"><input type="checkbox" class="provider-metal" data-provider="METAL_PRICE_API" data-metal="palladium" checked><span class="metal-name">Palladium (PD)</span></label>
                      </div>
                    </div>
                    <div class="provider-info">
                      <div class="api-key-note">Your API key is stored locally and never shared.</div>
                      <div class="provider-status"><span class="status-dot"></span><span class="status-text">Disconnected</span><span class="status-last-used"></span></div>
                      <div class="provider-history"></div>
                    </div>
                  </div>
                  <div class="provider-footer">
                    <div class="provider-actions">
                      <button type="button" class="btn api-save-btn" data-provider="METAL_PRICE_API">Save</button>
                      <button type="button" class="btn api-sync-btn success" data-provider="METAL_PRICE_API">Save and Test</button>
                      <button type="button" class="btn api-clear-btn warning" data-provider="METAL_PRICE_API">Clear Key</button>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Custom Spot API Provider Panel -->
              <div class="settings-provider-panel" id="providerPanel_CUSTOM" style="display: none">
                <div class="api-provider" data-provider="CUSTOM">
                  <div class="provider-header">
                    <span class="provider-name">Custom Spot API</span>
                  </div>
                  <div class="api-field-row">
                    <label for="apiBase_CUSTOM">Base URL:</label>
                    <input type="text" id="apiBase_CUSTOM" placeholder="https://api.example.com" />
                  </div>
                  <div class="api-field-row">
                    <label for="apiEndpoint_CUSTOM">Endpoint:</label>
                    <input type="text" id="apiEndpoint_CUSTOM" placeholder="/latest?key={API_KEY}&metal={METAL}" />
                  </div>
                  <div class="api-field-row">
                    <label for="apiFormat_CUSTOM">Metal Format:</label>
                    <select id="apiFormat_CUSTOM">
                      <option value="symbol">Symbol</option>
                      <option value="word">Word</option>
                    </select>
                  </div>
                  <div class="api-key-row">
                    <label for="apiKey_CUSTOM">API Key:</label>
                    <input type="password" id="apiKey_CUSTOM" placeholder="Enter your API key" />
                  </div>
                  <div class="provider-settings">
                    <h4>Provider Settings</h4>
                    <div class="provider-setting-row">
                      <label for="cacheTimeout_CUSTOM">Cache Timeout:</label>
                      <select id="cacheTimeout_CUSTOM" class="provider-cache-select">
                        <option value="0">No Cache</option>
                        <option value="1">1 hour</option>
                        <option value="6">6 hours</option>
                        <option value="12">12 hours</option>
                        <option value="24" selected>24 hours</option>
                      </select>
                    </div>
                    <div class="provider-setting-row">
                      <label for="historyDays_CUSTOM">History Days:</label>
                      <input type="number" id="historyDays_CUSTOM" class="provider-history-input" min="1" max="365" value="30" placeholder="1-365">
                    </div>
                    <div class="provider-setting-row">
                      <label for="historyTimes_CUSTOM">Times per Day:</label>
                      <input type="text" id="historyTimes_CUSTOM" class="provider-history-input" placeholder="08:00,20:00">
                    </div>
                    <div class="metal-selection">
                      <label>Select Metals to Track:</label>
                      <div class="metal-checkboxes">
                        <label class="metal-checkbox"><input type="checkbox" class="provider-metal" data-provider="CUSTOM" data-metal="silver" checked><span class="metal-name">Silver (AG)</span></label>
                        <label class="metal-checkbox"><input type="checkbox" class="provider-metal" data-provider="CUSTOM" data-metal="gold" checked><span class="metal-name">Gold (AU)</span></label>
                        <label class="metal-checkbox"><input type="checkbox" class="provider-metal" data-provider="CUSTOM" data-metal="platinum" checked><span class="metal-name">Platinum (PT)</span></label>
                        <label class="metal-checkbox"><input type="checkbox" class="provider-metal" data-provider="CUSTOM" data-metal="palladium" checked><span class="metal-name">Palladium (PD)</span></label>
                      </div>
                    </div>
                    <div class="provider-info">
                      <div class="api-key-note">Your API key is stored locally and never shared.</div>
                      <div class="provider-status"><span class="status-dot"></span><span class="status-text">Disconnected</span><span class="status-last-used"></span></div>
                      <div class="provider-history"></div>
                    </div>
                  </div>
                  <div class="provider-footer">
                    <div class="provider-actions">
                      <button type="button" class="btn api-save-btn" data-provider="CUSTOM">Save</button>
                      <button type="button" class="btn api-sync-btn success" data-provider="CUSTOM">Save and Test</button>
                      <button type="button" class="btn api-clear-btn warning" data-provider="CUSTOM">Clear Key</button>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- ===== FILES ===== -->
            <div class="settings-section-panel" id="settingsPanel_files" style="display: none">
              <h3>Files</h3>
              <div class="settings-card-grid">
                <div class="settings-card">
                  <h3>Import</h3>
                  <p class="settings-subtext">Import your data files.</p>
                  <div class="import-block">
                    <div class="import-export-grid">
                      <div class="import-csv-grid">
                        <button class="btn warning" id="importCsvOverride">Import CSV</button>
                        <button class="btn success" id="importCsvMerge">Merge CSV</button>
                        <input accept=".csv" hidden id="importCsvFile" type="file" />
                      </div>
                      <div class="import-json-grid">
                        <button class="btn warning" id="importJsonOverride">Import JSON</button>
                        <button class="btn success" id="importJsonMerge">Merge JSON</button>
                        <input accept=".json" hidden id="importJsonFile" type="file" />
                      </div>
                    </div>
                    <progress class="import-progress" id="importProgress" value="0" max="0"></progress>
                    <div class="import-progress-text" id="importProgressText"></div>
                  </div>
                </div>
                <div class="settings-card">
                  <h3>Export</h3>
                  <p class="settings-subtext">Export your data files.</p>
                  <div class="export-block">
                    <div class="import-export-grid">
                      <button class="btn info" id="exportCsvBtn">Export CSV</button>
                      <button class="btn info" id="exportJsonBtn">Export JSON</button>
                      <button class="btn info" id="exportPdfBtn">Export PDF</button>
                    </div>
                  </div>
                </div>
                <div class="settings-card">
                  <h3>Third-Party</h3>
                  <p class="settings-subtext">Import data from external services like Numista.</p>
                  <div class="third-party-block">
                    <div class="import-export-grid">
                      <div class="grid grid-2">
                        <button class="btn warning" id="importNumistaBtn">Import Numista CSV</button>
                        <button class="btn success" id="mergeNumistaBtn">Merge Numista CSV</button>
                      </div>
                      <input type="file" id="numistaImportFile" accept=".csv" hidden />
                      <div class="beta-warning">Numista import is a beta feature</div>
                    </div>
                  </div>
                </div>
                <div class="settings-card boating-accident-section">
                  <h3>Backup, Restore, Clear</h3>
                  <p class="settings-subtext">Manage local application data.</p>
                  <div class="backup-buttons">
                    <button class="btn" id="vaultExportBtn">Export Encrypted Backup</button>
                    <button class="btn info" id="vaultImportBtn">Import Encrypted Backup</button>
                    <input type="file" id="vaultImportFile" accept=".stvault" hidden />
                    <hr class="vault-separator" />
                    <button class="btn warning" id="removeInventoryDataBtn">Remove Inventory Data</button>
                    <button class="btn danger" id="boatingAccidentBtn">Wipe All Data</button>
                  </div>
                </div>
              </div>
            </div>

            <!-- ===== CLOUD SYNC (placeholder) ===== -->
            <div class="settings-section-panel" id="settingsPanel_cloud" style="display: none">
              <h3>Cloud Sync</h3>
              <div class="settings-placeholder">
                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" style="opacity:0.3"><path d="M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z"/></svg>
                <p>BYO-Backend (Supabase) coming soon.</p>
              </div>
            </div>

            <!-- ===== TOOLS (placeholder) ===== -->
            <div class="settings-section-panel" id="settingsPanel_tools" style="display: none">
              <h3>Tools</h3>
              <div class="settings-group">
                <label>Bulk Edit</label>
                <p class="settings-subtext">Select multiple items and edit fields, copy, or delete in bulk.</p>
                <button class="btn btn-primary" id="bulkEditBtn" type="button">Open Bulk Edit</button>
              </div>
            </div>

            <!-- ===== CHANGE LOG ===== -->
            <div class="settings-section-panel" id="settingsPanel_changelog" style="display: none">
              <h3>Change Log</h3>
              <p class="settings-subtext">Recent inventory changes. Click a row to edit the item, or undo/redo individual changes.</p>
              <div class="settings-changelog-actions">
                <button class="btn btn-secondary" id="settingsChangeLogClearBtn" type="button">Clear Log</button>
              </div>
              <div class="settings-changelog-wrap">
                <table id="settingsChangeLogTable">
                  <thead>
                    <tr>
                      <th>Date</th>
                      <th>Item</th>
                      <th>Field</th>
                      <th>Old Value</th>
                      <th>New Value</th>
                      <th>Undo</th>
                    </tr>
                  </thead>
                  <tbody></tbody>
                </table>
              </div>
            </div>

          </div><!-- .settings-content-area -->
        </div><!-- .settings-modal-layout -->
        <div class="settings-footer" id="settingsFooter"></div>
      </div><!-- .settings-modal-content -->
    </div><!-- #settingsModal -->

    <div class="modal" id="cloudSyncModal" style="display: none">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Cloud Sync</h2>
          <button
            aria-label="Close modal"
            class="modal-close"
            id="cloudSyncCloseBtn"
          >
            Ã—
          </button>
        </div>
        <div class="modal-body">
          â˜ï¸ Feature coming soon â˜ï¸
        </div>
      </div>
    </div>

    <!-- Vault Encrypted Backup Modal -->
    <div class="modal" id="vaultModal" style="display: none">
      <div class="modal-content">
        <div class="modal-header">
          <h2 id="vaultModalTitle">Encrypted Backup</h2>
          <button
            aria-label="Close modal"
            class="modal-close"
            id="vaultCloseBtn"
            onclick="closeVaultModal()"
          >
            &times;
          </button>
        </div>
        <div class="modal-body">
          <div class="encryption-info">
            <strong>Included:</strong> All inventory data, settings, API keys, and price history.
          </div>

          <div id="vaultFileInfo" class="encryption-info" style="display: none">
            <strong>File:</strong> <span id="vaultFileName"></span>
            (<span id="vaultFileSize"></span>)
          </div>

          <div class="form-row">
            <label for="vaultPassword">Password</label>
            <div class="password-input-group">
              <input
                type="password"
                id="vaultPassword"
                placeholder="Minimum 8 characters"
                autocomplete="off"
              />
              <button
                type="button"
                class="password-toggle"
                id="vaultPasswordToggle"
                title="Show/hide password"
                onclick="toggleVaultPasswordVisibility('vaultPassword', this)"
              >&#9678;</button>
            </div>
          </div>

          <div id="vaultStrengthRow">
            <div class="strength-bar">
              <div class="strength-fill" id="vaultStrengthFill"></div>
            </div>
            <div class="strength-text" id="vaultStrengthText"></div>
          </div>

          <div class="form-row" id="vaultConfirmRow">
            <label for="vaultConfirmPassword">Confirm Password</label>
            <div class="password-input-group">
              <input
                type="password"
                id="vaultConfirmPassword"
                placeholder="Re-enter password"
                autocomplete="off"
              />
              <button
                type="button"
                class="password-toggle"
                id="vaultConfirmToggle"
                title="Show/hide password"
                onclick="toggleVaultPasswordVisibility('vaultConfirmPassword', this)"
              >&#9678;</button>
            </div>
            <div class="password-match" id="vaultMatchIndicator"></div>
          </div>

          <div id="vaultStatus" class="encryption-status" style="display: none"></div>

          <div class="encryption-warning">
            <strong>Warning:</strong> If you forget this password, your backup cannot be recovered.
          </div>

          <div class="encryption-actions">
            <button class="btn" id="vaultActionBtn" onclick="handleVaultAction()">Export</button>
            <button class="btn warning" onclick="closeVaultModal()">Cancel</button>
          </div>
        </div>
      </div>
    </div>

    <div class="modal" id="apiQuotaModal" style="display: none">
      <div class="modal-content">
        <div class="modal-header">
          <h2>API Quota</h2>
          <button
            aria-label="Close modal"
            class="modal-close"
            id="apiQuotaCloseBtn"
          >
            Ã—
          </button>
        </div>
        <div class="modal-body" style="text-align: center">
          <label for="apiQuotaInput">Monthly quota:</label>
          <input type="number" id="apiQuotaInput" min="1" />
          <div style="margin-top: 1rem">
            <button class="btn" id="apiQuotaSaveBtn">Save</button>
          </div>
        </div>
      </div>
    </div>

    <div class="modal" id="apiInfoModal" style="display: none">
      <div class="modal-content">
        <div class="modal-header">
          <h3 id="apiInfoTitle">Provider Information</h3>
          <button aria-label="Close modal" class="modal-close" id="apiInfoCloseBtn">Ã—</button>
        </div>
        <div class="modal-body">
          <div id="apiInfoBody" class="api-info-body"></div>
        </div>
      </div>
    </div>
    <div class="modal" id="apiHistoryModal" style="display: none">
      <div class="modal-content">
        <div class="modal-header">
          <h2>API Price History</h2>
          <button
            aria-label="Close modal"
            class="modal-close"
            id="apiHistoryCloseBtn"
          >
            Ã—
          </button>
        </div>
        <div class="modal-body">
          <div class="api-history-body">
            <div class="api-history-table">
              <div class="api-history-filter">
                <input
                  type="text"
                  id="apiHistoryFilter"
                  placeholder="Filter history..."
                />
                <button
                  type="button"
                  class="btn secondary"
                  id="apiHistoryClearFilterBtn"
                >
                  Clear
                </button>
              </div>
              <div class="api-history-table-wrapper">
                <table id="apiHistoryTable"></table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- =============================================================================
       CATALOG HISTORY MODAL

       Modal for viewing catalog API call history (Numista lookups, searches).
       Mirrors the apiHistoryModal structure with sortable/filterable table.
       ============================================================================= -->
    <div class="modal" id="catalogHistoryModal" style="display: none">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Catalog API History</h2>
          <button
            aria-label="Close modal"
            class="modal-close"
            id="catalogHistoryCloseBtn"
          >
            &times;
          </button>
        </div>
        <div class="modal-body">
          <div class="api-history-body">
            <div class="api-history-table">
              <div class="api-history-filter">
                <input
                  type="text"
                  id="catalogHistoryFilter"
                  placeholder="Filter history..."
                />
                <button
                  type="button"
                  class="btn secondary"
                  id="catalogHistoryClearFilterBtn"
                >
                  Clear
                </button>
              </div>
              <div class="api-history-table-wrapper">
                <table id="catalogHistoryTable"></table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Numista pages open in a popup window (X-Frame-Options blocks iframes) -->

    <!-- =============================================================================
       NUMISTA RESULTS MODAL

       Stacked modal (z-index 10000) that appears over the item Add/Edit form.
       Shows search results from Numista API and a field picker to fill form fields.
       ============================================================================= -->
    <div class="modal" id="numistaResultsModal" style="display: none">
      <div class="modal-content numista-results-modal-content">
        <div class="modal-header">
          <h2 id="numistaResultsTitle">Numista Results</h2>
          <button aria-label="Close modal" class="modal-close" id="numistaResultsCloseBtn">&times;</button>
        </div>
        <div class="modal-body">
          <!-- Search results list -->
          <div id="numistaResultsList" class="numista-results-list"></div>

          <!-- Field picker (hidden until a result is selected) -->
          <div id="numistaFieldPicker" class="numista-field-picker" style="display: none">
            <div id="numistaSelectedItem" class="numista-selected-preview"></div>
            <div id="numistaFieldCheckboxes" class="numista-field-checkboxes">
              <div class="numista-fields-heading">Fields to fill:</div>
              <!-- Populated dynamically with value previews by catalog-api.js -->
            </div>
            <div class="numista-fill-actions">
              <button class="btn" id="numistaFillCancelBtn" type="button">Cancel</button>
              <button class="btn premium" id="numistaFillBtn" type="button">Fill Fields</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- =============================================================================
       DEBUG LOG MODAL

       Displays collected debug output when debug mode is enabled.
       ============================================================================= -->
    <div class="modal" id="debugModal" style="display: none">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Debug Log</h2>
          <button aria-label="Close modal" class="modal-close" id="debugCloseBtn">Ã—</button>
        </div>
        <div class="modal-body">
          <pre id="debugModalContent"></pre>
        </div>
      </div>
    </div>

    <!-- =============================================================================
       BULK EDIT MODAL

       Full-screen modal for multi-item editing, copying, and deletion.
       ============================================================================= -->
    <div class="modal" id="bulkEditModal" style="display: none">
      <div class="modal-content bulk-edit-content">
        <div class="modal-header">
          <h2>Bulk Edit</h2>
          <button aria-label="Close modal" class="modal-close" id="bulkEditCloseBtn">&times;</button>
        </div>
        <div class="modal-body bulk-edit-body">
          <!-- Left: Field panel -->
          <div class="bulk-edit-fields" id="bulkEditFieldPanel"></div>
          <!-- Right: Item selection table -->
          <div class="bulk-edit-items">
            <div class="bulk-edit-toolbar" id="bulkEditToolbar"></div>
            <div class="bulk-edit-table-wrap" id="bulkEditTableWrap"></div>
          </div>
        </div>
        <div class="modal-footer bulk-edit-footer" id="bulkEditFooter"></div>
      </div>
    </div>

    <!-- =============================================================================
       JAVASCRIPT MODULE LOADING
       
       Modular architecture with proper dependency order:
       1. constants.js - Global configuration and version
       2. state.js - Application state and DOM element caching
       3. utils.js - Utility functions and formatters
       4. Feature modules - charts, theme, search, sorting, portal view, etc.
       5. Core modules - spot price management and inventory operations
       6. events.js - Event listener setup (requires all other modules)
       7. init.js - Application initialization and startup
       
       All scripts use 'defer' to ensure DOM is ready before execution
       External libraries (Chart.js, jsPDF, PapaParse, JSZip) loaded via CDN
       ============================================================================= -->

  <script defer src="js/debug-log.js"></script>
  <script defer src="./js/constants.js"></script>
  <script defer src="./js/state.js"></script>
  <script defer src="./js/utils.js"></script>
  <script defer src="./js/fuzzy-search.js"></script>
  <script defer src="./js/autocomplete.js"></script>
  <script defer src="./js/versionCheck.js"></script>
  <script defer src="./js/changeLog.js"></script>
    <script defer src="./js/charts.js"></script>
    <script defer src="./js/theme.js"></script>
    <script defer src="./js/search.js"></script>
    <script defer src="./js/chip-grouping.js"></script>
    <script defer src="./js/filters.js"></script>
    <script defer src="./js/sorting.js"></script>
    <script defer src="./js/pagination.js"></script>
    <script defer src="./js/detailsModal.js"></script>
    <script defer src="./js/debugModal.js"></script>
    <script defer src="./js/numista-modal.js"></script>
    <script defer src="./js/spot.js"></script>
    <script defer src="./js/api.js"></script>
    <script defer src="./js/catalog-api.js"></script>
    <script defer src="./js/catalog-providers.js"></script>
    <script defer src="./js/catalog-manager.js"></script>
    <script defer src="./js/inventory.js"></script>
    <script defer src="./js/vault.js"></script>
    <script defer src="./js/about.js"></script>
    <script defer src="./js/customMapping.js"></script>
    <script defer src="./js/settings.js"></script>
    <script defer src="./js/bulkEdit.js"></script>
    <script defer src="./js/events.js"></script>
    
    <!-- Test Scripts (Development) -->
    <script>
      if (window.location.hostname === 'localhost') {
        const testScript = document.createElement('script');
        testScript.defer = true;
        testScript.src = './tests/grouped-name-chips.test.js';
        document.head.appendChild(testScript);
      }
    </script>

    <script defer src="./js/init.js"></script>
  </body>
</html>
