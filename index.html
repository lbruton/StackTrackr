<!doctype html>
<!--
  StackTrackr - Main Application Interface
  
  A comprehensive client-side web application for tracking precious metal investments
  including silver, gold, platinum, and palladium. Features include spot price management,
  premium calculations, collectable item handling, and multi-format data import/export.
  
  All data is stored locally using localStorage - no server required.
  Application version is managed dynamically via constants.js
-->
<html lang="en">
  <head>
    <!--
    Content Security Policy is intentionally relaxed to ensure
    local file execution when opening this tool with the file:// protocol.
    The previous strict policy blocked external scripts and prevented
    the interface from rendering. The simplified policy below permits
    all sources while keeping inline execution restrictions.
  -->
    <meta
      http-equiv="Content-Security-Policy"
      content="default-src * 'unsafe-inline' 'unsafe-eval' data: blob:;"
    />
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1, minimum-scale=1, user-scalable=yes"
      name="viewport"
    />

    <!-- Title is dynamically updated by init.js using APP_VERSION constant -->
    <title>StackTrackr</title>
    <!-- FILE PROTOCOL COMPATIBILITY - MUST LOAD FIRST -->
    <script src="./js/file-protocol-fix.js"></script>

    <!-- External libraries for data import/export functionality -->
    <script
      defer=""
      src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"
    ></script>
    <script
      defer=""
      src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"
    ></script>
    <script
      defer=""
      src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"
    ></script>
    <script
      defer=""
      src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"
    ></script>
    <!-- Chart.js for pie charts -->
    <script
      defer=""
      src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"
    ></script>
    <!-- JSZip for backup functionality -->
    <script
      defer=""
      src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"
    ></script>

    <link rel="stylesheet" href="./css/styles.css" />
  </head>
  <body>
    <!-- Application Header -->
    <div class="app-header">
      <div class="app-title">
        <h1>StackTrackr</h1>
        <p class="app-subtitle">The open source precious metals tracking tool.</p>
      </div>
      <div style="margin-left: auto; display: flex; gap: 0.5rem">
        <button class="btn" id="aboutBtn" title="About" aria-label="About">
          About üìñ
        </button>
        <button class="btn" id="apiBtn" title="API" aria-label="API">
          API üîå
        </button>
        <a
          class="btn"
          id="communityBtn"
          href="https://www.reddit.com/r/stackrtrackr/"
          target="_blank"
          rel="noopener"
          title="Community"
          aria-label="Community"
        >
          <img
            src="https://www.redditstatic.com/desktop2x/img/favicon/favicon-32x32.png"
            alt=""
            style="height: 1em; width: 1em"
          />
          Community
        </a>
        <button class="btn" id="filesBtn" title="Files" aria-label="Files">
          Files üìÅ
        </button>
        <button
          class="btn theme-btn"
          id="appearanceBtn"
          title="Theme"
          aria-label="Theme"
        ></button>
      </div>
    </div>
    <div class="container">
      <!-- =============================================================================
         SPOT PRICES SECTION
         
         Displays current spot prices for all four supported metals and provides
         manual input controls for setting custom spot prices. Each metal has:
         - Display card showing current spot price
         - Input field for setting new spot price
         - Save and Reset buttons for price management
         
         Spot prices are used for premium calculations and profit/loss analysis
         ============================================================================= -->
      <section class="spot-prices">
        <div
          class="grid"
          style="
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 1rem;
          "
        >
          <!-- Silver spot price controls -->
          <div class="spot-input silver">
            <div class="spot-card">
              <div class="spot-card-label">Silver Spot Price</div>
              <div class="spot-card-value" id="spotPriceDisplaySilver">$ -</div>
              <div class="spot-card-timestamp" id="spotTimestampSilver">
                No data
              </div>
            </div>
            <div class="spot-actions">
              <button
                class="btn spot-action-btn"
                id="syncBtnSilver"
                title="Sync from API"
                disabled
              >
                Sync
              </button>
              <button
                class="btn spot-action-btn"
                id="addBtnSilver"
                title="Add/Override Price"
              >
                Add
              </button>
              <button
                class="btn spot-action-btn"
                id="resetBtnSilver"
                title="Reset to Default/API"
              >
                Reset
              </button>
            </div>
            <div
              class="manual-input"
              id="manualInputSilver"
              style="display: none"
            >
              <label for="userSpotPriceSilver">Manual Silver Price</label>
              <div class="currency-input">
                <input
                  id="userSpotPriceSilver"
                  min="0"
                  placeholder="Enter price"
                  step="0.01"
                  type="number"
                />
              </div>
              <div class="grid grid-2">
                <button class="btn" id="saveSpotBtnSilver">Save</button>
                <button class="btn" id="cancelSpotBtnSilver">Cancel</button>
              </div>
            </div>
          </div>
          <!-- Gold spot price controls -->
          <div class="spot-input gold">
            <div class="spot-card">
              <div class="spot-card-label">Gold Spot Price</div>
              <div class="spot-card-value" id="spotPriceDisplayGold">$ -</div>
              <div class="spot-card-timestamp" id="spotTimestampGold">
                No data
              </div>
            </div>
            <div class="spot-actions">
              <button
                class="btn spot-action-btn"
                id="syncBtnGold"
                title="Sync from API"
                disabled
              >
                Sync
              </button>
              <button
                class="btn spot-action-btn"
                id="addBtnGold"
                title="Add/Override Price"
              >
                Add
              </button>
              <button
                class="btn spot-action-btn"
                id="resetBtnGold"
                title="Reset to Default/API"
              >
                Reset
              </button>
            </div>
            <div
              class="manual-input"
              id="manualInputGold"
              style="display: none"
            >
              <label for="userSpotPriceGold">Manual Gold Price</label>
              <div class="currency-input">
                <input
                  id="userSpotPriceGold"
                  min="0"
                  placeholder="Enter price"
                  step="0.01"
                  type="number"
                />
              </div>
              <div class="grid grid-2">
                <button class="btn" id="saveSpotBtnGold">Save</button>
                <button class="btn" id="cancelSpotBtnGold">Cancel</button>
              </div>
            </div>
          </div>
          <!-- Platinum spot price controls -->
          <div class="spot-input platinum">
            <div class="spot-card">
              <div class="spot-card-label">Platinum Spot Price</div>
              <div class="spot-card-value" id="spotPriceDisplayPlatinum">
                $ -
              </div>
              <div class="spot-card-timestamp" id="spotTimestampPlatinum">
                No data
              </div>
            </div>
            <div class="spot-actions">
              <button
                class="btn spot-action-btn"
                id="syncBtnPlatinum"
                title="Sync from API"
                disabled
              >
                Sync
              </button>
              <button
                class="btn spot-action-btn"
                id="addBtnPlatinum"
                title="Add/Override Price"
              >
                Add
              </button>
              <button
                class="btn spot-action-btn"
                id="resetBtnPlatinum"
                title="Reset to Default/API"
              >
                Reset
              </button>
            </div>
            <div
              class="manual-input"
              id="manualInputPlatinum"
              style="display: none"
            >
              <label for="userSpotPricePlatinum">Manual Platinum Price</label>
              <div class="currency-input">
                <input
                  id="userSpotPricePlatinum"
                  min="0"
                  placeholder="Enter price"
                  step="0.01"
                  type="number"
                />
              </div>
              <div class="grid grid-2">
                <button class="btn" id="saveSpotBtnPlatinum">Save</button>
                <button class="btn" id="cancelSpotBtnPlatinum">Cancel</button>
              </div>
            </div>
          </div>
          <!-- Palladium spot price controls -->
          <div class="spot-input palladium">
            <div class="spot-card">
              <div class="spot-card-label">Palladium Spot Price</div>
              <div class="spot-card-value" id="spotPriceDisplayPalladium">
                $ -
              </div>
              <div class="spot-card-timestamp" id="spotTimestampPalladium">
                No data
              </div>
            </div>
            <div class="spot-actions">
              <button
                class="btn spot-action-btn"
                id="syncBtnPalladium"
                title="Sync from API"
                disabled
              >
                Sync
              </button>
              <button
                class="btn spot-action-btn"
                id="addBtnPalladium"
                title="Add/Override Price"
              >
                Add
              </button>
              <button
                class="btn spot-action-btn"
                id="resetBtnPalladium"
                title="Reset to Default/API"
              >
                Reset
              </button>
            </div>
            <div
              class="manual-input"
              id="manualInputPalladium"
              style="display: none"
            >
              <label for="userSpotPricePalladium">Manual Palladium Price</label>
              <div class="currency-input">
                <input
                  id="userSpotPricePalladium"
                  min="0"
                  placeholder="Enter price"
                  step="0.01"
                  type="number"
                />
              </div>
              <div class="grid grid-2">
                <button class="btn" id="saveSpotBtnPalladium">Save</button>
                <button class="btn" id="cancelSpotBtnPalladium">Cancel</button>
              </div>
            </div>
          </div>
        </div>
      </section><!-- =============================================================================
         INVENTORY FORM SECTION
         
         Primary data entry form for adding new inventory items. Includes fields for:
         - Metal type selection (Silver, Gold, Platinum, Palladium)
         - Item details (name, type, quantity, weight)
         - Purchase information (price, location, storage location, date)
         
         Form submission is handled by events.js with validation and automatic
         premium calculation based on current spot prices
         ============================================================================= -->
      <!--
        Legacy add item form - commented out pending removal after
        verifying new modal workflow.
      <section class="form-section">
        ...
      </section>
      -->
      <!-- =============================================================================
         INVENTORY

         Wrapper containing search and inventory table
         ============================================================================= -->
      <section class="inventory-section">
        <!-- =============================================================================
           SEARCH FUNCTIONALITY

           Live search interface that filters inventory table in real-time.
           Searches across all relevant fields including:
           - Metal type, name, type, purchase/storage locations, date
           - Quantity, weight, price values
           - Collectable status (yes/no)

           Search is case-insensitive and supports partial matches
           Implementation in search.js with filterInventory() function
           ============================================================================= -->
        <section class="search-section">
          <div class="search-container">
            <input
              id="searchInput"
              placeholder="Search inventory by metal, name, type, purchase location, storage location, notes, date..."
              type="text"
            />
            <button class="btn" id="clearSearchBtn">Clear</button>
            <button class="btn success" id="newItemBtn">New Item</button>
          </div>
          <div class="search-results-info" id="searchResultsInfo"></div>
        </section>
        <!-- =============================================================================
           INVENTORY TABLE SECTION

           Main data display table showing all inventory items with:
           - Sortable columns (click headers to sort ascending/descending)
           - Clickable item names for editing (opens edit modal)
           - Collectable status checkboxes for quick toggle
           - Delete buttons with confirmation
           - Responsive design with column resizing capability

        Table rendering handled by renderTable() in inventory.js
         Pagination controls limit display to selected items per page
         ============================================================================= -->
        <section class="table-section">
          <table id="inventoryTable">
          <thead>
            <tr>
              <th class="shrink" data-column="date">Date</th>
              <th class="shrink" data-column="type">Type</th>
              <th class="shrink" data-column="metal">Metal</th>
              <th class="expand" data-column="name">Name</th>
              <th class="shrink" data-column="qty">Qty</th>
              <th class="shrink" data-column="weight">Weight<br />(oz)</th>
              <th class="shrink" data-column="purchasePrice">Purchase<br />Price ($)</th>
              <th class="shrink" data-column="spot">Spot at<br />Purchase ($)</th>
              <th class="shrink" data-column="premium">Premium<br />($)</th>
              <th class="shrink" data-column="purchaseLocation">Purchase<br />Location</th>
              <th class="shrink" data-column="storageLocation">Storage<br />Location</th>
              <th class="shrink" data-column="collectable">Collectable</th>
              <th class="shrink" data-column="notes">Notes</th>
              <th class="shrink" data-column="delete">Delete</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
          <div class="table-controls">
            <span id="changeLogBtn" class="change-log-label">Change Log</span>
            <span class="table-disclaimer"
              >All data is stored locally. Back up often.</span
            >
            <div class="items-per-page">
              <span class="items-label">Items:</span>
              <select class="pagination-select" id="itemsPerPage">
                <option selected value="10">10</option>
                <option value="15">15</option>
                <option value="25">25</option>
                <option value="50">50</option>
                <option value="100">100</option>
              </select>
            </div>
          </div>
        <!-- Pagination Controls -->
        <section class="pagination-section">
          <div class="pagination-container">
            <div class="pagination-controls">
              <div class="pagination-buttons">
                <div class="pagination-left">
                  <button
                    class="pagination-btn"
                    id="firstPage"
                    title="First Page"
                  >
                    ¬´
                  </button>
                  <button
                    class="pagination-btn"
                    id="prevPage"
                    title="Previous Page"
                  >
                    ‚Äπ
                  </button>
                </div>
                <div class="pagination-center" id="pageNumbers"></div>
                <div class="pagination-right">
                  <button class="pagination-btn" id="nextPage" title="Next Page">
                    ‚Ä∫
                  </button>
                  <button class="pagination-btn" id="lastPage" title="Last Page">
                    ¬ª
                  </button>
                </div>
              </div>
            </div>
          </div>
        </section>
      </section>
      </section>
      <!-- =============================================================================
         TOTALS SECTION

         Comprehensive financial summary cards for each metal type showing:
         - Total items and weight in inventory
         - Purchase price vs current value calculations
         - Average prices (overall, collectable, non-collectable)
         - Premium analysis and profit/loss calculations
         - Clickable totals titles opening analytics modals with pie charts

         All calculations are performed by updateSummary() in inventory.js
         Values are updated automatically when inventory changes
         ============================================================================= -->
      <section class="totals-section">
        <div class="totals">
          <!-- Silver totals card -->
          <div class="total-card silver">
            <div class="total-title" data-metal="Silver">Silver Totals</div>
            <div class="total-group">
              <div class="total-item">
                <span class="total-label">Total Items:</span>
                <span class="total-value" id="totalItemsSilver">0</span>
              </div>
              <div class="total-item">
                <span class="total-label">Total Weight (oz):</span>
                <span class="total-value" id="totalWeightSilver">0.00</span>
              </div>
            </div>
            <div class="total-group">
              <div class="total-item">
                <span class="total-label">Purchase Price:</span>
                <span class="total-value" id="totalPurchasedSilver">$0.00</span>
              </div>
              <div class="total-item">
                <span class="total-label">Melt Value:</span>
                <span class="total-value" id="currentValueSilver">$0.00</span>
              </div>
              <div class="total-item">
                <span class="total-label">Avg. Price (oz):</span>
                <span class="total-value" id="avgPriceSilver">$0.00</span>
              </div>
              <div class="total-item">
                <span class="total-label">Avg. Collectable (oz):</span>
                <span class="total-value" id="avgCollectablePriceSilver"
                  >$0.00</span
                >
              </div>
              <div class="total-item">
                <span class="total-label">Avg Non-Collectable (oz):</span>
                <span class="total-value" id="avgNonCollectablePriceSilver"
                  >$0.00</span
                >
              </div>
              <div class="total-item">
                <span class="total-label">Avg. Premium (oz):</span>
                <span class="total-value" id="avgPremiumSilver">$0.00</span>
              </div>
            </div>
            <div class="total-group">
              <div class="total-item">
                <span class="total-label">Lifetime Premiums Paid:</span>
                <span class="total-value" id="totalPremiumSilver">$0.00</span>
              </div>
              <div class="total-item">
                <span class="total-label">Lifetime Loss/Profit:</span>
                <span class="total-value" id="lossProfitSilver">$0.00</span>
              </div>
            </div>
          </div>
          <!-- Gold totals card -->
          <div class="total-card gold">
            <div class="total-title" data-metal="Gold">Gold Totals</div>
            <div class="total-group">
              <div class="total-item">
                <span class="total-label">Total Items:</span>
                <span class="total-value" id="totalItemsGold">0</span>
              </div>
              <div class="total-item">
                <span class="total-label">Total Weight (oz):</span>
                <span class="total-value" id="totalWeightGold">0.00</span>
              </div>
            </div>
            <div class="total-group">
              <div class="total-item">
                <span class="total-label">Purchase Price:</span>
                <span class="total-value" id="totalPurchasedGold">$0.00</span>
              </div>
              <div class="total-item">
                <span class="total-label">Melt Value:</span>
                <span class="total-value" id="currentValueGold">$0.00</span>
              </div>
              <div class="total-item">
                <span class="total-label">Avg. Price (oz):</span>
                <span class="total-value" id="avgPriceGold">$0.00</span>
              </div>
              <div class="total-item">
                <span class="total-label">Avg. Collectable (oz):</span>
                <span class="total-value" id="avgCollectablePriceGold"
                  >$0.00</span
                >
              </div>
              <div class="total-item">
                <span class="total-label">Avg Non-Collectable (oz):</span>
                <span class="total-value" id="avgNonCollectablePriceGold"
                  >$0.00</span
                >
              </div>
              <div class="total-item">
                <span class="total-label">Avg. Premium (oz):</span>
                <span class="total-value" id="avgPremiumGold">$0.00</span>
              </div>
            </div>
            <div class="total-group">
              <div class="total-item">
                <span class="total-label">Lifetime Premiums Paid:</span>
                <span class="total-value" id="totalPremiumGold">$0.00</span>
              </div>
              <div class="total-item">
                <span class="total-label">Lifetime Loss/Profit:</span>
                <span class="total-value" id="lossProfitGold">$0.00</span>
              </div>
            </div>
          </div>
          <!-- Platinum totals card -->
          <div class="total-card platinum">
            <div class="total-title" data-metal="Platinum">Platinum Totals</div>
            <div class="total-group">
              <div class="total-item">
                <span class="total-label">Total Items:</span>
                <span class="total-value" id="totalItemsPlatinum">0</span>
              </div>
              <div class="total-item">
                <span class="total-label">Total Weight (oz):</span>
                <span class="total-value" id="totalWeightPlatinum">0.00</span>
              </div>
            </div>
            <div class="total-group">
              <div class="total-item">
                <span class="total-label">Purchase Price:</span>
                <span class="total-value" id="totalPurchasedPlatinum"
                  >$0.00</span
                >
              </div>
              <div class="total-item">
                <span class="total-label">Melt Value:</span>
                <span class="total-value" id="currentValuePlatinum">$0.00</span>
              </div>
              <div class="total-item">
                <span class="total-label">Avg. Price (oz):</span>
                <span class="total-value" id="avgPricePlatinum">$0.00</span>
              </div>
              <div class="total-item">
                <span class="total-label">Avg. Collectable (oz):</span>
                <span class="total-value" id="avgCollectablePricePlatinum"
                  >$0.00</span
                >
              </div>
              <div class="total-item">
                <span class="total-label">Avg Non-Collectable (oz):</span>
                <span class="total-value" id="avgNonCollectablePricePlatinum"
                  >$0.00</span
                >
              </div>
              <div class="total-item">
                <span class="total-label">Avg. Premium (oz):</span>
                <span class="total-value" id="avgPremiumPlatinum">$0.00</span>
              </div>
            </div>
            <div class="total-group">
              <div class="total-item">
                <span class="total-label">Lifetime Premiums Paid:</span>
                <span class="total-value" id="totalPremiumPlatinum">$0.00</span>
              </div>
              <div class="total-item">
                <span class="total-label">Lifetime Loss/Profit:</span>
                <span class="total-value" id="lossProfitPlatinum">$0.00</span>
              </div>
            </div>
          </div>
          <!-- Palladium totals card -->
          <div class="total-card palladium">
            <div class="total-title" data-metal="Palladium">Palladium Totals</div>
            <div class="total-group">
              <div class="total-item">
                <span class="total-label">Total Items:</span>
                <span class="total-value" id="totalItemsPalladium">0</span>
              </div>
              <div class="total-item">
                <span class="total-label">Total Weight (oz):</span>
                <span class="total-value" id="totalWeightPalladium">0.00</span>
              </div>
            </div>
            <div class="total-group">
              <div class="total-item">
                <span class="total-label">Purchase Price:</span>
                <span class="total-value" id="totalPurchasedPalladium"
                  >$0.00</span
                >
              </div>
              <div class="total-item">
                <span class="total-label">Melt Value:</span>
                <span class="total-value" id="currentValuePalladium"
                  >$0.00</span
                >
              </div>
              <div class="total-item">
                <span class="total-label">Avg. Price (oz):</span>
                <span class="total-value" id="avgPricePalladium">$0.00</span>
              </div>
              <div class="total-item">
                <span class="total-label">Avg. Collectable (oz):</span>
                <span class="total-value" id="avgCollectablePricePalladium"
                  >$0.00</span
                >
              </div>
              <div class="total-item">
                <span class="total-label">Avg Non-Collectable (oz):</span>
                <span class="total-value" id="avgNonCollectablePricePalladium"
                  >$0.00</span
                >
              </div>
              <div class="total-item">
                <span class="total-label">Avg. Premium (oz):</span>
                <span class="total-value" id="avgPremiumPalladium">$0.00</span>
              </div>
            </div>
            <div class="total-group">
              <div class="total-item">
                <span class="total-label">Lifetime Premiums Paid:</span>
                <span class="total-value" id="totalPremiumPalladium"
                  >$0.00</span
                >
              </div>
              <div class="total-item">
                <span class="total-label">Lifetime Loss/Profit:</span>
                <span class="total-value" id="lossProfitPalladium">$0.00</span>
              </div>
            </div>
          </div>
        </div>
      </section>
      <!-- =============================================================================
         IMPORT/EXPORT SECTION
         
         Comprehensive data management with support for multiple formats:
         
         IMPORT OPTIONS:
         - CSV: Standard comma-separated values with automatic field mapping
         - JSON: Native application format preserving all data
         - Excel: .xlsx and .xls files with robust parsing
         
         EXPORT OPTIONS:
         - CSV: Compatible with spreadsheet applications
         - JSON: Full data backup with metadata
         - Excel: Formatted spreadsheet with proper column types
         - PDF: Print-ready report with totals and formatting
         - HTML: Standalone web page with embedded styles
         
         All import/export functions include data validation and error handling
         Implementation in inventory.js with format-specific parsing
      ============================================================================= -->
    </div>
    <!-- ADD ITEM MODAL -->
    <div class="modal" id="addModal" style="display: none">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Add Inventory Item</h2>
          <button aria-label="Close modal" class="modal-close" id="addCloseBtn">√ó</button>
        </div>
        <div class="modal-body">
          <form id="inventoryForm">
            <div class="grid grid-2">
              <div>
                <label for="itemMetal">Metal</label>
                <select id="itemMetal">
                  <option value="Silver">Silver</option>
                  <option value="Gold">Gold</option>
                  <option value="Platinum">Platinum</option>
                  <option value="Palladium">Palladium</option>
                  <option value="Alloy/Other">Alloy/Other</option>
                </select>
              </div>
              <div>
                <label for="itemType">Type</label>
                <select id="itemType">
                  <option value="Round">Round</option>
                  <option value="Bar">Bar</option>
                  <option value="Coin">Coin</option>
                  <option value="Note">Note</option>
                  <option value="Aurum">Aurum</option>
                  <option value="Other">Other</option>
                </select>
              </div>
              <div>
                <label for="itemQty">Quantity</label>
                <input id="itemQty" min="1" required step="1" type="number" />
              </div>
              <div>
                <label for="itemWeight">Weight (oz)</label>
                <input id="itemWeight" min="0.0001" required step="0.0001" type="number" />
              </div>
            </div>
            <div class="grid grid-2">
              <div>
                <label for="itemName">Name</label>
                <input id="itemName" required type="text" />
              </div>
              <div>
                <label for="purchaseLocation">Purchase Location</label>
                <input id="purchaseLocation" required type="text" />
              </div>
              <div>
                <label for="storageLocation">Storage Location</label>
                <input id="storageLocation" type="text" placeholder="Vault A, Safe B, etc..." />
              </div>
              <div>
                <label for="itemNotes">Notes</label>
                <input id="itemNotes" type="text" placeholder="Additional notes or comments..." />
              </div>
            </div>
            <div class="grid grid-2">
              <div>
                <label for="itemPrice">Purchase Price ($)</label>
                <div class="currency-input">
                  <input id="itemPrice" min="0" required step="0.01" type="number" />
                </div>
              </div>
              <div>
                <label for="itemDate">Purchase Date</label>
                <input id="itemDate" required type="date" />
              </div>
            </div>
            <div class="grid grid-2">
              <div>
                <label for="itemSpotPrice">Spot Price ($/oz)</label>
                <div class="currency-input">
                  <input id="itemSpotPrice" min="0" step="0.01" type="number" />
                </div>
              </div>
              <div class="collectable-toggle">
                <label for="itemCollectable">Collectable Item</label>
                <label class="switch">
                  <input id="itemCollectable" type="checkbox" />
                  <span class="slider"></span>
                </label>
                <span class="collectable-note"
                  >Collectable items may have additional numismatic value beyond their metal content</span
                >
              </div>
            </div>
            <div style="margin-top: 1rem; text-align: right">
              <button class="btn" id="cancelAdd" type="button">Cancel</button>
              <button class="btn premium" type="submit">Add to Inventory</button>
            </div>
          </form>
        </div>
      </div>
    </div>
    <!-- =============================================================================
       EDIT MODAL

       Comprehensive item editing interface that appears when:
       - User clicks on item name in table
       - Edit button is pressed (in older versions)
       Features:
       - All item fields editable including historical spot price
       - Collectable toggle switch with explanatory text
       - Real-time validation and premium recalculation
       - Save/Cancel actions with confirmation

       Modal display controlled by editItem() function in inventory.js
       Form submission handled in events.js with data validation
       ============================================================================= -->
    <div class="modal" id="editModal" style="display: none">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Edit Inventory Item</h2>
          <button aria-label="Close modal" class="modal-close" id="editCloseBtn">√ó</button>
        </div>
        <div class="modal-body">
        <form id="editForm">
          <!-- First row of edit form fields -->
          <div class="grid grid-2">
            <div>
              <label for="editMetal">Metal</label>
              <select id="editMetal">
                <option value="Silver">Silver</option>
                <option value="Gold">Gold</option>
                <option value="Platinum">Platinum</option>
                <option value="Palladium">Palladium</option>
                <option value="Alloy/Other">Alloy/Other</option>
              </select>
            </div>
            <div>
              <label for="editType">Type</label>
              <select id="editType">
                <option value="Round">Round</option>
                <option value="Bar">Bar</option>
                <option value="Coin">Coin</option>
                <option value="Note">Note</option>
                <option value="Aurum">Aurum</option>
                <option value="Other">Other</option>
              </select>
            </div>
            <div>
              <label for="editQty">Quantity</label>
              <input id="editQty" min="1" required="" step="1" type="number" />
            </div>
            <div>
              <label for="editWeight">Weight (oz)</label>
              <input
                id="editWeight"
                min="0.0001"
                required=""
                step="0.0001"
                type="number"
              />
            </div>
          </div>
          <!-- Second row of edit form fields -->
          <div class="grid grid-2">
            <div>
              <label for="editName">Name</label>
              <input id="editName" required="" type="text" />
            </div>
            <div>
              <label for="editPurchaseLocation">Purchase Location</label>
              <input id="editPurchaseLocation" required="" type="text" />
            </div>
            <div>
              <label for="editStorageLocation">Storage Location</label>
              <input
                id="editStorageLocation"
                type="text"
                placeholder="Vault A, Safe B, etc..."
              />
            </div>
            <div>
              <label for="editNotes">Notes</label>
              <input
                id="editNotes"
                type="text"
                placeholder="Additional notes or comments..."
              />
            </div>
          </div>
          <!-- Third row of edit form fields -->
          <div class="grid grid-2">
            <div>
              <label for="editPrice">Purchase Price ($)</label>
              <div class="currency-input">
                <input
                  id="editPrice"
                  min="0"
                  required=""
                  step="0.01"
                  type="number"
                />
              </div>
            </div>
            <div>
              <label for="editDate">Purchase Date</label>
              <input id="editDate" required="" type="date" />
            </div>
          </div>
          <!-- Spot price and collectable toggle -->
          <div class="grid grid-2">
            <div>
              <label for="editSpotPrice">Spot Price ($/oz)</label>
              <div class="currency-input">
                <input
                  id="editSpotPrice"
                  min="0"
                  required
                  step="0.01"
                  type="number"
                />
              </div>
            </div>
            <div class="collectable-toggle">
              <label for="editCollectable">Collectable Item</label>
              <label class="switch">
                <input id="editCollectable" type="checkbox" />
                <span class="slider"></span>
              </label>
              <span class="collectable-note"
                >Collectable items may have additional numismatic value beyond their metal content</span
              >
            </div>
          </div>
          <!-- Form action buttons -->
          <div style="margin-top: 1rem; text-align: right">
            <button class="btn" id="cancelEdit" type="button">Cancel</button>
            <button class="btn premium" type="submit">Save Changes</button>
          </div>
        </form>
        </div>
      </div>
    </div>

    <!-- =============================================================================
       NOTES MODAL

       Simple modal for viewing and editing item notes. Opens when the Notes
       button is clicked in the inventory table. Allows users to update the
       notes field without opening the full edit form.
       ============================================================================= -->
    <div class="modal" id="notesModal" style="display: none">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Item Notes</h2>
          <button aria-label="Close modal" class="modal-close" id="notesCloseBtn">√ó</button>
        </div>
        <div class="modal-body">
          <textarea id="notesTextarea" rows="6" style="width: 100%"></textarea>
          <div style="margin-top: 1rem; text-align: right">
            <button class="btn" id="cancelNotes" type="button">Cancel</button>
            <button class="btn premium" id="saveNotes" type="button">Save</button>
          </div>
        </div>
      </div>
    </div>

    <!-- =============================================================================
       CHANGE LOG MODAL

       Displays the 10 most recent inventory cell changes tracked by the system.
       Data is populated dynamically from localStorage and rendered as a table.
       ============================================================================= -->
    <div class="modal" id="changeLogModal" style="display: none">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Change Log</h2>
          <button aria-label="Close modal" class="modal-close" id="changeLogCloseBtn">√ó</button>
        </div>
        <div class="modal-body">
          <table id="changeLogTable">
            <thead>
              <tr>
                <th>Date</th>
                <th>Item</th>
                <th>Field</th>
                <th>Old Value</th>
                <th>New Value</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
      </div>
    </div>
  </div>

    <!-- =============================================================================
       STORAGE REPORT MODAL

       Displays the generated storage report inside an iframe for in-app viewing.
       ============================================================================= -->
    <div class="modal" id="storageReportModal" style="display: none">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Storage Report</h2>
          <button aria-label="Close modal" class="modal-close" id="storageReportCloseBtn">√ó</button>
        </div>
        <div class="modal-body" style="height: 80vh; padding: 0;">
          <iframe id="storageReportFrame" style="width: 100%; height: 100%; border: none;"></iframe>
        </div>
      </div>
    </div>

    <!-- =============================================================================
       DETAILS MODAL WITH PIE CHARTS
       
       Advanced analytics modal opened by clicking totals titles.
       Provides in-depth analysis for selected metal including:
       
       VISUAL ANALYTICS:
       - Pie chart breakdown by item type (rounds, bars, coins, etc.)
       - Pie chart breakdown by purchase location
       - Interactive Chart.js visualizations with hover details
       
       DATA BREAKDOWNS:
       - Type details: count, weight, and value by item type
       - Location details: count, weight, and value by purchase location
       - Formatted currency and weight displays
       
       Modal implementation in detailsModal.js with Chart.js integration
       Data preparation and chart rendering handled by charts.js
       ============================================================================= -->
    <div class="modal" id="detailsModal" style="display: none">
      <div class="modal-content">
        <div class="modal-header">
          <h2 id="detailsModalTitle"></h2>
          <button aria-label="Close modal" class="modal-close" id="detailsCloseBtn">√ó</button>
        </div>
        <div class="modal-body">
          <div class="details-grid">
            <div class="details-panel">
              <h3 class="details-panel-title">Breakdown by Type</h3>
              <div class="chart-canvas-container">
                <canvas class="chart-canvas" id="typeChart"></canvas>
              </div>
              <div class="details-breakdown" id="typeBreakdown">
                <!-- Content will be populated by JavaScript -->
              </div>
            </div>
            <div class="details-panel">
              <h3 class="details-panel-title">Breakdown by Purchase Location</h3>
              <div class="chart-canvas-container">
                <canvas class="chart-canvas" id="locationChart"></canvas>
              </div>
              <div class="details-breakdown" id="locationBreakdown">
                <!-- Content will be populated by JavaScript -->
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <footer class="app-footer">
      <div class="storage-line">Storage: <span id="storageUsage"></span> <progress id="storageUsageBar" max="5120" value="0"></progress> <a href="#" id="storageReportLink">Storage report</a></div>
      <div class="footer-meta">
        <span>Thank you for using StackTrackr (<span id="footerVersion"></span>). ¬© 2025 <span id="footerDomain">stacktrackr.com</span>.</span>
        <span class="footer-links"><a href="./archive/v_previous/index.html">Previous build</a> | <a href="https://github.com/lbruton/StackTrackr/issues" target="_blank" rel="noopener">Report issues</a></span>
      </div>
    </footer>
    <!-- =============================================================================
       ABOUT & DISCLAIMER MODAL
       Comprehensive application information and disclaimer modal similar to the
       original splash page design with enhanced features and detailed information.
       ============================================================================= -->
    <div class="modal" id="ackModal" style="display: none">
      <div class="modal-content about-modal-content">
        <div class="modal-header about-modal-header">
          <h1 class="about-title">
            <span id="ackAppName">StackTrackr</span> <span id="ackVersion"></span>
          </h1>
          <button aria-label="Close modal" class="modal-close" id="ackCloseBtn">
            √ó
          </button>
        </div>
        <div class="modal-body about-modal-body">
          <!-- Application Description -->
          <div class="about-description">
            Track your precious metal investments with comprehensive spot price
            tracking, premium calculations, and detailed reporting. Add items to
            your inventory, monitor current values across Silver, Gold,
            Platinum, and Palladium, and export your data in multiple formats
            including CSV, JSON, Excel, PDF, and HTML.
          </div>

          <!-- Important Notice -->
          <div class="about-alert">
            <div class="alert-header">
              <span class="alert-icon">‚ö†Ô∏è</span>
              <strong>Important Privacy & Data Notice</strong>
            </div>
            <div class="alert-content">
              <p>
                <strong>Your Privacy is Protected:</strong> All data is stored
                locally in your browser using localStorage and
                <em>never transmitted to any server</em>. Your precious metals
                inventory information remains completely private and under your
                control.
              </p>

              <p>
                <strong>Data Backup Responsibility:</strong> Since data is
                stored locally, it will be lost if you clear browser history,
                reset browser data, or use private browsing mode. Remember to
                export your data regularly to keep a copy.
              </p>

              <p>
                <strong>Use at Your Own Risk:</strong> This tool is provided for
                informational and organizational purposes only. The developer
                assumes no responsibility for any financial decisions,
                investment choices, or data loss. Always verify spot prices and
                calculations independently.
              </p>

              <p>
                <strong>Spot Price Accuracy:</strong> Prices displayed are for
                reference only and may not reflect real-time market conditions.
                Always confirm current pricing with your dealer or official
                market sources before making transactions.
              </p>
            </div>
          </div>
          <div class="alert-actions">
            <button class="btn btn-primary about-accept-btn" id="ackAcceptBtn">
              ‚úÖ I Understand - Continue to Application
            </button>
          </div>
          <div class="acceptance-text">
            By continuing, you acknowledge that you understand this tool stores
            data locally, you are responsible for backing up your data, and you
            use this application at your own risk.
          </div>
        </div>
      </div>
    </div>
    <div class="modal" id="aboutModal" style="display: none">
      <div class="modal-content about-modal-content">
        <div class="modal-header about-modal-header">
          <h1>About</h1>
          <button
            aria-label="Close modal"
            class="modal-close"
            id="aboutCloseBtn"
          >
            √ó
          </button>
        </div>
        <div class="modal-body about-modal-body">
          <h2 class="about-title" id="aboutTitle">
            <span id="aboutAppName">StackTrackr</span>
            <span id="aboutVersion"></span>
          </h2>
          <div class="about-description">
            Track your precious metal investments with comprehensive spot price
            tracking, premium calculations, and detailed reporting. Add items to
            your inventory, monitor current values across Silver, Gold,
            Platinum, and Palladium, and export your data in multiple formats
            including CSV, JSON, Excel, PDF, and HTML.
          </div>

          <div class="about-alert">
            <div class="alert-header">
              <span class="alert-icon">‚ö†Ô∏è</span>
              <strong>Important Privacy &amp; Data Notice</strong>
            </div>
            <div class="alert-content">
              <p>
                <strong>Your Privacy is Protected:</strong> All data is stored
                locally in your browser using localStorage and
                <em>never transmitted to any server</em>. Your precious metals
                inventory information remains completely private and under your
                control.
              </p>

              <p>
                <strong>Data Backup Responsibility:</strong> Since data is
                stored locally, it will be lost if you clear browser history,
                reset browser data, or use private browsing mode. Remember to
                export your data regularly to keep a copy.
              </p>

              <p>
                <strong>Use at Your Own Risk:</strong> This tool is provided for
                informational and organizational purposes only. The developer
                assumes no responsibility for any financial decisions,
                investment choices, or data loss. Always verify spot prices and
                calculations independently.
              </p>

              <p>
                <strong>Spot Price Accuracy:</strong> Prices displayed are for
                reference only and may not reflect real-time market conditions.
                Always confirm current pricing with your dealer or official
                market sources before making transactions.
              </p>
            </div>
          </div>
          <!-- Key Features -->
          <div class="about-features">
            <div class="features-title">‚ú® Key Features</div>
            <div class="features-grid">
              <div class="feature-item">üìä Live Spot Price Tracking</div>
              <div class="feature-item">üí∞ Premium & Profit Calculations</div>
              <div class="feature-item">üìà Advanced Analytics & Charts</div>
              <div class="feature-item">üìÅ Multi-Format Import/Export</div>
              <div class="feature-item">üîç Real-time Search & Filtering</div>
              <div class="feature-item">üè¶ Storage Location Tracking</div>
              <div class="feature-item">üé® Dark/Light Theme Support</div>
              <div class="feature-item">üîí 100% Local Storage</div>
            </div>
          </div>

          <!-- What's New and Roadmap -->
          <div class="about-info-grid">
            <div class="about-section">
              <div class="section-title">
                üöÄ What's New in <span id="aboutCurrentVersion"></span>
              </div>
              <ul id="aboutChangelogLatest" class="changelog-list"></ul>
            </div>

            <div class="about-section" id="aboutRoadmapSection">
              <div class="section-title">üó∫Ô∏è Development Roadmap</div>
              <p>
                See the
                <a href="docs/roadmap.md" target="_blank" rel="noopener"
                  >project roadmap</a
                >
                for upcoming patch plans.
              </p>
            </div>
          </div>

          <!-- Resources Section -->
          <div class="about-section">
            <div class="section-title">üìÑ Resources & Links</div>
            <div class="resources-grid">
              <a class="resource-btn" href="sample.csv" download="sample.csv">
                üìÑ Download Sample Data
              </a>
              <a
                class="resource-btn"
                href="https://github.com/lbruton/Precious-Metals-Inventory"
                target="_blank"
                rel="noopener"
              >
                üìÅ View Source Code
              </a>
              <button class="resource-btn" id="aboutShowChangelogBtn">
                üìú View Full Changelog
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="modal" id="versionModal" style="display: none">
      <div class="modal-content about-modal-content">
        <div class="modal-header about-modal-header">
          <h1 class="about-title">
            What's New <span id="versionModalVersion"></span>
          </h1>
          <button aria-label="Close modal" class="modal-close" id="versionCloseBtn">√ó</button>
        </div>
        <div class="modal-body about-modal-body">
          <div id="versionChanges"></div>
          <div class="alert-actions">
            <button class="btn btn-primary" id="versionAcceptBtn">Accept and continue</button>
          </div>
        </div>
      </div>
    </div>
    <!-- =============================================================================
       ============================================================================= -->

    <div class="modal" id="apiModal" style="display: none">
      <div class="modal-content">
        <div class="modal-header">
          <h2>API</h2>
          <button aria-label="Close modal" class="modal-close" id="apiCloseBtn">
            √ó
          </button>
        </div>
        <div class="modal-body">
          <div class="settings-section">
            <h3 style="margin-bottom: 1rem">API Configuration</h3>
            <p class="settings-subtext">Manage API cache, history, and providers.</p>

            <div class="cache-duration-row">
              <label for="apiCacheDuration">Cache Duration:</label>
              <select id="apiCacheDuration">
                <option value="0">No Cache</option>
                <option value="1">1 hour</option>
                <option value="6">6 hours</option>
                <option value="12">12 hours</option>
                <option value="24">24 hours</option>
              </select>
            </div>

            <div class="api-status-summary" id="apiStatusSummary"></div>

            <div class="settings-actions">
              <button type="button" class="btn" id="providersBtn">
                Providers üñ•Ô∏è
              </button>
              <button type="button" class="btn success" id="syncAllBtn">
                Sync All ‚ôªÔ∏è
              </button>
              <button type="button" class="btn danger" id="flushCacheBtn">
                Flush Cache üöΩ
              </button>
              <button type="button" class="btn" id="apiHistoryBtn">
                History üìú
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="modal" id="filesModal" style="display: none">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Files</h2>
          <button aria-label="Close modal" class="modal-close" id="filesCloseBtn">
            √ó
          </button>
        </div>
        <div class="modal-body">
          <div class="storage-line">
            Storage Breakdown:
            <div class="files-progress" id="filesProgress">
              <div class="files-progress-tooltip" id="filesProgressTooltip"></div>
            </div>
          </div>
          <div class="settings-card-grid">
            <div class="settings-card">
              <h3>Import</h3>
              <p class="settings-subtext">Import your data files.</p>
              <div class="import-block">
                <div class="import-export-grid">
                  <label class="btn" id="importCsvBtn">
                    Import CSV <span class="import-icon">‚¨áÔ∏è</span>
                    <input accept=".csv" hidden id="importCsvFile" type="file" />
                  </label>
                  <label class="btn" id="importJsonBtn">
                    Import JSON <span class="import-icon">‚¨áÔ∏è</span>
                    <input accept=".json" hidden id="importJsonFile" type="file" />
                  </label>
                  <label class="btn" id="importExcelBtn">
                    Import Excel <span class="import-icon">‚¨áÔ∏è</span>
                    <input
                      accept=".xlsx,.xls"
                      hidden
                      id="importExcelFile"
                      type="file"
                    />
                  </label>
                  <button class="btn secondary" id="cloudSyncBtn">Cloud Sync ‚òÅÔ∏è</button>
                </div>
                <progress
                  class="import-progress"
                  id="importProgress"
                  value="0"
                  max="0"
                ></progress>
                <div class="import-progress-text" id="importProgressText"></div>
              </div>
            </div>

            <div class="settings-card">
              <h3>Export</h3>
              <p class="settings-subtext">Export your data files.</p>
              <div class="export-block">
                <div class="import-export-grid">
                  <button class="btn" id="exportCsvBtn">
                    Export CSV <span class="export-icon">‚¨ÜÔ∏è</span>
                  </button>
                  <button class="btn" id="exportJsonBtn">
                    Export JSON <span class="export-icon">‚¨ÜÔ∏è</span>
                  </button>
                  <button class="btn" id="exportExcelBtn">
                    Export Excel <span class="export-icon">‚¨ÜÔ∏è</span>
                  </button>
                  <button class="btn" id="exportPdfBtn">
                    Export PDF <span class="export-icon">‚¨ÜÔ∏è</span>
                  </button>
                </div>
              </div>
            </div>

            <div class="settings-card">
              <h3>Third-Party</h3>
              <p class="settings-subtext">Connect with external services like Numista.</p>
              <div class="third-party-block">
                <div class="import-export-grid">
                  <button class="btn" id="numistaImportBtn">Import from Numista</button>
                  <button class="btn" id="numistaExportBtn">Numista Export CSV</button>
                </div>
              </div>
            </div>

            <div class="settings-card">
              <h3>Custom Mapping</h3>
              <p class="settings-subtext">Define regex rules to map imported fields.</p>
              <div class="third-party-block">
                <div class="import-export-grid">
                  <button class="btn" id="addMappingBtn">Add Mapping</button>
                  <button class="btn" id="applyMappingsBtn">Apply Mappings</button>
                  <button class="btn" id="clearMappingsBtn">Clear Mappings</button>
                </div>
              </div>
            </div>

            <div class="settings-card boating-accident-section">
              <h3>Clear All Data</h3>
              <p class="settings-subtext">Clear all data from the app.</p>
              <div class="backup-buttons">
                <button class="btn danger" id="boatingAccidentBtn">
                  üè¥‚Äç‚ò†Ô∏è So, you've been in a boating accident? üè¥‚Äç‚ò†Ô∏è
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="modal" id="apiProvidersModal" style="display: none">
      <div class="modal-content">
        <div class="modal-header">
          <h2>API Providers</h2>
          <button
            aria-label="Close modal"
            class="modal-close"
            id="apiProvidersCloseBtn"
          >
            √ó
          </button>
        </div>
        <div class="modal-body">
          <p class="settings-subtext">
            Enter 1‚Äì4 API keys below, choose a default provider, and enable the
            metals you want each service to update.
          </p>
          <div class="api-providers">
              <div class="api-provider" data-provider="METALS_DEV">
                <div class="provider-header">
                  <span class="provider-name">Metals.dev</span>
                  <span class="provider-url">https://api.metals.dev/v1</span>
                </div>
                <a href="#" class="api-info-link" data-provider="METALS_DEV">
                  Provider Information
                </a>
                <div class="api-key-row">
                  <label for="apiKey_METALS_DEV">Key:</label>
                  <input
                    type="password"
                    id="apiKey_METALS_DEV"
                    placeholder="Enter your API key"
                  />
                </div>
                <div class="provider-footer">
                  <div class="provider-info">
                    <div class="api-key-note">
                      Your API key is stored locally and never shared.
                    </div>
                    <div class="provider-status">
                      <span class="status-dot"></span>
                      <span class="status-text">Disconnected</span>
                    </div>
                    <div class="provider-history"></div>
                  </div>
                  <div class="provider-actions">
                    <button
                      type="button"
                      class="btn provider-default-btn"
                      data-provider="METALS_DEV"
                    >
                    </button>
                    <div class="provider-actions-right">
                      <button
                        type="button"
                        class="btn api-quota-btn"
                        data-provider="METALS_DEV"
                      >
                        Quota
                      </button>
                      <button
                        type="button"
                        class="btn api-clear-btn warning"
                        data-provider="METALS_DEV"
                      >
                        Clear Key
                      </button>
                      <button
                        type="button"
                        class="btn api-sync-btn success"
                        data-provider="METALS_DEV"
                      >
                        Save and Test
                      </button>
                    </div>
                  </div>
                </div>
              </div>

              <div class="api-provider" data-provider="METALS_API">
                <div class="provider-header">
                  <span class="provider-name">Metals-API.com</span>
                  <span class="provider-url">https://metals-api.com/api</span>
                </div>
                <a href="#" class="api-info-link" data-provider="METALS_API">
                  Provider Information
                </a>
                <div class="api-key-row">
                  <label for="apiKey_METALS_API">Key:</label>
                  <input
                    type="password"
                    id="apiKey_METALS_API"
                    placeholder="Enter your API key"
                  />
                </div>
                <div class="provider-footer">
                  <div class="provider-info">
                    <div class="api-key-note">
                      Your API key is stored locally and never shared.
                    </div>
                    <div class="provider-status">
                      <span class="status-dot"></span>
                      <span class="status-text">Disconnected</span>
                    </div>
                    <div class="provider-history"></div>
                  </div>
                  <div class="provider-actions">
                    <button
                      type="button"
                      class="btn provider-default-btn"
                      data-provider="METALS_API"
                    >
                    </button>
                    <div class="provider-actions-right">
                      <button
                        type="button"
                        class="btn api-quota-btn"
                        data-provider="METALS_API"
                      >
                        Quota
                      </button>
                      <button
                        type="button"
                        class="btn api-clear-btn warning"
                        data-provider="METALS_API"
                      >
                        Clear Key
                      </button>
                      <button
                        type="button"
                        class="btn api-sync-btn success"
                        data-provider="METALS_API"
                      >
                        Save and Test
                      </button>
                    </div>
                  </div>
                </div>
              </div>

              <div class="api-provider" data-provider="METAL_PRICE_API">
                <div class="provider-header">
                  <span class="provider-name">MetalPriceAPI.com</span>
                  <span class="provider-url">
                    https://api.metalpriceapi.com/v1
                  </span>
                </div>
                <a
                  href="#"
                  class="api-info-link"
                  data-provider="METAL_PRICE_API"
                >
                  Provider Information
                </a>
                <div class="api-key-row">
                  <label for="apiKey_METAL_PRICE_API">Key:</label>
                  <input
                    type="password"
                    id="apiKey_METAL_PRICE_API"
                    placeholder="Enter your API key"
                  />
                </div>
                <div class="provider-footer">
                  <div class="provider-info">
                    <div class="api-key-note">
                      Your API key is stored locally and never shared.
                    </div>
                    <div class="provider-status">
                      <span class="status-dot"></span>
                      <span class="status-text">Disconnected</span>
                    </div>
                    <div class="provider-history"></div>
                  </div>
                  <div class="provider-actions">
                    <button
                      type="button"
                      class="btn provider-default-btn"
                      data-provider="METAL_PRICE_API"
                    >
                    </button>
                    <div class="provider-actions-right">
                      <button
                        type="button"
                        class="btn api-quota-btn"
                        data-provider="METAL_PRICE_API"
                      >
                        Quota
                      </button>
                      <button
                        type="button"
                        class="btn api-clear-btn warning"
                        data-provider="METAL_PRICE_API"
                      >
                        Clear Key
                      </button>
                      <button
                        type="button"
                        class="btn api-sync-btn success"
                        data-provider="METAL_PRICE_API"
                      >
                        Save and Test
                      </button>
                    </div>
                  </div>
                </div>
              </div>

              <div class="api-provider" data-provider="CUSTOM">
                <div class="provider-header">
                  <span class="provider-name">Custom Provider</span>
                </div>
                <div class="api-field-row">
                  <label for="apiBase_CUSTOM">Base URL:</label>
                  <input
                    type="text"
                    id="apiBase_CUSTOM"
                    placeholder="https://api.example.com"
                  />
                </div>
                <div class="api-field-row">
                  <label for="apiEndpoint_CUSTOM">Endpoint:</label>
                  <input
                    type="text"
                    id="apiEndpoint_CUSTOM"
                    placeholder="/latest?key={API_KEY}&metal={METAL}"
                  />
                </div>
                <div class="api-field-row">
                  <label for="apiFormat_CUSTOM">Metal Format:</label>
                  <select id="apiFormat_CUSTOM">
                    <option value="symbol">Symbol</option>
                    <option value="word">Word</option>
                  </select>
                </div>
                <div class="api-key-row">
                  <label for="apiKey_CUSTOM">Key:</label>
                  <input
                    type="password"
                    id="apiKey_CUSTOM"
                    placeholder="Enter your API key"
                  />
                </div>
                <div class="provider-footer">
                  <div class="provider-info">
                    <div class="api-key-note">
                      Your API key is stored locally and never shared.
                    </div>
                    <div class="provider-status">
                      <span class="status-dot"></span>
                      <span class="status-text">Disconnected</span>
                    </div>
                    <div class="provider-history"></div>
                  </div>
                  <div class="provider-actions">
                    <button
                      type="button"
                      class="btn provider-default-btn"
                      data-provider="CUSTOM"
                    >
                    </button>
                    <div class="provider-actions-right">
                      <button
                        type="button"
                        class="btn api-quota-btn"
                        data-provider="CUSTOM"
                      >
                        Quota
                      </button>
                      <button
                        type="button"
                        class="btn api-clear-btn warning"
                        data-provider="CUSTOM"
                      >
                        Clear Key
                      </button>
                      <button
                        type="button"
                        class="btn api-sync-btn success"
                        data-provider="CUSTOM"
                      >
                        Save and Test
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

    <div class="modal" id="cloudSyncModal" style="display: none">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Cloud Sync</h2>
          <button
            aria-label="Close modal"
            class="modal-close"
            id="cloudSyncCloseBtn"
          >
            √ó
          </button>
        </div>
        <div class="modal-body">
          ‚òÅÔ∏è Feature coming soon ‚òÅÔ∏è
        </div>
      </div>
    </div>

    <div class="modal" id="apiQuotaModal" style="display: none">
      <div class="modal-content">
        <div class="modal-header">
          <h2>API Quota</h2>
          <button
            aria-label="Close modal"
            class="modal-close"
            id="apiQuotaCloseBtn"
          >
            √ó
          </button>
        </div>
        <div class="modal-body" style="text-align: center">
          <label for="apiQuotaInput">Monthly quota:</label>
          <input type="number" id="apiQuotaInput" min="1" />
          <div style="margin-top: 1rem">
            <button class="btn" id="apiQuotaSaveBtn">Save</button>
          </div>
        </div>
      </div>
    </div>

    <div class="modal" id="apiInfoModal" style="display: none">
      <div class="modal-content">
        <div class="modal-header">
          <h3 id="apiInfoTitle">Provider Information</h3>
          <button aria-label="Close modal" class="modal-close" id="apiInfoCloseBtn">√ó</button>
        </div>
        <div class="modal-body">
          <div id="apiInfoBody" class="api-info-body"></div>
        </div>
      </div>
    </div>
    <div class="modal" id="apiHistoryModal" style="display: none">
      <div class="modal-content">
        <div class="modal-header">
          <h2>API Price History</h2>
          <button
            aria-label="Close modal"
            class="modal-close"
            id="apiHistoryCloseBtn"
          >
            √ó
          </button>
        </div>
        <div class="modal-body">
          <div class="api-history-body">
            <div class="api-history-table">
              <div class="api-history-filter">
                <input
                  type="text"
                  id="apiHistoryFilter"
                  placeholder="Filter history..."
                />
                <button
                  type="button"
                  class="btn secondary"
                  id="apiHistoryClearFilterBtn"
                >
                  Clear
                </button>
              </div>
              <div class="api-history-table-wrapper">
                <table id="apiHistoryTable"></table>
              </div>
            </div>
            <div class="api-history-charts">
              <div class="chart-panel">
                <h3>Silver</h3>
                <canvas id="apiHistoryChartSilver"></canvas>
              </div>
              <div class="chart-panel">
                <h3>Gold</h3>
                <canvas id="apiHistoryChartGold"></canvas>
              </div>
              <div class="chart-panel">
                <h3>Platinum</h3>
                <canvas id="apiHistoryChartPlatinum"></canvas>
              </div>
              <div class="chart-panel">
                <h3>Palladium</h3>
                <canvas id="apiHistoryChartPalladium"></canvas>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- =============================================================================
       JAVASCRIPT MODULE LOADING
       
       Modular architecture with proper dependency order:
       1. constants.js - Global configuration and version
       2. state.js - Application state and DOM element caching
       3. utils.js - Utility functions and formatters
       4. Feature modules - charts, theme, search, sorting, pagination, etc.
       5. Core modules - spot price management and inventory operations
       6. events.js - Event listener setup (requires all other modules)
       7. init.js - Application initialization and startup
       
       All scripts use 'defer' to ensure DOM is ready before execution
       External libraries (Chart.js, jsPDF, PapaParse, XLSX) loaded via CDN
       ============================================================================= -->

<script defer src="./js/constants.js"></script>
<script defer src="./js/state.js"></script>
<script defer src="./js/utils.js"></script>
<script defer src="./js/versionCheck.js"></script>
<script defer src="./js/changeLog.js"></script>
    <script defer src="./js/charts.js"></script>
    <script defer src="./js/theme.js"></script>
    <script defer src="./js/search.js"></script>
    <script defer src="./js/sorting.js"></script>
    <script defer src="./js/pagination.js"></script>
    <script defer src="./js/detailsModal.js"></script>
    <script defer src="./js/spot.js"></script>
    <script defer src="./js/api.js"></script>
    <script defer src="./js/inventory.js"></script>
    <script defer src="./js/about.js"></script>
    <script defer src="./js/customMapping.js"></script>
    <script defer src="./js/events.js"></script>
    <script defer src="./js/init.js"></script>
  </body>
</html>
