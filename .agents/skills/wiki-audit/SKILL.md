---
name: wiki-audit
description: Background audit of StakTrakrWiki — cross-checks all frontend pages against the current codebase, opens a PR with corrections, and reports results. Dispatches a background Task agent and returns immediately. Use /wiki-audit to trigger.
allowed-tools: Bash, Read, Task
---

# Wiki Audit

Spawns a background Task agent that reads every frontend wiki page, cross-checks
key claims against the StakTrakr codebase, fixes any stale content, and opens a
PR on StakTrakrWiki with corrections.

**Returns immediately.** Check `lbruton/StakTrakrWiki/pulls` for results.

## How to invoke

Run `/wiki-audit`. The background agent handles everything.

## Audit checks (the background agent runs these)

### 1. Script count — `frontend-overview.md`
```bash
ACTUAL=$(grep -c '<script' /Volumes/DATA/GitHub/StakTrakr/index.html)
# Verify frontend-overview.md states the correct count
```

### 2. ALLOWED_STORAGE_KEYS — `data-model.md`
```bash
grep -A 60 'ALLOWED_STORAGE_KEYS = \[' /Volumes/DATA/GitHub/StakTrakr/js/constants.js
# Verify data-model.md accurately describes the storage key pattern
# (does not need to list every key — should direct readers to constants.js)
```

### 3. CORE_ASSETS — `service-worker.md`
```bash
grep -A 80 'CORE_ASSETS = \[' /Volumes/DATA/GitHub/StakTrakr/sw.js | head -85
# Verify service-worker.md describes CORE_ASSETS correctly
```

### 4. Retail globals — `retail-modal.md`
```bash
grep 'window\.' /Volumes/DATA/GitHub/StakTrakr/js/retail.js | grep -v '//' | head -20
# Verify retail-modal.md lists the correct window.* exports
```

### 5. API endpoints — `api-consumption.md`
```bash
grep 'api\.staktrakr\|api2\.staktrakr' /Volumes/DATA/GitHub/StakTrakr/js/api.js | head -10
# Verify endpoint names/URLs in wiki match code
```

### 6. APP_VERSION in release-workflow.md
```bash
grep 'APP_VERSION' /Volumes/DATA/GitHub/StakTrakr/js/constants.js | grep 'const APP_VERSION'
# Verify release-workflow.md references the correct version format
```

### 7. Last-updated timestamps
```bash
# Verify each page's "> **Last updated:**" version matches or is close to
# the current APP_VERSION — flag pages more than 2 versions behind
grep 'APP_VERSION' /Volumes/DATA/GitHub/StakTrakr/js/constants.js | grep 'const APP_VERSION'
```

## Fix via PR

Branch protection requires all changes go through a PR. Never push directly to `main`.

For each page with stale or incorrect content:

1. Re-read the relevant source files
2. Rewrite only the stale sections (preserve overall structure)
3. Update the `> **Last updated:**` line
4. Commit to a branch and open a PR:

```bash
cd /Volumes/DATA/GitHub/StakTrakrWiki
git pull origin main
BRANCH="wiki-audit/$(date +%Y%m%d)"
git checkout -b "$BRANCH"

# Copy corrected pages into repo
cp /tmp/PAGENAME.md ./PAGENAME.md
# ... repeat for each fixed page

git add -A
git commit -m "audit: fix stale content in [list of pages]

Co-Authored-By: Claude Opus 4.6 <noreply@anthropic.com>"
git push -u origin "$BRANCH"

gh pr create --repo lbruton/StakTrakrWiki \
  --title "[audit] $(date +%Y-%m-%d) — fix stale wiki content" \
  --body "$(cat <<'EOF'
## Summary
Automated wiki audit found stale content in the following pages.

## Pages fixed
- [list each page with what changed]

## Pages verified OK
- [list accurate pages]

Generated by `/wiki-audit` skill.
EOF
)"

git checkout main
```

## Report

The PR body serves as the audit report. If no pages need fixing, create a GitHub
issue instead to record that the audit passed:

```bash
gh issue create --repo lbruton/StakTrakrWiki \
  --title "[audit] $(date +%Y-%m-%d) — all pages verified OK" \
  --body "## Wiki Audit Report — $(date +%Y-%m-%d)

### Pages verified OK
- [list pages that were accurate]

No corrections needed.
"
```

## Write access policy

All changes go through a PR — branch protection on `main` requires review.
Mark genuinely uncertain sections with `> ⚠️ NEEDS VERIFICATION` rather than
leaving stale content. The PR description serves as the audit report.
