<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: card-view2.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: card-view2.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>// DEPRECATED (v3.30.09): This prototype file has been promoted to card-view.js.
// Kept for reference — will be removed in a future release.
// =============================================================================

// CARD VIEW RENDERING ENGINE (STAK-118)
// =============================================================================

/**
 * Returns the active card style from localStorage.
 * @returns {'A'|'B'|'C'|'D'}
 */
const getCardStyle = () => localStorage.getItem(CARD_STYLE_KEY) || 'A';

/**
 * Returns true when the card view (A/B/C) should be rendered instead of the table.
 * Style D = table view. When D is selected, returns false so inventory.js renders the table.
 * @returns {boolean}
 */
function isCardViewActive() {
  return getCardStyle() !== 'D';
}

/**
 * Computes portfolio summary totals for currently filtered items.
 * @returns {{ purchase: number, melt: number, retail: number, gainLoss: number, count: number }}
 */
function _computePortfolioSummary() {
  const items = (typeof filterInventory === 'function') ? filterInventory() : (inventory || []);
  let purchase = 0, melt = 0, retail = 0, count = 0;
  items.forEach(item => {
    const spot = (typeof spotPrices !== 'undefined' ? spotPrices[(item.metal || '').toLowerCase()] : 0) || 0;
    const qty = Number(item.qty) || 1;
    const itemMelt = (typeof computeMeltValue === 'function') ? computeMeltValue(item, spot) : 0;
    const gbPrice = (typeof getGoldbackRetailPrice === 'function') ? getGoldbackRetailPrice(item) : null;
    const mktVal = parseFloat(item.marketValue) || 0;
    const itemRetail = gbPrice ? gbPrice * qty : (mktVal > 0 ? mktVal * qty : itemMelt);
    const itemPurchase = (typeof item.price === 'number' ? item.price : parseFloat(item.price) || 0) * qty;
    purchase += itemPurchase;
    melt += itemMelt;
    retail += itemRetail;
    count++;
  });
  return { purchase, melt, retail, gainLoss: retail - purchase, count };
}

/**
 * Ensures the sort bar is always visible and syncs controls to the active view style.
 * Called after every renderTable() — works around inventory.js hiding the bar in table mode.
 */
function _syncSortBar() {
  const style = getCardStyle();
  const bar = document.getElementById('cardSortBar');
  if (!bar) return;

  // Always show the bar
  bar.style.display = 'flex';

  // Sort controls: invisible when in table view (D) — visibility:hidden preserves
  // layout so the summary stays centered; display:none would shift it right.
  const sortLeft = bar.querySelector('.card-sort-left');
  if (sortLeft) sortLeft.style.visibility = style === 'D' ? 'hidden' : '';

  // Sync style toggle active state
  const styleToggle = document.getElementById('cardStyleToggle');
  if (styleToggle) {
    styleToggle.querySelectorAll('.chip-sort-btn[data-style]').forEach(btn => {
      btn.classList.toggle('active', btn.dataset.style === style);
    });
  }

  // Update summary
  _renderSortBarSummary();

  // Body class for CSS hooks
  document.body.classList.toggle('view-mode-d', style === 'D');

  // Set table min-width directly (inline style beats any CSS specificity issue).
  // 1200px forces the table wider than typical tablet/mobile viewports so .portal-scroll scrolls.
  // At desktop (>1200px) width:100% naturally fills the container — no forced overflow there.
  const table = document.getElementById('inventoryTable');
  if (table) table.style.minWidth = style === 'D' ? '1200px' : '';

  // Custom horizontal scrollbar (show in D mode, hide in card modes)
  _syncHScrollBar(style === 'D');
}

// ---------------------------------------------------------------------------
// Custom horizontal scrollbar for D (table) mode
// ---------------------------------------------------------------------------

/** Whether the custom H-scroll bar event listeners have been wired */
let _hScrollWired = false;

/**
 * Creates the scrollbar DOM node (once) and inserts it after .portal-scroll.
 * @returns {{ track: HTMLElement, thumb: HTMLElement }|null}
 */
function _getOrCreateHScrollBar() {
  let track = document.getElementById('tableHScrollTrack');
  if (track) return { track, thumb: document.getElementById('tableHScrollThumb') };

  const portal = document.querySelector('.portal-scroll');
  if (!portal) return null;

  track = document.createElement('div');
  track.id = 'tableHScrollTrack';
  track.className = 'h-scroll-track';
  track.setAttribute('aria-hidden', 'true');

  const thumb = document.createElement('div');
  thumb.id = 'tableHScrollThumb';
  thumb.className = 'h-scroll-thumb';
  track.appendChild(thumb);

  // Insert immediately after the portal-scroll container
  portal.parentNode.insertBefore(track, portal.nextSibling);
  return { track, thumb };
}

/**
 * Recalculates thumb size and position from portal scroll state.
 */
function _updateHScrollThumb() {
  const track = document.getElementById('tableHScrollTrack');
  const thumb = document.getElementById('tableHScrollThumb');
  const portal = document.querySelector('.portal-scroll');
  const table = document.getElementById('inventoryTable');
  if (!track || !thumb || !portal || !table) return;

  const scrollWidth = table.scrollWidth;
  const clientWidth = portal.clientWidth;

  // Hide the bar if content fits (no scroll needed)
  if (scrollWidth &lt;= clientWidth + 2) {
    track.hidden = true;
    return;
  }
  track.hidden = false;

  const trackWidth = track.clientWidth || track.offsetWidth;
  const thumbWidth = Math.max(44, (clientWidth / scrollWidth) * trackWidth);
  const maxLeft = trackWidth - thumbWidth;
  const scrollPct = portal.scrollLeft / (scrollWidth - clientWidth);

  thumb.style.width = thumbWidth + 'px';
  thumb.style.transform = `translateX(${scrollPct * maxLeft}px)`;
}

/**
 * Shows or hides the custom H-scroll bar and wires events (once).
 * @param {boolean} show
 */
function _syncHScrollBar(show) {
  const result = _getOrCreateHScrollBar();
  if (!result) return;
  const { track, thumb } = result;

  // Constrain table-section so it can't inflate beyond its parent container.
  // Without this, table-section expands to match the table's min-width (1200px),
  // making portal.clientWidth === table.scrollWidth → no perceived overflow → scrollbar hidden.
  // overflow-x:hidden creates a BFC that locks the element to its parent's width.
  const tableSection = document.getElementById('tableSectionEl');
  if (tableSection) {
    tableSection.style.overflowX = show ? 'hidden' : '';
  }

  // Switch portal-scroll to always-show scroll mode so iOS creates a real scroll container
  const portal = document.querySelector('.portal-scroll');
  if (portal) {
    portal.style.overflowX = show ? 'scroll' : '';
    portal.style.maxWidth = show ? '100%' : '';
  }

  if (!show) {
    track.hidden = true;
    return;
  }

  _updateHScrollThumb();

  // Wire all events only once
  if (_hScrollWired) return;
  _hScrollWired = true;

  // Sync native scroll → thumb position
  if (portal) {
    portal.addEventListener('scroll', _updateHScrollThumb, { passive: true });
  }
  window.addEventListener('resize', _updateHScrollThumb, { passive: true });

  // ── Drag logic ──────────────────────────────────────────────────────────
  let dragging = false;
  let dragStartX = 0;
  let dragStartScrollLeft = 0;

  function clientX(e) {
    return (e.touches &amp;&amp; e.touches.length) ? e.touches[0].clientX : e.clientX;
  }

  function onDragStart(e) {
    if (!portal) return;
    dragging = true;
    dragStartX = clientX(e);
    dragStartScrollLeft = portal.scrollLeft;
    thumb.style.cursor = 'grabbing';
    e.preventDefault();
  }

  function onDragMove(e) {
    if (!dragging || !portal) return;
    const table = document.getElementById('inventoryTable');
    if (!table) return;
    const dx = clientX(e) - dragStartX;
    const trackWidth = track.clientWidth || track.offsetWidth;
    const thumbWidth = thumb.offsetWidth;
    const maxLeft = trackWidth - thumbWidth;
    const maxScroll = table.scrollWidth - portal.clientWidth;
    if (maxLeft &lt;= 0) return;
    portal.scrollLeft = dragStartScrollLeft + (dx / maxLeft) * maxScroll;
    _updateHScrollThumb();
    e.preventDefault();
  }

  function onDragEnd() {
    dragging = false;
    thumb.style.cursor = '';
  }

  thumb.addEventListener('mousedown', onDragStart);
  thumb.addEventListener('touchstart', onDragStart, { passive: false });
  document.addEventListener('mousemove', onDragMove);
  document.addEventListener('touchmove', onDragMove, { passive: false });
  document.addEventListener('mouseup', onDragEnd);
  document.addEventListener('touchend', onDragEnd);

  // Click-on-track to jump scroll position
  track.addEventListener('click', (e) => {
    if (!portal || e.target === thumb) return;
    const table = document.getElementById('inventoryTable');
    if (!table) return;
    const rect = track.getBoundingClientRect();
    const clickFrac = (clientX(e) - rect.left) / rect.width;
    portal.scrollLeft = clickFrac * (table.scrollWidth - portal.clientWidth);
    _updateHScrollThumb();
  });
}

/**
 * Renders the portfolio summary strip in the sort bar.
 */
function _renderSortBarSummary() {
  const el = document.getElementById('cardSortSummary');
  if (!el) return;
  const fmt = (typeof formatCurrency === 'function') ? formatCurrency : v => '$' + v.toFixed(2);
  const s = _computePortfolioSummary();
  const gl = s.gainLoss;
  const glClass = gl >= 0 ? 'summary-positive' : 'summary-negative';
  const glSign = gl >= 0 ? '+' : '';
  el.innerHTML =
    `&lt;span class="summary-item">&lt;span class="summary-label">Buy&lt;/span>&lt;span class="summary-val">${fmt(s.purchase)}&lt;/span>&lt;/span>` +
    `&lt;span class="summary-sep">·&lt;/span>` +
    `&lt;span class="summary-item">&lt;span class="summary-label">Melt&lt;/span>&lt;span class="summary-val">${fmt(s.melt)}&lt;/span>&lt;/span>` +
    `&lt;span class="summary-sep">·&lt;/span>` +
    `&lt;span class="summary-item">&lt;span class="summary-label">Market&lt;/span>&lt;span class="summary-val">${fmt(s.retail)}&lt;/span>&lt;/span>` +
    `&lt;span class="summary-sep">·&lt;/span>` +
    `&lt;span class="summary-item ${glClass}">&lt;span class="summary-label">G/L&lt;/span>&lt;span class="summary-val">${glSign}${fmt(gl)}&lt;/span>&lt;/span>`;
}

// ---------------------------------------------------------------------------
// SVG Sparkline helpers
// ---------------------------------------------------------------------------

/**
 * Converts an array of numeric values to SVG polyline coordinate string.
 * @param {number[]} data - Data points
 * @param {number} w - SVG viewBox width
 * @param {number} h - SVG viewBox height
 * @param {number} [padY=4] - Vertical padding
 * @returns {string} Space-separated "x,y" pairs
 */
const dataToPolyline = (data, w, h, padY = 4) => {
  if (data.length === 0) return '';
  if (data.length === 1) return `0,${(h / 2).toFixed(1)}`;
  const min = Math.min(...data);
  const max = Math.max(...data);
  const range = max - min || 1;
  return data
    .map((v, i) => {
      const x = (i / (data.length - 1)) * w;
      const y = padY + ((max - v) / range) * (h - padY * 2);
      return `${x.toFixed(1)},${y.toFixed(1)}`;
    })
    .join(' ');
};

/**
 * Generates a "since purchased" 3-line sparkline SVG matching the view modal pattern.
 * Red dashed = purchase price (flat), Green = melt value over time, Blue = retail/market value.
 * Uses real spot history with timestamps when available.
 * @param {object} item - Inventory item
 * @param {number} w - SVG viewBox width
 * @param {number} h - SVG viewBox height
 * @param {object} [opts] - Options
 * @param {number} [opts.opacity=1] - SVG opacity
 * @param {number} [opts.points=60] - Number of data points
 * @returns {string} SVG markup string
 */
const generateSparklineSVG = (item, w, h, opts = {}) => {
  const opacity = opts.opacity || 1;
  const points = opts.points || 60;
  const metal = (item.metal || '').toLowerCase();
  const weightOz = parseFloat(item.weight) || 1;
  const qty = Number(item.qty) || 1;
  const purity = parseFloat(item.purity) || 1;
  const meltFactor = weightOz * qty * purity;
  const purchasePerUnit = parseFloat(item.price) || 0;
  const purchaseTotal = purchasePerUnit * qty;
  const currentRetail = (parseFloat(item.marketValue) || 0) * qty;

  // Try real spot history with timestamps
  let spotEntries;
  if (typeof getSpotHistoryForMetal === 'function') {
    spotEntries = getSpotHistoryForMetal(metal, points, true);
  }

  let meltData, purchaseData, retailData;

  if (spotEntries &amp;&amp; spotEntries.length >= 2) {
    // Prepend synthetic entry at purchase date if before earliest spot
    const purchaseDate = item.date ? new Date(item.date).getTime() : 0;
    if (purchaseDate > 0 &amp;&amp; purchaseDate &lt; spotEntries[0].ts) {
      spotEntries.unshift({ ts: purchaseDate, spot: spotEntries[0].spot });
    }

    // Melt line: spot * meltFactor over time (green)
    meltData = spotEntries.map(e => e.spot * meltFactor);

    // Purchase line: flat reference (red dashed)
    purchaseData = spotEntries.map(() => purchaseTotal || 1);

    // Retail line: anchored sparse line (blue) — purchase at start, current at end
    // with itemPriceHistory midpoints if available
    retailData = new Array(spotEntries.length).fill(null);

    // Anchor start: purchase price
    if (purchaseTotal > 0) retailData[0] = purchaseTotal;

    // Middle: sparse retail snapshots from itemPriceHistory
    if (typeof itemPriceHistory !== 'undefined' &amp;&amp; item.uuid) {
      const history = itemPriceHistory[item.uuid] || [];
      for (const re of history) {
        if (re.retail > 0) {
          // Find nearest spot entry index
          let best = 0, bestDist = Math.abs(spotEntries[0].ts - re.ts);
          for (let i = 1; i &lt; spotEntries.length; i++) {
            const dist = Math.abs(spotEntries[i].ts - re.ts);
            if (dist &lt; bestDist) { best = i; bestDist = dist; }
          }
          retailData[best] = re.retail * qty;
        }
      }
    }

    // Anchor end: current retail/market value
    if (currentRetail > 0) {
      retailData[spotEntries.length - 1] = currentRetail;
    }

    // Interpolate nulls for SVG polyline (spanGaps equivalent)
    retailData = _interpolateNulls(retailData);
  } else {
    // No history — flat lines as fallback
    const currentSpot = (typeof spotPrices !== 'undefined' &amp;&amp; spotPrices[metal]) || 0;
    const meltVal = currentSpot * meltFactor;
    meltData = Array(points).fill(meltVal || 1);
    purchaseData = Array(points).fill(purchaseTotal || 1);
    const retailVal = currentRetail > 0 ? currentRetail : meltVal;
    retailData = Array(points).fill(retailVal || 1);
  }

  // Use shared scale across all 3 lines so they're comparable
  const allVals = [...meltData, ...purchaseData, ...retailData];
  const globalMin = Math.min(...allVals);
  const globalMax = Math.max(...allVals);

  const meltLine = _dataToPolylineScaled(meltData, w, h, globalMin, globalMax);
  const purchaseLine = _dataToPolylineScaled(purchaseData, w, h, globalMin, globalMax);
  const retailLine = _dataToPolylineScaled(retailData, w, h, globalMin, globalMax);

  const uid = (item.uuid || item.name || '').replace(/[^a-z0-9]/gi, '').slice(0, 20);
  const meltGradId = `meltFill-${uid}`;
  const purchGradId = `purchFill-${uid}`;
  const meltFillPoints = `${meltLine} ${w},${h} 0,${h}`;
  const purchFillPoints = `${purchaseLine} ${w},${h} 0,${h}`;

  // Theme-aware — bold strokes and fills on light/sepia backgrounds
  const _svgTheme = document.documentElement.getAttribute('data-theme') || 'light';
  const _lt = _svgTheme === 'light' || _svgTheme === 'sepia';
  const _meltStroke = _lt ? '#047857' : '#10b981';
  const _purchStroke = _lt ? '#b91c1c' : '#ef4444';
  const _retailStroke = _lt ? '#1d4ed8' : '#3b82f6';
  const _meltFillOp = _lt ? '0.70' : '0.18';
  const _purchFillOp = _lt ? '0.50' : '0.08';
  const _sw = _lt ? '3.5' : '1.5';
  const _purchOp = _lt ? '1' : '0.85';

  return `&lt;svg viewBox="0 0 ${w} ${h}" preserveAspectRatio="none" xmlns="http://www.w3.org/2000/svg" style="opacity:${opacity}">` +
    `&lt;defs>` +
    `&lt;linearGradient id="${meltGradId}" x1="0" y1="0" x2="0" y2="1">` +
    `&lt;stop offset="0%" stop-color="${_meltStroke}" stop-opacity="${_meltFillOp}"/>` +
    `&lt;stop offset="100%" stop-color="${_meltStroke}" stop-opacity="0"/>` +
    `&lt;/linearGradient>` +
    `&lt;linearGradient id="${purchGradId}" x1="0" y1="0" x2="0" y2="1">` +
    `&lt;stop offset="0%" stop-color="${_purchStroke}" stop-opacity="${_purchFillOp}"/>` +
    `&lt;stop offset="100%" stop-color="${_purchStroke}" stop-opacity="0"/>` +
    `&lt;/linearGradient>` +
    `&lt;/defs>` +
    `&lt;polygon points="${purchFillPoints}" fill="url(#${purchGradId})"/>` +
    `&lt;polygon points="${meltFillPoints}" fill="url(#${meltGradId})"/>` +
    `&lt;polyline points="${meltLine}" fill="none" stroke="${_meltStroke}" stroke-width="${_sw}" stroke-linecap="round"/>` +
    `&lt;polyline points="${purchaseLine}" fill="none" stroke="${_purchStroke}" stroke-width="${_sw}" stroke-dasharray="4,3" opacity="${_purchOp}"/>` +
    `&lt;polyline points="${retailLine}" fill="none" stroke="${_retailStroke}" stroke-width="${_sw}" stroke-linecap="round"/>` +
    `&lt;/svg>`;
};

/**
 * Interpolate null gaps in an array for SVG rendering (equivalent to Chart.js spanGaps).
 * @param {(number|null)[]} arr
 * @returns {number[]}
 */
const _interpolateNulls = (arr) => {
  const result = [...arr];
  // Find first non-null
  let firstIdx = result.findIndex(v => v !== null);
  if (firstIdx &lt; 0) return result.map(() => 0);

  // Fill leading nulls
  for (let i = 0; i &lt; firstIdx; i++) result[i] = result[firstIdx];

  // Find last non-null and fill trailing
  let lastIdx = result.length - 1;
  while (lastIdx >= 0 &amp;&amp; result[lastIdx] === null) lastIdx--;
  for (let i = lastIdx + 1; i &lt; result.length; i++) result[i] = result[lastIdx];

  // Interpolate interior nulls
  for (let i = firstIdx + 1; i &lt; lastIdx; i++) {
    if (result[i] !== null) continue;
    // Find next non-null
    let nextIdx = i + 1;
    while (nextIdx &lt; result.length &amp;&amp; result[nextIdx] === null) nextIdx++;
    const prevVal = result[i - 1];
    const nextVal = result[nextIdx];
    const span = nextIdx - (i - 1);
    for (let j = i; j &lt; nextIdx; j++) {
      result[j] = prevVal + (nextVal - prevVal) * ((j - (i - 1)) / span);
    }
  }
  return result;
};

/**
 * Converts data to SVG polyline using a shared min/max scale.
 * @param {number[]} data
 * @param {number} w - SVG width
 * @param {number} h - SVG height
 * @param {number} globalMin
 * @param {number} globalMax
 * @param {number} [padY=4]
 * @returns {string}
 */
const _dataToPolylineScaled = (data, w, h, globalMin, globalMax, padY = 4) => {
  if (data.length === 0) return '';
  if (data.length === 1) {
    const y = padY + ((globalMax - data[0]) / (globalMax - globalMin || 1)) * (h - padY * 2);
    return `0,${y.toFixed(1)}`;
  }
  const range = globalMax - globalMin || 1;
  return data
    .map((v, i) => {
      const x = (i / (data.length - 1)) * w;
      const y = padY + ((globalMax - v) / range) * (h - padY * 2);
      return `${x.toFixed(1)},${y.toFixed(1)}`;
    })
    .join(' ');
};

// ---------------------------------------------------------------------------
// Shared helpers
// ---------------------------------------------------------------------------

/**
 * Returns metal CSS class for card border/accent.
 * @param {string} metal
 * @returns {string}
 */
const _cardMetalClass = (metal) => `metal-${(metal || 'silver').toLowerCase()}`;

/**
 * Returns coin image HTML. Renders an &lt;img> with data attributes for async
 * ImageCache resolution (same pattern as table thumbnails in inventory.js).
 * Falls back to a metal-initial placeholder via onerror.
 * @param {object} item
 * @param {string} [extraClass='']
 * @param {string} [side='obverse'] - 'obverse' or 'reverse'
 * @returns {string}
 */
const _cardImageHTML = (item, extraClass = '', side = 'obverse') => {
  const itemType = (item.type || '').toLowerCase();
  const isRect = itemType === 'bar' || itemType === 'note' || itemType === 'aurum'
    || itemType === 'set' || item.weightUnit === 'gb';
  const shape = isRect ? ' bar-shape' : '';
  const uuid = item.uuid || '';
  const catalogId = item.numistaId || '';
  const metalKey = (item.metal || '').toLowerCase();

  // Initial src from item data (CDN URL) if available
  const urlKey = side === 'reverse' ? 'reverseImageUrl' : 'obverseImageUrl';
  const rawUrl = item[urlKey] || '';
  const directUrl = (rawUrl &amp;&amp; /^https?:\/\/.+\..+/i.test(rawUrl)) ? rawUrl : '';
  const srcAttr = directUrl ? ` src="${_cvEscapeAttr(directUrl)}"` : '';

  const fitStyle = isRect ? 'object-fit:contain;' : 'object-fit:cover;';

  return `&lt;div class="coin-img${shape}${extraClass}" data-metal="${_cvEscapeAttr(metalKey)}">` +
    `&lt;img class="cv-thumb" data-side="${side}"${srcAttr}` +
    ` data-catalog-id="${_cvEscapeAttr(catalogId)}"` +
    ` data-item-uuid="${_cvEscapeAttr(uuid)}"` +
    ` data-item-name="${_cvEscapeAttr(item.name || '')}"` +
    ` data-item-metal="${_cvEscapeAttr(metalKey)}"` +
    ` data-item-type="${_cvEscapeAttr(item.type || '')}"` +
    ` alt="" loading="lazy" style="${directUrl ? '' : 'display:none;'}width:100%;height:100%;${fitStyle}border-radius:inherit;"` +
    ` onerror="this.style.display='none';this.nextElementSibling.style.display='flex';" />` +
    `&lt;div class="cv-no-image" style="display:${directUrl ? 'none' : 'flex'}">&lt;/div>` +
    `&lt;/div>`;
};

/**
 * Escapes HTML attribute values — fallback for card-view context.
 * The main escapeAttribute lives in inventory.js (loaded before this file).
 * @param {string} s
 * @returns {string}
 */
const _cvEscapeAttr = (s) => {
  if (typeof escapeAttribute === 'function') return escapeAttribute(s);
  return String(s || '').replace(/&amp;/g, '&amp;amp;').replace(/"/g, '&amp;quot;').replace(/&lt;/g, '&amp;lt;').replace(/>/g, '&amp;gt;');
};

/**
 * Builds chip HTML for card views.
 * @param {object} item
 * @param {boolean} [small=false]
 * @returns {string}
 */
const _cardChipsHTML = (item, small = false) => {
  const s = small ? ' style="font-size:0.58rem;padding:0.05rem 0.35rem"' : '';
  const type = (item.type || 'coin').toLowerCase();
  let h = `&lt;span class="cv-chip cv-chip-type ${type}"${s}>${sanitizeHtml(type)}&lt;/span>`;
  if (item.year) h += `&lt;span class="cv-chip cv-chip-year"${s}>${sanitizeHtml(String(item.year))}&lt;/span>`;
  if (item.grade) h += `&lt;span class="cv-chip cv-chip-grade"${s}>${sanitizeHtml(item.grade)}&lt;/span>`;
  const qty = Number(item.qty) || 1;
  if (qty > 1) h += `&lt;span class="cv-chip cv-chip-qty"${s}>x${qty}&lt;/span>`;
  const _wUnit = (item.weightUnit || 'oz').toLowerCase() === 'gb' ? 'gb' : (item.weightUnit || 'oz');
  h += `&lt;span class="cv-chip cv-chip-weight"${s}>${sanitizeHtml(item.weight || '')} ${sanitizeHtml(_wUnit)}&lt;/span>`;
  return h;
};

/**
 * Format currency using app's formatCurrency or simple fallback.
 */
const _cardFmt = (n) => {
  if (typeof formatCurrency === 'function') return formatCurrency(Math.abs(n));
  return '$' + Math.abs(n).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
};

const _gainClass = (gl) => (gl >= 0 ? 'cv-gain' : 'cv-loss');
const _gainSign = (gl) => (gl >= 0 ? '+' : '-');
const _gainArrow = (gl) => (gl >= 0 ? '&amp;#9650;' : '&amp;#9660;');

// ---------------------------------------------------------------------------
// Card renderers — A through D
// ---------------------------------------------------------------------------

/**
 * Renders Card Style A: Sparkline Header with stacked images.
 * @param {object} item - Inventory item
 * @param {number} idx - Original inventory index
 * @param {object} computed - Pre-computed financial values
 * @returns {string}
 */
const renderCardA = (item, idx, computed) => {
  const { purchaseTotal, retailTotal, gainLoss } = computed;
  const gl = gainLoss ?? 0;
  const pct = purchaseTotal > 0 ? ((gl / purchaseTotal) * 100) : 0;

  return `&lt;article class="card-a ${_cardMetalClass(item.metal)}" data-idx="${idx}">` +
    `&lt;div class="card-a-chart-wrap">&lt;canvas class="card-a-canvas" data-metal="${_cvEscapeAttr((item.metal || '').toLowerCase())}" data-weight="${parseFloat(item.weight) || 1}" data-qty="${Number(item.qty) || 1}" data-purity="${parseFloat(item.purity) || 1}" data-price="${parseFloat(item.price) || 0}" data-market="${parseFloat(item.marketValue) || 0}" data-date="${_cvEscapeAttr(item.date || '')}">&lt;/canvas>&lt;/div>` +
    `&lt;div class="card-body">` +
      `&lt;div class="cv-item-name">${sanitizeHtml(item.name || '')}&lt;/div>` +
      `&lt;div class="cv-chips-img-row">&lt;div class="cv-chips-row">${_cardChipsHTML(item)}&lt;/div>&lt;div class="cv-images-row cv-images-sm">${_cardImageHTML(item, '', 'obverse')}${_cardImageHTML(item, '', 'reverse')}&lt;/div>&lt;/div>` +
      `&lt;div class="cv-value-row">` +
        `&lt;span class="cv-value-journey">${_cardFmt(purchaseTotal)}&lt;span class="cv-arrow">&amp;rarr;&lt;/span>${_cardFmt(retailTotal)}&lt;/span>` +
        `&lt;span class="cv-value-gain ${_gainClass(gl)}">${_gainArrow(gl)} ${_gainSign(gl)}${_cardFmt(gl)} (${_gainSign(gl)}${Math.abs(pct).toFixed(1)}%)&lt;/span>` +
      `&lt;/div>` +
    `&lt;/div>` +
  `&lt;/article>`;
};

/**
 * Renders Card Style B: Full-Bleed Overlay with hero gain number.
 */
const renderCardB = (item, idx, computed) => {
  const { purchaseTotal, retailTotal, gainLoss } = computed;
  const gl = gainLoss ?? 0;
  const pct = purchaseTotal > 0 ? ((gl / purchaseTotal) * 100) : 0;

  return `&lt;article class="card-b ${_cardMetalClass(item.metal)}" data-idx="${idx}">` +
    `&lt;div class="sparkline-bg">${generateSparklineSVG(item, 400, 180)}&lt;/div>` +
    `&lt;div class="card-content">` +
      `&lt;div class="cv-images-row cv-images-center">${_cardImageHTML(item, '', 'obverse')}${_cardImageHTML(item, '', 'reverse')}&lt;/div>` +
      `&lt;div class="cv-item-name">${sanitizeHtml(item.name || '')}&lt;/div>` +
      `&lt;div class="cv-chips-row cv-chips-center">${_cardChipsHTML(item)}&lt;/div>` +
      `&lt;div class="cv-value-hero ${_gainClass(gl)}">${_gainSign(gl)}${_cardFmt(gl)}&lt;/div>` +
      `&lt;div class="cv-value-detail">${_cardFmt(purchaseTotal)} cost &amp;rarr; ${_cardFmt(retailTotal)} retail &amp;middot; ${_gainSign(gl)}${Math.abs(pct).toFixed(1)}%&lt;/div>` +
    `&lt;/div>` +
  `&lt;/article>`;
};

/**
 * Renders Card Style C: Split Card (image left, data right).
 */
const renderCardC = (item, idx, computed) => {
  const { purchaseTotal, retailTotal, gainLoss } = computed;
  const gl = gainLoss ?? 0;

  return `&lt;article class="card-c ${_cardMetalClass(item.metal)}" data-idx="${idx}">` +
    `&lt;div class="cv-image-col">` +
      `${_cardImageHTML(item, '', 'obverse')}` +
      `${_cardImageHTML(item, '', 'reverse')}` +
      `&lt;div class="cv-sparkline-strip">&lt;svg viewBox="0 0 4 120" preserveAspectRatio="none">&lt;rect width="4" height="120" rx="2" fill="var(--metal-color)" opacity="0.3"/>&lt;/svg>&lt;/div>` +
    `&lt;/div>` +
    `&lt;div class="cv-data-col">` +
      `&lt;div class="cv-item-name">${sanitizeHtml(item.name || '')}&lt;/div>` +
      `&lt;div class="cv-chips-row">${_cardChipsHTML(item, true)}&lt;/div>` +
      `&lt;div class="cv-value-row">` +
        `&lt;span class="cv-value-journey">${_cardFmt(purchaseTotal)}&lt;span class="cv-arrow">&amp;rarr;&lt;/span>${_cardFmt(retailTotal)}&lt;/span>` +
        `&lt;span class="cv-value-gain ${_gainClass(gl)}">${_gainArrow(gl)} ${_gainSign(gl)}${_cardFmt(gl)}&lt;/span>` +
      `&lt;/div>` +
    `&lt;/div>` +
  `&lt;/article>`;
};


// ---------------------------------------------------------------------------
// Main card view renderer
// ---------------------------------------------------------------------------

const _cardRenderers = { A: renderCardA, B: renderCardB, C: renderCardC };

/**
 * Renders all items as cards into the given container.
 * @param {object[]} sortedItems - Sorted/filtered inventory items
 * @param {HTMLElement} container - Target container element
 */
const renderCardView = (sortedItems, container) => {
  const style = getCardStyle();
  const renderer = _cardRenderers[style] || renderCardB;

  const html = sortedItems.map(item => {
    const originalIdx = inventory.indexOf(item);
    const currentSpot = (typeof spotPrices !== 'undefined' ? spotPrices[(item.metal || '').toLowerCase()] : 0) || 0;
    const qty = Number(item.qty) || 1;
    const meltValue = typeof computeMeltValue === 'function' ? computeMeltValue(item, currentSpot) : 0;
    const gbDenomPrice = (typeof getGoldbackRetailPrice === 'function') ? getGoldbackRetailPrice(item) : null;
    const marketValue = parseFloat(item.marketValue) || 0;
    const isManualRetail = !gbDenomPrice &amp;&amp; marketValue > 0;
    const retailTotal = gbDenomPrice ? gbDenomPrice * qty
                      : isManualRetail ? marketValue * qty
                      : meltValue;
    const purchasePrice = typeof item.price === 'number' ? item.price : parseFloat(item.price) || 0;
    const purchaseTotal = purchasePrice * qty;
    const gainLoss = (currentSpot > 0 || isManualRetail || gbDenomPrice) ? retailTotal - purchaseTotal : null;

    return renderer(item, originalIdx, { purchaseTotal, retailTotal, meltValue, gainLoss });
  });

  // Revoke previous card blob URLs to prevent memory leaks
  for (const url of _cvBlobUrls) {
    try { URL.revokeObjectURL(url); } catch { /* ignore */ }
  }
  _cvBlobUrls = [];

  // nosemgrep: javascript.browser.security.insecure-innerhtml.insecure-innerhtml
  container.innerHTML = html.join('');

  // Async image enhancement from ImageCache (fire-and-forget)
  _enhanceCardImages(container);

  // Initialize Chart.js charts on Card A canvases
  _initCardCharts(container);

};

// ---------------------------------------------------------------------------
// Chart.js card charts (Card A) — mirrors view modal pattern
// ---------------------------------------------------------------------------

/** @type {Chart[]} Active card chart instances to destroy on re-render */
let _cvChartInstances = [];

/**
 * Initializes Chart.js mini-charts on all .card-a-canvas elements.
 * Reads spot history data from the canvas data attributes and builds
 * the same 3-line chart as the view modal (purchase/melt/retail).
 * @param {HTMLElement} container
 */
function _initCardCharts(container) {
  // Destroy previous instances
  for (const chart of _cvChartInstances) {
    try { chart.destroy(); } catch { /* ignore */ }
  }
  _cvChartInstances = [];

  if (typeof Chart === 'undefined') return;

  const canvases = container.querySelectorAll('.card-a-canvas');
  for (const canvas of canvases) {
    const metal = canvas.dataset.metal || '';
    const weightOz = parseFloat(canvas.dataset.weight) || 1;
    const qty = parseInt(canvas.dataset.qty, 10) || 1;
    const purity = parseFloat(canvas.dataset.purity) || 1;
    const meltFactor = weightOz * qty * purity;
    const purchasePerUnit = parseFloat(canvas.dataset.price) || 0;
    const purchaseTotal = purchasePerUnit * qty;
    const marketValue = parseFloat(canvas.dataset.market) || 0;
    const currentRetail = marketValue * qty;
    const purchaseDate = canvas.dataset.date ? new Date(canvas.dataset.date).getTime() : 0;

    // Get spot history with timestamps
    let spotEntries = [];
    if (typeof getSpotHistoryForMetal === 'function') {
      spotEntries = getSpotHistoryForMetal(metal, 60, true) || [];
    }
    if (spotEntries.length &lt; 2) continue; // No chart without data

    // Prepend synthetic entry at purchase date
    if (purchaseDate > 0 &amp;&amp; spotEntries.length > 0 &amp;&amp; purchaseDate &lt; spotEntries[0].ts) {
      spotEntries.unshift({ ts: purchaseDate, spot: spotEntries[0].spot });
    }

    // Build labels (compact dates)
    const labels = spotEntries.map(e => {
      const d = new Date(e.ts);
      return d.toLocaleDateString(undefined, { month: 'short', day: 'numeric' });
    });

    // Melt line: spot * meltFactor
    const meltData = spotEntries.map(e => parseFloat((e.spot * meltFactor).toFixed(2)));

    // Purchase line: flat
    const purchaseLine = spotEntries.map(() => purchaseTotal);

    // Retail line: anchored sparse (purchase at start → current at end)
    const retailData = new Array(spotEntries.length).fill(null);
    if (purchaseTotal > 0) retailData[0] = purchaseTotal;

    // Sparse midpoints from itemPriceHistory
    if (typeof itemPriceHistory !== 'undefined') {
      const itemUuid = canvas.closest('[data-idx]')?.dataset.idx;
      const item = typeof inventory !== 'undefined' &amp;&amp; itemUuid ? inventory[parseInt(itemUuid, 10)] : null;
      if (item?.uuid) {
        const history = itemPriceHistory[item.uuid] || [];
        for (const re of history) {
          if (re.retail > 0) {
            let best = 0, bestDist = Math.abs(spotEntries[0].ts - re.ts);
            for (let i = 1; i &lt; spotEntries.length; i++) {
              const dist = Math.abs(spotEntries[i].ts - re.ts);
              if (dist &lt; bestDist) { best = i; bestDist = dist; }
            }
            retailData[best] = re.retail * qty;
          }
        }
      }
    }
    if (currentRetail > 0) retailData[spotEntries.length - 1] = currentRetail;

    const hasRetail = retailData.some(v => v !== null);

    // Theme-aware chart colors — bold lines/fills for light &amp; sepia
    const _theme = document.documentElement.getAttribute('data-theme') || 'light';
    const _isLight = _theme === 'light' || _theme === 'sepia';
    const datasets = [
      {
        label: 'Purchase',
        data: purchaseLine,
        borderColor: _isLight ? '#b91c1c' : '#ef4444',
        backgroundColor: _isLight ? 'rgba(185, 28, 28, 0.15)' : 'rgba(239, 68, 68, 0.06)',
        fill: 'origin',
        borderDash: [6, 3],
        tension: 0,
        pointRadius: 0,
        pointHoverRadius: 0,
        borderWidth: _isLight ? 3 : 1.5,
        order: 1,
      },
      {
        label: 'Melt',
        data: meltData,
        borderColor: _isLight ? '#047857' : '#10b981',
        backgroundColor: _isLight ? 'rgba(4, 120, 87, 0.25)' : 'rgba(16, 185, 129, 0.18)',
        fill: 'origin',
        tension: 0.3,
        pointRadius: 0,
        pointHoverRadius: 3,
        borderWidth: _isLight ? 3 : 2,
        order: 3,
      },
      {
        label: 'Retail',
        data: retailData,
        borderColor: _isLight ? '#1d4ed8' : '#3b82f6',
        backgroundColor: _isLight ? 'rgba(29, 78, 216, 0.15)' : 'rgba(59, 130, 246, 0.12)',
        fill: 'origin',
        tension: 0.3,
        spanGaps: true,
        pointRadius: 0,
        pointHoverRadius: 3,
        borderWidth: _isLight ? 3 : 1.5,
        hidden: !hasRetail,
        order: 2,
      },
    ];

    const chart = new Chart(canvas, {
      type: 'line',
      data: { labels, datasets },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        animation: { duration: 0 },
        interaction: { mode: 'index', intersect: false },
        scales: {
          x: {
            ticks: {
              color: typeof getChartTextColor === 'function' ? getChartTextColor() : '#8b949e',
              maxTicksLimit: 4,
              autoSkip: true,
              font: { size: 8 },
              maxRotation: 0,
            },
            grid: { display: false },
          },
          y: {
            ticks: {
              color: typeof getChartTextColor === 'function' ? getChartTextColor() : '#8b949e',
              maxTicksLimit: 3,
              font: { size: 8 },
              callback: function(value) {
                return typeof formatCurrency === 'function' ? formatCurrency(value) : '$' + value;
              },
            },
            grid: { color: 'rgba(128,128,128,0.08)' },
          },
        },
        plugins: {
          legend: {
            display: true,
            position: 'bottom',
            labels: {
              color: typeof getChartTextColor === 'function' ? getChartTextColor() : '#8b949e',
              usePointStyle: true,
              pointStyle: 'line',
              padding: 6,
              boxWidth: 16,
              font: { size: 8 },
            },
          },
          tooltip: {
            enabled: true,
            backgroundColor: 'rgba(0,0,0,0.8)',
            titleColor: '#fff',
            bodyColor: '#fff',
            padding: 6,
            bodyFont: { size: 10 },
            titleFont: { size: 10 },
            callbacks: {
              label: function(ctx) {
                if (ctx.parsed.y === null) return null;
                const val = typeof formatCurrency === 'function' ? formatCurrency(ctx.parsed.y) : '$' + ctx.parsed.y.toFixed(2);
                return `${ctx.dataset.label}: ${val}`;
              }
            }
          }
        }
      }
    });
    _cvChartInstances.push(chart);
  }
}

// ---------------------------------------------------------------------------
// Image enhancement — async load from ImageCache
// ---------------------------------------------------------------------------

/** @type {string[]} Blob URLs to revoke on next render */
let _cvBlobUrls = [];

/** @type {IntersectionObserver|null} */
let _cvImageObserver = null;

/**
 * Enhances card thumbnail images from IndexedDB ImageCache.
 * Uses IntersectionObserver for lazy loading (same pattern as table thumbnails).
 * @param {HTMLElement} container
 */
async function _enhanceCardImages(container) {
  if (typeof featureFlags === 'undefined' || !featureFlags.isEnabled('COIN_IMAGES')) return;
  if (!window.imageCache?.isAvailable()) return;

  if (_cvImageObserver) _cvImageObserver.disconnect();

  _cvImageObserver = new IntersectionObserver((entries) => {
    for (const entry of entries) {
      if (!entry.isIntersecting) continue;
      _cvImageObserver.unobserve(entry.target);
      // Observe the visible .coin-img wrapper, find the img inside
      const img = entry.target.querySelector('.cv-thumb');
      if (img) _loadCardImage(img);
    }
  }, { rootMargin: '200px 0px' });

  container.querySelectorAll('.coin-img').forEach(wrapper => {
    _cvImageObserver.observe(wrapper);
  });
}

/**
 * Resolves and sets blob URL for a single card thumbnail image.
 * @param {HTMLImageElement} img
 */
async function _loadCardImage(img) {
  try {
    const item = {
      uuid: img.dataset.itemUuid || '',
      numistaId: img.dataset.catalogId || '',
      name: img.dataset.itemName || '',
      metal: img.dataset.itemMetal || '',
      type: img.dataset.itemType || '',
    };
    const side = img.dataset.side || 'obverse';

    // Resolve CDN URL from inventory item
    const idx = img.closest('[data-idx]')?.dataset.idx;
    let cdnUrl = '';
    if (idx !== undefined &amp;&amp; typeof inventory !== 'undefined') {
      const invItem = inventory[parseInt(idx, 10)];
      if (invItem) {
        const urlKey = side === 'reverse' ? 'reverseImageUrl' : 'obverseImageUrl';
        cdnUrl = (invItem[urlKey] &amp;&amp; /^https?:\/\/.+\..+/i.test(invItem[urlKey])) ? invItem[urlKey] : '';
      }
    }

    // Numista override: CDN URLs (Numista source) win over user/pattern blobs
    const numistaOverride = localStorage.getItem('numistaOverridePersonal') === 'true';
    if (numistaOverride &amp;&amp; cdnUrl) {
      _showCardImage(img, cdnUrl);
      return;
    }

    // Try IDB resolution cascade (user → pattern → numista cache)
    if (window.imageCache?.isAvailable()) {
      const resolved = await imageCache.resolveImageForItem(item);
      if (resolved) {
        let blobUrl;
        if (resolved.source === 'user') {
          blobUrl = await imageCache.getUserImageUrl(resolved.catalogId, side);
        } else if (resolved.source === 'pattern') {
          blobUrl = await imageCache.getPatternImageUrl(resolved.catalogId, side);
        } else {
          blobUrl = await imageCache.getImageUrl(resolved.catalogId, side);
        }

        if (blobUrl) {
          _cvBlobUrls.push(blobUrl);
          _showCardImage(img, blobUrl);
          return;
        }
      }
    }

    // Fallback: CDN URL
    if (cdnUrl) {
      _showCardImage(img, cdnUrl);
      return;
    }
  } catch { /* ignore — IDB unavailable or entry missing */ }
}

/**
 * Show a card image and hide its placeholder.
 * @param {HTMLImageElement} img
 * @param {string} url
 */
function _showCardImage(img, url) {
  img.src = url;
  img.style.display = '';
  const placeholder = img.nextElementSibling;
  if (placeholder) placeholder.style.display = 'none';
}

// ---------------------------------------------------------------------------
// Delegated click handler for card grid
// ---------------------------------------------------------------------------

/** @type {boolean} */
let _cardClickBound = false;

/**
 * Binds a delegated click handler on the card grid container.
 * @param {HTMLElement} container
 */
const bindCardClickHandler = (container) => {
  if (_cardClickBound) return;
  _cardClickBound = true;
  container.addEventListener('click', (e) => {
    const card = e.target.closest('[data-idx]');
    if (!card) return;
    const idx = Number(card.dataset.idx);
    if (typeof showViewModal === 'function') {
      showViewModal(idx);
    } else if (typeof editItem === 'function') {
      editItem(idx);
    }
  });
};

// ---------------------------------------------------------------------------
// Card Sort Bar — sort controls + style toggle (STAK-131)
// ---------------------------------------------------------------------------

/** @type {boolean} Whether card sort bar event listeners have been bound */
let _cardSortBarBound = false;

/**
 * Updates the card sort bar UI to reflect current sort state and card style.
 * Called from renderTable() whenever card view (A/B/C) is active.
 * For D mode, _syncSortBar handles everything via MutationObserver.
 */
const updateCardSortBar = () => {
  // Sync sort dropdown with current sortColumn
  const colSelect = document.getElementById('cardSortColumn');
  if (colSelect &amp;&amp; colSelect.value !== String(sortColumn)) {
    colSelect.value = String(sortColumn);
  }

  // Sync direction button
  const dirBtn = document.getElementById('cardSortDirBtn');
  if (dirBtn) {
    dirBtn.setAttribute('data-dir', sortDirection);
    dirBtn.title = sortDirection === 'asc' ? 'Ascending — click to reverse' : 'Descending — click to reverse';
  }

  _syncSortBar();
};

/**
 * Binds event listeners on the card sort bar (once).
 * Also sets up the MutationObserver that keeps the bar visible in D (table) mode.
 */
const initCardSortBar = () => {
  if (_cardSortBarBound) return;
  _cardSortBarBound = true;

  // Sort column dropdown
  const colSelect = document.getElementById('cardSortColumn');
  if (colSelect) {
    colSelect.addEventListener('change', () => {
      sortColumn = parseInt(colSelect.value, 10);
      if (typeof renderTable === 'function') renderTable();
    });
  }

  // Sort direction toggle
  const dirBtn = document.getElementById('cardSortDirBtn');
  if (dirBtn) {
    dirBtn.addEventListener('click', () => {
      sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
      if (typeof renderTable === 'function') renderTable();
    });
  }

  // Style A/B/C/D toggle
  const styleToggle = document.getElementById('cardStyleToggle');
  if (styleToggle) {
    styleToggle.addEventListener('click', (e) => {
      const btn = e.target.closest('.chip-sort-btn');
      if (!btn || !btn.dataset.style) return;
      const newStyle = btn.dataset.style;
      localStorage.setItem(CARD_STYLE_KEY, newStyle);
      // Sync settings dropdown (D is not in the settings list, skip it)
      const styleSelect = document.getElementById('settingsCardStyle');
      if (styleSelect &amp;&amp; newStyle !== 'D') styleSelect.value = newStyle;
      if (typeof renderTable === 'function') renderTable();
      // After renderTable(), inventory.js may have hidden bar (D mode) — restore it
      _syncSortBar();
    });
  }

  // MutationObserver: when inventory.js hides the bar in table mode (D), immediately restore it.
  // inventory.js sets cardSortBar.style.display='none' when isCardViewActive()===false.
  const bar = document.getElementById('cardSortBar');
  if (bar) {
    new MutationObserver(() => {
      if (getCardStyle() === 'D' &amp;&amp; bar.style.display === 'none') {
        _syncSortBar();
      }
    }).observe(bar, { attributes: true, attributeFilter: ['style'] });
  }
};

// =============================================================================
// GLOBAL SPOT CONTROLS
// =============================================================================

/**
 * Trend period presets and labels for the header trend cycle button.
 */
const TREND_PRESETS = ['1', '7', '30', '90', '365', '1095'];
const TREND_LABELS  = { '1': '1d', '7': '7d', '30': '30d', '90': '90d', '365': '1Y', '1095': '3Y' };

/**
 * Applies a trend period value to all four metal sparkline selects and updates
 * the header trend label.
 * @param {string} val - The trend period value to apply.
 */
const _applyTrend = (val) => {
  ['Silver', 'Gold', 'Platinum', 'Palladium'].forEach(m => {
    const sel = document.getElementById(`spotRange${m}`);
    if (sel &amp;&amp; sel.value !== val) { sel.value = val; sel.dispatchEvent(new Event('change')); }
  });
  const label = document.getElementById('headerTrendLabel');
  if (label) label.textContent = TREND_LABELS[val] || val + 'd';
};

/**
 * Cycles through trend period presets, persists the selection, and applies it.
 */
const cycleSpotTrend = () => {
  const current = localStorage.getItem('spotTrendPeriod') || '90';
  const next = TREND_PRESETS[(TREND_PRESETS.indexOf(current) + 1) % TREND_PRESETS.length];
  localStorage.setItem('spotTrendPeriod', next);
  _applyTrend(next);
};
window.cycleSpotTrend = cycleSpotTrend;

/**
 * Initialises spot controls: applies the persisted trend period on load.
 *
 * The per-card &lt;select> elements remain in the DOM (hidden via CSS) so that
 * the existing spot.js sparkline listeners continue to work.
 */
const _initSpotControls = () => {
  _applyTrend(localStorage.getItem('spotTrendPeriod') || '90');
};

// =============================================================================
// TOTALS CAROUSEL
// =============================================================================

/**
 * Initialises the totals cards carousel:
 *  - Generates one dot per card inside #totalsDots
 *  - Wires prev/next buttons to scroll by one card width
 *  - Wires the scroll event to update the active dot and button states
 *
 * At ≥1350px the nav buttons and dots are hidden via CSS; the carousel
 * degenerates to a plain flex row with no overflow.
 */
/**
 * Rebuilds totals carousel dots after metal order/visibility changes.
 * Safe to call multiple times — does not re-wire scroll or nav listeners.
 */
const refreshTotalsDots = () => {
  const carousel = document.getElementById('totalsCarousel');
  const dotsEl   = document.getElementById('totalsDots');
  if (!carousel || !dotsEl) return;
  const cards = [...carousel.querySelectorAll('.total-card')].filter(c => c.style.display !== 'none');
  dotsEl.innerHTML = '';
  cards.forEach((card, i) => {
    const dot = document.createElement('button');
    dot.className = 'totals-dot' + (i === 0 ? ' active' : '');
    dot.setAttribute('aria-label', `Go to card ${i + 1}`);
    dot.addEventListener('click', () => carousel.scrollTo({ left: card.offsetLeft, behavior: 'smooth' }));
    dotsEl.appendChild(dot);
  });
};
window.refreshTotalsDots = refreshTotalsDots;

const _initTotalsCarousel = () => {
  const carousel = document.getElementById('totalsCarousel');
  const prevBtn  = document.getElementById('totalsPrev');
  const nextBtn  = document.getElementById('totalsNext');
  const dotsEl   = document.getElementById('totalsDots');

  if (!carousel || !prevBtn || !nextBtn || !dotsEl) return;

  const cards = Array.from(carousel.querySelectorAll('.total-card'));
  if (!cards.length) return;

  // Sort by visual (rendered) left offset so CSS `order` is respected.
  // All Metals has order:-1 so it renders first but is last in DOM order.
  const sortedCards = [...cards].sort((a, b) => a.offsetLeft - b.offsetLeft);

  // --- Build dots ---
  dotsEl.innerHTML = '';
  const dots = sortedCards.map((card, i) => {
    const dot = document.createElement('button');
    dot.className = 'totals-dot' + (i === 0 ? ' active' : '');
    dot.setAttribute('aria-label', `Go to card ${i + 1}`);
    dot.addEventListener('click', () => {
      carousel.scrollTo({ left: card.offsetLeft, behavior: 'smooth' });
    });
    dotsEl.appendChild(dot);
    return dot;
  });

  // --- Helpers ---
  const getCardWidth = () => {
    const card = sortedCards[0];
    const gap  = parseFloat(getComputedStyle(carousel).gap) || 0;
    return card.getBoundingClientRect().width + gap;
  };

  const updateState = () => {
    const scrollLeft = carousel.scrollLeft;
    const maxScroll  = carousel.scrollWidth - carousel.clientWidth;

    prevBtn.disabled = scrollLeft &lt; 4;
    nextBtn.disabled = scrollLeft >= maxScroll - 1;

    // Highlight the dot whose card is most in view
    const activeIdx = Math.round(scrollLeft / getCardWidth());
    dots.forEach((d, i) => d.classList.toggle('active', i === activeIdx));
  };

  // --- Button clicks ---
  prevBtn.addEventListener('click', () => {
    carousel.scrollBy({ left: -getCardWidth(), behavior: 'smooth' });
  });
  nextBtn.addEventListener('click', () => {
    carousel.scrollBy({ left: getCardWidth(), behavior: 'smooth' });
  });

  // --- Scroll tracking ---
  let scrollTimer;
  carousel.addEventListener('scroll', () => {
    clearTimeout(scrollTimer);
    scrollTimer = setTimeout(updateState, 50);
  }, { passive: true });

  // --- Initial state ---
  updateState();
};

// On page load: initialise sort bar event handlers (needed even in D mode where
// inventory.js never calls initCardSortBar) and fix initial bar visibility.
document.addEventListener('DOMContentLoaded', () => {
  initCardSortBar();
  _initSpotControls();
  _initTotalsCarousel();
  // requestAnimationFrame runs after all DOMContentLoaded handlers (including init.js)
  // so the sort bar has already been shown/hidden by inventory.js by this point.
  requestAnimationFrame(_syncSortBar);
});

</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="CatalogAPI.html">CatalogAPI</a></li><li><a href="CatalogConfig.html">CatalogConfig</a></li><li><a href="CatalogManager.html">CatalogManager</a></li><li><a href="CatalogProvider.html">CatalogProvider</a></li><li><a href="FeatureFlags.html">FeatureFlags</a></li><li><a href="ImageCache.html">ImageCache</a></li><li><a href="ImageProcessor.html">ImageProcessor</a></li><li><a href="LocalProvider.html">LocalProvider</a></li><li><a href="NumistaCatalogProvider.html">NumistaCatalogProvider</a></li><li><a href="NumistaProvider.html">NumistaProvider</a></li></ul><h3>Global</h3><ul><li><a href="global.html#ACK_DISMISSED_KEY">ACK_DISMISSED_KEY</a></li><li><a href="global.html#API_CACHE_KEY">API_CACHE_KEY</a></li><li><a href="global.html#API_KEY_STORAGE_KEY">API_KEY_STORAGE_KEY</a></li><li><a href="global.html#API_PROVIDERS">API_PROVIDERS</a></li><li><a href="global.html#APP_VERSION">APP_VERSION</a></li><li><a href="global.html#APP_VERSION_KEY">APP_VERSION_KEY</a></li><li><a href="global.html#AUTOCOMPLETE_CONFIG">AUTOCOMPLETE_CONFIG</a></li><li><a href="global.html#BRANDING_DOMAIN_OPTIONS">BRANDING_DOMAIN_OPTIONS</a></li><li><a href="global.html#BRANDING_DOMAIN_OVERRIDE">BRANDING_DOMAIN_OVERRIDE</a></li><li><a href="global.html#BRANDING_TITLE">BRANDING_TITLE</a></li><li><a href="global.html#CARD_STYLE_KEY">CARD_STYLE_KEY</a></li><li><a href="global.html#CATALOG_HISTORY_KEY">CATALOG_HISTORY_KEY</a></li><li><a href="global.html#CATALOG_MAP_KEY">CATALOG_MAP_KEY</a></li><li><a href="global.html#CERT_LOOKUP_URLS">CERT_LOOKUP_URLS</a></li><li><a href="global.html#CLOUD_PROVIDERS">CLOUD_PROVIDERS</a></li><li><a href="global.html#DEBUG">DEBUG</a></li><li><a href="global.html#DEFAULT_API_CACHE_DURATION">DEFAULT_API_CACHE_DURATION</a></li><li><a href="global.html#DEFAULT_API_QUOTA">DEFAULT_API_QUOTA</a></li><li><a href="global.html#DEFAULT_CURRENCY">DEFAULT_CURRENCY</a></li><li><a href="global.html#DEFAULT_SORT_COL_KEY">DEFAULT_SORT_COL_KEY</a></li><li><a href="global.html#DEFAULT_SORT_DIR_KEY">DEFAULT_SORT_DIR_KEY</a></li><li><a href="global.html#DESKTOP_CARD_VIEW_KEY">DESKTOP_CARD_VIEW_KEY</a></li><li><a href="global.html#DEV_MODE">DEV_MODE</a></li><li><a href="global.html#DISPLAY_CURRENCY_KEY">DISPLAY_CURRENCY_KEY</a></li><li><a href="global.html#EXCHANGE_RATES_KEY">EXCHANGE_RATES_KEY</a></li><li><a href="global.html#EXCHANGE_RATE_API_URL">EXCHANGE_RATE_API_URL</a></li><li><a href="global.html#FALLBACK_EXCHANGE_RATES">FALLBACK_EXCHANGE_RATES</a></li><li><a href="global.html#FEATURE_FLAGS">FEATURE_FLAGS</a></li><li><a href="global.html#FEATURE_FLAGS_KEY">FEATURE_FLAGS_KEY</a></li><li><a href="global.html#FIELD_COERCIONS">FIELD_COERCIONS</a></li><li><a href="global.html#FILTER_CHIP_CATEGORY_DEFAULTS">FILTER_CHIP_CATEGORY_DEFAULTS</a></li><li><a href="global.html#GB_ESTIMATE_MODIFIER_KEY">GB_ESTIMATE_MODIFIER_KEY</a></li><li><a href="global.html#GB_ESTIMATE_PREMIUM">GB_ESTIMATE_PREMIUM</a></li><li><a href="global.html#GB_TO_OZT">GB_TO_OZT</a></li><li><a href="global.html#GITHUB_RELEASES_URL">GITHUB_RELEASES_URL</a></li><li><a href="global.html#GOLDBACK_DENOMINATIONS">GOLDBACK_DENOMINATIONS</a></li><li><a href="global.html#GOLDBACK_ENABLED_KEY">GOLDBACK_ENABLED_KEY</a></li><li><a href="global.html#GOLDBACK_ESTIMATE_ENABLED_KEY">GOLDBACK_ESTIMATE_ENABLED_KEY</a></li><li><a href="global.html#GOLDBACK_PRICES_KEY">GOLDBACK_PRICES_KEY</a></li><li><a href="global.html#GOLDBACK_PRICE_HISTORY_KEY">GOLDBACK_PRICE_HISTORY_KEY</a></li><li><a href="global.html#HEADER_SYNC_BTN_KEY">HEADER_SYNC_BTN_KEY</a></li><li><a href="global.html#HEADER_TREND_BTN_KEY">HEADER_TREND_BTN_KEY</a></li><li><a href="global.html#IMAGE_MAX_BYTES">IMAGE_MAX_BYTES</a></li><li><a href="global.html#IMAGE_MAX_DIM">IMAGE_MAX_DIM</a></li><li><a href="global.html#IMAGE_QUALITY">IMAGE_QUALITY</a></li><li><a href="global.html#INLINE_CHIP_DEFAULTS">INLINE_CHIP_DEFAULTS</a></li><li><a href="global.html#ITEMS_PER_PAGE_KEY">ITEMS_PER_PAGE_KEY</a></li><li><a href="global.html#ITEM_PRICE_HISTORY_KEY">ITEM_PRICE_HISTORY_KEY</a></li><li><a href="global.html#ITEM_TAGS_KEY">ITEM_TAGS_KEY</a></li><li><a href="global.html#LAST_API_SYNC_KEY">LAST_API_SYNC_KEY</a></li><li><a href="global.html#LAST_CACHE_REFRESH_KEY">LAST_CACHE_REFRESH_KEY</a></li><li><a href="global.html#LAST_VERSION_CHECK_KEY">LAST_VERSION_CHECK_KEY</a></li><li><a href="global.html#LATEST_REMOTE_URL_KEY">LATEST_REMOTE_URL_KEY</a></li><li><a href="global.html#LATEST_REMOTE_VERSION_KEY">LATEST_REMOTE_VERSION_KEY</a></li><li><a href="global.html#LAYOUT_SECTION_DEFAULTS">LAYOUT_SECTION_DEFAULTS</a></li><li><a href="global.html#LOG_TAB_RENDERERS">LOG_TAB_RENDERERS</a></li><li><a href="global.html#LS_KEY">LS_KEY</a></li><li><a href="global.html#MAX_LOCAL_FILE_SIZE">MAX_LOCAL_FILE_SIZE</a></li><li><a href="global.html#MAX_TAGS_PER_ITEM">MAX_TAGS_PER_ITEM</a></li><li><a href="global.html#MAX_TAG_LENGTH">MAX_TAG_LENGTH</a></li><li><a href="global.html#METALS">METALS</a></li><li><a href="global.html#METAL_COLORS">METAL_COLORS</a></li><li><a href="global.html#METAL_ORDER_KEY">METAL_ORDER_KEY</a></li><li><a href="global.html#METAL_SYMBOLS">METAL_SYMBOLS</a></li><li><a href="global.html#NUMISTA_VIEW_FIELD_DEFAULTS">NUMISTA_VIEW_FIELD_DEFAULTS</a></li><li><a href="global.html#NumistaLookup">NumistaLookup</a></li><li><a href="global.html#PREBUILT_LOOKUP_DATA">PREBUILT_LOOKUP_DATA</a></li><li><a href="global.html#PRICE_HISTORY_COLS">PRICE_HISTORY_COLS</a></li><li><a href="global.html#Remote">Remote</a></li><li><a href="global.html#SEED_CUSTOM_RULES">SEED_CUSTOM_RULES</a></li><li><a href="global.html#SEED_DATA_YEARS">SEED_DATA_YEARS</a></li><li><a href="global.html#SEED_IMAGES_VERSION">SEED_IMAGES_VERSION</a></li><li><a href="global.html#SEED_INVENTORY_ITEMS">SEED_INVENTORY_ITEMS</a></li><li><a href="global.html#SERIAL_KEY">SERIAL_KEY</a></li><li><a href="global.html#SPOT_COMPARE_MODE_KEY">SPOT_COMPARE_MODE_KEY</a></li><li><a href="global.html#SPOT_HISTORY_KEY">SPOT_HISTORY_KEY</a></li><li><a href="global.html#SPOT_TREND_KEY">SPOT_TREND_KEY</a></li><li><a href="global.html#SPOT_TREND_RANGE_KEY">SPOT_TREND_RANGE_KEY</a></li><li><a href="global.html#STORAGE_KEY_LABELS">STORAGE_KEY_LABELS</a></li><li><a href="global.html#STORAGE_TINY_THRESHOLD_KB">STORAGE_TINY_THRESHOLD_KB</a></li><li><a href="global.html#SUPPORTED_CURRENCIES">SUPPORTED_CURRENCIES</a></li><li><a href="global.html#SYNC_FILE_PATH">SYNC_FILE_PATH</a></li><li><a href="global.html#SYNC_META_PATH">SYNC_META_PATH</a></li><li><a href="global.html#SYNC_POLL_INTERVAL">SYNC_POLL_INTERVAL</a></li><li><a href="global.html#SYNC_PUSH_DEBOUNCE">SYNC_PUSH_DEBOUNCE</a></li><li><a href="global.html#SYNC_SCOPE_KEYS">SYNC_SCOPE_KEYS</a></li><li><a href="global.html#THEME_KEY">THEME_KEY</a></li><li><a href="global.html#TIMEZONE_KEY">TIMEZONE_KEY</a></li><li><a href="global.html#TREND_PRESETS">TREND_PRESETS</a></li><li><a href="global.html#VALID_TYPES">VALID_TYPES</a></li><li><a href="global.html#VAULT_FILE_EXTENSION">VAULT_FILE_EXTENSION</a></li><li><a href="global.html#VERSION_ACK_KEY">VERSION_ACK_KEY</a></li><li><a href="global.html#VERSION_CHECK_TTL">VERSION_CHECK_TTL</a></li><li><a href="global.html#VERSION_CHECK_URL">VERSION_CHECK_URL</a></li><li><a href="global.html#VIEW_METADATA_TTL">VIEW_METADATA_TTL</a></li><li><a href="global.html#VIEW_MODAL_SECTION_DEFAULTS">VIEW_MODAL_SECTION_DEFAULTS</a></li><li><a href="global.html#_VIEW_CHART_DEFAULT_RANGE">_VIEW_CHART_DEFAULT_RANGE</a></li><li><a href="global.html#_VIEW_CHART_RANGES">_VIEW_CHART_RANGES</a></li><li><a href="global.html#_VIEW_CHART_RANGE_LABELS">_VIEW_CHART_RANGE_LABELS</a></li><li><a href="global.html#__ST_COMP_PREFIX">__ST_COMP_PREFIX</a></li><li><a href="global.html#_addDetail">_addDetail</a></li><li><a href="global.html#_applyTrend">_applyTrend</a></li><li><a href="global.html#_cardChipsHTML">_cardChipsHTML</a></li><li><a href="global.html#_cardClickBound">_cardClickBound</a></li><li><a href="global.html#_cardFmt">_cardFmt</a></li><li><a href="global.html#_cardImageHTML">_cardImageHTML</a></li><li><a href="global.html#_cardMetalClass">_cardMetalClass</a></li><li><a href="global.html#_cardSortBarBound">_cardSortBarBound</a></li><li><a href="global.html#_cloudBackupWithCachedPw">_cloudBackupWithCachedPw</a></li><li><a href="global.html#_cloudBtnAction">_cloudBtnAction</a></li><li><a href="global.html#_cloudContext">_cloudContext</a></li><li><a href="global.html#_cloudRestoreWithCachedPw">_cloudRestoreWithCachedPw</a></li><li><a href="global.html#_computePortfolioSummary">_computePortfolioSummary</a></li><li><a href="global.html#_createPriceHistoryChart">_createPriceHistoryChart</a></li><li><a href="global.html#_cvBlobUrls">_cvBlobUrls</a></li><li><a href="global.html#_cvChartInstances">_cvChartInstances</a></li><li><a href="global.html#_cvEscapeAttr">_cvEscapeAttr</a></li><li><a href="global.html#_cvImageObserver">_cvImageObserver</a></li><li><a href="global.html#_darkenColor">_darkenColor</a></li><li><a href="global.html#_dataToPolylineScaled">_dataToPolylineScaled</a></li><li><a href="global.html#_deleteObverseOnSave">_deleteObverseOnSave</a></li><li><a href="global.html#_deleteReverseOnSave">_deleteReverseOnSave</a></li><li><a href="global.html#_detailItem">_detailItem</a></li><li><a href="global.html#_el">_el</a></li><li><a href="global.html#_enhanceCardImages">_enhanceCardImages</a></li><li><a href="global.html#_enhanceTableThumbnails">_enhanceTableThumbnails</a></li><li><a href="global.html#_extractMetadata">_extractMetadata</a></li><li><a href="global.html#_fetchHistoricalSpotData">_fetchHistoricalSpotData</a></li><li><a href="global.html#_fetchNumistaResult">_fetchNumistaResult</a></li><li><a href="global.html#_fetchYearFile">_fetchYearFile</a></li><li><a href="global.html#_getBulkImageSides">_getBulkImageSides</a></li><li><a href="global.html#_getOrCreateHScrollBar">_getOrCreateHScrollBar</a></li><li><a href="global.html#_getThumbPlaceholder">_getThumbPlaceholder</a></li><li><a href="global.html#_getViewMetrics">_getViewMetrics</a></li><li><a href="global.html#_hScrollWired">_hScrollWired</a></li><li><a href="global.html#_imageSlot">_imageSlot</a></li><li><a href="global.html#_initCardCharts">_initCardCharts</a></li><li><a href="global.html#_initSpotControls">_initSpotControls</a></li><li><a href="global.html#_interpolateNulls">_interpolateNulls</a></li><li><a href="global.html#_isLightColor">_isLightColor</a></li><li><a href="global.html#_itemPriceModalFilterText">_itemPriceModalFilterText</a></li><li><a href="global.html#_itemPriceModalUuid">_itemPriceModalUuid</a></li><li><a href="global.html#_loadBulkRowImages">_loadBulkRowImages</a></li><li><a href="global.html#_loadCardImage">_loadCardImage</a></li><li><a href="global.html#_loadSectionConfig">_loadSectionConfig</a></li><li><a href="global.html#_loadThumbImage">_loadThumbImage</a></li><li><a href="global.html#_normalizePatterns">_normalizePatterns</a></li><li><a href="global.html#_openBulkImagePopover">_openBulkImagePopover</a></li><li><a href="global.html#_openExternalPopup">_openExternalPopup</a></li><li><a href="global.html#_openThumbPopover">_openThumbPopover</a></li><li><a href="global.html#_parseColor">_parseColor</a></li><li><a href="global.html#_patternMode">_patternMode</a></li><li><a href="global.html#_pendingObverseBlob">_pendingObverseBlob</a></li><li><a href="global.html#_pendingObversePreviewUrl">_pendingObversePreviewUrl</a></li><li><a href="global.html#_pendingReverseBlob">_pendingReverseBlob</a></li><li><a href="global.html#_pendingReversePreviewUrl">_pendingReversePreviewUrl</a></li><li><a href="global.html#_renderSectionConfigTable">_renderSectionConfigTable</a></li><li><a href="global.html#_renderSortBarSummary">_renderSortBarSummary</a></li><li><a href="global.html#_restoreCdnFolderFromZip">_restoreCdnFolderFromZip</a></li><li><a href="global.html#_saveSectionConfig">_saveSectionConfig</a></li><li><a href="global.html#_schedulePoll">_schedulePoll</a></li><li><a href="global.html#_section">_section</a></li><li><a href="global.html#_setSlotImage">_setSlotImage</a></li><li><a href="global.html#_showCardImage">_showCardImage</a></li><li><a href="global.html#_statusCells">_statusCells</a></li><li><a href="global.html#_storageTinyVisible">_storageTinyVisible</a></li><li><a href="global.html#_storedSortCol">_storedSortCol</a></li><li><a href="global.html#_syncFallbackUUID">_syncFallbackUUID</a></li><li><a href="global.html#_syncHScrollBar">_syncHScrollBar</a></li><li><a href="global.html#_syncPollerTimer">_syncPollerTimer</a></li><li><a href="global.html#_syncProvider">_syncProvider</a></li><li><a href="global.html#_syncPushInFlight">_syncPushInFlight</a></li><li><a href="global.html#_syncRelativeTime">_syncRelativeTime</a></li><li><a href="global.html#_syncRetryDelay">_syncRetryDelay</a></li><li><a href="global.html#_syncSortBar">_syncSortBar</a></li><li><a href="global.html#_thumbBlobUrls">_thumbBlobUrls</a></li><li><a href="global.html#_thumbObserver">_thumbObserver</a></li><li><a href="global.html#_updateHScrollThumb">_updateHScrollThumb</a></li><li><a href="global.html#_vaultPendingFile">_vaultPendingFile</a></li><li><a href="global.html#_viewModalChartInstance">_viewModalChartInstance</a></li><li><a href="global.html#_viewModalObjectUrls">_viewModalObjectUrls</a></li><li><a href="global.html#_viewYearCache">_viewYearCache</a></li><li><a href="global.html#_viewYearFetchPromises">_viewYearFetchPromises</a></li><li><a href="global.html#acceptAck">acceptAck</a></li><li><a href="global.html#activeFilters">activeFilters</a></li><li><a href="global.html#addCompositionOption">addCompositionOption</a></li><li><a href="global.html#addItemTag">addItemTag</a></li><li><a href="global.html#analyzeStorageData">analyzeStorageData</a></li><li><a href="global.html#analyzeStorageItem">analyzeStorageItem</a></li><li><a href="global.html#apiCache">apiCache</a></li><li><a href="global.html#apiConfig">apiConfig</a></li><li><a href="global.html#apiHistoryEntries">apiHistoryEntries</a></li><li><a href="global.html#apiHistoryFilterText">apiHistoryFilterText</a></li><li><a href="global.html#apiHistorySortAsc">apiHistorySortAsc</a></li><li><a href="global.html#apiHistorySortColumn">apiHistorySortColumn</a></li><li><a href="global.html#applyColumnFilter">applyColumnFilter</a></li><li><a href="global.html#applyHeaderToggleVisibility">applyHeaderToggleVisibility</a></li><li><a href="global.html#applyLayoutOrder">applyLayoutOrder</a></li><li><a href="global.html#applyMetalOrder">applyMetalOrder</a></li><li><a href="global.html#applyMinCountThreshold">applyMinCountThreshold</a></li><li><a href="global.html#applyNumistaTags">applyNumistaTags</a></li><li><a href="global.html#applyQuickFilter">applyQuickFilter</a></li><li><a href="global.html#attachAutocomplete">attachAutocomplete</a></li><li><a href="global.html#attachPriceHistorySortHeaders">attachPriceHistorySortHeaders</a></li><li><a href="global.html#autoSelectDefaultProvider">autoSelectDefaultProvider</a></li><li><a href="global.html#autoSyncSpotPrices">autoSyncSpotPrices</a></li><li><a href="global.html#backfillStaktrakrHourly">backfillStaktrakrHourly</a></li><li><a href="global.html#bindAppearanceAndHeaderListeners">bindAppearanceAndHeaderListeners</a></li><li><a href="global.html#bindCardAndTableImageListeners">bindCardAndTableImageListeners</a></li><li><a href="global.html#bindCardClickHandler">bindCardClickHandler</a></li><li><a href="global.html#bindCloudCacheListeners">bindCloudCacheListeners</a></li><li><a href="global.html#bindCloudStorageListeners">bindCloudStorageListeners</a></li><li><a href="global.html#bindFilterAndNumistaListeners">bindFilterAndNumistaListeners</a></li><li><a href="global.html#bindGoldbackActionListeners">bindGoldbackActionListeners</a></li><li><a href="global.html#bindGoldbackToggleListeners">bindGoldbackToggleListeners</a></li><li><a href="global.html#bindImageImportExportListeners">bindImageImportExportListeners</a></li><li><a href="global.html#bindImageSettingsListeners">bindImageSettingsListeners</a></li><li><a href="global.html#bindImageSyncListeners">bindImageSyncListeners</a></li><li><a href="global.html#bindNumistaBulkSyncListeners">bindNumistaBulkSyncListeners</a></li><li><a href="global.html#bindPatternRuleModeListeners">bindPatternRuleModeListeners</a></li><li><a href="global.html#bindSettingsModalShellListeners">bindSettingsModalShellListeners</a></li><li><a href="global.html#bindSettingsNavigationListeners">bindSettingsNavigationListeners</a></li><li><a href="global.html#bindStorageListeners">bindStorageListeners</a></li><li><a href="global.html#blobToWebP">blobToWebP</a></li><li><a href="global.html#brandingWarned">brandingWarned</a></li><li><a href="global.html#buildBulkItemRow">buildBulkItemRow</a></li><li><a href="global.html#buildImageExportZip">buildImageExportZip</a></li><li><a href="global.html#buildItemFields">buildItemFields</a></li><li><a href="global.html#buildNumistaSearchQuery">buildNumistaSearchQuery</a></li><li><a href="global.html#buildSearchIndices">buildSearchIndices</a></li><li><a href="global.html#buildTagSection">buildTagSection</a></li><li><a href="global.html#buildViewContent">buildViewContent</a></li><li><a href="global.html#cacheLookupTable">cacheLookupTable</a></li><li><a href="global.html#calculateApiUsage">calculateApiUsage</a></li><li><a href="global.html#calculateLevenshteinDistance">calculateLevenshteinDistance</a></li><li><a href="global.html#catalogHistory">catalogHistory</a></li><li><a href="global.html#catalogMap">catalogMap</a></li><li><a href="global.html#changeLog">changeLog</a></li><li><a href="global.html#chartInstances">chartInstances</a></li><li><a href="global.html#checkFileSize">checkFileSize</a></li><li><a href="global.html#checkRemoteVersion">checkRemoteVersion</a></li><li><a href="global.html#checkVersionChange">checkVersionChange</a></li><li><a href="global.html#cleanOrphanedItemPriceHistory">cleanOrphanedItemPriceHistory</a></li><li><a href="global.html#cleanSearchTerm">cleanSearchTerm</a></li><li><a href="global.html#cleanString">cleanString</a></li><li><a href="global.html#cleanupStorage">cleanupStorage</a></li><li><a href="global.html#clearAllCachedData">clearAllCachedData</a></li><li><a href="global.html#clearAllFilters">clearAllFilters</a></li><li><a href="global.html#clearApiCache">clearApiCache</a></li><li><a href="global.html#clearApiConfig">clearApiConfig</a></li><li><a href="global.html#clearApiHistory">clearApiHistory</a></li><li><a href="global.html#clearApiKey">clearApiKey</a></li><li><a href="global.html#clearCatalogHistory">clearCatalogHistory</a></li><li><a href="global.html#clearChangeLog">clearChangeLog</a></li><li><a href="global.html#clearItemPriceHistory">clearItemPriceHistory</a></li><li><a href="global.html#clearLookupCache">clearLookupCache</a></li><li><a href="global.html#clearSpotHistory">clearSpotHistory</a></li><li><a href="global.html#clearUploadState">clearUploadState</a></li><li><a href="global.html#closeCurrencyDropdown">closeCurrencyDropdown</a></li><li><a href="global.html#closeCurrencyDropdownOnOutside">closeCurrencyDropdownOnOutside</a></li><li><a href="global.html#closeDetailsModal">closeDetailsModal</a></li><li><a href="global.html#closeModalById">closeModalById</a></li><li><a href="global.html#closeNumistaResultsModal">closeNumistaResultsModal</a></li><li><a href="global.html#closePcgsFieldPicker">closePcgsFieldPicker</a></li><li><a href="global.html#closeSpotLookupModal">closeSpotLookupModal</a></li><li><a href="global.html#closeVaultModal">closeVaultModal</a></li><li><a href="global.html#closeViewModal">closeViewModal</a></li><li><a href="global.html#cloudBackupEnabled">cloudBackupEnabled</a></li><li><a href="global.html#coerceFieldValue">coerceFieldValue</a></li><li><a href="global.html#collectVaultData">collectVaultData</a></li><li><a href="global.html#commitItemToInventory">commitItemToInventory</a></li><li><a href="global.html#compareVersions">compareVersions</a></li><li><a href="global.html#compositionOptions">compositionOptions</a></li><li><a href="global.html#computeGoldbackEstimatedRate">computeGoldbackEstimatedRate</a></li><li><a href="global.html#computeMeltValue">computeMeltValue</a></li><li><a href="global.html#convertToUsd">convertToUsd</a></li><li><a href="global.html#createBackupData">createBackupData</a></li><li><a href="global.html#createBackupZip">createBackupZip</a></li><li><a href="global.html#createBreakdownElements">createBreakdownElements</a></li><li><a href="global.html#createDummyElement">createDummyElement</a></li><li><a href="global.html#createEmptyLookupTable">createEmptyLookupTable</a></li><li><a href="global.html#createFieldInput">createFieldInput</a></li><li><a href="global.html#createPieChart">createPieChart</a></li><li><a href="global.html#createStorageItemModal">createStorageItemModal</a></li><li><a href="global.html#createThumbEl">createThumbEl</a></li><li><a href="global.html#currentLookupTable">currentLookupTable</a></li><li><a href="global.html#currentMonthKey">currentMonthKey</a></li><li><a href="global.html#cycleSpotTrend">cycleSpotTrend</a></li><li><a href="global.html#dataToPolyline">dataToPolyline</a></li><li><a href="global.html#dataUriToBlob">dataUriToBlob</a></li><li><a href="global.html#debounce">debounce</a></li><li><a href="global.html#debugLog">debugLog</a></li><li><a href="global.html#deleteItem">deleteItem</a></li><li><a href="global.html#deleteItemPriceEntry">deleteItemPriceEntry</a></li><li><a href="global.html#deleteItemTags">deleteItemTags</a></li><li><a href="global.html#deleteTagGlobal">deleteTagGlobal</a></li><li><a href="global.html#deriveSearchLabel">deriveSearchLabel</a></li><li><a href="global.html#destroyCharts">destroyCharts</a></li><li><a href="global.html#destroySparklines">destroySparklines</a></li><li><a href="global.html#detailsChartMetric">detailsChartMetric</a></li><li><a href="global.html#detailsResizeObserver">detailsResizeObserver</a></li><li><a href="global.html#detectCurrency">detectCurrency</a></li><li><a href="global.html#disableCloudSync">disableCloudSync</a></li><li><a href="global.html#dismissAllAutocompletes">dismissAllAutocompletes</a></li><li><a href="global.html#dismissNotesModal">dismissNotesModal</a></li><li><a href="global.html#displayCurrency">displayCurrency</a></li><li><a href="global.html#downloadCompleteBackup">downloadCompleteBackup</a></li><li><a href="global.html#downloadFile">downloadFile</a></li><li><a href="global.html#downloadStorageReport">downloadStorageReport</a></li><li><a href="global.html#duplicateItem">duplicateItem</a></li><li><a href="global.html#editItem">editItem</a></li><li><a href="global.html#editingChangeLogIndex">editingChangeLogIndex</a></li><li><a href="global.html#editingIndex">editingIndex</a></li><li><a href="global.html#elements">elements</a></li><li><a href="global.html#enableCloudSync">enableCloudSync</a></li><li><a href="global.html#escapeAttribute">escapeAttribute</a></li><li><a href="global.html#escapeHtml">escapeHtml</a></li><li><a href="global.html#escapeHtmlCatalog">escapeHtmlCatalog</a></li><li><a href="global.html#escapeHtmlPcgs">escapeHtmlPcgs</a></li><li><a href="global.html#exchangeRates">exchangeRates</a></li><li><a href="global.html#exportCsv">exportCsv</a></li><li><a href="global.html#exportEncryptedBackup">exportEncryptedBackup</a></li><li><a href="global.html#exportGoldbackHistory">exportGoldbackHistory</a></li><li><a href="global.html#exportJson">exportJson</a></li><li><a href="global.html#exportNumistaCsv">exportNumistaCsv</a></li><li><a href="global.html#exportPdf">exportPdf</a></li><li><a href="global.html#exportSpotHistory">exportSpotHistory</a></li><li><a href="global.html#extractUniqueValues">extractUniqueValues</a></li><li><a href="global.html#featureFlags">featureFlags</a></li><li><a href="global.html#fetchBatchSpotPrices">fetchBatchSpotPrices</a></li><li><a href="global.html#fetchExchangeRates">fetchExchangeRates</a></li><li><a href="global.html#fetchHistoryBatched">fetchHistoryBatched</a></li><li><a href="global.html#fetchLatestPrices">fetchLatestPrices</a></li><li><a href="global.html#fetchMetalPriceApiHourly">fetchMetalPriceApiHourly</a></li><li><a href="global.html#fetchSpotForDate">fetchSpotForDate</a></li><li><a href="global.html#fetchSpotPrice">fetchSpotPrice</a></li><li><a href="global.html#fetchSpotPricesFromApi">fetchSpotPricesFromApi</a></li><li><a href="global.html#fetchStaktrakrHourlyRange">fetchStaktrakrHourlyRange</a></li><li><a href="global.html#fetchStaktrakrPrices">fetchStaktrakrPrices</a></li><li><a href="global.html#fetchYearFile">fetchYearFile</a></li><li><a href="global.html#fillFormFromNumistaResult">fillFormFromNumistaResult</a></li><li><a href="global.html#fillFormFromPcgsResult">fillFormFromPcgsResult</a></li><li><a href="global.html#filterInventory">filterInventory</a></li><li><a href="global.html#filterInventoryAdvanced">filterInventoryAdvanced</a></li><li><a href="global.html#filterItemPriceHistoryTable">filterItemPriceHistoryTable</a></li><li><a href="global.html#flattenGoldbackHistory">flattenGoldbackHistory</a></li><li><a href="global.html#formatCurrency">formatCurrency</a></li><li><a href="global.html#formatDateOnly">formatDateOnly</a></li><li><a href="global.html#formatDisplayDate">formatDisplayDate</a></li><li><a href="global.html#formatFileSize">formatFileSize</a></li><li><a href="global.html#formatLossProfit">formatLossProfit</a></li><li><a href="global.html#formatOffsetLabel">formatOffsetLabel</a></li><li><a href="global.html#formatPurchaseLocation">formatPurchaseLocation</a></li><li><a href="global.html#formatStorageLocation">formatStorageLocation</a></li><li><a href="global.html#formatTimeOnly">formatTimeOnly</a></li><li><a href="global.html#formatTimestamp">formatTimestamp</a></li><li><a href="global.html#formatWeight">formatWeight</a></li><li><a href="global.html#fuzzyMatch">fuzzyMatch</a></li><li><a href="global.html#fuzzySearch">fuzzySearch</a></li><li><a href="global.html#gbHistoryFilterText">gbHistoryFilterText</a></li><li><a href="global.html#gbHistorySortAsc">gbHistorySortAsc</a></li><li><a href="global.html#gbHistorySortColumn">gbHistorySortColumn</a></li><li><a href="global.html#generateBackupHtml">generateBackupHtml</a></li><li><a href="global.html#generateCategorySummary">generateCategorySummary</a></li><li><a href="global.html#generateColors">generateColors</a></li><li><a href="global.html#generateItemDataTable">generateItemDataTable</a></li><li><a href="global.html#generateLookupTable">generateLookupTable</a></li><li><a href="global.html#generateNGrams">generateNGrams</a></li><li><a href="global.html#generateReadmeContent">generateReadmeContent</a></li><li><a href="global.html#generateSparklineSVG">generateSparklineSVG</a></li><li><a href="global.html#generateStorageReport">generateStorageReport</a></li><li><a href="global.html#generateStorageReportHTML">generateStorageReportHTML</a></li><li><a href="global.html#generateStorageReportTar">generateStorageReportTar</a></li><li><a href="global.html#generateUUID">generateUUID</a></li><li><a href="global.html#generateVariations">generateVariations</a></li><li><a href="global.html#get24hChange">get24hChange</a></li><li><a href="global.html#getAllMetalsBreakdownData">getAllMetalsBreakdownData</a></li><li><a href="global.html#getAllUniqueTags">getAllUniqueTags</a></li><li><a href="global.html#getApiAvailability">getApiAvailability</a></li><li><a href="global.html#getAppTitle">getAppTitle</a></li><li><a href="global.html#getBreakdownData">getBreakdownData</a></li><li><a href="global.html#getCacheDurationMs">getCacheDurationMs</a></li><li><a href="global.html#getCachedLookupTable">getCachedLookupTable</a></li><li><a href="global.html#getCardStyle">getCardStyle</a></li><li><a href="global.html#getChartBackgroundColor">getChartBackgroundColor</a></li><li><a href="global.html#getChartColor">getChartColor</a></li><li><a href="global.html#getChartTextColor">getChartTextColor</a></li><li><a href="global.html#getChipColors">getChipColors</a></li><li><a href="global.html#getCompositionFirstWords">getCompositionFirstWords</a></li><li><a href="global.html#getContrastColor">getContrastColor</a></li><li><a href="global.html#getCryptoBackend">getCryptoBackend</a></li><li><a href="global.html#getCurrencySymbol">getCurrencySymbol</a></li><li><a href="global.html#getDateChunks">getDateChunks</a></li><li><a href="global.html#getDefaultSyncMode">getDefaultSyncMode</a></li><li><a href="global.html#getDisplayComposition">getDisplayComposition</a></li><li><a href="global.html#getEmbeddedRoadmap">getEmbeddedRoadmap</a></li><li><a href="global.html#getEmbeddedSeedData">getEmbeddedSeedData</a></li><li><a href="global.html#getEmbeddedWhatsNew">getEmbeddedWhatsNew</a></li><li><a href="global.html#getExchangeRate">getExchangeRate</a></li><li><a href="global.html#getExistingElement">getExistingElement</a></li><li><a href="global.html#getFilterChipCategoryConfig">getFilterChipCategoryConfig</a></li><li><a href="global.html#getFooterDomain">getFooterDomain</a></li><li><a href="global.html#getGoldbackDenominationPrice">getGoldbackDenominationPrice</a></li><li><a href="global.html#getGoldbackRetailPrice">getGoldbackRetailPrice</a></li><li><a href="global.html#getHistoricalSparklineData">getHistoricalSparklineData</a></li><li><a href="global.html#getInlineChipConfig">getInlineChipConfig</a></li><li><a href="global.html#getItemTags">getItemTags</a></li><li><a href="global.html#getLastProviderSyncTime">getLastProviderSyncTime</a></li><li><a href="global.html#getLastUpdateTime">getLastUpdateTime</a></li><li><a href="global.html#getLayoutSectionConfig">getLayoutSectionConfig</a></li><li><a href="global.html#getLookupStats">getLookupStats</a></li><li><a href="global.html#getMetalColor">getMetalColor</a></li><li><a href="global.html#getMetalOrderConfig">getMetalOrderConfig</a></li><li><a href="global.html#getNumistaViewFieldConfig">getNumistaViewFieldConfig</a></li><li><a href="global.html#getPasswordStrength">getPasswordStrength</a></li><li><a href="global.html#getPopularNumistaItems">getPopularNumistaItems</a></li><li><a href="global.html#getProviderOrder">getProviderOrder</a></li><li><a href="global.html#getRequiredYears">getRequiredYears</a></li><li><a href="global.html#getSparklineData">getSparklineData</a></li><li><a href="global.html#getSpotHistoryForMetal">getSpotHistoryForMetal</a></li><li><a href="global.html#getStorageItemDescription">getStorageItemDescription</a></li><li><a href="global.html#getStorageItemDisplayName">getStorageItemDisplayName</a></li><li><a href="global.html#getStorageReportCSS">getStorageReportCSS</a></li><li><a href="global.html#getStorageReportJS">getStorageReportJS</a></li><li><a href="global.html#getSyncDeviceId">getSyncDeviceId</a></li><li><a href="global.html#getSyncPassword">getSyncPassword</a></li><li><a href="global.html#getTemplateVariables">getTemplateVariables</a></li><li><a href="global.html#getUserFriendlyMessage">getUserFriendlyMessage</a></li><li><a href="global.html#getVersionString">getVersionString</a></li><li><a href="global.html#getViewModalSectionConfig">getViewModalSectionConfig</a></li><li><a href="global.html#goldbackEnabled">goldbackEnabled</a></li><li><a href="global.html#goldbackEstimateEnabled">goldbackEstimateEnabled</a></li><li><a href="global.html#goldbackEstimateModifier">goldbackEstimateModifier</a></li><li><a href="global.html#goldbackPriceHistory">goldbackPriceHistory</a></li><li><a href="global.html#goldbackPrices">goldbackPrices</a></li><li><a href="global.html#gramsToOzt">gramsToOzt</a></li><li><a href="global.html#handleError">handleError</a></li><li><a href="global.html#handleHistoryPull">handleHistoryPull</a></li><li><a href="global.html#handleImageDeletion">handleImageDeletion</a></li><li><a href="global.html#handleProviderSave">handleProviderSave</a></li><li><a href="global.html#handleProviderSync">handleProviderSync</a></li><li><a href="global.html#handleRemoteChange">handleRemoteChange</a></li><li><a href="global.html#handleSaveSearchPattern">handleSaveSearchPattern</a></li><li><a href="global.html#handleStaktrakrHistoryPull">handleStaktrakrHistoryPull</a></li><li><a href="global.html#handleVaultAction">handleVaultAction</a></li><li><a href="global.html#hideAboutModal">hideAboutModal</a></li><li><a href="global.html#hideAckModal">hideAckModal</a></li><li><a href="global.html#hideApiHistoryModal">hideApiHistoryModal</a></li><li><a href="global.html#hideApiModal">hideApiModal</a></li><li><a href="global.html#hideApiProvidersModal">hideApiProvidersModal</a></li><li><a href="global.html#hideCatalogHistoryModal">hideCatalogHistoryModal</a></li><li><a href="global.html#hideEmptyColumns">hideEmptyColumns</a></li><li><a href="global.html#hideFilesModal">hideFilesModal</a></li><li><a href="global.html#hideGoldbackHistoryModal">hideGoldbackHistoryModal</a></li><li><a href="global.html#hideManualInput">hideManualInput</a></li><li><a href="global.html#hideProviderInfo">hideProviderInfo</a></li><li><a href="global.html#hideSettingsModal">hideSettingsModal</a></li><li><a href="global.html#historicalDataCache">historicalDataCache</a></li><li><a href="global.html#historicalFetchPromises">historicalFetchPromises</a></li><li><a href="global.html#importCsv">importCsv</a></li><li><a href="global.html#importEncryptedBackup">importEncryptedBackup</a></li><li><a href="global.html#importJson">importJson</a></li><li><a href="global.html#importNumistaCsv">importNumistaCsv</a></li><li><a href="global.html#importSpotHistory">importSpotHistory</a></li><li><a href="global.html#initCardSortBar">initCardSortBar</a></li><li><a href="global.html#initCloudSync">initCloudSync</a></li><li><a href="global.html#initSpotHistoryButtons">initSpotHistoryButtons</a></li><li><a href="global.html#initTheme">initTheme</a></li><li><a href="global.html#initializeAutocomplete">initializeAutocomplete</a></li><li><a href="global.html#injectVersionString">injectVersionString</a></li><li><a href="global.html#inventory">inventory</a></li><li><a href="global.html#isCardViewActive">isCardViewActive</a></li><li><a href="global.html#isFeatureEnabled">isFeatureEnabled</a></li><li><a href="global.html#isGoldbackPricingActive">isGoldbackPricingActive</a></li><li><a href="global.html#isValidSelectOption">isValidSelectOption</a></li><li><a href="global.html#itemPriceHistory">itemPriceHistory</a></li><li><a href="global.html#itemTags">itemTags</a></li><li><a href="global.html#itemsPerPage">itemsPerPage</a></li><li><a href="global.html#loadAnnouncements">loadAnnouncements</a></li><li><a href="global.html#loadApiCache">loadApiCache</a></li><li><a href="global.html#loadApiConfig">loadApiConfig</a></li><li><a href="global.html#loadCatalogHistory">loadCatalogHistory</a></li><li><a href="global.html#loadData">loadData</a></li><li><a href="global.html#loadDisplayCurrency">loadDisplayCurrency</a></li><li><a href="global.html#loadExchangeRates">loadExchangeRates</a></li><li><a href="global.html#loadGoldbackEnabled">loadGoldbackEnabled</a></li><li><a href="global.html#loadGoldbackEstimateEnabled">loadGoldbackEstimateEnabled</a></li><li><a href="global.html#loadGoldbackEstimateModifier">loadGoldbackEstimateModifier</a></li><li><a href="global.html#loadGoldbackPriceHistory">loadGoldbackPriceHistory</a></li><li><a href="global.html#loadGoldbackPrices">loadGoldbackPrices</a></li><li><a href="global.html#loadInventory">loadInventory</a></li><li><a href="global.html#loadItemPriceHistory">loadItemPriceHistory</a></li><li><a href="global.html#loadItemTags">loadItemTags</a></li><li><a href="global.html#loadLookupTable">loadLookupTable</a></li><li><a href="global.html#loadProviderPriorities">loadProviderPriorities</a></li><li><a href="global.html#loadSeedImages">loadSeedImages</a></li><li><a href="global.html#loadSeedInventory">loadSeedInventory</a></li><li><a href="global.html#loadSeedSpotHistory">loadSeedSpotHistory</a></li><li><a href="global.html#loadSpotHistory">loadSpotHistory</a></li><li><a href="global.html#loadTrendRanges">loadTrendRanges</a></li><li><a href="global.html#loadViewImages">loadViewImages</a></li><li><a href="global.html#loadViewNumistaData">loadViewNumistaData</a></li><li><a href="global.html#logChange">logChange</a></li><li><a href="global.html#logItemChanges">logItemChanges</a></li><li><a href="global.html#logSyncActivity">logSyncActivity</a></li><li><a href="global.html#lookupPcgsByNumber">lookupPcgsByNumber</a></li><li><a href="global.html#lookupPcgsFromForm">lookupPcgsFromForm</a></li><li><a href="global.html#mapNumistaType">mapNumistaType</a></li><li><a href="global.html#marketValueViewItems">marketValueViewItems</a></li><li><a href="global.html#matchCoinSeries">matchCoinSeries</a></li><li><a href="global.html#mergeItemPriceHistory">mergeItemPriceHistory</a></li><li><a href="global.html#migrateHourlySource">migrateHourlySource</a></li><li><a href="global.html#migrateLayoutVisibility">migrateLayoutVisibility</a></li><li><a href="global.html#migrateProviderPriority">migrateProviderPriority</a></li><li><a href="global.html#monitorPerformance">monitorPerformance</a></li><li><a href="global.html#normalizeItemName">normalizeItemName</a></li><li><a href="global.html#normalizeString">normalizeString</a></li><li><a href="global.html#normalizeType">normalizeType</a></li><li><a href="global.html#notesIndex">notesIndex</a></li><li><a href="global.html#onGoldSpotPriceChanged">onGoldSpotPriceChanged</a></li><li><a href="global.html#openEbaySearch">openEbaySearch</a></li><li><a href="global.html#openItemPriceHistoryModal">openItemPriceHistoryModal</a></li><li><a href="global.html#openModalById">openModalById</a></li><li><a href="global.html#openNumistaModal">openNumistaModal</a></li><li><a href="global.html#openSpotLookupModal">openSpotLookupModal</a></li><li><a href="global.html#openStorageReportPopup">openStorageReportPopup</a></li><li><a href="global.html#openVaultModal">openVaultModal</a></li><li><a href="global.html#optimizeStoragePhase1C">optimizeStoragePhase1C</a></li><li><a href="global.html#optionalListener">optionalListener</a></li><li><a href="global.html#oztToGrams">oztToGrams</a></li><li><a href="global.html#pad2">pad2</a></li><li><a href="global.html#parseDate">parseDate</a></li><li><a href="global.html#parseFraction">parseFraction</a></li><li><a href="global.html#parseItemFormFields">parseItemFormFields</a></li><li><a href="global.html#parseNumistaMetal">parseNumistaMetal</a></li><li><a href="global.html#parsePcgsResponse">parsePcgsResponse</a></li><li><a href="global.html#parsePriceToUSD">parsePriceToUSD</a></li><li><a href="global.html#parsePurity">parsePurity</a></li><li><a href="global.html#parseSearchPatterns">parseSearchPatterns</a></li><li><a href="global.html#parseVaultFile">parseVaultFile</a></li><li><a href="global.html#parseWeight">parseWeight</a></li><li><a href="global.html#pcgsFetch">pcgsFetch</a></li><li><a href="global.html#pcgsPreflightCheck">pcgsPreflightCheck</a></li><li><a href="global.html#persistInventoryAndRefresh">persistInventoryAndRefresh</a></li><li><a href="global.html#pollForRemoteChanges">pollForRemoteChanges</a></li><li><a href="global.html#populateAboutModal">populateAboutModal</a></li><li><a href="global.html#populateAckModal">populateAckModal</a></li><li><a href="global.html#populateApiSection">populateApiSection</a></li><li><a href="global.html#populateImagesSection">populateImagesSection</a></li><li><a href="global.html#populateVersionModal">populateVersionModal</a></li><li><a href="global.html#preparePriceHistoryRows">preparePriceHistoryRows</a></li><li><a href="global.html#priceHistoryFilterText">priceHistoryFilterText</a></li><li><a href="global.html#processUploadedImage">processUploadedImage</a></li><li><a href="global.html#providerRequiresKey">providerRequiresKey</a></li><li><a href="global.html#pullSyncVault">pullSyncVault</a></li><li><a href="global.html#purgeCatalogHistory">purgeCatalogHistory</a></li><li><a href="global.html#purgeItemPriceHistory">purgeItemPriceHistory</a></li><li><a href="global.html#purgeSpotHistory">purgeSpotHistory</a></li><li><a href="global.html#pushSyncVault">pushSyncVault</a></li><li><a href="global.html#recalcItem">recalcItem</a></li><li><a href="global.html#recordAllItemPriceSnapshots">recordAllItemPriceSnapshots</a></li><li><a href="global.html#recordCatalogHistory">recordCatalogHistory</a></li><li><a href="global.html#recordGoldbackPrices">recordGoldbackPrices</a></li><li><a href="global.html#recordItemPrice">recordItemPrice</a></li><li><a href="global.html#recordSingleItemPrice">recordSingleItemPrice</a></li><li><a href="global.html#recordSpot">recordSpot</a></li><li><a href="global.html#refreshCompositionOptions">refreshCompositionOptions</a></li><li><a href="global.html#refreshFromCache">refreshFromCache</a></li><li><a href="global.html#refreshLookupTable">refreshLookupTable</a></li><li><a href="global.html#refreshProviderStatuses">refreshProviderStatuses</a></li><li><a href="global.html#refreshSyncUI">refreshSyncUI</a></li><li><a href="global.html#refreshTotalsDots">refreshTotalsDots</a></li><li><a href="global.html#registerName">registerName</a></li><li><a href="global.html#removeFilter">removeFilter</a></li><li><a href="global.html#removeItemTag">removeItemTag</a></li><li><a href="global.html#renameTag">renameTag</a></li><li><a href="global.html#renderActiveFilters">renderActiveFilters</a></li><li><a href="global.html#renderApiHistoryTable">renderApiHistoryTable</a></li><li><a href="global.html#renderApiStatusSummary">renderApiStatusSummary</a></li><li><a href="global.html#renderBulkTable">renderBulkTable</a></li><li><a href="global.html#renderBulkTableBody">renderBulkTableBody</a></li><li><a href="global.html#renderBulkToolbar">renderBulkToolbar</a></li><li><a href="global.html#renderCardA">renderCardA</a></li><li><a href="global.html#renderCardB">renderCardB</a></li><li><a href="global.html#renderCardC">renderCardC</a></li><li><a href="global.html#renderCardView">renderCardView</a></li><li><a href="global.html#renderCatalogHistoryForSettings">renderCatalogHistoryForSettings</a></li><li><a href="global.html#renderCatalogHistoryTable">renderCatalogHistoryTable</a></li><li><a href="global.html#renderChangeLog">renderChangeLog</a></li><li><a href="global.html#renderCloudBackupList">renderCloudBackupList</a></li><li><a href="global.html#renderCustomPatternRules">renderCustomPatternRules</a></li><li><a href="global.html#renderCustomRuleTable">renderCustomRuleTable</a></li><li><a href="global.html#renderEligibleItemsTable">renderEligibleItemsTable</a></li><li><a href="global.html#renderFilterChipCategoryTable">renderFilterChipCategoryTable</a></li><li><a href="global.html#renderGoldbackHistoryTable">renderGoldbackHistoryTable</a></li><li><a href="global.html#renderImageStorageStats">renderImageStorageStats</a></li><li><a href="global.html#renderInlineChipConfigTable">renderInlineChipConfigTable</a></li><li><a href="global.html#renderItemPriceHistoryModalTable">renderItemPriceHistoryModalTable</a></li><li><a href="global.html#renderItemPriceHistoryTable">renderItemPriceHistoryTable</a></li><li><a href="global.html#renderLayoutSectionConfigTable">renderLayoutSectionConfigTable</a></li><li><a href="global.html#renderLogTab">renderLogTab</a></li><li><a href="global.html#renderMetalOrderConfigTable">renderMetalOrderConfigTable</a></li><li><a href="global.html#renderNumistaFieldCheckboxes">renderNumistaFieldCheckboxes</a></li><li><a href="global.html#renderNumistaResultCard">renderNumistaResultCard</a></li><li><a href="global.html#renderNumistaSelectedItem">renderNumistaSelectedItem</a></li><li><a href="global.html#renderNumistaSyncUI">renderNumistaSyncUI</a></li><li><a href="global.html#renderNumistaUsageBar">renderNumistaUsageBar</a></li><li><a href="global.html#renderPcgsFieldCheckboxes">renderPcgsFieldCheckboxes</a></li><li><a href="global.html#renderPcgsSelectedItem">renderPcgsSelectedItem</a></li><li><a href="global.html#renderPcgsUsageBar">renderPcgsUsageBar</a></li><li><a href="global.html#renderSeedRuleTable">renderSeedRuleTable</a></li><li><a href="global.html#renderSpotHistoryTable">renderSpotHistoryTable</a></li><li><a href="global.html#renderSpotLookupEmpty">renderSpotLookupEmpty</a></li><li><a href="global.html#renderSpotLookupResults">renderSpotLookupResults</a></li><li><a href="global.html#renderStorageSection">renderStorageSection</a></li><li><a href="global.html#renderSyncHistorySection">renderSyncHistorySection</a></li><li><a href="global.html#renderSyncStats">renderSyncStats</a></li><li><a href="global.html#renderUserImageGrid">renderUserImageGrid</a></li><li><a href="global.html#renderVersionBadge">renderVersionBadge</a></li><li><a href="global.html#renderViewModalSectionConfigTable">renderViewModalSectionConfigTable</a></li><li><a href="global.html#replaceTemplateVariables">replaceTemplateVariables</a></li><li><a href="global.html#resetSpot">resetSpot</a></li><li><a href="global.html#resetSpotByName">resetSpotByName</a></li><li><a href="global.html#resetSpotPrice">resetSpotPrice</a></li><li><a href="global.html#resolveElement">resolveElement</a></li><li><a href="global.html#restoreBackupZip">restoreBackupZip</a></li><li><a href="global.html#restoreVaultData">restoreVaultData</a></li><li><a href="global.html#resyncCachedEntry">resyncCachedEntry</a></li><li><a href="global.html#safeAttachListener">safeAttachListener</a></li><li><a href="global.html#safeGetElement">safeGetElement</a></li><li><a href="global.html#sanitizeHtml">sanitizeHtml</a></li><li><a href="global.html#sanitizeImportedItem">sanitizeImportedItem</a></li><li><a href="global.html#sanitizeObjectFields">sanitizeObjectFields</a></li><li><a href="global.html#sanitizeTablesOnLoad">sanitizeTablesOnLoad</a></li><li><a href="global.html#saveApiCache">saveApiCache</a></li><li><a href="global.html#saveApiConfig">saveApiConfig</a></li><li><a href="global.html#saveCatalogHistory">saveCatalogHistory</a></li><li><a href="global.html#saveData">saveData</a></li><li><a href="global.html#saveDisplayCurrency">saveDisplayCurrency</a></li><li><a href="global.html#saveExchangeRates">saveExchangeRates</a></li><li><a href="global.html#saveFilterChipCategoryConfig">saveFilterChipCategoryConfig</a></li><li><a href="global.html#saveGoldbackEnabled">saveGoldbackEnabled</a></li><li><a href="global.html#saveGoldbackEstimateEnabled">saveGoldbackEstimateEnabled</a></li><li><a href="global.html#saveGoldbackEstimateModifier">saveGoldbackEstimateModifier</a></li><li><a href="global.html#saveGoldbackPriceHistory">saveGoldbackPriceHistory</a></li><li><a href="global.html#saveGoldbackPrices">saveGoldbackPrices</a></li><li><a href="global.html#saveInlineChipConfig">saveInlineChipConfig</a></li><li><a href="global.html#saveInventory">saveInventory</a></li><li><a href="global.html#saveItemPriceHistory">saveItemPriceHistory</a></li><li><a href="global.html#saveItemTags">saveItemTags</a></li><li><a href="global.html#saveLayoutSectionConfig">saveLayoutSectionConfig</a></li><li><a href="global.html#saveNumistaViewFieldConfig">saveNumistaViewFieldConfig</a></li><li><a href="global.html#saveProviderPriorities">saveProviderPriorities</a></li><li><a href="global.html#saveSpotHistory">saveSpotHistory</a></li><li><a href="global.html#saveTrendRange">saveTrendRange</a></li><li><a href="global.html#saveUserImageForItem">saveUserImageForItem</a></li><li><a href="global.html#saveViewModalSectionConfig">saveViewModalSectionConfig</a></li><li><a href="global.html#scheduleSyncPush">scheduleSyncPush</a></li><li><a href="global.html#searchHistoricalByDate">searchHistoricalByDate</a></li><li><a href="global.html#searchPatternExistsInCustomGroups">searchPatternExistsInCustomGroups</a></li><li><a href="global.html#searchPatternMatchesAutoChip">searchPatternMatchesAutoChip</a></li><li><a href="global.html#searchQuery">searchQuery</a></li><li><a href="global.html#searchSpotByDate">searchSpotByDate</a></li><li><a href="global.html#serializeVaultFile">serializeVaultFile</a></li><li><a href="global.html#setDefaultProvider">setDefaultProvider</a></li><li><a href="global.html#setEditPreviewUrl">setEditPreviewUrl</a></li><li><a href="global.html#setProviderStatus">setProviderStatus</a></li><li><a href="global.html#setTheme">setTheme</a></li><li><a href="global.html#settingsCatalogSortAsc">settingsCatalogSortAsc</a></li><li><a href="global.html#settingsCatalogSortColumn">settingsCatalogSortColumn</a></li><li><a href="global.html#settingsCloudSortAsc">settingsCloudSortAsc</a></li><li><a href="global.html#settingsCloudSortColumn">settingsCloudSortColumn</a></li><li><a href="global.html#settingsPriceSortAsc">settingsPriceSortAsc</a></li><li><a href="global.html#settingsPriceSortColumn">settingsPriceSortColumn</a></li><li><a href="global.html#settingsSpotSortAsc">settingsSpotSortAsc</a></li><li><a href="global.html#settingsSpotSortColumn">settingsSpotSortColumn</a></li><li><a href="global.html#setupAboutModalEvents">setupAboutModalEvents</a></li><li><a href="global.html#setupAckModalEvents">setupAckModalEvents</a></li><li><a href="global.html#setupApiEvents">setupApiEvents</a></li><li><a href="global.html#setupBasicEventListeners">setupBasicEventListeners</a></li><li><a href="global.html#setupBulkEditControls">setupBulkEditControls</a></li><li><a href="global.html#setupColumnResizing">setupColumnResizing</a></li><li><a href="global.html#setupDataManagementListeners">setupDataManagementListeners</a></li><li><a href="global.html#setupEventListeners">setupEventListeners</a></li><li><a href="global.html#setupFormatImport">setupFormatImport</a></li><li><a href="global.html#setupHeaderButtonListeners">setupHeaderButtonListeners</a></li><li><a href="global.html#setupImportExportListeners">setupImportExportListeners</a></li><li><a href="global.html#setupItemFormListeners">setupItemFormListeners</a></li><li><a href="global.html#setupNoteAndModalListeners">setupNoteAndModalListeners</a></li><li><a href="global.html#setupPagination">setupPagination</a></li><li><a href="global.html#setupProviderPriority">setupProviderPriority</a></li><li><a href="global.html#setupProviderSettingsListeners">setupProviderSettingsListeners</a></li><li><a href="global.html#setupResponsiveColumns">setupResponsiveColumns</a></li><li><a href="global.html#setupSearch">setupSearch</a></li><li><a href="global.html#setupSearchAndChipListeners">setupSearchAndChipListeners</a></li><li><a href="global.html#setupSettingsEventListeners">setupSettingsEventListeners</a></li><li><a href="global.html#setupSpotPriceListeners">setupSpotPriceListeners</a></li><li><a href="global.html#setupSystemThemeListener">setupSystemThemeListener</a></li><li><a href="global.html#setupTableSortListeners">setupTableSortListeners</a></li><li><a href="global.html#setupThemeToggle">setupThemeToggle</a></li><li><a href="global.html#setupVaultListeners">setupVaultListeners</a></li><li><a href="global.html#setupVersionModalEvents">setupVersionModalEvents</a></li><li><a href="global.html#shouldShowSearchSaveButton">shouldShowSearchSaveButton</a></li><li><a href="global.html#showAboutModal">showAboutModal</a></li><li><a href="global.html#showAckModal">showAckModal</a></li><li><a href="global.html#showApiHistoryModal">showApiHistoryModal</a></li><li><a href="global.html#showApiModal">showApiModal</a></li><li><a href="global.html#showApiProvidersModal">showApiProvidersModal</a></li><li><a href="global.html#showBulkConfirm">showBulkConfirm</a></li><li><a href="global.html#showCatalogHistoryModal">showCatalogHistoryModal</a></li><li><a href="global.html#showDetailsModal">showDetailsModal</a></li><li><a href="global.html#showFilesModal">showFilesModal</a></li><li><a href="global.html#showFullChangelog">showFullChangelog</a></li><li><a href="global.html#showGoldbackHistoryModal">showGoldbackHistoryModal</a></li><li><a href="global.html#showManualInput">showManualInput</a></li><li><a href="global.html#showNotes">showNotes</a></li><li><a href="global.html#showNotesView">showNotesView</a></li><li><a href="global.html#showNumistaResults">showNumistaResults</a></li><li><a href="global.html#showPcgsFieldPicker">showPcgsFieldPicker</a></li><li><a href="global.html#showProviderInfo">showProviderInfo</a></li><li><a href="global.html#showSettingsModal">showSettingsModal</a></li><li><a href="global.html#showStaticVersionBadge">showStaticVersionBadge</a></li><li><a href="global.html#showSyncConflictModal">showSyncConflictModal</a></li><li><a href="global.html#showSyncUpdateModal">showSyncUpdateModal</a></li><li><a href="global.html#showTagInput">showTagInput</a></li><li><a href="global.html#showVaultStatus">showVaultStatus</a></li><li><a href="global.html#showViewModal">showViewModal</a></li><li><a href="global.html#simpleHash">simpleHash</a></li><li><a href="global.html#simplifyChipValue">simplifyChipValue</a></li><li><a href="global.html#sortInventory">sortInventory</a></li><li><a href="global.html#sortInventoryByDateNewestFirst">sortInventoryByDateNewestFirst</a></li><li><a href="global.html#sparklineInstances">sparklineInstances</a></li><li><a href="global.html#spotHistory">spotHistory</a></li><li><a href="global.html#spotPrices">spotPrices</a></li><li><a href="global.html#startBulkSync">startBulkSync</a></li><li><a href="global.html#startCellEdit">startCellEdit</a></li><li><a href="global.html#startSpotInlineEdit">startSpotInlineEdit</a></li><li><a href="global.html#startSyncPoller">startSyncPoller</a></li><li><a href="global.html#stopSyncPoller">stopSyncPoller</a></li><li><a href="global.html#stripNonAlphanumeric">stripNonAlphanumeric</a></li><li><a href="global.html#switchLogTab">switchLogTab</a></li><li><a href="global.html#switchProviderTab">switchProviderTab</a></li><li><a href="global.html#switchSettingsSection">switchSettingsSection</a></li><li><a href="global.html#syncAllProviders">syncAllProviders</a></li><li><a href="global.html#syncChipToggle">syncChipToggle</a></li><li><a href="global.html#syncCurrencySettingsUI">syncCurrencySettingsUI</a></li><li><a href="global.html#syncGoldbackSettingsUI">syncGoldbackSettingsUI</a></li><li><a href="global.html#syncHasLocalChanges">syncHasLocalChanges</a></li><li><a href="global.html#syncHeaderToggleUI">syncHeaderToggleUI</a></li><li><a href="global.html#syncLayoutVisibilityUI">syncLayoutVisibilityUI</a></li><li><a href="global.html#syncProviderChain">syncProviderChain</a></li><li><a href="global.html#syncProviderPriorityUI">syncProviderPriorityUI</a></li><li><a href="global.html#syncRestoreOverrideBackup">syncRestoreOverrideBackup</a></li><li><a href="global.html#syncSaveOverrideBackup">syncSaveOverrideBackup</a></li><li><a href="global.html#syncSettingsUI">syncSettingsUI</a></li><li><a href="global.html#syncSpotPricesFromApi">syncSpotPricesFromApi</a></li><li><a href="global.html#testApiConnection">testApiConnection</a></li><li><a href="global.html#todayStr">todayStr</a></li><li><a href="global.html#toggleChange">toggleChange</a></li><li><a href="global.html#toggleCurrencyDropdown">toggleCurrencyDropdown</a></li><li><a href="global.html#toggleGlobalPriceView">toggleGlobalPriceView</a></li><li><a href="global.html#togglePriceView">togglePriceView</a></li><li><a href="global.html#toggleTheme">toggleTheme</a></li><li><a href="global.html#toggleVaultPasswordVisibility">toggleVaultPasswordVisibility</a></li><li><a href="global.html#tokenizeWords">tokenizeWords</a></li><li><a href="global.html#updateAllSparklines">updateAllSparklines</a></li><li><a href="global.html#updateCardSortBar">updateCardSortBar</a></li><li><a href="global.html#updateColumnVisibility">updateColumnVisibility</a></li><li><a href="global.html#updateFuzzyIndicator">updateFuzzyIndicator</a></li><li><a href="global.html#updateHistoryPullCost">updateHistoryPullCost</a></li><li><a href="global.html#updateItemCount">updateItemCount</a></li><li><a href="global.html#updateLastTimestamps">updateLastTimestamps</a></li><li><a href="global.html#updateManualSpot">updateManualSpot</a></li><li><a href="global.html#updateMatchIndicator">updateMatchIndicator</a></li><li><a href="global.html#updateModalCurrencyUI">updateModalCurrencyUI</a></li><li><a href="global.html#updatePortalHeight">updatePortalHeight</a></li><li><a href="global.html#updateProviderHistoryTables">updateProviderHistoryTables</a></li><li><a href="global.html#updateProviderSettings">updateProviderSettings</a></li><li><a href="global.html#updateSaveSearchButton">updateSaveSearchButton</a></li><li><a href="global.html#updateSettingsFooter">updateSettingsFooter</a></li><li><a href="global.html#updateSparkline">updateSparkline</a></li><li><a href="global.html#updateSpotCardColor">updateSpotCardColor</a></li><li><a href="global.html#updateSpotChangePercent">updateSpotChangePercent</a></li><li><a href="global.html#updateSpotTimestamp">updateSpotTimestamp</a></li><li><a href="global.html#updateStatusCell">updateStatusCell</a></li><li><a href="global.html#updateStorageStats">updateStorageStats</a></li><li><a href="global.html#updateStrengthBar">updateStrengthBar</a></li><li><a href="global.html#updateSummary">updateSummary</a></li><li><a href="global.html#updateSyncButtonStates">updateSyncButtonStates</a></li><li><a href="global.html#updateSyncStatusIndicator">updateSyncStatusIndicator</a></li><li><a href="global.html#updateThemeButton">updateThemeButton</a></li><li><a href="global.html#useSpotPrice">useSpotPrice</a></li><li><a href="global.html#validateFieldValue">validateFieldValue</a></li><li><a href="global.html#validateInventoryItem">validateInventoryItem</a></li><li><a href="global.html#validateItemFields">validateItemFields</a></li><li><a href="global.html#vaultDecrypt">vaultDecrypt</a></li><li><a href="global.html#vaultDecryptAndRestore">vaultDecryptAndRestore</a></li><li><a href="global.html#vaultDeriveKey">vaultDeriveKey</a></li><li><a href="global.html#vaultEncrypt">vaultEncrypt</a></li><li><a href="global.html#vaultEncryptToBytes">vaultEncryptToBytes</a></li><li><a href="global.html#vaultEncryptToBytesScoped">vaultEncryptToBytesScoped</a></li><li><a href="global.html#vaultRandomBytes">vaultRandomBytes</a></li><li><a href="global.html#verifyPcgsCert">verifyPcgsCert</a></li><li><a href="global.html#wireChipSortToggle">wireChipSortToggle</a></li><li><a href="global.html#wireFeatureFlagToggle">wireFeatureFlagToggle</a></li><li><a href="global.html#wireStorageToggle">wireStorageToggle</a></li><li><a href="global.html#xhrLoadJSON">xhrLoadJSON</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.5</a> on Thu Feb 19 2026 02:57:08 GMT-0600 (Central Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
