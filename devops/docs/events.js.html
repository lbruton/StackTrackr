<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: events.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: events.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * EVENTS MODULE - FIXED VERSION
 *
 * Handles all DOM event listeners with proper null checking and error handling.
 * Includes file protocol compatibility fixes and fallback event attachment methods.
 */

// EVENT UTILITIES
// =============================================================================

/**
 * Safely attaches event listener with fallback methods
 * @param {HTMLElement|Window|Document} element - Element to attach listener to
 * @param {string} event - Event type
 * @param {Function} handler - Event handler function
 * @param {string} [description=""] - Description for logging
 * @returns {boolean} Success status
 */
const safeAttachListener = (element, event, handler, description = "") => {
  if (!element) {
    console.warn(
      `Cannot attach ${event} listener: element not found (${description})`,
    );
    return false;
  }

  try {
    // Method 1: Standard addEventListener
    element.addEventListener(event, handler);
    return true;
  } catch (error) {
    console.warn(`Standard addEventListener failed for ${description}:`, error);

    try {
      // Method 2: Legacy event handler
      element["on" + event] = handler;
      debugLog(`✓ Fallback event handler attached: ${description}`);
      return true;
    } catch (fallbackError) {
      console.error(
        `All event attachment methods failed for ${description}:`,
        fallbackError,
      );
      return false;
    }
  }
};

/**
 * Attaches a listener only if the element exists; silent no-op otherwise.
 * Avoids console.warn spam for intentionally optional UI elements.
 * @param {HTMLElement|null} el - Element (may be null)
 * @param {string} event - Event type
 * @param {Function} handler - Event handler
 * @param {string} label - Description for logging
 */
const optionalListener = (el, event, handler, label) => {
  if (el) safeAttachListener(el, event, handler, label);
};

// =============================================================================
// IMAGE UPLOAD STATE (STACK-32) — Dual obverse/reverse support
// =============================================================================

/** @type {Blob|null} Pending obverse upload blob — saved on item commit */
let _pendingObverseBlob = null;
/** @type {Blob|null} Pending reverse upload blob — saved on item commit */
let _pendingReverseBlob = null;

/** @type {string|null} Preview object URL for obverse — revoked on modal close */
let _pendingObversePreviewUrl = null;
/** @type {string|null} Preview object URL for reverse — revoked on modal close */
let _pendingReversePreviewUrl = null;

/** @type {boolean} User clicked Remove on obverse — delete on save */
let _deleteObverseOnSave = false;
/** @type {boolean} User clicked Remove on reverse — delete on save */
let _deleteReverseOnSave = false;

/**
 * Process a user-selected image file and show preview for a specific side.
 * @param {File} file
 * @param {'obverse'|'reverse'} [side='obverse']
 */
const processUploadedImage = async (file, side = 'obverse') => {
  if (!file || typeof imageProcessor === 'undefined') return;

  const result = await imageProcessor.processFile(file, {
    maxDim: typeof IMAGE_MAX_DIM !== 'undefined' ? IMAGE_MAX_DIM : 600,
    maxBytes: typeof IMAGE_MAX_BYTES !== 'undefined' ? IMAGE_MAX_BYTES : 512000,
  });

  if (!result?.blob) {
    debugLog(`Image processing failed for ${side}`);
    return;
  }

  const suffix = side === 'reverse' ? 'Rev' : 'Obv';

  if (side === 'reverse') {
    _pendingReverseBlob = result.blob;
    if (_pendingReversePreviewUrl) URL.revokeObjectURL(_pendingReversePreviewUrl);
    _pendingReversePreviewUrl = imageProcessor.createPreview(result.blob);
  } else {
    _pendingObverseBlob = result.blob;
    if (_pendingObversePreviewUrl) URL.revokeObjectURL(_pendingObversePreviewUrl);
    _pendingObversePreviewUrl = imageProcessor.createPreview(result.blob);
  }

  const previewUrl = side === 'reverse' ? _pendingReversePreviewUrl : _pendingObversePreviewUrl;

  // Show preview in the appropriate side's elements
  const previewContainer = document.getElementById('itemImagePreview' + suffix);
  const previewImg = document.getElementById('itemImagePreviewImg' + suffix);
  const sizeInfo = document.getElementById('itemImageSizeInfo' + suffix);
  const removeBtn = document.getElementById('itemImageRemoveBtn' + suffix);

  if (previewImg &amp;&amp; previewUrl) {
    previewImg.src = previewUrl;
    if (previewContainer) previewContainer.style.display = 'block';
  }
  if (sizeInfo) {
    const origKB = (result.originalSize / 1024).toFixed(0);
    const compKB = (result.compressedSize / 1024).toFixed(0);
    sizeInfo.textContent = `${origKB} KB → ${compKB} KB (${result.format.split('/')[1]})`;
  }
  if (removeBtn) removeBtn.style.display = '';
};

/**
 * Track an externally-created preview object URL so it gets revoked
 * when clearUploadState() runs (prevents memory leaks in editItem preview).
 * @param {string} url - Object URL to track
 * @param {'obverse'|'reverse'} [side='obverse']
 */
const setEditPreviewUrl = (url, side = 'obverse') => {
  if (side === 'reverse') {
    if (_pendingReversePreviewUrl) URL.revokeObjectURL(_pendingReversePreviewUrl);
    _pendingReversePreviewUrl = url;
  } else {
    if (_pendingObversePreviewUrl) URL.revokeObjectURL(_pendingObversePreviewUrl);
    _pendingObversePreviewUrl = url;
  }
};

/**
 * Clear the pending upload state and previews for both sides.
 */
const clearUploadState = () => {
  _pendingObverseBlob = null;
  _pendingReverseBlob = null;
  _deleteObverseOnSave = false;
  _deleteReverseOnSave = false;

  if (_pendingObversePreviewUrl) {
    URL.revokeObjectURL(_pendingObversePreviewUrl);
    _pendingObversePreviewUrl = null;
  }
  if (_pendingReversePreviewUrl) {
    URL.revokeObjectURL(_pendingReversePreviewUrl);
    _pendingReversePreviewUrl = null;
  }

  // Clear obverse side UI
  const previewObv = document.getElementById('itemImagePreviewObv');
  const imgObv = document.getElementById('itemImagePreviewImgObv');
  const sizeObv = document.getElementById('itemImageSizeInfoObv');
  const removeObv = document.getElementById('itemImageRemoveBtnObv');
  const fileObv = document.getElementById('itemImageFileObv');

  if (previewObv) previewObv.style.display = 'none';
  if (imgObv) imgObv.src = '';
  if (sizeObv) sizeObv.textContent = '';
  if (removeObv) removeObv.style.display = 'none';
  if (fileObv) fileObv.value = '';

  // Clear reverse side UI
  const previewRev = document.getElementById('itemImagePreviewRev');
  const imgRev = document.getElementById('itemImagePreviewImgRev');
  const sizeRev = document.getElementById('itemImageSizeInfoRev');
  const removeRev = document.getElementById('itemImageRemoveBtnRev');
  const fileRev = document.getElementById('itemImageFileRev');

  if (previewRev) previewRev.style.display = 'none';
  if (imgRev) imgRev.src = '';
  if (sizeRev) sizeRev.textContent = '';
  if (removeRev) removeRev.style.display = 'none';
  if (fileRev) fileRev.value = '';

  // Reset pattern toggle state
  const patternToggle = document.getElementById('imagePatternToggle');
  const patternKeywordsGroup = document.getElementById('imagePatternKeywordsGroup');
  const patternKeywords = document.getElementById('imagePatternKeywords');
  if (patternToggle) patternToggle.checked = false;
  if (patternKeywordsGroup) patternKeywordsGroup.style.display = 'none';
  if (patternKeywords) patternKeywords.value = '';
};

/**
 * Save the pending upload blob(s) to IndexedDB for the given item UUID.
 * @param {string} uuid
 * @returns {Promise&lt;boolean>}
 */
const saveUserImageForItem = async (uuid) => {
  if (!uuid || !window.imageCache?.isAvailable()) {
    debugLog('saveUserImageForItem: invalid uuid or cache unavailable');
    return false;
  }

  // Priority 1: Handle deletions first
  const hasDeleteIntent = _deleteObverseOnSave || _deleteReverseOnSave;
  const hasNewImages = _pendingObverseBlob || _pendingReverseBlob;

  if (hasDeleteIntent &amp;&amp; !hasNewImages) {
    // Pure deletion case: user removed images without uploading new ones
    await handleImageDeletion(uuid);
    clearUploadState();
    return true;
  }

  if (!hasNewImages) {
    // No changes at all
    debugLog('saveUserImageForItem: no changes to save');
    clearUploadState();
    return false;
  }

  // Priority 2: New uploads - merge with existing or replace deleted sides
  debugLog(`saveUserImageForItem: saving images for ${uuid}`);

  let obvBlob = _pendingObverseBlob;
  let revBlob = _pendingReverseBlob;

  // Merge with existing images if only one side uploaded
  if (!obvBlob || !revBlob) {
    try {
      const existing = await window.imageCache.getUserImage(uuid);
      if (existing) {
        // Only merge if not marked for deletion
        if (!obvBlob &amp;&amp; existing.obverse &amp;&amp; !_deleteObverseOnSave) {
          obvBlob = existing.obverse;
        }
        if (!revBlob &amp;&amp; existing.reverse &amp;&amp; !_deleteReverseOnSave) {
          revBlob = existing.reverse;
        }
      }
    } catch { /* ignore */ }
  }

  // cacheUserImage requires at least obverse; pass reverse as optional
  if (!obvBlob &amp;&amp; revBlob) {
    // Only reverse uploaded — store as obverse (API requirement)
    obvBlob = revBlob;
    revBlob = null;
  }

  const saved = await window.imageCache.cacheUserImage(uuid, obvBlob, revBlob);
  debugLog(`saveUserImageForItem: saved=${saved}`);
  clearUploadState();
  return saved;
};

/**
 * Handle image deletion based on deletion flags.
 * Supports partial deletion (one side only) or full deletion (both sides).
 * @param {string} uuid - Item UUID
 * @returns {Promise&lt;void>}
 */
const handleImageDeletion = async (uuid) => {
  if (!uuid || !window.imageCache?.isAvailable()) return;

  const deleteBoth = _deleteObverseOnSave &amp;&amp; _deleteReverseOnSave;
  const deleteNeither = !_deleteObverseOnSave &amp;&amp; !_deleteReverseOnSave;

  if (deleteNeither) return;

  if (deleteBoth) {
    // Delete entire record
    debugLog(`handleImageDeletion: deleting both sides for ${uuid}`);
    await window.imageCache.deleteUserImage(uuid);
  } else {
    // Partial deletion: keep one side, delete the other
    debugLog(`handleImageDeletion: partial deletion for ${uuid}`);

    try {
      const existing = await window.imageCache.getUserImage(uuid);
      if (!existing) return; // Nothing to delete

      // Nullify the deleted side, keep the other
      const newObverse = _deleteObverseOnSave ? null : existing.obverse;
      const newReverse = _deleteReverseOnSave ? null : existing.reverse;

      // If both would be null, delete entire record
      if (!newObverse &amp;&amp; !newReverse) {
        await window.imageCache.deleteUserImage(uuid);
      } else {
        // Save updated record with one side nullified
        // cacheUserImage requires obverse, so if only reverse remains, store it as obverse
        const obvToSave = newObverse || newReverse;
        const revToSave = newObverse ? newReverse : null;
        await window.imageCache.cacheUserImage(uuid, obvToSave, revToSave);
      }
    } catch (err) {
      debugLog(`Failed to handle partial deletion: ${err}`, 'warn');
    }
  }
};

/**
 * Sets up the override/merge/file-input triad for a single import format.
 * @param {HTMLElement|null} overrideBtn - "Override" button element
 * @param {HTMLElement|null} mergeBtn - "Merge" button element
 * @param {HTMLElement|null} fileInput - Hidden file input element
 * @param {Function} importFn - Import function (file, isOverride) => void
 * @param {string} formatName - Human label (e.g. "CSV", "JSON", "Numista CSV")
 */
const setupFormatImport = (overrideBtn, mergeBtn, fileInput, importFn, formatName) => {
  let isOverride = false;

  if (overrideBtn &amp;&amp; fileInput) {
    safeAttachListener(overrideBtn, "click", () => {
      if (confirm(`Importing ${formatName} will overwrite all existing data. To combine data, choose Merge instead. Press OK to continue.`)) {
        isOverride = true;
        fileInput.click();
      }
    }, `${formatName} override button`);
  }

  if (mergeBtn &amp;&amp; fileInput) {
    safeAttachListener(mergeBtn, "click", () => {
      isOverride = false;
      fileInput.click();
    }, `${formatName} merge button`);
  }

  optionalListener(fileInput, "change", function (e) {
    if (e.target.files.length > 0) {
      const file = e.target.files[0];
      if (!checkFileSize(file)) {
        alert("File exceeds 2MB limit. Enable cloud backup for larger uploads.");
      } else {
        importFn(file, isOverride);
      }
    }
    this.value = "";
  }, `${formatName} import`);
};

/**
 * Implements dynamic column resizing for the inventory table
 */
const setupColumnResizing = () => {
  const table = document.getElementById("inventoryTable");
  if (!table) {
    console.warn("Inventory table not found for column resizing");
    return;
  }

  // Clear any existing resize handles
  const existingHandles = table.querySelectorAll(".resize-handle");
  existingHandles.forEach((handle) => handle.remove());

  let isResizing = false;
  let currentColumn = null;
  let startX = 0;
  let startWidth = 0;

  // Add resize handles to table headers
  const headers = table.querySelectorAll("th");
  headers.forEach((header, index) => {
    // Ensure header text is wrapped in .header-text span
    let headerTextSpan = header.querySelector('.header-text');
    if (!headerTextSpan) {
      // Create new header-text span
      headerTextSpan = document.createElement('span');
      headerTextSpan.className = 'header-text';
    }

    // Check if the span is empty or needs text
    if (!headerTextSpan.textContent.trim()) {
      // Find the text content (excluding SVG and existing elements)
      const textNodes = Array.from(header.childNodes).filter(node =>
        node.nodeType === Node.TEXT_NODE &amp;&amp; node.textContent.trim()
      );

      if (textNodes.length > 0) {
        // Move text content into the span
        headerTextSpan.textContent = textNodes.map(node => node.textContent.trim()).join(' ');

        // Remove original text nodes
        textNodes.forEach(node => node.remove());

        // Insert the span after the SVG icon (if present) if it's not already in the DOM
        if (!header.contains(headerTextSpan)) {
          const svg = header.querySelector('svg');
          if (svg) {
            svg.insertAdjacentElement('afterend', headerTextSpan);
          } else {
            header.insertBefore(headerTextSpan, header.firstChild);
          }
        }
      }
    }

    // Skip adding resize handle to the Actions column (last column)
    if (index >= headers.length - 1) return;

    const resizeHandle = document.createElement("div");
    resizeHandle.className = "resize-handle";

    /* position:sticky (set via CSS on #inventoryTable thead th) already
       provides a containing block for the absolutely-positioned resize
       handle — no inline position:relative needed. */
    header.appendChild(resizeHandle);

    safeAttachListener(
      resizeHandle,
      "mousedown",
      (e) => {
        isResizing = true;
        currentColumn = header;
        startX = e.clientX;
        startWidth = parseInt(
          document.defaultView.getComputedStyle(header).width,
          10,
        );

        e.preventDefault();
        e.stopPropagation();

        // Prevent header click event from firing
        header.style.pointerEvents = "none";
        setTimeout(() => {
          header.style.pointerEvents = "auto";
        }, 100);
      },
      "Column resize handle",
    );
  });

  // Handle mouse move for resizing
  safeAttachListener(
    document,
    "mousemove",
    (e) => {
      if (!isResizing || !currentColumn) return;

      const width = startWidth + e.clientX - startX;
      const minWidth = 40;
      const maxWidth = 300;

      if (width >= minWidth &amp;&amp; width &lt;= maxWidth) {
        currentColumn.style.width = width + "px";
      }
    },
    "Document mousemove for resizing",
  );

  // Handle mouse up to stop resizing
  safeAttachListener(
    document,
    "mouseup",
    () => {
      if (isResizing) {
        isResizing = false;
        currentColumn = null;
      }
    },
    "Document mouseup for resizing",
  );

  // Prevent text selection during resize
  safeAttachListener(
    document,
    "selectstart",
    (e) => {
      if (isResizing) {
        e.preventDefault();
      }
    },
    "Document selectstart for resizing",
  );
};

// RESPONSIVE TABLE HANDLING
// =============================================================================

/**
 * Updates column visibility based on current viewport width
 */
const updateColumnVisibility = () => {
  const width = window.innerWidth;
  const isTouch = window.matchMedia('(pointer: coarse)').matches;
  const desktopCardView = localStorage.getItem(DESKTOP_CARD_VIEW_KEY) === 'true';
  const forceCards = desktopCardView || (isTouch &amp;&amp; width > 1350 &amp;&amp; width &lt;= 1600);

  document.body.classList.toggle('force-card-view', forceCards);

  // Card view handles all column visibility via CSS at ≤1350px (STACK-70)
  // or via .force-card-view for large touch tablets (STACK-70)
  if (width &lt;= 1350 || forceCards) return;
  const hidden = new Set();

  const breakpoints = [
    { width: 1400, hide: ["notes"] },
    { width: 1200, hide: ["notes"] },
    { width: 992, hide: ["notes", "premium"] },
    { width: 768, hide: ["notes", "premium", "spot"] },
    {
      width: 640,
      hide: ["notes", "premium", "spot", "weight"],
    },
    {
      width: 576,
      hide: [
        "notes",
        "premium",
        "spot",
        "weight",
        "purchaseLocation",
        "storageLocation",
        "numista",
        "type",
        "metal",
        "actions",
      ],
    },
  ];

  breakpoints.forEach((bp) => {
    if (width &lt; bp.width) bp.hide.forEach((c) => hidden.add(c));
  });

  // Hide image column when table thumbnails are off or COIN_IMAGES disabled
  const _imgOn = localStorage.getItem('tableImagesEnabled') !== 'false'
    &amp;&amp; typeof featureFlags !== 'undefined' &amp;&amp; featureFlags.isEnabled('COIN_IMAGES');
  if (!_imgOn) hidden.add('image');

  const allColumns = [
    "date",
    "type",
    "metal",
    "image",
    "qty",
    "name",
    "weight",
    "purchasePrice",
    "spot",
    "premium",
    "purchaseLocation",
    "storageLocation",
    "numista",
    "notes",
    "actions",
  ];

  allColumns.forEach((col) => {
    document.querySelectorAll(`[data-column="${col}"]`).forEach((el) => {
      el.classList.toggle("hidden", hidden.has(col));
    });
  });
};

/**
 * Sets up responsive column visibility handling
 */
const setupResponsiveColumns = () => {
  updateColumnVisibility();
  safeAttachListener(
    window,
    "resize",
    updateColumnVisibility,
    "Window resize for column visibility",
  );
};

// SUB-FUNCTIONS FOR EVENT LISTENER SETUP
// =============================================================================

/**
 * Sets up search input and chip-related listeners
 */
const setupSearchAndChipListeners = () => {
  // Search Input
  if (elements.searchInput) {
    const debouncedSearch = debounce(() => {
      searchQuery = elements.searchInput.value.replace(/[&lt;>]/g, "").trim();
      renderTable();
      if (typeof renderActiveFilters === "function") {
        renderActiveFilters();
      }
    }, 300);
    safeAttachListener(elements.searchInput, "input", debouncedSearch, "Search Input");
  }

  // Chip minimum count dropdown (inline)
  const chipMinCountEl = document.getElementById('chipMinCount');
  if (chipMinCountEl) {
    safeAttachListener(
      chipMinCountEl,
      'change',
      (e) => {
        const minCount = parseInt(e.target.value, 10);
        localStorage.setItem('chipMinCount', minCount.toString());
        // Sync settings modal control
        const settingsChipMin = document.getElementById('settingsChipMinCount');
        if (settingsChipMin) settingsChipMin.value = minCount.toString();
        if (typeof renderActiveFilters === 'function') {
          renderActiveFilters();
        }
      },
      'Chip minimum count dropdown'
    );
  }

  // Grouped name chips toggle (inline) — uses global helper from settings.js
  const groupNameChipsEl = document.getElementById('groupNameChips');
  if (groupNameChipsEl &amp;&amp; window.featureFlags) {
    // Set initial state from feature flag
    const initVal = window.featureFlags.isEnabled('GROUPED_NAME_CHIPS') ? 'yes' : 'no';
    groupNameChipsEl.querySelectorAll('.chip-sort-btn').forEach(btn => {
      btn.classList.toggle('active', btn.dataset.val === initVal);
    });
  }
  if (typeof wireFeatureFlagToggle === 'function') {
    wireFeatureFlagToggle('groupNameChips', 'GROUPED_NAME_CHIPS', {
      syncId: 'settingsGroupNameChips',
      onApply: () => { if (typeof renderActiveFilters === 'function') renderActiveFilters(); },
    });
  }

  // Chip sort order inline toggle — uses global helper from settings.js
  const chipSortEl = document.getElementById('chipSortOrder');
  if (chipSortEl) {
    // Restore saved value on setup (migrate 'default' → 'alpha')
    const savedSort = localStorage.getItem('chipSortOrder');
    const activeSort = (savedSort === 'count') ? 'count' : 'alpha';
    chipSortEl.querySelectorAll('.chip-sort-btn').forEach(btn => {
      btn.classList.toggle('active', btn.dataset.sort === activeSort);
    });
  }
  if (typeof wireChipSortToggle === 'function') {
    wireChipSortToggle('chipSortOrder', 'settingsChipSortOrder');
  }
};

/**
 * Sets up header button listeners (logo, settings, about, details)
 */
const setupHeaderButtonListeners = () => {
  // CRITICAL HEADER BUTTONS
  debugLog("Setting up header buttons...");

  // App Logo
  if (elements.appLogo) {
    safeAttachListener(
      elements.appLogo,
      "click",
      () => window.location.reload(),
      "App Logo",
    );
  }

  // Settings Button
  if (elements.settingsBtn) {
    safeAttachListener(
      elements.settingsBtn,
      "click",
      (e) => {
        e.preventDefault();
        debugLog("Settings button clicked");
        if (typeof showSettingsModal === "function") {
          showSettingsModal();
        }
      },
      "Settings Button",
    );
  }

  // About Button
  if (elements.aboutBtn) {
    safeAttachListener(
      elements.aboutBtn,
      "click",
      (e) => {
        e.preventDefault();
        if (typeof showAboutModal === "function") {
          showAboutModal();
        }
      },
      "About Button",
    );
  }


  // Details modal triggers
  if (elements.totalTitles &amp;&amp; elements.totalTitles.length) {
    elements.totalTitles.forEach((title) => {
      safeAttachListener(
        title,
        "click",
        () => {
          const metal = title.dataset.metal;
          if (typeof showDetailsModal === "function") {
            showDetailsModal(metal);
          }
        },
        `Totals title (${title.dataset.metal})`,
      );
    });
  }

  if (elements.detailsCloseBtn) {
    safeAttachListener(
      elements.detailsCloseBtn,
      "click",
      () => {
        if (typeof closeDetailsModal === "function") {
          closeDetailsModal();
        }
      },
      "Close details modal",
    );
  }
};

/**
 * Sets up table header sorting and Goldback denomination picker
 */
const setupTableSortListeners = () => {
  // TABLE HEADER SORTING
  debugLog("Setting up table sorting...");
  const inventoryTable = document.getElementById("inventoryTable");
  if (inventoryTable) {
    const headers = inventoryTable.querySelectorAll("th");
    headers.forEach((header, index) => {
      // Skip the Actions column (last column)
      if (index >= headers.length - 1) {
        return;
      }

      header.style.cursor = "pointer";

      safeAttachListener(
        header,
        "click",
        (e) => {
          if (e.shiftKey) return;
          // Toggle sort direction if same column, otherwise set to new column with asc
          if (sortColumn === index) {
            sortDirection = sortDirection === "asc" ? "desc" : "asc";
          } else {
            sortColumn = index;
            sortDirection = "asc";
          }

          renderTable();
        },
        `Table header ${index}`,
      );
    });
  } else {
    console.error("Inventory table not found for sorting setup!");
  }

  // GOLDBACK DENOMINATION PICKER TOGGLE (STACK-45)
  // Swaps weight text input ↔ denomination select when unit changes to/from 'gb'.
  // Auto-fills hidden weight value from the selected denomination.
  const showEl = (el, visible) => { if (el) el.style.display = visible ? '' : 'none'; };
  /**
   * Toggles the visible input between weight and goldback denomination.
   * Auto-fills hidden weight value from the selected denomination when in 'gb' mode.
   */
  window.toggleGbDenomPicker = () => {
    const isGb = elements.itemWeightUnit?.value === 'gb';
    const denomSelect = elements.itemGbDenom;
    const weightInput = elements.itemWeight;
    const weightLabel = document.getElementById('itemWeightLabel');

    showEl(denomSelect, isGb);
    showEl(weightInput, !isGb);
    if (isGb &amp;&amp; weightInput &amp;&amp; denomSelect) weightInput.value = denomSelect.value;
    if (weightLabel) weightLabel.textContent = isGb ? 'Denomination' : 'Weight';
  };
};

// FORM SUBMIT HELPERS (STACK-61)
// =============================================================================

/**
 * Parses weight from form input, handling Goldback denominations,
 * fractions, and gram-to-troy-oz conversion.
 * @param {string} weightRaw - Raw weight input value
 * @param {string} weightUnit - Unit: 'oz', 'g', or 'gb'
 * @param {boolean} isEditing - Whether in edit mode
 * @param {Object} existingItem - Existing item (edit mode)
 * @returns {number} Weight in troy ounces (or denomination value for gb)
 */
const parseWeight = (weightRaw, weightUnit, isEditing, existingItem) => {
  if (isEditing &amp;&amp; weightRaw === '') {
    return typeof existingItem.weight !== 'undefined' ? existingItem.weight : 0;
  }
  let weight = parseFraction(weightRaw);
  if (weightUnit === 'g') {
    weight = gramsToOzt(weight);
  }
  // gb: weight stays as raw denomination value (conversion happens in computeMeltValue)
  return isNaN(weight) ? 0 : parseFloat(weight.toFixed(6));
};

/**
 * Converts a user-entered price from display currency to USD.
 * @param {string} rawValue - Raw price input value
 * @param {number} fxRate - Exchange rate (display currency per 1 USD)
 * @param {boolean} isEditing - Whether in edit mode
 * @param {number} existingValue - Existing price (edit mode)
 * @returns {number} Price in USD
 */
const parsePriceToUSD = (rawValue, fxRate, isEditing, existingValue) => {
  if (isEditing &amp;&amp; rawValue === '') {
    return typeof existingValue !== 'undefined' ? existingValue : 0;
  }
  let entered = rawValue === '' ? 0 : parseFloat(rawValue);
  entered = isNaN(entered) || entered &lt; 0 ? 0 : entered;
  return fxRate !== 1 ? entered / fxRate : entered;
};

/**
 * Reads purity from the select/custom input pair.
 * @param {boolean} isEditing - Whether in edit mode
 * @param {Object} existingItem - Existing item (edit mode)
 * @returns {number} Purity value (0–1)
 */
const parsePurity = (isEditing, existingItem) => {
  const puritySelect = elements.itemPuritySelect;
  if (puritySelect &amp;&amp; puritySelect.value === 'custom') {
    return elements.itemPurity ? (parseFloat(elements.itemPurity.value) || 1.0) : 1.0;
  }
  if (puritySelect) {
    return parseFloat(puritySelect.value) || 1.0;
  }
  return isEditing ? (existingItem.purity || 1.0) : 1.0;
};

/**
 * Reads all form fields and returns a parsed fields object.
 * @param {boolean} isEditing - Whether in edit mode
 * @param {Object} existingItem - Existing item (edit mode)
 * @returns {Object} Parsed field values
 */
const parseItemFormFields = (isEditing, existingItem) => {
  const composition = getCompositionFirstWords(elements.itemMetal.value);
  const metal = parseNumistaMetal(composition);
  const fxRate = (typeof getExchangeRate === 'function') ? getExchangeRate() : 1;

  const nameInput = elements.itemName.value.trim();
  const qtyInput = elements.itemQty.value.trim();

  const weightUnit = elements.itemWeightUnit.value;
  const weightRaw = (weightUnit === 'gb' &amp;&amp; elements.itemGbDenom)
    ? elements.itemGbDenom.value
    : elements.itemWeight.value;

  const marketValueInput = elements.itemMarketValue ? elements.itemMarketValue.value.trim() : '';
  let marketValue;
  if (marketValueInput &amp;&amp; !isNaN(parseFloat(marketValueInput))) {
    const enteredMv = parseFloat(marketValueInput);
    marketValue = fxRate !== 1 ? enteredMv / fxRate : enteredMv;
  } else {
    marketValue = 0;
  }

  return {
    metal,
    composition,
    name: isEditing ? (nameInput || existingItem.name || '') : nameInput,
    qty: qtyInput === '' ? (isEditing ? (existingItem.qty || 1) : 1) : parseInt(qtyInput, 10),
    type: elements.itemType.value || (isEditing ? existingItem.type : ''),
    weight: parseWeight(weightRaw, weightUnit, isEditing, existingItem),
    weightUnit,
    price: parsePriceToUSD(elements.itemPrice.value.trim(), fxRate, isEditing, existingItem.price),
    purchaseLocation: elements.purchaseLocation.value.trim(),
    storageLocation: elements.storageLocation.value.trim(),
    serialNumber: elements.itemSerialNumber?.value?.trim() ?? '',
    notes: elements.itemNotes.value.trim(),
    date: elements.itemDate.value || (isEditing ? (existingItem.date || '') : todayStr()),
    catalog: elements.itemCatalog ? elements.itemCatalog.value.trim() : '',
    year: elements.itemYear?.value?.trim() ?? '',
    grade: elements.itemGrade?.value?.trim() ?? '',
    gradingAuthority: elements.itemGradingAuthority?.value?.trim() ?? '',
    certNumber: elements.itemCertNumber?.value?.trim() ?? '',
    pcgsNumber: elements.itemPcgsNumber?.value?.trim() ?? '',
    marketValue,
    purity: parsePurity(isEditing, existingItem),
    currency: displayCurrency,
    obverseImageUrl: elements.itemObverseImageUrl?.value?.trim() ?? '',
    reverseImageUrl: elements.itemReverseImageUrl?.value?.trim() ?? '',
  };
};

/**
 * Validates mandatory item fields.
 * @param {Object} f - Parsed fields from parseItemFormFields()
 * @returns {string|null} Error message or null if valid
 */
const validateItemFields = (f) => {
  if (
    !f.name || !f.date || !f.type || !f.metal ||
    isNaN(f.weight) || f.weight &lt;= 0 ||
    isNaN(f.qty) || f.qty &lt; 1 || !Number.isInteger(f.qty)
  ) {
    return "Please enter valid values for Name, Date, Type, Metal, Weight, and Quantity.";
  }
  return null;
};

/**
 * Builds the common field object shared by both add and edit paths.
 * @param {Object} f - Parsed fields from parseItemFormFields()
 * @returns {Object} Common item fields
 */
const buildItemFields = (f) => ({
  metal: f.metal, composition: f.composition, name: f.name, qty: f.qty,
  type: f.type, weight: f.weight, weightUnit: f.weightUnit, price: f.price,
  marketValue: f.marketValue, date: f.date, purchaseLocation: f.purchaseLocation,
  storageLocation: f.storageLocation, serialNumber: f.serialNumber, notes: f.notes,
  year: f.year, grade: f.grade, gradingAuthority: f.gradingAuthority,
  certNumber: f.certNumber, pcgsNumber: f.pcgsNumber, purity: f.purity,
});

/**
 * Commits a parsed item to inventory (add or edit mode).
 * @param {Object} f - Parsed fields from parseItemFormFields()
 * @param {boolean} isEditing - Whether in edit mode
 * @param {number|null} editIdx - Index being edited (null for add)
 */
const commitItemToInventory = (f, isEditing, editIdx) => {
  if (isEditing) {
    const oldItem = { ...inventory[editIdx] };
    const serial = oldItem.serial;

    inventory[editIdx] = {
      ...oldItem,
      ...buildItemFields(f),
      numistaId: f.catalog,
      currency: f.currency,
      obverseImageUrl: f.obverseImageUrl || window.selectedNumistaResult?.imageUrl || oldItem.obverseImageUrl || '',
      reverseImageUrl: f.reverseImageUrl || window.selectedNumistaResult?.reverseImageUrl || oldItem.reverseImageUrl || '',
    };

    addCompositionOption(f.composition);

    try {
      if (window.catalogManager &amp;&amp; inventory[editIdx].numistaId) {
        catalogManager.setCatalogId(serial, inventory[editIdx].numistaId);
      }
    } catch (catErr) {
      console.warn('Failed to update catalog mapping:', catErr);
    }

    // Apply spot lookup override if user selected a historical spot (STACK-49)
    const lookupSpotEdit = elements.itemSpotPrice ? parseFloat(elements.itemSpotPrice.value) : NaN;
    if (!isNaN(lookupSpotEdit) &amp;&amp; lookupSpotEdit > 0) {
      inventory[editIdx].spotPriceAtPurchase = lookupSpotEdit;
    }

    saveInventory();

    // Record price data point if price-related fields changed (STACK-43)
    if (typeof recordSingleItemPrice === 'function') {
      const cur = inventory[editIdx];
      const priceChanged = oldItem.marketValue !== cur.marketValue
        || oldItem.price !== cur.price || oldItem.weight !== cur.weight
        || oldItem.qty !== cur.qty || oldItem.metal !== cur.metal
        || oldItem.purity !== cur.purity;
      if (priceChanged) recordSingleItemPrice(cur, 'edit');
    }

    renderTable();
    renderActiveFilters();
    logItemChanges(oldItem, inventory[editIdx]);

    editingIndex = null;
    editingChangeLogIndex = null;
  } else {
    const metalKey = f.metal.toLowerCase();
    // Prefer spot price from lookup modal, fall back to current spot (STACK-49)
    const lookupSpot = elements.itemSpotPrice ? parseFloat(elements.itemSpotPrice.value) : NaN;
    const spotPriceAtPurchase = !isNaN(lookupSpot) &amp;&amp; lookupSpot > 0
      ? lookupSpot
      : (spotPrices[metalKey] ?? 0);
    const serial = getNextSerial();

    inventory.push({
      ...buildItemFields(f),
      pcgsVerified: false,
      spotPriceAtPurchase,
      premiumPerOz: 0,
      totalPremium: 0,
      serial,
      uuid: generateUUID(),
      numistaId: f.catalog,
      currency: f.currency,
      obverseImageUrl: f.obverseImageUrl || window.selectedNumistaResult?.imageUrl || '',
      reverseImageUrl: f.reverseImageUrl || window.selectedNumistaResult?.reverseImageUrl || '',
    });

    typeof registerName === "function" &amp;&amp; registerName(f.name);
    addCompositionOption(f.composition);

    if (window.catalogManager &amp;&amp; f.catalog) {
      catalogManager.setCatalogId(serial, f.catalog);
    }

    saveInventory();

    // Log the add action to the changelog (BUG-004)
    const addedItem = inventory[inventory.length - 1];
    const addSummary = [addedItem.metal, addedItem.type, addedItem.name,
    typeof formatWeight === 'function' ? formatWeight(addedItem.weight, addedItem.weightUnit) : addedItem.weight + ' oz',
    typeof formatCurrency === 'function' ? formatCurrency(addedItem.price) : '$' + Number(addedItem.price).toFixed(2)
    ].filter(Boolean).join(' · ');
    logChange(addedItem.name, 'Added', '', addSummary, inventory.length - 1);

    // STAK-126: Auto-apply Numista tags from the lookup result
    if (window.selectedNumistaResult?.tags &amp;&amp; typeof applyNumistaTags === 'function') {
      const newUuid = addedItem.uuid;
      applyNumistaTags(newUuid, window.selectedNumistaResult.tags);
    }

    // Record initial price data point (STACK-43)
    if (typeof recordSingleItemPrice === 'function') {
      recordSingleItemPrice(addedItem, 'add');
    }

    renderTable();

    // Success toast (UX-002)
    if (typeof showToast === 'function') {
      showToast('\u2713 ' + addedItem.name + ' added to inventory');
    }
  }
};

/**
 * Builds a Numista search query, optionally rewriting via NumistaLookup patterns.
 * @param {string} nameVal - Item name input value
 * @param {string} metalVal - Metal composition value
 * @returns {{ query: string, numistaId: string|null, matched: boolean }}
 */
const buildNumistaSearchQuery = (nameVal, metalVal) => {
  const combined = (metalVal &amp;&amp; !nameVal.toLowerCase().includes(metalVal.toLowerCase()))
    ? `${metalVal} ${nameVal}` : nameVal;

  // Try pattern-based lookup if feature is enabled
  if (window.NumistaLookup &amp;&amp; window.featureFlags &amp;&amp; featureFlags.isEnabled('NUMISTA_SEARCH_LOOKUP')) {
    const match = NumistaLookup.matchQuery(combined);
    if (match) {
      return { query: match.replacement, numistaId: match.numistaId, matched: true };
    }
  }

  // Fallback: original behavior (raw query)
  return { query: combined, numistaId: null, matched: false };
};

/**
 * Sets up item form submission and related button listeners
 */
const setupItemFormListeners = () => {
  // UNIFIED FORM SUBMISSION (Add + Edit via single #itemModal)
  debugLog("Setting up unified item form...");
  if (elements.inventoryForm) {
    safeAttachListener(
      elements.inventoryForm,
      "submit",
      async function (e) {
        e.preventDefault();

        const isEditing = editingIndex !== null;
        const existingItem = isEditing ? { ...inventory[editingIndex] } : {};

        const fields = parseItemFormFields(isEditing, existingItem);
        const error = validateItemFields(fields);
        if (error) { alert(error); return; }

        // Capture index before commit — commitItemToInventory nulls editingIndex
        const savedEditIdx = editingIndex;
        commitItemToInventory(fields, isEditing, editingIndex);

        // Save user-uploaded image if pending (STACK-32)
        // Pattern toggle: create a pattern rule instead of per-item image
        let patternRuleSaved = false;
        const patternToggle = document.getElementById('imagePatternToggle');
        if ((_pendingObverseBlob || _pendingReverseBlob) &amp;&amp; patternToggle?.checked) {
          try {
            const rawKeywords = (document.getElementById('imagePatternKeywords')?.value || '').trim();
            if (rawKeywords) {
              // Convert keywords to regex: "morgan, peace" → "morgan|peace"
              const terms = rawKeywords.split(/[,;]/).map(t => t.trim()).filter(t => t.length > 0);
              const pattern = terms.map(t => t.replace(/[.*+?^${}()|[\]\\]/g, '\\$&amp;')).join('|');
              // Pre-generate ruleId and pass as seedImageId — the image lookup
              // chain resolves via rule.seedImageId, not rule.id
              const ruleId = 'custom-img-' + Date.now();
              const result = NumistaLookup.addRule(pattern, rawKeywords, null, ruleId);
              if (result?.success &amp;&amp; window.imageCache?.isAvailable()) {
                await window.imageCache.cachePatternImage(ruleId, _pendingObverseBlob, _pendingReverseBlob);
                debugLog(`Pattern rule created: ${result.id} (images: ${ruleId}) for "${rawKeywords}"`);
              } else {
                debugLog(`Failed to create pattern rule: ${result?.error}`, 'warn');
              }
              clearUploadState();
              patternRuleSaved = true;
            }
          } catch (err) {
            console.warn('Failed to create pattern rule from modal:', err);
            clearUploadState();
            patternRuleSaved = true; // prevent double-save on error
          }
        }
        if (!patternRuleSaved &amp;&amp; (_pendingObverseBlob || _pendingReverseBlob || _deleteObverseOnSave || _deleteReverseOnSave)) {
          // Per-item save: save blobs against the item's UUID
          const savedItem = isEditing ? inventory[savedEditIdx] : inventory[inventory.length - 1];
          if (savedItem?.uuid) {
            try {
              const saved = await saveUserImageForItem(savedItem.uuid);
              if (!saved) {
                debugLog('Image save returned false — image may not have been stored');
              }
            } catch (err) {
              console.warn('Failed to save user image:', err);
            }
          }
        } else if (!patternRuleSaved) {
          clearUploadState();
        }

        // Clear spot lookup hidden field after commit (STACK-49)
        if (elements.itemSpotPrice) elements.itemSpotPrice.value = '';

        if (!isEditing) {
          this.reset();
          elements.itemWeightUnit.value = "oz";
          elements.itemDate.value = todayStr();
        }

        // Close modal
        try {
          if (typeof closeModalById === 'function') {
            closeModalById('itemModal');
          } else if (elements.itemModal) {
            elements.itemModal.style.display = 'none';
            document.body.style.overflow = '';
          }
        } catch (closeErr) {
          console.warn('Failed to close item modal:', closeErr);
        }

        // Update filter chips after inventory mutation
        if (typeof renderActiveFilters === 'function') {
          renderActiveFilters();
        }
      },
      "Unified item form",
    );
  } else {
    console.error("Main inventory form not found!");
  }

  // UNDO CHANGE BUTTON
  if (elements.undoChangeBtn) {
    safeAttachListener(
      elements.undoChangeBtn,
      "click",
      (e) => {
        if (e &amp;&amp; typeof e.preventDefault === 'function') e.preventDefault();
        if (editingChangeLogIndex !== null) {
          toggleChange(editingChangeLogIndex);
          try { if (typeof closeModalById === 'function') closeModalById('itemModal'); } catch (undoErr) { }
          editingIndex = null;
          editingChangeLogIndex = null;
          renderChangeLog();
        }
      },
      "Undo change button",
    );
  }

  // ITEM MODAL CLOSE / CANCEL BUTTONS
  const closeItemModal = (e) => {
    if (e &amp;&amp; typeof e.preventDefault === 'function') e.preventDefault();
    if (e &amp;&amp; typeof e.stopPropagation === 'function') e.stopPropagation();
    // Dismiss any open autocomplete dropdowns (BUG-002/003)
    if (typeof dismissAllAutocompletes === 'function') dismissAllAutocompletes();
    try { if (typeof closeModalById === 'function') closeModalById('itemModal'); } catch (closeErr) { }
    editingIndex = null;
    editingChangeLogIndex = null;
  };

  optionalListener(elements.cancelItemBtn, "click", closeItemModal, "Cancel item button");
  optionalListener(elements.itemCloseBtn, "click", closeItemModal, "Item modal close button");

  // RETAIL PRICE HISTORY LINK — opens per-item price history modal (STAK-109)
  const retailHistoryLink = document.getElementById('retailPriceHistoryLink');
  if (retailHistoryLink) {
    retailHistoryLink.addEventListener('click', (e) => {
      e.preventDefault();
      e.stopPropagation();
      if (editingIndex === null) return;
      const item = inventory[editingIndex];
      if (!item || !item.uuid) return;
      if (typeof openItemPriceHistoryModal === 'function') {
        openItemPriceHistoryModal(item.uuid, item.name || 'Unnamed');
      }
    });
  }

  // ITEM PRICE HISTORY MODAL — close &amp; filter handlers (STAK-109)
  const itemPriceHistoryModal = document.getElementById('itemPriceHistoryModal');
  const itemPriceHistoryCloseBtn = document.getElementById('itemPriceHistoryCloseBtn');
  const itemPriceHistoryFilter = document.getElementById('itemPriceHistoryFilter');
  const itemPriceHistoryClearFilterBtn = document.getElementById('itemPriceHistoryClearFilterBtn');

  if (itemPriceHistoryCloseBtn) {
    itemPriceHistoryCloseBtn.addEventListener('click', () => {
      if (itemPriceHistoryModal) itemPriceHistoryModal.style.display = 'none';
    });
  }
  if (itemPriceHistoryModal) {
    itemPriceHistoryModal.addEventListener('click', (e) => {
      if (e.target === itemPriceHistoryModal) {
        itemPriceHistoryModal.style.display = 'none';
      }
    });
  }
  if (itemPriceHistoryFilter) {
    itemPriceHistoryFilter.addEventListener('input', () => {
      if (typeof window._setItemPriceModalFilter === 'function') {
        window._setItemPriceModalFilter(itemPriceHistoryFilter.value);
      }
    });
  }
  if (itemPriceHistoryClearFilterBtn) {
    itemPriceHistoryClearFilterBtn.addEventListener('click', () => {
      if (itemPriceHistoryFilter) itemPriceHistoryFilter.value = '';
      if (typeof window._setItemPriceModalFilter === 'function') {
        window._setItemPriceModalFilter('');
      }
    });
  }

  // IMAGE URL FIELDS — show when COIN_IMAGES enabled
  const imageUrlGroup = document.getElementById('imageUrlGroup');
  if (imageUrlGroup &amp;&amp; featureFlags.isEnabled('COIN_IMAGES')) {
    imageUrlGroup.style.display = '';
  }

  // Refresh image URLs button — bypasses SW cache, fetches direct from Numista
  const refreshImageUrlsBtn = document.getElementById('refreshImageUrlsBtn');
  if (refreshImageUrlsBtn) {
    safeAttachListener(refreshImageUrlsBtn, 'click', async () => {
      const catalogId = (elements.itemCatalog?.value || '').trim();
      if (!catalogId) {
        alert('Enter a Numista # first.');
        return;
      }
      refreshImageUrlsBtn.disabled = true;
      refreshImageUrlsBtn.title = 'Fetching…';
      try {
        const config = typeof catalogConfig !== 'undefined' ? catalogConfig.getNumistaConfig() : null;
        if (!config?.apiKey) {
          alert('Numista API key not configured.');
          return;
        }
        const url = `https://api.numista.com/v3/types/${catalogId}?lang=en`;
        const resp = await fetch(url, {
          headers: { 'Numista-API-Key': config.apiKey, 'Content-Type': 'application/json' },
          cache: 'no-cache',
        });
        if (!resp.ok) throw new Error(`HTTP ${resp.status}`);
        const data = await resp.json();
        const obv = data.obverse_thumbnail || data.obverse?.thumbnail || '';
        const rev = data.reverse_thumbnail || data.reverse?.thumbnail || '';
        if (elements.itemObverseImageUrl) elements.itemObverseImageUrl.value = obv;
        if (elements.itemReverseImageUrl) elements.itemReverseImageUrl.value = rev;
        if (!obv &amp;&amp; !rev) alert('No image URLs returned by Numista for this item.');
      } catch (err) {
        console.error('Image URL refresh failed:', err);
        alert('Failed to fetch image URLs: ' + err.message);
      } finally {
        refreshImageUrlsBtn.disabled = false;
        refreshImageUrlsBtn.title = 'Fetch image URLs from Numista API (bypasses cache)';
      }
    }, 'Refresh image URLs button');
  }

  // IMAGE UPLOAD BUTTONS — Obverse + Reverse (STACK-32/33)
  const imageUploadGroup = document.getElementById('imageUploadGroup');

  if (imageUploadGroup &amp;&amp; featureFlags.isEnabled('COIN_IMAGES')) {
    imageUploadGroup.style.display = '';

    const isSecure = location.protocol === 'https:' || location.hostname === 'localhost';
    const isMobile = /Mobi|Android/i.test(navigator.userAgent);

    // Wire each side: Obv and Rev
    ['Obv', 'Rev'].forEach(suffix => {
      const side = suffix === 'Rev' ? 'reverse' : 'obverse';
      const fileInput = document.getElementById('itemImageFile' + suffix);
      const uploadBtn = document.getElementById('itemImageUploadBtn' + suffix);
      const cameraBtn = document.getElementById('itemImageCameraBtn' + suffix);
      const removeBtn = document.getElementById('itemImageRemoveBtn' + suffix);

      if (isMobile &amp;&amp; isSecure &amp;&amp; cameraBtn &amp;&amp; fileInput) {
        cameraBtn.style.display = '';
        cameraBtn.addEventListener('click', () => {
          fileInput.setAttribute('capture', 'environment');
          fileInput.click();
        });
      }

      if (uploadBtn &amp;&amp; fileInput) {
        uploadBtn.addEventListener('click', () => {
          fileInput.removeAttribute('capture');
          fileInput.click();
        });
      }

      if (fileInput) {
        fileInput.addEventListener('change', async () => {
          const file = fileInput.files?.[0];
          if (file) await processUploadedImage(file, side);
        });
      }

      if (removeBtn) {
        removeBtn.addEventListener('click', () => {
          // Clear just this side
          if (side === 'reverse') {
            _pendingReverseBlob = null;
            _deleteReverseOnSave = true;
            if (_pendingReversePreviewUrl) { URL.revokeObjectURL(_pendingReversePreviewUrl); _pendingReversePreviewUrl = null; }
          } else {
            _pendingObverseBlob = null;
            _deleteObverseOnSave = true;
            if (_pendingObversePreviewUrl) { URL.revokeObjectURL(_pendingObversePreviewUrl); _pendingObversePreviewUrl = null; }
          }
          const preview = document.getElementById('itemImagePreview' + suffix);
          const img = document.getElementById('itemImagePreviewImg' + suffix);
          const sizeInfo = document.getElementById('itemImageSizeInfo' + suffix);
          if (preview) preview.style.display = 'none';
          if (img) img.src = '';
          if (sizeInfo) sizeInfo.textContent = '';
          if (removeBtn) removeBtn.style.display = 'none';
          if (fileInput) fileInput.value = '';
        });
      }
    });

    // PATTERN TOGGLE — "Apply to all matching items" checkbox
    const patternToggleGroup = document.getElementById('imagePatternToggleGroup');
    const patternToggleCheckbox = document.getElementById('imagePatternToggle');
    const patternKeywordsGroup = document.getElementById('imagePatternKeywordsGroup');
    const patternKeywordsInput = document.getElementById('imagePatternKeywords');

    if (patternToggleGroup) {
      patternToggleGroup.style.display = '';
    }
    if (patternToggleCheckbox) {
      patternToggleCheckbox.addEventListener('change', () => {
        if (patternKeywordsGroup) {
          patternKeywordsGroup.style.display = patternToggleCheckbox.checked ? '' : 'none';
        }
        if (patternToggleCheckbox.checked &amp;&amp; patternKeywordsInput) {
          const itemName = document.getElementById('itemName')?.value?.trim() || '';
          if (itemName &amp;&amp; !patternKeywordsInput.value.trim()) {
            patternKeywordsInput.value = itemName;
          }
        }
      });
    }
  }

  // SEARCH NUMISTA BUTTON — lookup by N# or search by name
  if (elements.searchNumistaBtn) {
    safeAttachListener(
      elements.searchNumistaBtn,
      "click",
      async () => {
        const catalogVal = elements.itemCatalog?.value.trim() || '';
        const nameVal = elements.itemName?.value.trim() || '';

        if (!catalogVal &amp;&amp; !nameVal) {
          alert('Enter a Name or Catalog N# to search.');
          return;
        }

        if (!catalogAPI || !catalogAPI.activeProvider) {
          alert('Configure Numista API key in Settings first.');
          return;
        }

        const btn = elements.searchNumistaBtn;
        const originalHTML = btn.innerHTML;
        btn.textContent = 'Searching...';
        btn.disabled = true;

        // Type → Numista category mapping for smarter search results
        const TYPE_TO_NUMISTA_CATEGORY = {
          'Coin': 'coin',
          'Bar': 'exonumia',
          'Round': 'exonumia',
          'Note': 'banknote',
        };

        try {
          if (catalogVal) {
            const result = await catalogAPI.lookupItem(catalogVal);
            showNumistaResults(result ? [result] : [], true, catalogVal);
          } else {
            const typeVal = elements.itemType?.value || '';
            const metalVal = elements.itemMetal?.value || '';

            const searchFilters = { limit: 20 };
            const numistaCategory = TYPE_TO_NUMISTA_CATEGORY[typeVal];
            if (numistaCategory) searchFilters.category = numistaCategory;

            const searchResult = buildNumistaSearchQuery(nameVal, metalVal);

            if (searchResult.matched) {
              // Pattern matched — build raw query for fallback results
              const rawQuery = (metalVal &amp;&amp; !nameVal.toLowerCase().includes(metalVal.toLowerCase()))
                ? `${metalVal} ${nameVal}` : nameVal;

              // Fire all requests in parallel: direct N# + rewritten + raw fallback
              const promises = [
                searchResult.numistaId
                  ? catalogAPI.lookupItem(searchResult.numistaId).catch(() => null)
                  : Promise.resolve(null),
                catalogAPI.searchItems(searchResult.query, searchFilters),
                catalogAPI.searchItems(rawQuery, searchFilters),
              ];
              const [directResult, rewrittenResults, rawResults] = await Promise.all(promises);

              // Layer results: pinned direct → rewritten → raw fallback (deduped)
              const seen = new Set();
              const merged = [];
              const addUnique = (item) => {
                if (item &amp;&amp; item.catalogId &amp;&amp; !seen.has(item.catalogId)) {
                  seen.add(item.catalogId);
                  merged.push(item);
                }
              };
              if (directResult) addUnique(directResult);
              for (const r of rewrittenResults) addUnique(r);
              for (const r of rawResults) addUnique(r);

              showNumistaResults(merged, false, searchResult.query);
            } else {
              const results = await catalogAPI.searchItems(searchResult.query, searchFilters);
              showNumistaResults(results, false, searchResult.query);
            }
          }
        } catch (error) {
          console.error('Numista search error:', error);
          alert('Search failed: ' + error.message);
        } finally {
          // nosemgrep: javascript.browser.security.insecure-innerhtml.insecure-innerhtml, javascript.browser.security.insecure-document-method.insecure-document-method
          btn.innerHTML = originalHTML;
          btn.disabled = false;
        }
      },
      "Search Numista button",
    );
  }

  // LOOKUP PCGS BUTTON — verify by Cert# or look up by PCGS#
  if (elements.lookupPcgsBtn) {
    safeAttachListener(
      elements.lookupPcgsBtn,
      "click",
      async () => {
        if (typeof lookupPcgsFromForm !== 'function') {
          alert('PCGS lookup is not available.');
          return;
        }

        const btn = elements.lookupPcgsBtn;
        const originalHTML = btn.innerHTML;
        btn.textContent = 'Looking up...';
        btn.disabled = true;

        try {
          const result = await lookupPcgsFromForm();

          if (!result.verified) {
            alert(result.error || 'PCGS lookup failed.');
            return;
          }

          // Show field picker modal instead of auto-filling
          if (typeof showPcgsFieldPicker === 'function') {
            showPcgsFieldPicker(result);
          } else {
            alert('PCGS field picker not available.');
          }
        } catch (error) {
          console.error('PCGS lookup error:', error);
          alert('PCGS lookup failed: ' + error.message);
        } finally {
          btn.innerHTML = originalHTML;
          btn.disabled = false;
        }
      },
      "Lookup PCGS button",
    );
  }

  // SPOT LOOKUP BUTTON — search historical spot prices by date (STACK-49)
  if (elements.spotLookupBtn) {
    safeAttachListener(
      elements.spotLookupBtn,
      "click",
      () => {
        if (typeof openSpotLookupModal === 'function') openSpotLookupModal();
      },
      "Spot lookup button",
    );
  }

  // DATE FIELD — enable/disable spot lookup button based on date value (STACK-49)
  if (elements.itemDate) {
    const updateSpotBtnState = () => {
      if (elements.spotLookupBtn) {
        elements.spotLookupBtn.disabled = !elements.itemDate.value;
      }
      if (elements.itemSpotPrice) elements.itemSpotPrice.value = '';
    };
    safeAttachListener(elements.itemDate, "change", updateSpotBtnState, "Date field for spot btn");
    safeAttachListener(elements.itemDate, "input", updateSpotBtnState, "Date field input for spot btn");
  }

  // METAL CHANGE — clear stale spot lookup value (STACK-49)
  if (elements.itemMetal) {
    safeAttachListener(
      elements.itemMetal,
      "change",
      () => {
        if (elements.itemSpotPrice) elements.itemSpotPrice.value = '';
      },
      "Metal change clears spot lookup",
    );
  }
};

/** Closes the notes modal and resets the notes index. */
const dismissNotesModal = () => {
  if (elements.notesModal) elements.notesModal.style.display = "none";
  notesIndex = null;
};

/**
 * Sets up notes modal, debug modal, bulk edit, changelog, and settings clear button listeners
 */
const setupNoteAndModalListeners = () => {
  // NOTES MODAL BUTTONS
  optionalListener(elements.saveNotesBtn, "click", () => {
    if (notesIndex === null) return;
    const text = elements.notesTextarea ? elements.notesTextarea.value.trim() : "";

    const oldItem = { ...inventory[notesIndex] };
    inventory[notesIndex].notes = text;
    saveInventory();
    renderTable();
    logItemChanges(oldItem, inventory[notesIndex]);
    dismissNotesModal();
  }, "Save notes button");

  optionalListener(elements.cancelNotesBtn, "click", dismissNotesModal, "Cancel notes button");
  optionalListener(elements.notesCloseBtn, "click", dismissNotesModal, "Notes modal close button");
  optionalListener(document.getElementById('notesViewCloseBtn'), "click", () => {
    if (typeof closeModalById === 'function') closeModalById('notesViewModal');
  }, "Notes view modal close button");

  optionalListener(document.getElementById('goldbackExchangeRateLink'), "click", (e) => {
    e.preventDefault();
    window.open(
      'https://www.goldback.com/exchange-rates/',
      'goldback_rates',
      'width=1250,height=800,scrollbars=yes,resizable=yes,toolbar=no,location=no,menubar=no,status=no',
    );
  }, "Goldback exchange rates link");

  optionalListener(document.getElementById('spotLookupCloseBtn'), "click", () => {
    if (typeof closeSpotLookupModal === 'function') closeSpotLookupModal();
  }, "Spot lookup modal close button");

  optionalListener(elements.debugCloseBtn, "click",
    () => { if (typeof hideDebugModal === "function") hideDebugModal(); },
    "Debug modal close button");

  // Bulk Edit modal open/close
  optionalListener(elements.bulkEditBtn, "click",
    () => { if (typeof openBulkEdit === "function") openBulkEdit(); },
    "Bulk edit open button");
  optionalListener(elements.bulkEditCloseBtn, "click",
    () => { if (typeof closeBulkEdit === "function") closeBulkEdit(); },
    "Bulk edit close button");

  optionalListener(elements.changeLogBtn, "click", (e) => {
    e.preventDefault();
    if (typeof showSettingsModal === "function") showSettingsModal("changelog");
  }, "Change log button");

  // Settings panel clear buttons (STACK-44)
  optionalListener(elements.settingsChangeLogClearBtn, "click",
    () => { if (typeof clearChangeLog === "function") clearChangeLog(); },
    "Settings change log clear button");
  optionalListener(elements.settingsSpotHistoryClearBtn, "click",
    () => { if (typeof clearSpotHistory === "function") clearSpotHistory(); },
    "Settings spot history clear button");
  optionalListener(elements.settingsCatalogHistoryClearBtn, "click",
    () => { if (typeof clearCatalogHistory === "function") clearCatalogHistory(); },
    "Settings catalog history clear button");
  optionalListener(elements.settingsPriceHistoryClearBtn, "click",
    () => { if (typeof clearItemPriceHistory === "function") clearItemPriceHistory(); },
    "Settings price history clear button");
  optionalListener(elements.settingsCloudActivityClearBtn, "click",
    () => { if (typeof clearCloudActivityLog === "function") clearCloudActivityLog(); },
    "Settings cloud activity clear button");

  // Price History filter input (STACK-44)
  optionalListener(elements.priceHistoryFilterInput, "input",
    () => { if (typeof filterItemPriceHistoryTable === "function") filterItemPriceHistoryTable(); },
    "Price history filter input");

  optionalListener(elements.backupReminder, "click", (e) => {
    e.preventDefault();
    if (typeof showSettingsModal === "function") showSettingsModal('system');
  }, "Backup reminder link");

  optionalListener(elements.storageReportLink, "click", (e) => {
    e.preventDefault();
    if (typeof showSettingsModal === "function") showSettingsModal("storage");
  }, "Storage report link");

  optionalListener(elements.changeLogCloseBtn, "click", () => {
    if (elements.changeLogModal) {
      if (window.closeModalById) closeModalById('changeLogModal');
      else {
        elements.changeLogModal.style.display = "none";
        document.body.style.overflow = "";
      }
    }
  }, "Change log close button");

  optionalListener(elements.changeLogClearBtn, "click",
    () => { if (typeof clearChangeLog === "function") clearChangeLog(); },
    "Change log clear button");

};

/**
 * Sets up spot price sync icons, range dropdowns, and inline editing
 */
const setupSpotPriceListeners = () => {
  // SPOT PRICE EVENT LISTENERS — Sparkline card redesign
  debugLog("Setting up spot price listeners...");
  Object.values(METALS).forEach((metalConfig) => {
    const metalKey = metalConfig.key;
    const metalName = metalConfig.name;

    // Sync icon button
    const syncIcon = document.getElementById(`syncIcon${metalName}`);
    if (syncIcon) {
      safeAttachListener(
        syncIcon,
        "click",
        () => {
          debugLog(`Sync icon clicked for ${metalName}`);
          if (typeof syncSpotPricesFromApi === "function") {
            syncSpotPricesFromApi(true);
          } else {
            alert(
              "API sync functionality requires Metals API configuration. Please configure an API provider first.",
            );
          }
        },
        `Sync spot price for ${metalName}`,
      );
    }

    // Range dropdown change → re-render sparkline + save preference
    const rangeSelect = document.getElementById(`spotRange${metalName}`);
    if (rangeSelect) {
      // Restore saved preference
      const saved = typeof loadTrendRanges === "function" ? loadTrendRanges() : {};
      if (saved[metalKey]) {
        rangeSelect.value = String(saved[metalKey]);
      }

      safeAttachListener(
        rangeSelect,
        "change",
        () => {
          const days = parseInt(rangeSelect.value, 10);
          if (typeof saveTrendRange === "function") saveTrendRange(metalKey, days);
          if (typeof updateSparkline === "function") updateSparkline(metalKey);
        },
        `Trend range for ${metalName}`,
      );
    }
  });

  // Shift+click capture handler for inline spot price editing
  document.addEventListener(
    "click",
    (e) => {
      if (!e.shiftKey) return;
      const valueEl = e.target.closest(".spot-card-value");
      if (!valueEl) return;

      e.preventDefault();
      e.stopPropagation();

      const card = valueEl.closest(".spot-card");
      if (!card || !card.dataset.metal) return;

      if (typeof startSpotInlineEdit === "function") {
        startSpotInlineEdit(valueEl, card.dataset.metal);
      }
    },
    true,
  );

};

/**
 * Sets up vault backup/restore listeners and password strength UI.
 */
const setupVaultListeners = () => {
  const vaultCloseBtn = document.getElementById('vaultCloseBtn');
  const vaultActionBtn = document.getElementById('vaultActionBtn');
  const vaultCancelBtn = document.getElementById('vaultCancelBtn');
  const vaultPasswordToggle = document.getElementById('vaultPasswordToggle');
  const vaultConfirmToggle = document.getElementById('vaultConfirmToggle');

  optionalListener(elements.vaultExportBtn, "click",
    () => { openVaultModal("export"); },
    "Vault export button");

  optionalListener(elements.vaultImportBtn, "click",
    () => { if (elements.vaultImportFile) elements.vaultImportFile.click(); },
    "Vault import button");

  optionalListener(elements.vaultImportFile, "change", function (e) {
    var file = e.target.files &amp;&amp; e.target.files[0];
    if (file) {
      openVaultModal("import", file);
      e.target.value = "";
    }
  }, "Vault import file input");

  optionalListener(vaultCloseBtn, "click", () => {
    if (typeof closeVaultModal === 'function') closeVaultModal();
  }, "Vault modal close button");

  optionalListener(vaultActionBtn, "click", () => {
    if (typeof handleVaultAction === 'function') handleVaultAction();
  }, "Vault modal action button");

  optionalListener(vaultCancelBtn, "click", () => {
    if (typeof closeVaultModal === 'function') closeVaultModal();
  }, "Vault modal cancel button");

  optionalListener(vaultPasswordToggle, "click", () => {
    if (typeof toggleVaultPasswordVisibility === 'function') {
      toggleVaultPasswordVisibility('vaultPassword', vaultPasswordToggle);
    }
  }, "Vault password toggle");

  optionalListener(vaultConfirmToggle, "click", () => {
    if (typeof toggleVaultPasswordVisibility === 'function') {
      toggleVaultPasswordVisibility('vaultConfirmPassword', vaultConfirmToggle);
    }
  }, "Vault confirm password toggle");

  // Vault modal live password events
  const pw = document.getElementById("vaultPassword");
  const cpw = document.getElementById("vaultConfirmPassword");
  optionalListener(pw, "input", () => {
    updateStrengthBar(pw.value);
    if (cpw) updateMatchIndicator(pw.value, cpw.value);
  }, "Vault password input");
  optionalListener(cpw, "input", () => {
    if (pw) updateMatchIndicator(pw.value, cpw.value);
  }, "Vault confirm password input");
};

/**
 * Sets up data-destructive action listeners (remove data, boating accident).
 */
const setupDataManagementListeners = () => {
  optionalListener(elements.removeInventoryDataBtn, "click", async () => {
    const confirmed = typeof showAppConfirm === "function"
      ? await showAppConfirm("Remove all inventory items? This cannot be undone.", "Data Management")
      : confirm("Remove all inventory items? This cannot be undone.");
    if (confirmed) {
      localStorage.removeItem(LS_KEY);
      // STACK-62: Clear stale autocomplete cache so it rebuilds from fresh inventory
      if (typeof clearLookupCache === 'function') clearLookupCache();
      loadInventory();
      renderTable();
      renderActiveFilters();
      if (typeof showAppAlert === "function") await showAppAlert("Inventory data cleared.", "Data Management");
      else alert("Inventory data cleared.");
    }
  }, "Remove inventory data button");

  optionalListener(elements.boatingAccidentBtn, "click", async () => {
    const confirmed = typeof showAppConfirm === "function"
      ? await showAppConfirm("Did you really lose it all in a boating accident? This will wipe all local data.", "Data Management")
      : confirm("Did you really lose it all in a boating accident? This will wipe all local data.");
    if (confirmed) {
      // Nuclear wipe: clear every allowed localStorage key
      ALLOWED_STORAGE_KEYS.forEach((key) => {
        localStorage.removeItem(key);
      });
      sessionStorage.clear();

      // Clear IndexedDB image cache
      if (window.imageCache &amp;&amp; typeof imageCache.clearAll === 'function') {
        imageCache.clearAll().catch(() => { });
      }

      // Reset in-memory log/history arrays
      if (typeof changeLog !== 'undefined') changeLog = [];
      if (typeof catalogHistory !== 'undefined') catalogHistory = [];
      if (typeof spotHistory !== 'undefined') spotHistory = {};

      // Disconnect cloud providers (UI reset)
      if (typeof syncCloudUI === 'function') syncCloudUI();

      loadInventory();
      renderTable();
      renderActiveFilters();
      loadSpotHistory();
      fetchSpotPrice();

      apiConfig = { provider: "", keys: {} };
      apiCache = null;
      updateSyncButtonStates();

      if (typeof showAppAlert === "function") await showAppAlert("All data has been erased. Hope your scuba gear is ready!", "Data Management");
      else alert("All data has been erased. Hope your scuba gear is ready!");
    }
  }, "Boating accident button");
};

/**
 * Sets up import/export event listeners (CSV, JSON, Numista, PDF, Vault, etc.)
 */
const setupImportExportListeners = () => {
  debugLog("Setting up import/export listeners...");

  // Import triads: Override / Merge / File-input for each format
  setupFormatImport(elements.importCsvOverride, elements.importCsvMerge, elements.importCsvFile, importCsv, "CSV");
  setupFormatImport(elements.importJsonOverride, elements.importJsonMerge, elements.importJsonFile, importJson, "JSON");
  setupFormatImport(
    document.getElementById("importNumistaBtn"),
    document.getElementById("mergeNumistaBtn"),
    elements.numistaImportFile, importNumistaCsv, "Numista CSV"
  );

  // Export buttons
  optionalListener(elements.exportCsvBtn, "click", exportCsv, "CSV export");
  optionalListener(elements.exportJsonBtn, "click", exportJson, "JSON export");
  optionalListener(elements.exportPdfBtn, "click", exportPdf, "PDF export");
  optionalListener(document.getElementById("exportZipBtn"), "click", () => {
    if (typeof createBackupZip === "function") createBackupZip();
  }, "ZIP export");

  // ZIP import
  const importZipBtn = document.getElementById("importZipBtn");
  const importZipFile = document.getElementById("importZipFile");
  if (importZipBtn &amp;&amp; importZipFile) {
    importZipBtn.addEventListener("click", () => importZipFile.click());
    importZipFile.addEventListener("change", (e) => {
      const file = e.target.files &amp;&amp; e.target.files[0];
      if (file &amp;&amp; typeof restoreBackupZip === "function") {
        restoreBackupZip(file);
        importZipFile.value = "";
      }
    });
  }

  // Cloud Sync modal
  optionalListener(elements.cloudSyncBtn, "click", () => {
    if (elements.cloudSyncModal) {
      if (window.openModalById) openModalById('cloudSyncModal');
      else elements.cloudSyncModal.style.display = "flex";
    }
  }, "Cloud Sync button");
  const cloudSyncCloseBtn = document.getElementById("cloudSyncCloseBtn");
  if (cloudSyncCloseBtn &amp;&amp; elements.cloudSyncModal) {
    safeAttachListener(cloudSyncCloseBtn, "click", () => {
      if (window.closeModalById) closeModalById('cloudSyncModal');
      else elements.cloudSyncModal.style.display = "none";
    }, "Cloud Sync close");
  }

  setupVaultListeners();
  setupDataManagementListeners();
};

// MAIN EVENT LISTENERS SETUP
// =============================================================================

/**
 * Sets up all primary event listeners for the application
 */
const setupEventListeners = () => {
  console.log(`Setting up event listeners (v${APP_VERSION})...`);

  try {
    setupSearchAndChipListeners();
    setupResponsiveColumns();
    setupHeaderButtonListeners();
    setupTableSortListeners();
    setupItemFormListeners();
    setupNoteAndModalListeners();
    setupSpotPriceListeners();
    setupImportExportListeners();

    // API MODAL EVENT LISTENERS
    debugLog("Setting up API modal listeners...");
    setupApiEvents();

    // ABOUT MODAL EVENT LISTENERS
    debugLog("Setting up about modal listeners...");
    if (typeof setupAboutModalEvents === "function") {
      setupAboutModalEvents();
    }

    debugLog("✓ All event listeners setup complete");
  } catch (error) {
    console.error("❌ Error setting up event listeners:", error);
    throw error;
  }
};

/**
 * Sets up visible-rows (portal view) event listener
 */
const setupPagination = () => {
  debugLog("Setting up visible-rows listener...");

  try {
    if (elements.itemsPerPage) {
      safeAttachListener(
        elements.itemsPerPage,
        "change",
        function () {
          const ippVal = this.value;
          itemsPerPage = ippVal === 'all' ? Infinity : parseInt(ippVal, 10);
          // Persist setting
          try { localStorage.setItem(ITEMS_PER_PAGE_KEY, ippVal); } catch (e) { /* ignore */ }
          // Sync settings modal control
          const settingsIpp = document.getElementById('settingsItemsPerPage');
          if (settingsIpp) settingsIpp.value = ippVal;
          renderTable();
        },
        "Visible rows select",
      );
    }

    debugLog("✓ Visible-rows listener setup complete");
  } catch (error) {
    console.error("❌ Error setting up visible-rows listener:", error);
  }

  // Back to top floating button
  const backToTopBtn = document.getElementById('backToTopBtn');
  if (backToTopBtn) {
    if (!window._backToTopInitialized) {
      window.addEventListener('scroll', () => {
        backToTopBtn.classList.toggle('visible', window.scrollY > 300);
      }, { passive: true });
      backToTopBtn.addEventListener('click', () => {
        window.scrollTo({ top: 0, behavior: 'smooth' });
      });
      window._backToTopInitialized = true;
    }
  }
};

/**
 * Sets up bulk edit control panel event listeners
 */
const setupBulkEditControls = () => {
  debugLog("Setting up bulk edit control listeners...");

  try {
    // Bulk toggle all edit mode
    const bulkToggleAll = document.getElementById('bulkToggleAll');
    if (bulkToggleAll) {
      safeAttachListener(
        bulkToggleAll,
        "click",
        function () {
          if (typeof window.toggleAllItemsEdit === 'function') {
            window.toggleAllItemsEdit();
          }
        },
        "Bulk toggle all edit mode",
      );
    }

    // Bulk save all changes
    const bulkSaveAll = document.getElementById('bulkSaveAll');
    if (bulkSaveAll) {
      safeAttachListener(
        bulkSaveAll,
        "click",
        function () {
          if (typeof window.saveAllEdits === 'function') {
            window.saveAllEdits();
          }
        },
        "Bulk save all changes",
      );
    }

    // Bulk cancel all changes
    const bulkCancelAll = document.getElementById('bulkCancelAll');
    if (bulkCancelAll) {
      safeAttachListener(
        bulkCancelAll,
        "click",
        function () {
          if (typeof window.cancelAllEdits === 'function') {
            window.cancelAllEdits();
          }
        },
        "Bulk cancel all changes",
      );
    }

    debugLog("✓ Bulk edit control listeners setup complete");
  } catch (error) {
    console.error("❌ Error setting up bulk edit control listeners:", error);
  }
};

/**
 * Sets up search event listeners
 */
const setupSearch = () => {
  debugLog("Setting up search listeners...");

  try {
    if (elements.searchInput) {
      const handleSearchInput = debounce(function () {
        searchQuery = this.value.replace(/[&lt;>]/g, '').trim();
        renderTable();
      }, 300);
      safeAttachListener(
        elements.searchInput,
        "input",
        handleSearchInput,
        "Search input",
      );
    }

    if (elements.typeFilter) {
      safeAttachListener(
        elements.typeFilter,
        "change",
        function () {
          const value = this.value;
          if (value) {
            activeFilters.type = { values: [value], exclude: false };
          } else {
            delete activeFilters.type;
          }
          searchQuery = "";
          if (elements.searchInput) elements.searchInput.value = "";
          renderTable();
          renderActiveFilters();
        },
        "Type filter select",
      );
    }

    if (elements.metalFilter) {
      safeAttachListener(
        elements.metalFilter,
        "change",
        function () {
          const value = this.value;
          if (value) {
            activeFilters.metal = { values: [value], exclude: false };
          } else {
            delete activeFilters.metal;
          }
          searchQuery = "";
          if (elements.searchInput) elements.searchInput.value = "";
          renderTable();
          renderActiveFilters();
        },
        "Metal filter select",
      );
    }

    if (elements.clearBtn) {
      safeAttachListener(
        elements.clearBtn,
        "click",
        clearAllFilters,
        "Clear search button",
      );
    }

    if (elements.newItemBtn) {
      safeAttachListener(
        elements.newItemBtn,
        "click",
        () => {
          // Clear editing state (ensures add mode)
          editingIndex = null;
          editingChangeLogIndex = null;
          // Reset form and set defaults
          if (elements.inventoryForm) {
            elements.inventoryForm.reset();
            elements.itemWeightUnit.value = "oz";
            elements.itemDate.value = todayStr();
          }
          if (elements.itemSerial) elements.itemSerial.value = '';
          // Reset spot lookup state (STACK-49)
          if (elements.itemSpotPrice) elements.itemSpotPrice.value = '';
          if (elements.spotLookupBtn) elements.spotLookupBtn.disabled = !elements.itemDate.value;
          // Set modal to add mode
          if (elements.itemModalTitle) elements.itemModalTitle.textContent = "Add Inventory Item";
          if (elements.itemModalSubmit) elements.itemModalSubmit.textContent = "Add to Inventory";
          if (elements.undoChangeBtn) elements.undoChangeBtn.style.display = "none";
          // Reset purity to default (form.reset already sets select to first option)
          const purityCustom = elements.purityCustomWrapper;
          if (purityCustom) purityCustom.style.display = 'none';
          if (elements.itemPurity) elements.itemPurity.value = '';
          // Reset gb denomination picker (STACK-45)
          if (typeof toggleGbDenomPicker === 'function') toggleGbDenomPicker();
          // Hide PCGS verified icon in add mode
          const certVerifiedIcon = document.getElementById('certVerifiedIcon');
          if (certVerifiedIcon) certVerifiedIcon.style.display = 'none';
          // Hide price history link in add mode (STAK-109)
          const addRetailHistoryLink = document.getElementById('retailPriceHistoryLink');
          if (addRetailHistoryLink) addRetailHistoryLink.style.display = 'none';
          // Update currency symbols in modal (STACK-50)
          if (typeof updateModalCurrencyUI === 'function') updateModalCurrencyUI();
          // Clear image upload state for fresh add (STACK-32)
          if (typeof clearUploadState === 'function') clearUploadState();
          // Open modal
          if (elements.itemModal) {
            if (window.openModalById) openModalById('itemModal');
            else elements.itemModal.style.display = "flex";
          }
        },
        "New item button",
      );
    }

    // Chip minimum count control
    const chipMinCountEl = document.getElementById('chipMinCount');
    if (chipMinCountEl) {
      safeAttachListener(
        chipMinCountEl,
        "change",
        function () {
          localStorage.setItem('chipMinCount', this.value);
          if (typeof renderActiveFilters === "function") {
            renderActiveFilters();
          }
        },
        "Chip minimum count select",
      );
    }

    debugLog("✓ Search listeners setup complete");
  } catch (error) {
    console.error("❌ Error setting up search listeners:", error);
  }
};

/**
 * Sets up theme toggle event listeners
 */
const updateThemeButton = () => {
  const savedTheme = localStorage.getItem(THEME_KEY) || "light";

  // Apply theme classes to all theme buttons (header buttons)
  document.querySelectorAll(".theme-btn").forEach((btn) => {
    btn.classList.remove("dark", "light", "sepia");
    btn.classList.add(savedTheme);
  });

  // Update settings modal theme picker active state
  document.querySelectorAll('.theme-option').forEach(btn => {
    btn.classList.toggle('active', btn.dataset.theme === savedTheme);
  });
};

window.updateThemeButton = updateThemeButton;

/**
 * Sets up the theme toggle logic and listeners.
 * Initializes the theme based on saved preference or system settings.
 */
const setupThemeToggle = () => {
  debugLog("Setting up theme toggle...");

  try {
    // Initialize theme with system preference detection
    if (typeof initTheme === "function") {
      initTheme();
    } else {
      const savedTheme = localStorage.getItem(THEME_KEY) || "system";
      setTheme(savedTheme);
    }

    updateThemeButton();

    // Set up system theme change listener
    if (typeof setupSystemThemeListener === "function") {
      setupSystemThemeListener();
    }

    if (window.matchMedia) {
      window
        .matchMedia("(prefers-color-scheme: dark)")
        .addEventListener("change", () => {
          // Update button if no explicit theme is set
          if (!localStorage.getItem(THEME_KEY)) {
            updateThemeButton();
          }
        });
    }

    // Theme is now controlled from the Settings modal theme picker
    debugLog("✓ Theme toggle setup complete");
  } catch (error) {
    console.error("❌ Error setting up theme toggle:", error);
  }
};

/**
 * Sets up API-related event listeners
 */
const setupApiEvents = () => {
  debugLog("Setting up API events...");

  try {
    let quotaProvider = null;
    const infoModal = document.getElementById("apiInfoModal");
    const infoCloseBtn = document.getElementById("apiInfoCloseBtn");

    if (infoModal) {
      safeAttachListener(
        infoModal,
        "click",
        (e) => {
          if (
            e.target === infoModal &amp;&amp;
            typeof hideProviderInfo === "function"
          ) {
            hideProviderInfo();
          }
        },
        "Provider info modal background",
      );
    }

    if (infoCloseBtn) {
      safeAttachListener(
        infoCloseBtn,
        "click",
        () => {
          if (typeof hideProviderInfo === "function") {
            hideProviderInfo();
          }
        },
        "Provider info close",
      );
    }

    document.querySelectorAll(".api-save-btn").forEach((btn) => {
      const provider = btn.getAttribute("data-provider");
      safeAttachListener(
        btn,
        "click",
        () => {
          if (typeof handleProviderSave === "function") {
            handleProviderSave(provider);
          }
        },
        "API save button",
      );
    });

    document.querySelectorAll(".api-sync-btn").forEach((btn) => {
      const provider = btn.getAttribute("data-provider");
      safeAttachListener(
        btn,
        "click",
        () => {
          if (typeof handleProviderSync === "function") {
            handleProviderSync(provider);
          }
        },
        "API sync button",
      );
    });

    document.querySelectorAll(".api-clear-btn").forEach((btn) => {
      const provider = btn.getAttribute("data-provider");
      safeAttachListener(
        btn,
        "click",
        () => {
          if (typeof clearApiKey === "function") {
            clearApiKey(provider);
          }
        },
        "API clear key button",
      );
    });

    const quotaClose = document.getElementById("apiQuotaCloseBtn");
    if (quotaClose &amp;&amp; elements.apiQuotaModal) {
      safeAttachListener(
        quotaClose,
        "click",
        () => (elements.apiQuotaModal.style.display = "none"),
        "API quota close",
      );
    }
    const quotaSave = document.getElementById("apiQuotaSaveBtn");
    if (quotaSave &amp;&amp; elements.apiQuotaModal) {
      safeAttachListener(
        quotaSave,
        "click",
        () => {
          const input = document.getElementById("apiQuotaInput");
          const val = parseInt(input.value, 10);
          const qp = elements.apiQuotaModal.dataset.quotaProvider || quotaProvider;
          if (!isNaN(val) &amp;&amp; qp) {
            const cfg = loadApiConfig();
            if (!cfg.usage[qp])
              cfg.usage[qp] = { quota: val, used: 0 };
            cfg.usage[qp].quota = val;
            saveApiConfig(cfg);
            elements.apiQuotaModal.style.display = "none";
            updateProviderHistoryTables();
          }
        },
        "API quota save",
      );
    }
    const flushCacheBtn = document.getElementById("flushCacheBtn");
    if (flushCacheBtn) {
      safeAttachListener(
        flushCacheBtn,
        "click",
        () => {
          if (typeof clearApiCache === "function") {
            const warnMessage =
              "This will delete the API cache and history. Click OK to continue or Cancel to keep it.";
            if (confirm(warnMessage)) {
              clearApiCache();
            }
          }
        },
        "Flush cache button",
      );
    }

    const historyBtn = document.getElementById("apiHistoryBtn");
    if (historyBtn) {
      safeAttachListener(
        historyBtn,
        "click",
        () => {
          if (typeof showApiHistoryModal === "function") {
            showApiHistoryModal();
          }
        },
        "API history button",
      );
    }

    const catalogHistoryBtn = document.getElementById("catalogHistoryBtn");
    if (catalogHistoryBtn) {
      safeAttachListener(
        catalogHistoryBtn,
        "click",
        () => {
          if (typeof showCatalogHistoryModal === "function") {
            showCatalogHistoryModal();
          }
        },
        "Catalog history button",
      );
    }

    const syncAllBtn = document.getElementById("syncAllBtn");
    if (syncAllBtn) {
      safeAttachListener(
        syncAllBtn,
        "click",
        async () => {
          if (typeof syncProviderChain === "function") {
            const { updatedCount, results } = await syncProviderChain({ showProgress: true, forceSync: true });
            const summary = Object.entries(results)
              .filter(([_, status]) => status !== "skipped")
              .map(([prov, status]) => `${API_PROVIDERS[prov]?.name || prov}: ${status}`)
              .join("\n");
            alert(`Synced ${updatedCount} prices.\n\n${summary}`);
          }
        },
        "Sync all providers button",
      );
    }

    const historyModal = document.getElementById("apiHistoryModal");
    const historyCloseBtn = document.getElementById("apiHistoryCloseBtn");
    if (historyModal) {
      safeAttachListener(
        historyModal,
        "click",
        (e) => {
          if (e.target === historyModal &amp;&amp; typeof hideApiHistoryModal === "function") {
            hideApiHistoryModal();
          }
        },
        "API history modal background",
      );
    }
    if (historyCloseBtn) {
      safeAttachListener(
        historyCloseBtn,
        "click",
        () => {
          if (typeof hideApiHistoryModal === "function") {
            hideApiHistoryModal();
          }
        },
        "API history close button",
      );
    }
    const catalogHistoryModal = document.getElementById("catalogHistoryModal");
    const catalogHistoryCloseBtn = document.getElementById("catalogHistoryCloseBtn");
    if (catalogHistoryModal) {
      safeAttachListener(
        catalogHistoryModal,
        "click",
        (e) => {
          if (e.target === catalogHistoryModal &amp;&amp; typeof hideCatalogHistoryModal === "function") {
            hideCatalogHistoryModal();
          }
        },
        "Catalog history modal background",
      );
    }
    if (catalogHistoryCloseBtn) {
      safeAttachListener(
        catalogHistoryCloseBtn,
        "click",
        () => {
          if (typeof hideCatalogHistoryModal === "function") {
            hideCatalogHistoryModal();
          }
        },
        "Catalog history close button",
      );
    }

    // ESC key to close modals (sub-modals first, then settings, then others)
    safeAttachListener(
      document,
      "keydown",
      (e) => {
        if (e.key === "Escape") {
          const infoModal = document.getElementById("apiInfoModal");
          const historyModal = document.getElementById("apiHistoryModal");
          const catalogHistModal = document.getElementById("catalogHistoryModal");
          const quotaModal = document.getElementById("apiQuotaModal");
          const bulkEditModal = document.getElementById("bulkEditModal");
          const settingsModal = document.getElementById("settingsModal");
          const itemModal = document.getElementById("itemModal");
          const notesModal = document.getElementById("notesModal");
          const detailsModal = document.getElementById("detailsModal");
          const changeLogModal = document.getElementById("changeLogModal");
          // Close sub-modals (stacking overlays) before settings modal
          if (
            infoModal &amp;&amp;
            infoModal.style.display === "flex" &amp;&amp;
            typeof hideProviderInfo === "function"
          ) {
            hideProviderInfo();
          } else if (
            historyModal &amp;&amp;
            historyModal.style.display === "flex" &amp;&amp;
            typeof hideApiHistoryModal === "function"
          ) {
            hideApiHistoryModal();
          } else if (
            catalogHistModal &amp;&amp;
            catalogHistModal.style.display === "flex" &amp;&amp;
            typeof hideCatalogHistoryModal === "function"
          ) {
            hideCatalogHistoryModal();
          } else if (
            quotaModal &amp;&amp;
            quotaModal.style.display === "flex"
          ) {
            quotaModal.style.display = "none";
          } else if (
            bulkEditModal &amp;&amp;
            bulkEditModal.style.display !== "none" &amp;&amp;
            typeof closeBulkEdit === "function"
          ) {
            closeBulkEdit();
          } else if (
            settingsModal &amp;&amp;
            settingsModal.style.display === "flex" &amp;&amp;
            typeof hideSettingsModal === "function"
          ) {
            hideSettingsModal();
          } else if (
            document.getElementById("spotLookupModal")?.style.display === "flex" &amp;&amp;
            typeof closeSpotLookupModal === "function"
          ) {
            closeSpotLookupModal();
          } else if (itemModal &amp;&amp; itemModal.style.display === "flex") {
            itemModal.style.display = "none";
            document.body.style.overflow = "";
            editingIndex = null;
            editingChangeLogIndex = null;
          } else if (notesModal &amp;&amp; notesModal.style.display === "flex") {
            notesModal.style.display = "none";
            notesIndex = null;
          } else if (changeLogModal &amp;&amp; changeLogModal.style.display === "flex") {
            changeLogModal.style.display = "none";
            document.body.style.overflow = "";
          } else if (
            detailsModal &amp;&amp;
            detailsModal.style.display === "flex" &amp;&amp;
            typeof closeDetailsModal === "function"
          ) {
            closeDetailsModal();
          }
        }
      },
      "ESC key modal close",
    );

    debugLog("✓ API events setup complete");
  } catch (error) {
    console.error("❌ Error setting up API events:", error);
  }
};

// =============================================================================

// Early cleanup of stray localStorage entries before application initialization
document.addEventListener('DOMContentLoaded', cleanupStorage);
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="CatalogAPI.html">CatalogAPI</a></li><li><a href="CatalogConfig.html">CatalogConfig</a></li><li><a href="CatalogManager.html">CatalogManager</a></li><li><a href="CatalogProvider.html">CatalogProvider</a></li><li><a href="FeatureFlags.html">FeatureFlags</a></li><li><a href="ImageCache.html">ImageCache</a></li><li><a href="ImageProcessor.html">ImageProcessor</a></li><li><a href="LocalProvider.html">LocalProvider</a></li><li><a href="NumistaCatalogProvider.html">NumistaCatalogProvider</a></li><li><a href="NumistaProvider.html">NumistaProvider</a></li></ul><h3>Global</h3><ul><li><a href="global.html#ACK_DISMISSED_KEY">ACK_DISMISSED_KEY</a></li><li><a href="global.html#API_CACHE_KEY">API_CACHE_KEY</a></li><li><a href="global.html#API_KEY_STORAGE_KEY">API_KEY_STORAGE_KEY</a></li><li><a href="global.html#API_PROVIDERS">API_PROVIDERS</a></li><li><a href="global.html#APP_VERSION">APP_VERSION</a></li><li><a href="global.html#APP_VERSION_KEY">APP_VERSION_KEY</a></li><li><a href="global.html#AUTOCOMPLETE_CONFIG">AUTOCOMPLETE_CONFIG</a></li><li><a href="global.html#BRANDING_DOMAIN_OPTIONS">BRANDING_DOMAIN_OPTIONS</a></li><li><a href="global.html#BRANDING_DOMAIN_OVERRIDE">BRANDING_DOMAIN_OVERRIDE</a></li><li><a href="global.html#BRANDING_TITLE">BRANDING_TITLE</a></li><li><a href="global.html#CARD_STYLE_KEY">CARD_STYLE_KEY</a></li><li><a href="global.html#CATALOG_HISTORY_KEY">CATALOG_HISTORY_KEY</a></li><li><a href="global.html#CATALOG_MAP_KEY">CATALOG_MAP_KEY</a></li><li><a href="global.html#CERT_LOOKUP_URLS">CERT_LOOKUP_URLS</a></li><li><a href="global.html#CLOUD_PROVIDERS">CLOUD_PROVIDERS</a></li><li><a href="global.html#DEBUG">DEBUG</a></li><li><a href="global.html#DEFAULT_API_CACHE_DURATION">DEFAULT_API_CACHE_DURATION</a></li><li><a href="global.html#DEFAULT_API_QUOTA">DEFAULT_API_QUOTA</a></li><li><a href="global.html#DEFAULT_CURRENCY">DEFAULT_CURRENCY</a></li><li><a href="global.html#DEFAULT_SORT_COL_KEY">DEFAULT_SORT_COL_KEY</a></li><li><a href="global.html#DEFAULT_SORT_DIR_KEY">DEFAULT_SORT_DIR_KEY</a></li><li><a href="global.html#DESKTOP_CARD_VIEW_KEY">DESKTOP_CARD_VIEW_KEY</a></li><li><a href="global.html#DEV_MODE">DEV_MODE</a></li><li><a href="global.html#DISPLAY_CURRENCY_KEY">DISPLAY_CURRENCY_KEY</a></li><li><a href="global.html#EXCHANGE_RATES_KEY">EXCHANGE_RATES_KEY</a></li><li><a href="global.html#EXCHANGE_RATE_API_URL">EXCHANGE_RATE_API_URL</a></li><li><a href="global.html#FALLBACK_EXCHANGE_RATES">FALLBACK_EXCHANGE_RATES</a></li><li><a href="global.html#FEATURE_FLAGS">FEATURE_FLAGS</a></li><li><a href="global.html#FEATURE_FLAGS_KEY">FEATURE_FLAGS_KEY</a></li><li><a href="global.html#FIELD_COERCIONS">FIELD_COERCIONS</a></li><li><a href="global.html#FILTER_CHIP_CATEGORY_DEFAULTS">FILTER_CHIP_CATEGORY_DEFAULTS</a></li><li><a href="global.html#GB_ESTIMATE_MODIFIER_KEY">GB_ESTIMATE_MODIFIER_KEY</a></li><li><a href="global.html#GB_ESTIMATE_PREMIUM">GB_ESTIMATE_PREMIUM</a></li><li><a href="global.html#GB_TO_OZT">GB_TO_OZT</a></li><li><a href="global.html#GITHUB_RELEASES_URL">GITHUB_RELEASES_URL</a></li><li><a href="global.html#GOLDBACK_DENOMINATIONS">GOLDBACK_DENOMINATIONS</a></li><li><a href="global.html#GOLDBACK_ENABLED_KEY">GOLDBACK_ENABLED_KEY</a></li><li><a href="global.html#GOLDBACK_ESTIMATE_ENABLED_KEY">GOLDBACK_ESTIMATE_ENABLED_KEY</a></li><li><a href="global.html#GOLDBACK_PRICES_KEY">GOLDBACK_PRICES_KEY</a></li><li><a href="global.html#GOLDBACK_PRICE_HISTORY_KEY">GOLDBACK_PRICE_HISTORY_KEY</a></li><li><a href="global.html#HEADER_SYNC_BTN_KEY">HEADER_SYNC_BTN_KEY</a></li><li><a href="global.html#HEADER_TREND_BTN_KEY">HEADER_TREND_BTN_KEY</a></li><li><a href="global.html#IMAGE_MAX_BYTES">IMAGE_MAX_BYTES</a></li><li><a href="global.html#IMAGE_MAX_DIM">IMAGE_MAX_DIM</a></li><li><a href="global.html#IMAGE_QUALITY">IMAGE_QUALITY</a></li><li><a href="global.html#INLINE_CHIP_DEFAULTS">INLINE_CHIP_DEFAULTS</a></li><li><a href="global.html#ITEMS_PER_PAGE_KEY">ITEMS_PER_PAGE_KEY</a></li><li><a href="global.html#ITEM_PRICE_HISTORY_KEY">ITEM_PRICE_HISTORY_KEY</a></li><li><a href="global.html#ITEM_TAGS_KEY">ITEM_TAGS_KEY</a></li><li><a href="global.html#LAST_API_SYNC_KEY">LAST_API_SYNC_KEY</a></li><li><a href="global.html#LAST_CACHE_REFRESH_KEY">LAST_CACHE_REFRESH_KEY</a></li><li><a href="global.html#LAST_VERSION_CHECK_KEY">LAST_VERSION_CHECK_KEY</a></li><li><a href="global.html#LATEST_REMOTE_URL_KEY">LATEST_REMOTE_URL_KEY</a></li><li><a href="global.html#LATEST_REMOTE_VERSION_KEY">LATEST_REMOTE_VERSION_KEY</a></li><li><a href="global.html#LAYOUT_SECTION_DEFAULTS">LAYOUT_SECTION_DEFAULTS</a></li><li><a href="global.html#LOG_TAB_RENDERERS">LOG_TAB_RENDERERS</a></li><li><a href="global.html#LS_KEY">LS_KEY</a></li><li><a href="global.html#MAX_LOCAL_FILE_SIZE">MAX_LOCAL_FILE_SIZE</a></li><li><a href="global.html#MAX_TAGS_PER_ITEM">MAX_TAGS_PER_ITEM</a></li><li><a href="global.html#MAX_TAG_LENGTH">MAX_TAG_LENGTH</a></li><li><a href="global.html#METALS">METALS</a></li><li><a href="global.html#METAL_COLORS">METAL_COLORS</a></li><li><a href="global.html#METAL_ORDER_KEY">METAL_ORDER_KEY</a></li><li><a href="global.html#METAL_SYMBOLS">METAL_SYMBOLS</a></li><li><a href="global.html#NUMISTA_VIEW_FIELD_DEFAULTS">NUMISTA_VIEW_FIELD_DEFAULTS</a></li><li><a href="global.html#NumistaLookup">NumistaLookup</a></li><li><a href="global.html#PREBUILT_LOOKUP_DATA">PREBUILT_LOOKUP_DATA</a></li><li><a href="global.html#PRICE_HISTORY_COLS">PRICE_HISTORY_COLS</a></li><li><a href="global.html#Remote">Remote</a></li><li><a href="global.html#SEED_CUSTOM_RULES">SEED_CUSTOM_RULES</a></li><li><a href="global.html#SEED_DATA_YEARS">SEED_DATA_YEARS</a></li><li><a href="global.html#SEED_IMAGES_VERSION">SEED_IMAGES_VERSION</a></li><li><a href="global.html#SEED_INVENTORY_ITEMS">SEED_INVENTORY_ITEMS</a></li><li><a href="global.html#SERIAL_KEY">SERIAL_KEY</a></li><li><a href="global.html#SPOT_COMPARE_MODE_KEY">SPOT_COMPARE_MODE_KEY</a></li><li><a href="global.html#SPOT_HISTORY_KEY">SPOT_HISTORY_KEY</a></li><li><a href="global.html#SPOT_TREND_KEY">SPOT_TREND_KEY</a></li><li><a href="global.html#SPOT_TREND_RANGE_KEY">SPOT_TREND_RANGE_KEY</a></li><li><a href="global.html#STORAGE_KEY_LABELS">STORAGE_KEY_LABELS</a></li><li><a href="global.html#STORAGE_TINY_THRESHOLD_KB">STORAGE_TINY_THRESHOLD_KB</a></li><li><a href="global.html#SUPPORTED_CURRENCIES">SUPPORTED_CURRENCIES</a></li><li><a href="global.html#SYNC_FILE_PATH">SYNC_FILE_PATH</a></li><li><a href="global.html#SYNC_META_PATH">SYNC_META_PATH</a></li><li><a href="global.html#SYNC_POLL_INTERVAL">SYNC_POLL_INTERVAL</a></li><li><a href="global.html#SYNC_PUSH_DEBOUNCE">SYNC_PUSH_DEBOUNCE</a></li><li><a href="global.html#SYNC_SCOPE_KEYS">SYNC_SCOPE_KEYS</a></li><li><a href="global.html#THEME_KEY">THEME_KEY</a></li><li><a href="global.html#TIMEZONE_KEY">TIMEZONE_KEY</a></li><li><a href="global.html#TREND_PRESETS">TREND_PRESETS</a></li><li><a href="global.html#VALID_TYPES">VALID_TYPES</a></li><li><a href="global.html#VAULT_FILE_EXTENSION">VAULT_FILE_EXTENSION</a></li><li><a href="global.html#VERSION_ACK_KEY">VERSION_ACK_KEY</a></li><li><a href="global.html#VERSION_CHECK_TTL">VERSION_CHECK_TTL</a></li><li><a href="global.html#VERSION_CHECK_URL">VERSION_CHECK_URL</a></li><li><a href="global.html#VIEW_METADATA_TTL">VIEW_METADATA_TTL</a></li><li><a href="global.html#VIEW_MODAL_SECTION_DEFAULTS">VIEW_MODAL_SECTION_DEFAULTS</a></li><li><a href="global.html#_VIEW_CHART_DEFAULT_RANGE">_VIEW_CHART_DEFAULT_RANGE</a></li><li><a href="global.html#_VIEW_CHART_RANGES">_VIEW_CHART_RANGES</a></li><li><a href="global.html#_VIEW_CHART_RANGE_LABELS">_VIEW_CHART_RANGE_LABELS</a></li><li><a href="global.html#__ST_COMP_PREFIX">__ST_COMP_PREFIX</a></li><li><a href="global.html#_addDetail">_addDetail</a></li><li><a href="global.html#_applyTrend">_applyTrend</a></li><li><a href="global.html#_cardChipsHTML">_cardChipsHTML</a></li><li><a href="global.html#_cardClickBound">_cardClickBound</a></li><li><a href="global.html#_cardFmt">_cardFmt</a></li><li><a href="global.html#_cardImageHTML">_cardImageHTML</a></li><li><a href="global.html#_cardMetalClass">_cardMetalClass</a></li><li><a href="global.html#_cardSortBarBound">_cardSortBarBound</a></li><li><a href="global.html#_cloudBackupWithCachedPw">_cloudBackupWithCachedPw</a></li><li><a href="global.html#_cloudBtnAction">_cloudBtnAction</a></li><li><a href="global.html#_cloudContext">_cloudContext</a></li><li><a href="global.html#_cloudRestoreWithCachedPw">_cloudRestoreWithCachedPw</a></li><li><a href="global.html#_computePortfolioSummary">_computePortfolioSummary</a></li><li><a href="global.html#_createPriceHistoryChart">_createPriceHistoryChart</a></li><li><a href="global.html#_cvBlobUrls">_cvBlobUrls</a></li><li><a href="global.html#_cvChartInstances">_cvChartInstances</a></li><li><a href="global.html#_cvEscapeAttr">_cvEscapeAttr</a></li><li><a href="global.html#_cvImageObserver">_cvImageObserver</a></li><li><a href="global.html#_darkenColor">_darkenColor</a></li><li><a href="global.html#_dataToPolylineScaled">_dataToPolylineScaled</a></li><li><a href="global.html#_deleteObverseOnSave">_deleteObverseOnSave</a></li><li><a href="global.html#_deleteReverseOnSave">_deleteReverseOnSave</a></li><li><a href="global.html#_detailItem">_detailItem</a></li><li><a href="global.html#_el">_el</a></li><li><a href="global.html#_enhanceCardImages">_enhanceCardImages</a></li><li><a href="global.html#_enhanceTableThumbnails">_enhanceTableThumbnails</a></li><li><a href="global.html#_extractMetadata">_extractMetadata</a></li><li><a href="global.html#_fetchHistoricalSpotData">_fetchHistoricalSpotData</a></li><li><a href="global.html#_fetchNumistaResult">_fetchNumistaResult</a></li><li><a href="global.html#_fetchYearFile">_fetchYearFile</a></li><li><a href="global.html#_getBulkImageSides">_getBulkImageSides</a></li><li><a href="global.html#_getOrCreateHScrollBar">_getOrCreateHScrollBar</a></li><li><a href="global.html#_getThumbPlaceholder">_getThumbPlaceholder</a></li><li><a href="global.html#_getViewMetrics">_getViewMetrics</a></li><li><a href="global.html#_hScrollWired">_hScrollWired</a></li><li><a href="global.html#_imageSlot">_imageSlot</a></li><li><a href="global.html#_initCardCharts">_initCardCharts</a></li><li><a href="global.html#_initSpotControls">_initSpotControls</a></li><li><a href="global.html#_interpolateNulls">_interpolateNulls</a></li><li><a href="global.html#_isLightColor">_isLightColor</a></li><li><a href="global.html#_itemPriceModalFilterText">_itemPriceModalFilterText</a></li><li><a href="global.html#_itemPriceModalUuid">_itemPriceModalUuid</a></li><li><a href="global.html#_loadBulkRowImages">_loadBulkRowImages</a></li><li><a href="global.html#_loadCardImage">_loadCardImage</a></li><li><a href="global.html#_loadSectionConfig">_loadSectionConfig</a></li><li><a href="global.html#_loadThumbImage">_loadThumbImage</a></li><li><a href="global.html#_normalizePatterns">_normalizePatterns</a></li><li><a href="global.html#_openBulkImagePopover">_openBulkImagePopover</a></li><li><a href="global.html#_openExternalPopup">_openExternalPopup</a></li><li><a href="global.html#_openThumbPopover">_openThumbPopover</a></li><li><a href="global.html#_parseColor">_parseColor</a></li><li><a href="global.html#_patternMode">_patternMode</a></li><li><a href="global.html#_pendingObverseBlob">_pendingObverseBlob</a></li><li><a href="global.html#_pendingObversePreviewUrl">_pendingObversePreviewUrl</a></li><li><a href="global.html#_pendingReverseBlob">_pendingReverseBlob</a></li><li><a href="global.html#_pendingReversePreviewUrl">_pendingReversePreviewUrl</a></li><li><a href="global.html#_renderSectionConfigTable">_renderSectionConfigTable</a></li><li><a href="global.html#_renderSortBarSummary">_renderSortBarSummary</a></li><li><a href="global.html#_restoreCdnFolderFromZip">_restoreCdnFolderFromZip</a></li><li><a href="global.html#_saveSectionConfig">_saveSectionConfig</a></li><li><a href="global.html#_schedulePoll">_schedulePoll</a></li><li><a href="global.html#_section">_section</a></li><li><a href="global.html#_setSlotImage">_setSlotImage</a></li><li><a href="global.html#_showCardImage">_showCardImage</a></li><li><a href="global.html#_statusCells">_statusCells</a></li><li><a href="global.html#_storageTinyVisible">_storageTinyVisible</a></li><li><a href="global.html#_storedSortCol">_storedSortCol</a></li><li><a href="global.html#_syncFallbackUUID">_syncFallbackUUID</a></li><li><a href="global.html#_syncHScrollBar">_syncHScrollBar</a></li><li><a href="global.html#_syncPollerTimer">_syncPollerTimer</a></li><li><a href="global.html#_syncProvider">_syncProvider</a></li><li><a href="global.html#_syncPushInFlight">_syncPushInFlight</a></li><li><a href="global.html#_syncRelativeTime">_syncRelativeTime</a></li><li><a href="global.html#_syncRetryDelay">_syncRetryDelay</a></li><li><a href="global.html#_syncSortBar">_syncSortBar</a></li><li><a href="global.html#_thumbBlobUrls">_thumbBlobUrls</a></li><li><a href="global.html#_thumbObserver">_thumbObserver</a></li><li><a href="global.html#_updateHScrollThumb">_updateHScrollThumb</a></li><li><a href="global.html#_vaultPendingFile">_vaultPendingFile</a></li><li><a href="global.html#_viewModalChartInstance">_viewModalChartInstance</a></li><li><a href="global.html#_viewModalObjectUrls">_viewModalObjectUrls</a></li><li><a href="global.html#_viewYearCache">_viewYearCache</a></li><li><a href="global.html#_viewYearFetchPromises">_viewYearFetchPromises</a></li><li><a href="global.html#acceptAck">acceptAck</a></li><li><a href="global.html#activeFilters">activeFilters</a></li><li><a href="global.html#addCompositionOption">addCompositionOption</a></li><li><a href="global.html#addItemTag">addItemTag</a></li><li><a href="global.html#analyzeStorageData">analyzeStorageData</a></li><li><a href="global.html#analyzeStorageItem">analyzeStorageItem</a></li><li><a href="global.html#apiCache">apiCache</a></li><li><a href="global.html#apiConfig">apiConfig</a></li><li><a href="global.html#apiHistoryEntries">apiHistoryEntries</a></li><li><a href="global.html#apiHistoryFilterText">apiHistoryFilterText</a></li><li><a href="global.html#apiHistorySortAsc">apiHistorySortAsc</a></li><li><a href="global.html#apiHistorySortColumn">apiHistorySortColumn</a></li><li><a href="global.html#applyColumnFilter">applyColumnFilter</a></li><li><a href="global.html#applyHeaderToggleVisibility">applyHeaderToggleVisibility</a></li><li><a href="global.html#applyLayoutOrder">applyLayoutOrder</a></li><li><a href="global.html#applyMetalOrder">applyMetalOrder</a></li><li><a href="global.html#applyMinCountThreshold">applyMinCountThreshold</a></li><li><a href="global.html#applyNumistaTags">applyNumistaTags</a></li><li><a href="global.html#applyQuickFilter">applyQuickFilter</a></li><li><a href="global.html#attachAutocomplete">attachAutocomplete</a></li><li><a href="global.html#attachPriceHistorySortHeaders">attachPriceHistorySortHeaders</a></li><li><a href="global.html#autoSelectDefaultProvider">autoSelectDefaultProvider</a></li><li><a href="global.html#autoSyncSpotPrices">autoSyncSpotPrices</a></li><li><a href="global.html#backfillStaktrakrHourly">backfillStaktrakrHourly</a></li><li><a href="global.html#bindAppearanceAndHeaderListeners">bindAppearanceAndHeaderListeners</a></li><li><a href="global.html#bindCardAndTableImageListeners">bindCardAndTableImageListeners</a></li><li><a href="global.html#bindCardClickHandler">bindCardClickHandler</a></li><li><a href="global.html#bindCloudCacheListeners">bindCloudCacheListeners</a></li><li><a href="global.html#bindCloudStorageListeners">bindCloudStorageListeners</a></li><li><a href="global.html#bindFilterAndNumistaListeners">bindFilterAndNumistaListeners</a></li><li><a href="global.html#bindGoldbackActionListeners">bindGoldbackActionListeners</a></li><li><a href="global.html#bindGoldbackToggleListeners">bindGoldbackToggleListeners</a></li><li><a href="global.html#bindImageImportExportListeners">bindImageImportExportListeners</a></li><li><a href="global.html#bindImageSettingsListeners">bindImageSettingsListeners</a></li><li><a href="global.html#bindImageSyncListeners">bindImageSyncListeners</a></li><li><a href="global.html#bindNumistaBulkSyncListeners">bindNumistaBulkSyncListeners</a></li><li><a href="global.html#bindPatternRuleModeListeners">bindPatternRuleModeListeners</a></li><li><a href="global.html#bindSettingsModalShellListeners">bindSettingsModalShellListeners</a></li><li><a href="global.html#bindSettingsNavigationListeners">bindSettingsNavigationListeners</a></li><li><a href="global.html#bindStorageListeners">bindStorageListeners</a></li><li><a href="global.html#blobToWebP">blobToWebP</a></li><li><a href="global.html#brandingWarned">brandingWarned</a></li><li><a href="global.html#buildBulkItemRow">buildBulkItemRow</a></li><li><a href="global.html#buildImageExportZip">buildImageExportZip</a></li><li><a href="global.html#buildItemFields">buildItemFields</a></li><li><a href="global.html#buildNumistaSearchQuery">buildNumistaSearchQuery</a></li><li><a href="global.html#buildSearchIndices">buildSearchIndices</a></li><li><a href="global.html#buildTagSection">buildTagSection</a></li><li><a href="global.html#buildViewContent">buildViewContent</a></li><li><a href="global.html#cacheLookupTable">cacheLookupTable</a></li><li><a href="global.html#calculateApiUsage">calculateApiUsage</a></li><li><a href="global.html#calculateLevenshteinDistance">calculateLevenshteinDistance</a></li><li><a href="global.html#catalogHistory">catalogHistory</a></li><li><a href="global.html#catalogMap">catalogMap</a></li><li><a href="global.html#changeLog">changeLog</a></li><li><a href="global.html#chartInstances">chartInstances</a></li><li><a href="global.html#checkFileSize">checkFileSize</a></li><li><a href="global.html#checkRemoteVersion">checkRemoteVersion</a></li><li><a href="global.html#checkVersionChange">checkVersionChange</a></li><li><a href="global.html#cleanOrphanedItemPriceHistory">cleanOrphanedItemPriceHistory</a></li><li><a href="global.html#cleanSearchTerm">cleanSearchTerm</a></li><li><a href="global.html#cleanString">cleanString</a></li><li><a href="global.html#cleanupStorage">cleanupStorage</a></li><li><a href="global.html#clearAllCachedData">clearAllCachedData</a></li><li><a href="global.html#clearAllFilters">clearAllFilters</a></li><li><a href="global.html#clearApiCache">clearApiCache</a></li><li><a href="global.html#clearApiConfig">clearApiConfig</a></li><li><a href="global.html#clearApiHistory">clearApiHistory</a></li><li><a href="global.html#clearApiKey">clearApiKey</a></li><li><a href="global.html#clearCatalogHistory">clearCatalogHistory</a></li><li><a href="global.html#clearChangeLog">clearChangeLog</a></li><li><a href="global.html#clearItemPriceHistory">clearItemPriceHistory</a></li><li><a href="global.html#clearLookupCache">clearLookupCache</a></li><li><a href="global.html#clearSpotHistory">clearSpotHistory</a></li><li><a href="global.html#clearUploadState">clearUploadState</a></li><li><a href="global.html#closeCurrencyDropdown">closeCurrencyDropdown</a></li><li><a href="global.html#closeCurrencyDropdownOnOutside">closeCurrencyDropdownOnOutside</a></li><li><a href="global.html#closeDetailsModal">closeDetailsModal</a></li><li><a href="global.html#closeModalById">closeModalById</a></li><li><a href="global.html#closeNumistaResultsModal">closeNumistaResultsModal</a></li><li><a href="global.html#closePcgsFieldPicker">closePcgsFieldPicker</a></li><li><a href="global.html#closeSpotLookupModal">closeSpotLookupModal</a></li><li><a href="global.html#closeVaultModal">closeVaultModal</a></li><li><a href="global.html#closeViewModal">closeViewModal</a></li><li><a href="global.html#cloudBackupEnabled">cloudBackupEnabled</a></li><li><a href="global.html#coerceFieldValue">coerceFieldValue</a></li><li><a href="global.html#collectVaultData">collectVaultData</a></li><li><a href="global.html#commitItemToInventory">commitItemToInventory</a></li><li><a href="global.html#compareVersions">compareVersions</a></li><li><a href="global.html#compositionOptions">compositionOptions</a></li><li><a href="global.html#computeGoldbackEstimatedRate">computeGoldbackEstimatedRate</a></li><li><a href="global.html#computeMeltValue">computeMeltValue</a></li><li><a href="global.html#convertToUsd">convertToUsd</a></li><li><a href="global.html#createBackupData">createBackupData</a></li><li><a href="global.html#createBackupZip">createBackupZip</a></li><li><a href="global.html#createBreakdownElements">createBreakdownElements</a></li><li><a href="global.html#createDummyElement">createDummyElement</a></li><li><a href="global.html#createEmptyLookupTable">createEmptyLookupTable</a></li><li><a href="global.html#createFieldInput">createFieldInput</a></li><li><a href="global.html#createPieChart">createPieChart</a></li><li><a href="global.html#createStorageItemModal">createStorageItemModal</a></li><li><a href="global.html#createThumbEl">createThumbEl</a></li><li><a href="global.html#currentLookupTable">currentLookupTable</a></li><li><a href="global.html#currentMonthKey">currentMonthKey</a></li><li><a href="global.html#cycleSpotTrend">cycleSpotTrend</a></li><li><a href="global.html#dataToPolyline">dataToPolyline</a></li><li><a href="global.html#dataUriToBlob">dataUriToBlob</a></li><li><a href="global.html#debounce">debounce</a></li><li><a href="global.html#debugLog">debugLog</a></li><li><a href="global.html#deleteItem">deleteItem</a></li><li><a href="global.html#deleteItemPriceEntry">deleteItemPriceEntry</a></li><li><a href="global.html#deleteItemTags">deleteItemTags</a></li><li><a href="global.html#deleteTagGlobal">deleteTagGlobal</a></li><li><a href="global.html#deriveSearchLabel">deriveSearchLabel</a></li><li><a href="global.html#destroyCharts">destroyCharts</a></li><li><a href="global.html#destroySparklines">destroySparklines</a></li><li><a href="global.html#detailsChartMetric">detailsChartMetric</a></li><li><a href="global.html#detailsResizeObserver">detailsResizeObserver</a></li><li><a href="global.html#detectCurrency">detectCurrency</a></li><li><a href="global.html#disableCloudSync">disableCloudSync</a></li><li><a href="global.html#dismissAllAutocompletes">dismissAllAutocompletes</a></li><li><a href="global.html#dismissNotesModal">dismissNotesModal</a></li><li><a href="global.html#displayCurrency">displayCurrency</a></li><li><a href="global.html#downloadCompleteBackup">downloadCompleteBackup</a></li><li><a href="global.html#downloadFile">downloadFile</a></li><li><a href="global.html#downloadStorageReport">downloadStorageReport</a></li><li><a href="global.html#duplicateItem">duplicateItem</a></li><li><a href="global.html#editItem">editItem</a></li><li><a href="global.html#editingChangeLogIndex">editingChangeLogIndex</a></li><li><a href="global.html#editingIndex">editingIndex</a></li><li><a href="global.html#elements">elements</a></li><li><a href="global.html#enableCloudSync">enableCloudSync</a></li><li><a href="global.html#escapeAttribute">escapeAttribute</a></li><li><a href="global.html#escapeHtml">escapeHtml</a></li><li><a href="global.html#escapeHtmlCatalog">escapeHtmlCatalog</a></li><li><a href="global.html#escapeHtmlPcgs">escapeHtmlPcgs</a></li><li><a href="global.html#exchangeRates">exchangeRates</a></li><li><a href="global.html#exportCsv">exportCsv</a></li><li><a href="global.html#exportEncryptedBackup">exportEncryptedBackup</a></li><li><a href="global.html#exportGoldbackHistory">exportGoldbackHistory</a></li><li><a href="global.html#exportJson">exportJson</a></li><li><a href="global.html#exportNumistaCsv">exportNumistaCsv</a></li><li><a href="global.html#exportPdf">exportPdf</a></li><li><a href="global.html#exportSpotHistory">exportSpotHistory</a></li><li><a href="global.html#extractUniqueValues">extractUniqueValues</a></li><li><a href="global.html#featureFlags">featureFlags</a></li><li><a href="global.html#fetchBatchSpotPrices">fetchBatchSpotPrices</a></li><li><a href="global.html#fetchExchangeRates">fetchExchangeRates</a></li><li><a href="global.html#fetchHistoryBatched">fetchHistoryBatched</a></li><li><a href="global.html#fetchLatestPrices">fetchLatestPrices</a></li><li><a href="global.html#fetchMetalPriceApiHourly">fetchMetalPriceApiHourly</a></li><li><a href="global.html#fetchSpotForDate">fetchSpotForDate</a></li><li><a href="global.html#fetchSpotPrice">fetchSpotPrice</a></li><li><a href="global.html#fetchSpotPricesFromApi">fetchSpotPricesFromApi</a></li><li><a href="global.html#fetchStaktrakrHourlyRange">fetchStaktrakrHourlyRange</a></li><li><a href="global.html#fetchStaktrakrPrices">fetchStaktrakrPrices</a></li><li><a href="global.html#fetchYearFile">fetchYearFile</a></li><li><a href="global.html#fillFormFromNumistaResult">fillFormFromNumistaResult</a></li><li><a href="global.html#fillFormFromPcgsResult">fillFormFromPcgsResult</a></li><li><a href="global.html#filterInventory">filterInventory</a></li><li><a href="global.html#filterInventoryAdvanced">filterInventoryAdvanced</a></li><li><a href="global.html#filterItemPriceHistoryTable">filterItemPriceHistoryTable</a></li><li><a href="global.html#flattenGoldbackHistory">flattenGoldbackHistory</a></li><li><a href="global.html#formatCurrency">formatCurrency</a></li><li><a href="global.html#formatDateOnly">formatDateOnly</a></li><li><a href="global.html#formatDisplayDate">formatDisplayDate</a></li><li><a href="global.html#formatFileSize">formatFileSize</a></li><li><a href="global.html#formatLossProfit">formatLossProfit</a></li><li><a href="global.html#formatOffsetLabel">formatOffsetLabel</a></li><li><a href="global.html#formatPurchaseLocation">formatPurchaseLocation</a></li><li><a href="global.html#formatStorageLocation">formatStorageLocation</a></li><li><a href="global.html#formatTimeOnly">formatTimeOnly</a></li><li><a href="global.html#formatTimestamp">formatTimestamp</a></li><li><a href="global.html#formatWeight">formatWeight</a></li><li><a href="global.html#fuzzyMatch">fuzzyMatch</a></li><li><a href="global.html#fuzzySearch">fuzzySearch</a></li><li><a href="global.html#gbHistoryFilterText">gbHistoryFilterText</a></li><li><a href="global.html#gbHistorySortAsc">gbHistorySortAsc</a></li><li><a href="global.html#gbHistorySortColumn">gbHistorySortColumn</a></li><li><a href="global.html#generateBackupHtml">generateBackupHtml</a></li><li><a href="global.html#generateCategorySummary">generateCategorySummary</a></li><li><a href="global.html#generateColors">generateColors</a></li><li><a href="global.html#generateItemDataTable">generateItemDataTable</a></li><li><a href="global.html#generateLookupTable">generateLookupTable</a></li><li><a href="global.html#generateNGrams">generateNGrams</a></li><li><a href="global.html#generateReadmeContent">generateReadmeContent</a></li><li><a href="global.html#generateSparklineSVG">generateSparklineSVG</a></li><li><a href="global.html#generateStorageReport">generateStorageReport</a></li><li><a href="global.html#generateStorageReportHTML">generateStorageReportHTML</a></li><li><a href="global.html#generateStorageReportTar">generateStorageReportTar</a></li><li><a href="global.html#generateUUID">generateUUID</a></li><li><a href="global.html#generateVariations">generateVariations</a></li><li><a href="global.html#get24hChange">get24hChange</a></li><li><a href="global.html#getAllMetalsBreakdownData">getAllMetalsBreakdownData</a></li><li><a href="global.html#getAllUniqueTags">getAllUniqueTags</a></li><li><a href="global.html#getApiAvailability">getApiAvailability</a></li><li><a href="global.html#getAppTitle">getAppTitle</a></li><li><a href="global.html#getBreakdownData">getBreakdownData</a></li><li><a href="global.html#getCacheDurationMs">getCacheDurationMs</a></li><li><a href="global.html#getCachedLookupTable">getCachedLookupTable</a></li><li><a href="global.html#getCardStyle">getCardStyle</a></li><li><a href="global.html#getChartBackgroundColor">getChartBackgroundColor</a></li><li><a href="global.html#getChartColor">getChartColor</a></li><li><a href="global.html#getChartTextColor">getChartTextColor</a></li><li><a href="global.html#getChipColors">getChipColors</a></li><li><a href="global.html#getCompositionFirstWords">getCompositionFirstWords</a></li><li><a href="global.html#getContrastColor">getContrastColor</a></li><li><a href="global.html#getCryptoBackend">getCryptoBackend</a></li><li><a href="global.html#getCurrencySymbol">getCurrencySymbol</a></li><li><a href="global.html#getDateChunks">getDateChunks</a></li><li><a href="global.html#getDefaultSyncMode">getDefaultSyncMode</a></li><li><a href="global.html#getDisplayComposition">getDisplayComposition</a></li><li><a href="global.html#getEmbeddedRoadmap">getEmbeddedRoadmap</a></li><li><a href="global.html#getEmbeddedSeedData">getEmbeddedSeedData</a></li><li><a href="global.html#getEmbeddedWhatsNew">getEmbeddedWhatsNew</a></li><li><a href="global.html#getExchangeRate">getExchangeRate</a></li><li><a href="global.html#getExistingElement">getExistingElement</a></li><li><a href="global.html#getFilterChipCategoryConfig">getFilterChipCategoryConfig</a></li><li><a href="global.html#getFooterDomain">getFooterDomain</a></li><li><a href="global.html#getGoldbackDenominationPrice">getGoldbackDenominationPrice</a></li><li><a href="global.html#getGoldbackRetailPrice">getGoldbackRetailPrice</a></li><li><a href="global.html#getHistoricalSparklineData">getHistoricalSparklineData</a></li><li><a href="global.html#getInlineChipConfig">getInlineChipConfig</a></li><li><a href="global.html#getItemTags">getItemTags</a></li><li><a href="global.html#getLastProviderSyncTime">getLastProviderSyncTime</a></li><li><a href="global.html#getLastUpdateTime">getLastUpdateTime</a></li><li><a href="global.html#getLayoutSectionConfig">getLayoutSectionConfig</a></li><li><a href="global.html#getLookupStats">getLookupStats</a></li><li><a href="global.html#getMetalColor">getMetalColor</a></li><li><a href="global.html#getMetalOrderConfig">getMetalOrderConfig</a></li><li><a href="global.html#getNumistaViewFieldConfig">getNumistaViewFieldConfig</a></li><li><a href="global.html#getPasswordStrength">getPasswordStrength</a></li><li><a href="global.html#getPopularNumistaItems">getPopularNumistaItems</a></li><li><a href="global.html#getProviderOrder">getProviderOrder</a></li><li><a href="global.html#getRequiredYears">getRequiredYears</a></li><li><a href="global.html#getSparklineData">getSparklineData</a></li><li><a href="global.html#getSpotHistoryForMetal">getSpotHistoryForMetal</a></li><li><a href="global.html#getStorageItemDescription">getStorageItemDescription</a></li><li><a href="global.html#getStorageItemDisplayName">getStorageItemDisplayName</a></li><li><a href="global.html#getStorageReportCSS">getStorageReportCSS</a></li><li><a href="global.html#getStorageReportJS">getStorageReportJS</a></li><li><a href="global.html#getSyncDeviceId">getSyncDeviceId</a></li><li><a href="global.html#getSyncPassword">getSyncPassword</a></li><li><a href="global.html#getTemplateVariables">getTemplateVariables</a></li><li><a href="global.html#getUserFriendlyMessage">getUserFriendlyMessage</a></li><li><a href="global.html#getVersionString">getVersionString</a></li><li><a href="global.html#getViewModalSectionConfig">getViewModalSectionConfig</a></li><li><a href="global.html#goldbackEnabled">goldbackEnabled</a></li><li><a href="global.html#goldbackEstimateEnabled">goldbackEstimateEnabled</a></li><li><a href="global.html#goldbackEstimateModifier">goldbackEstimateModifier</a></li><li><a href="global.html#goldbackPriceHistory">goldbackPriceHistory</a></li><li><a href="global.html#goldbackPrices">goldbackPrices</a></li><li><a href="global.html#gramsToOzt">gramsToOzt</a></li><li><a href="global.html#handleError">handleError</a></li><li><a href="global.html#handleHistoryPull">handleHistoryPull</a></li><li><a href="global.html#handleImageDeletion">handleImageDeletion</a></li><li><a href="global.html#handleProviderSave">handleProviderSave</a></li><li><a href="global.html#handleProviderSync">handleProviderSync</a></li><li><a href="global.html#handleRemoteChange">handleRemoteChange</a></li><li><a href="global.html#handleSaveSearchPattern">handleSaveSearchPattern</a></li><li><a href="global.html#handleStaktrakrHistoryPull">handleStaktrakrHistoryPull</a></li><li><a href="global.html#handleVaultAction">handleVaultAction</a></li><li><a href="global.html#hideAboutModal">hideAboutModal</a></li><li><a href="global.html#hideAckModal">hideAckModal</a></li><li><a href="global.html#hideApiHistoryModal">hideApiHistoryModal</a></li><li><a href="global.html#hideApiModal">hideApiModal</a></li><li><a href="global.html#hideApiProvidersModal">hideApiProvidersModal</a></li><li><a href="global.html#hideCatalogHistoryModal">hideCatalogHistoryModal</a></li><li><a href="global.html#hideEmptyColumns">hideEmptyColumns</a></li><li><a href="global.html#hideFilesModal">hideFilesModal</a></li><li><a href="global.html#hideGoldbackHistoryModal">hideGoldbackHistoryModal</a></li><li><a href="global.html#hideManualInput">hideManualInput</a></li><li><a href="global.html#hideProviderInfo">hideProviderInfo</a></li><li><a href="global.html#hideSettingsModal">hideSettingsModal</a></li><li><a href="global.html#historicalDataCache">historicalDataCache</a></li><li><a href="global.html#historicalFetchPromises">historicalFetchPromises</a></li><li><a href="global.html#importCsv">importCsv</a></li><li><a href="global.html#importEncryptedBackup">importEncryptedBackup</a></li><li><a href="global.html#importJson">importJson</a></li><li><a href="global.html#importNumistaCsv">importNumistaCsv</a></li><li><a href="global.html#importSpotHistory">importSpotHistory</a></li><li><a href="global.html#initCardSortBar">initCardSortBar</a></li><li><a href="global.html#initCloudSync">initCloudSync</a></li><li><a href="global.html#initSpotHistoryButtons">initSpotHistoryButtons</a></li><li><a href="global.html#initTheme">initTheme</a></li><li><a href="global.html#initializeAutocomplete">initializeAutocomplete</a></li><li><a href="global.html#injectVersionString">injectVersionString</a></li><li><a href="global.html#inventory">inventory</a></li><li><a href="global.html#isCardViewActive">isCardViewActive</a></li><li><a href="global.html#isFeatureEnabled">isFeatureEnabled</a></li><li><a href="global.html#isGoldbackPricingActive">isGoldbackPricingActive</a></li><li><a href="global.html#isValidSelectOption">isValidSelectOption</a></li><li><a href="global.html#itemPriceHistory">itemPriceHistory</a></li><li><a href="global.html#itemTags">itemTags</a></li><li><a href="global.html#itemsPerPage">itemsPerPage</a></li><li><a href="global.html#loadAnnouncements">loadAnnouncements</a></li><li><a href="global.html#loadApiCache">loadApiCache</a></li><li><a href="global.html#loadApiConfig">loadApiConfig</a></li><li><a href="global.html#loadCatalogHistory">loadCatalogHistory</a></li><li><a href="global.html#loadData">loadData</a></li><li><a href="global.html#loadDisplayCurrency">loadDisplayCurrency</a></li><li><a href="global.html#loadExchangeRates">loadExchangeRates</a></li><li><a href="global.html#loadGoldbackEnabled">loadGoldbackEnabled</a></li><li><a href="global.html#loadGoldbackEstimateEnabled">loadGoldbackEstimateEnabled</a></li><li><a href="global.html#loadGoldbackEstimateModifier">loadGoldbackEstimateModifier</a></li><li><a href="global.html#loadGoldbackPriceHistory">loadGoldbackPriceHistory</a></li><li><a href="global.html#loadGoldbackPrices">loadGoldbackPrices</a></li><li><a href="global.html#loadInventory">loadInventory</a></li><li><a href="global.html#loadItemPriceHistory">loadItemPriceHistory</a></li><li><a href="global.html#loadItemTags">loadItemTags</a></li><li><a href="global.html#loadLookupTable">loadLookupTable</a></li><li><a href="global.html#loadProviderPriorities">loadProviderPriorities</a></li><li><a href="global.html#loadSeedImages">loadSeedImages</a></li><li><a href="global.html#loadSeedInventory">loadSeedInventory</a></li><li><a href="global.html#loadSeedSpotHistory">loadSeedSpotHistory</a></li><li><a href="global.html#loadSpotHistory">loadSpotHistory</a></li><li><a href="global.html#loadTrendRanges">loadTrendRanges</a></li><li><a href="global.html#loadViewImages">loadViewImages</a></li><li><a href="global.html#loadViewNumistaData">loadViewNumistaData</a></li><li><a href="global.html#logChange">logChange</a></li><li><a href="global.html#logItemChanges">logItemChanges</a></li><li><a href="global.html#logSyncActivity">logSyncActivity</a></li><li><a href="global.html#lookupPcgsByNumber">lookupPcgsByNumber</a></li><li><a href="global.html#lookupPcgsFromForm">lookupPcgsFromForm</a></li><li><a href="global.html#mapNumistaType">mapNumistaType</a></li><li><a href="global.html#marketValueViewItems">marketValueViewItems</a></li><li><a href="global.html#matchCoinSeries">matchCoinSeries</a></li><li><a href="global.html#mergeItemPriceHistory">mergeItemPriceHistory</a></li><li><a href="global.html#migrateHourlySource">migrateHourlySource</a></li><li><a href="global.html#migrateLayoutVisibility">migrateLayoutVisibility</a></li><li><a href="global.html#migrateProviderPriority">migrateProviderPriority</a></li><li><a href="global.html#monitorPerformance">monitorPerformance</a></li><li><a href="global.html#normalizeItemName">normalizeItemName</a></li><li><a href="global.html#normalizeString">normalizeString</a></li><li><a href="global.html#normalizeType">normalizeType</a></li><li><a href="global.html#notesIndex">notesIndex</a></li><li><a href="global.html#onGoldSpotPriceChanged">onGoldSpotPriceChanged</a></li><li><a href="global.html#openEbaySearch">openEbaySearch</a></li><li><a href="global.html#openItemPriceHistoryModal">openItemPriceHistoryModal</a></li><li><a href="global.html#openModalById">openModalById</a></li><li><a href="global.html#openNumistaModal">openNumistaModal</a></li><li><a href="global.html#openSpotLookupModal">openSpotLookupModal</a></li><li><a href="global.html#openStorageReportPopup">openStorageReportPopup</a></li><li><a href="global.html#openVaultModal">openVaultModal</a></li><li><a href="global.html#optimizeStoragePhase1C">optimizeStoragePhase1C</a></li><li><a href="global.html#optionalListener">optionalListener</a></li><li><a href="global.html#oztToGrams">oztToGrams</a></li><li><a href="global.html#pad2">pad2</a></li><li><a href="global.html#parseDate">parseDate</a></li><li><a href="global.html#parseFraction">parseFraction</a></li><li><a href="global.html#parseItemFormFields">parseItemFormFields</a></li><li><a href="global.html#parseNumistaMetal">parseNumistaMetal</a></li><li><a href="global.html#parsePcgsResponse">parsePcgsResponse</a></li><li><a href="global.html#parsePriceToUSD">parsePriceToUSD</a></li><li><a href="global.html#parsePurity">parsePurity</a></li><li><a href="global.html#parseSearchPatterns">parseSearchPatterns</a></li><li><a href="global.html#parseVaultFile">parseVaultFile</a></li><li><a href="global.html#parseWeight">parseWeight</a></li><li><a href="global.html#pcgsFetch">pcgsFetch</a></li><li><a href="global.html#pcgsPreflightCheck">pcgsPreflightCheck</a></li><li><a href="global.html#persistInventoryAndRefresh">persistInventoryAndRefresh</a></li><li><a href="global.html#pollForRemoteChanges">pollForRemoteChanges</a></li><li><a href="global.html#populateAboutModal">populateAboutModal</a></li><li><a href="global.html#populateAckModal">populateAckModal</a></li><li><a href="global.html#populateApiSection">populateApiSection</a></li><li><a href="global.html#populateImagesSection">populateImagesSection</a></li><li><a href="global.html#populateVersionModal">populateVersionModal</a></li><li><a href="global.html#preparePriceHistoryRows">preparePriceHistoryRows</a></li><li><a href="global.html#priceHistoryFilterText">priceHistoryFilterText</a></li><li><a href="global.html#processUploadedImage">processUploadedImage</a></li><li><a href="global.html#providerRequiresKey">providerRequiresKey</a></li><li><a href="global.html#pullSyncVault">pullSyncVault</a></li><li><a href="global.html#purgeCatalogHistory">purgeCatalogHistory</a></li><li><a href="global.html#purgeItemPriceHistory">purgeItemPriceHistory</a></li><li><a href="global.html#purgeSpotHistory">purgeSpotHistory</a></li><li><a href="global.html#pushSyncVault">pushSyncVault</a></li><li><a href="global.html#recalcItem">recalcItem</a></li><li><a href="global.html#recordAllItemPriceSnapshots">recordAllItemPriceSnapshots</a></li><li><a href="global.html#recordCatalogHistory">recordCatalogHistory</a></li><li><a href="global.html#recordGoldbackPrices">recordGoldbackPrices</a></li><li><a href="global.html#recordItemPrice">recordItemPrice</a></li><li><a href="global.html#recordSingleItemPrice">recordSingleItemPrice</a></li><li><a href="global.html#recordSpot">recordSpot</a></li><li><a href="global.html#refreshCompositionOptions">refreshCompositionOptions</a></li><li><a href="global.html#refreshFromCache">refreshFromCache</a></li><li><a href="global.html#refreshLookupTable">refreshLookupTable</a></li><li><a href="global.html#refreshProviderStatuses">refreshProviderStatuses</a></li><li><a href="global.html#refreshSyncUI">refreshSyncUI</a></li><li><a href="global.html#refreshTotalsDots">refreshTotalsDots</a></li><li><a href="global.html#registerName">registerName</a></li><li><a href="global.html#removeFilter">removeFilter</a></li><li><a href="global.html#removeItemTag">removeItemTag</a></li><li><a href="global.html#renameTag">renameTag</a></li><li><a href="global.html#renderActiveFilters">renderActiveFilters</a></li><li><a href="global.html#renderApiHistoryTable">renderApiHistoryTable</a></li><li><a href="global.html#renderApiStatusSummary">renderApiStatusSummary</a></li><li><a href="global.html#renderBulkTable">renderBulkTable</a></li><li><a href="global.html#renderBulkTableBody">renderBulkTableBody</a></li><li><a href="global.html#renderBulkToolbar">renderBulkToolbar</a></li><li><a href="global.html#renderCardA">renderCardA</a></li><li><a href="global.html#renderCardB">renderCardB</a></li><li><a href="global.html#renderCardC">renderCardC</a></li><li><a href="global.html#renderCardView">renderCardView</a></li><li><a href="global.html#renderCatalogHistoryForSettings">renderCatalogHistoryForSettings</a></li><li><a href="global.html#renderCatalogHistoryTable">renderCatalogHistoryTable</a></li><li><a href="global.html#renderChangeLog">renderChangeLog</a></li><li><a href="global.html#renderCloudBackupList">renderCloudBackupList</a></li><li><a href="global.html#renderCustomPatternRules">renderCustomPatternRules</a></li><li><a href="global.html#renderCustomRuleTable">renderCustomRuleTable</a></li><li><a href="global.html#renderEligibleItemsTable">renderEligibleItemsTable</a></li><li><a href="global.html#renderFilterChipCategoryTable">renderFilterChipCategoryTable</a></li><li><a href="global.html#renderGoldbackHistoryTable">renderGoldbackHistoryTable</a></li><li><a href="global.html#renderImageStorageStats">renderImageStorageStats</a></li><li><a href="global.html#renderInlineChipConfigTable">renderInlineChipConfigTable</a></li><li><a href="global.html#renderItemPriceHistoryModalTable">renderItemPriceHistoryModalTable</a></li><li><a href="global.html#renderItemPriceHistoryTable">renderItemPriceHistoryTable</a></li><li><a href="global.html#renderLayoutSectionConfigTable">renderLayoutSectionConfigTable</a></li><li><a href="global.html#renderLogTab">renderLogTab</a></li><li><a href="global.html#renderMetalOrderConfigTable">renderMetalOrderConfigTable</a></li><li><a href="global.html#renderNumistaFieldCheckboxes">renderNumistaFieldCheckboxes</a></li><li><a href="global.html#renderNumistaResultCard">renderNumistaResultCard</a></li><li><a href="global.html#renderNumistaSelectedItem">renderNumistaSelectedItem</a></li><li><a href="global.html#renderNumistaSyncUI">renderNumistaSyncUI</a></li><li><a href="global.html#renderNumistaUsageBar">renderNumistaUsageBar</a></li><li><a href="global.html#renderPcgsFieldCheckboxes">renderPcgsFieldCheckboxes</a></li><li><a href="global.html#renderPcgsSelectedItem">renderPcgsSelectedItem</a></li><li><a href="global.html#renderPcgsUsageBar">renderPcgsUsageBar</a></li><li><a href="global.html#renderSeedRuleTable">renderSeedRuleTable</a></li><li><a href="global.html#renderSpotHistoryTable">renderSpotHistoryTable</a></li><li><a href="global.html#renderSpotLookupEmpty">renderSpotLookupEmpty</a></li><li><a href="global.html#renderSpotLookupResults">renderSpotLookupResults</a></li><li><a href="global.html#renderStorageSection">renderStorageSection</a></li><li><a href="global.html#renderSyncHistorySection">renderSyncHistorySection</a></li><li><a href="global.html#renderSyncStats">renderSyncStats</a></li><li><a href="global.html#renderUserImageGrid">renderUserImageGrid</a></li><li><a href="global.html#renderVersionBadge">renderVersionBadge</a></li><li><a href="global.html#renderViewModalSectionConfigTable">renderViewModalSectionConfigTable</a></li><li><a href="global.html#replaceTemplateVariables">replaceTemplateVariables</a></li><li><a href="global.html#resetSpot">resetSpot</a></li><li><a href="global.html#resetSpotByName">resetSpotByName</a></li><li><a href="global.html#resetSpotPrice">resetSpotPrice</a></li><li><a href="global.html#resolveElement">resolveElement</a></li><li><a href="global.html#restoreBackupZip">restoreBackupZip</a></li><li><a href="global.html#restoreVaultData">restoreVaultData</a></li><li><a href="global.html#resyncCachedEntry">resyncCachedEntry</a></li><li><a href="global.html#safeAttachListener">safeAttachListener</a></li><li><a href="global.html#safeGetElement">safeGetElement</a></li><li><a href="global.html#sanitizeHtml">sanitizeHtml</a></li><li><a href="global.html#sanitizeImportedItem">sanitizeImportedItem</a></li><li><a href="global.html#sanitizeObjectFields">sanitizeObjectFields</a></li><li><a href="global.html#sanitizeTablesOnLoad">sanitizeTablesOnLoad</a></li><li><a href="global.html#saveApiCache">saveApiCache</a></li><li><a href="global.html#saveApiConfig">saveApiConfig</a></li><li><a href="global.html#saveCatalogHistory">saveCatalogHistory</a></li><li><a href="global.html#saveData">saveData</a></li><li><a href="global.html#saveDisplayCurrency">saveDisplayCurrency</a></li><li><a href="global.html#saveExchangeRates">saveExchangeRates</a></li><li><a href="global.html#saveFilterChipCategoryConfig">saveFilterChipCategoryConfig</a></li><li><a href="global.html#saveGoldbackEnabled">saveGoldbackEnabled</a></li><li><a href="global.html#saveGoldbackEstimateEnabled">saveGoldbackEstimateEnabled</a></li><li><a href="global.html#saveGoldbackEstimateModifier">saveGoldbackEstimateModifier</a></li><li><a href="global.html#saveGoldbackPriceHistory">saveGoldbackPriceHistory</a></li><li><a href="global.html#saveGoldbackPrices">saveGoldbackPrices</a></li><li><a href="global.html#saveInlineChipConfig">saveInlineChipConfig</a></li><li><a href="global.html#saveInventory">saveInventory</a></li><li><a href="global.html#saveItemPriceHistory">saveItemPriceHistory</a></li><li><a href="global.html#saveItemTags">saveItemTags</a></li><li><a href="global.html#saveLayoutSectionConfig">saveLayoutSectionConfig</a></li><li><a href="global.html#saveNumistaViewFieldConfig">saveNumistaViewFieldConfig</a></li><li><a href="global.html#saveProviderPriorities">saveProviderPriorities</a></li><li><a href="global.html#saveSpotHistory">saveSpotHistory</a></li><li><a href="global.html#saveTrendRange">saveTrendRange</a></li><li><a href="global.html#saveUserImageForItem">saveUserImageForItem</a></li><li><a href="global.html#saveViewModalSectionConfig">saveViewModalSectionConfig</a></li><li><a href="global.html#scheduleSyncPush">scheduleSyncPush</a></li><li><a href="global.html#searchHistoricalByDate">searchHistoricalByDate</a></li><li><a href="global.html#searchPatternExistsInCustomGroups">searchPatternExistsInCustomGroups</a></li><li><a href="global.html#searchPatternMatchesAutoChip">searchPatternMatchesAutoChip</a></li><li><a href="global.html#searchQuery">searchQuery</a></li><li><a href="global.html#searchSpotByDate">searchSpotByDate</a></li><li><a href="global.html#serializeVaultFile">serializeVaultFile</a></li><li><a href="global.html#setDefaultProvider">setDefaultProvider</a></li><li><a href="global.html#setEditPreviewUrl">setEditPreviewUrl</a></li><li><a href="global.html#setProviderStatus">setProviderStatus</a></li><li><a href="global.html#setTheme">setTheme</a></li><li><a href="global.html#settingsCatalogSortAsc">settingsCatalogSortAsc</a></li><li><a href="global.html#settingsCatalogSortColumn">settingsCatalogSortColumn</a></li><li><a href="global.html#settingsCloudSortAsc">settingsCloudSortAsc</a></li><li><a href="global.html#settingsCloudSortColumn">settingsCloudSortColumn</a></li><li><a href="global.html#settingsPriceSortAsc">settingsPriceSortAsc</a></li><li><a href="global.html#settingsPriceSortColumn">settingsPriceSortColumn</a></li><li><a href="global.html#settingsSpotSortAsc">settingsSpotSortAsc</a></li><li><a href="global.html#settingsSpotSortColumn">settingsSpotSortColumn</a></li><li><a href="global.html#setupAboutModalEvents">setupAboutModalEvents</a></li><li><a href="global.html#setupAckModalEvents">setupAckModalEvents</a></li><li><a href="global.html#setupApiEvents">setupApiEvents</a></li><li><a href="global.html#setupBasicEventListeners">setupBasicEventListeners</a></li><li><a href="global.html#setupBulkEditControls">setupBulkEditControls</a></li><li><a href="global.html#setupColumnResizing">setupColumnResizing</a></li><li><a href="global.html#setupDataManagementListeners">setupDataManagementListeners</a></li><li><a href="global.html#setupEventListeners">setupEventListeners</a></li><li><a href="global.html#setupFormatImport">setupFormatImport</a></li><li><a href="global.html#setupHeaderButtonListeners">setupHeaderButtonListeners</a></li><li><a href="global.html#setupImportExportListeners">setupImportExportListeners</a></li><li><a href="global.html#setupItemFormListeners">setupItemFormListeners</a></li><li><a href="global.html#setupNoteAndModalListeners">setupNoteAndModalListeners</a></li><li><a href="global.html#setupPagination">setupPagination</a></li><li><a href="global.html#setupProviderPriority">setupProviderPriority</a></li><li><a href="global.html#setupProviderSettingsListeners">setupProviderSettingsListeners</a></li><li><a href="global.html#setupResponsiveColumns">setupResponsiveColumns</a></li><li><a href="global.html#setupSearch">setupSearch</a></li><li><a href="global.html#setupSearchAndChipListeners">setupSearchAndChipListeners</a></li><li><a href="global.html#setupSettingsEventListeners">setupSettingsEventListeners</a></li><li><a href="global.html#setupSpotPriceListeners">setupSpotPriceListeners</a></li><li><a href="global.html#setupSystemThemeListener">setupSystemThemeListener</a></li><li><a href="global.html#setupTableSortListeners">setupTableSortListeners</a></li><li><a href="global.html#setupThemeToggle">setupThemeToggle</a></li><li><a href="global.html#setupVaultListeners">setupVaultListeners</a></li><li><a href="global.html#setupVersionModalEvents">setupVersionModalEvents</a></li><li><a href="global.html#shouldShowSearchSaveButton">shouldShowSearchSaveButton</a></li><li><a href="global.html#showAboutModal">showAboutModal</a></li><li><a href="global.html#showAckModal">showAckModal</a></li><li><a href="global.html#showApiHistoryModal">showApiHistoryModal</a></li><li><a href="global.html#showApiModal">showApiModal</a></li><li><a href="global.html#showApiProvidersModal">showApiProvidersModal</a></li><li><a href="global.html#showBulkConfirm">showBulkConfirm</a></li><li><a href="global.html#showCatalogHistoryModal">showCatalogHistoryModal</a></li><li><a href="global.html#showDetailsModal">showDetailsModal</a></li><li><a href="global.html#showFilesModal">showFilesModal</a></li><li><a href="global.html#showFullChangelog">showFullChangelog</a></li><li><a href="global.html#showGoldbackHistoryModal">showGoldbackHistoryModal</a></li><li><a href="global.html#showManualInput">showManualInput</a></li><li><a href="global.html#showNotes">showNotes</a></li><li><a href="global.html#showNotesView">showNotesView</a></li><li><a href="global.html#showNumistaResults">showNumistaResults</a></li><li><a href="global.html#showPcgsFieldPicker">showPcgsFieldPicker</a></li><li><a href="global.html#showProviderInfo">showProviderInfo</a></li><li><a href="global.html#showSettingsModal">showSettingsModal</a></li><li><a href="global.html#showStaticVersionBadge">showStaticVersionBadge</a></li><li><a href="global.html#showSyncConflictModal">showSyncConflictModal</a></li><li><a href="global.html#showSyncUpdateModal">showSyncUpdateModal</a></li><li><a href="global.html#showTagInput">showTagInput</a></li><li><a href="global.html#showVaultStatus">showVaultStatus</a></li><li><a href="global.html#showViewModal">showViewModal</a></li><li><a href="global.html#simpleHash">simpleHash</a></li><li><a href="global.html#simplifyChipValue">simplifyChipValue</a></li><li><a href="global.html#sortInventory">sortInventory</a></li><li><a href="global.html#sortInventoryByDateNewestFirst">sortInventoryByDateNewestFirst</a></li><li><a href="global.html#sparklineInstances">sparklineInstances</a></li><li><a href="global.html#spotHistory">spotHistory</a></li><li><a href="global.html#spotPrices">spotPrices</a></li><li><a href="global.html#startBulkSync">startBulkSync</a></li><li><a href="global.html#startCellEdit">startCellEdit</a></li><li><a href="global.html#startSpotInlineEdit">startSpotInlineEdit</a></li><li><a href="global.html#startSyncPoller">startSyncPoller</a></li><li><a href="global.html#stopSyncPoller">stopSyncPoller</a></li><li><a href="global.html#stripNonAlphanumeric">stripNonAlphanumeric</a></li><li><a href="global.html#switchLogTab">switchLogTab</a></li><li><a href="global.html#switchProviderTab">switchProviderTab</a></li><li><a href="global.html#switchSettingsSection">switchSettingsSection</a></li><li><a href="global.html#syncAllProviders">syncAllProviders</a></li><li><a href="global.html#syncChipToggle">syncChipToggle</a></li><li><a href="global.html#syncCurrencySettingsUI">syncCurrencySettingsUI</a></li><li><a href="global.html#syncGoldbackSettingsUI">syncGoldbackSettingsUI</a></li><li><a href="global.html#syncHasLocalChanges">syncHasLocalChanges</a></li><li><a href="global.html#syncHeaderToggleUI">syncHeaderToggleUI</a></li><li><a href="global.html#syncLayoutVisibilityUI">syncLayoutVisibilityUI</a></li><li><a href="global.html#syncProviderChain">syncProviderChain</a></li><li><a href="global.html#syncProviderPriorityUI">syncProviderPriorityUI</a></li><li><a href="global.html#syncRestoreOverrideBackup">syncRestoreOverrideBackup</a></li><li><a href="global.html#syncSaveOverrideBackup">syncSaveOverrideBackup</a></li><li><a href="global.html#syncSettingsUI">syncSettingsUI</a></li><li><a href="global.html#syncSpotPricesFromApi">syncSpotPricesFromApi</a></li><li><a href="global.html#testApiConnection">testApiConnection</a></li><li><a href="global.html#todayStr">todayStr</a></li><li><a href="global.html#toggleChange">toggleChange</a></li><li><a href="global.html#toggleCurrencyDropdown">toggleCurrencyDropdown</a></li><li><a href="global.html#toggleGlobalPriceView">toggleGlobalPriceView</a></li><li><a href="global.html#togglePriceView">togglePriceView</a></li><li><a href="global.html#toggleTheme">toggleTheme</a></li><li><a href="global.html#toggleVaultPasswordVisibility">toggleVaultPasswordVisibility</a></li><li><a href="global.html#tokenizeWords">tokenizeWords</a></li><li><a href="global.html#updateAllSparklines">updateAllSparklines</a></li><li><a href="global.html#updateCardSortBar">updateCardSortBar</a></li><li><a href="global.html#updateColumnVisibility">updateColumnVisibility</a></li><li><a href="global.html#updateFuzzyIndicator">updateFuzzyIndicator</a></li><li><a href="global.html#updateHistoryPullCost">updateHistoryPullCost</a></li><li><a href="global.html#updateItemCount">updateItemCount</a></li><li><a href="global.html#updateLastTimestamps">updateLastTimestamps</a></li><li><a href="global.html#updateManualSpot">updateManualSpot</a></li><li><a href="global.html#updateMatchIndicator">updateMatchIndicator</a></li><li><a href="global.html#updateModalCurrencyUI">updateModalCurrencyUI</a></li><li><a href="global.html#updatePortalHeight">updatePortalHeight</a></li><li><a href="global.html#updateProviderHistoryTables">updateProviderHistoryTables</a></li><li><a href="global.html#updateProviderSettings">updateProviderSettings</a></li><li><a href="global.html#updateSaveSearchButton">updateSaveSearchButton</a></li><li><a href="global.html#updateSettingsFooter">updateSettingsFooter</a></li><li><a href="global.html#updateSparkline">updateSparkline</a></li><li><a href="global.html#updateSpotCardColor">updateSpotCardColor</a></li><li><a href="global.html#updateSpotChangePercent">updateSpotChangePercent</a></li><li><a href="global.html#updateSpotTimestamp">updateSpotTimestamp</a></li><li><a href="global.html#updateStatusCell">updateStatusCell</a></li><li><a href="global.html#updateStorageStats">updateStorageStats</a></li><li><a href="global.html#updateStrengthBar">updateStrengthBar</a></li><li><a href="global.html#updateSummary">updateSummary</a></li><li><a href="global.html#updateSyncButtonStates">updateSyncButtonStates</a></li><li><a href="global.html#updateSyncStatusIndicator">updateSyncStatusIndicator</a></li><li><a href="global.html#updateThemeButton">updateThemeButton</a></li><li><a href="global.html#useSpotPrice">useSpotPrice</a></li><li><a href="global.html#validateFieldValue">validateFieldValue</a></li><li><a href="global.html#validateInventoryItem">validateInventoryItem</a></li><li><a href="global.html#validateItemFields">validateItemFields</a></li><li><a href="global.html#vaultDecrypt">vaultDecrypt</a></li><li><a href="global.html#vaultDecryptAndRestore">vaultDecryptAndRestore</a></li><li><a href="global.html#vaultDeriveKey">vaultDeriveKey</a></li><li><a href="global.html#vaultEncrypt">vaultEncrypt</a></li><li><a href="global.html#vaultEncryptToBytes">vaultEncryptToBytes</a></li><li><a href="global.html#vaultEncryptToBytesScoped">vaultEncryptToBytesScoped</a></li><li><a href="global.html#vaultRandomBytes">vaultRandomBytes</a></li><li><a href="global.html#verifyPcgsCert">verifyPcgsCert</a></li><li><a href="global.html#wireChipSortToggle">wireChipSortToggle</a></li><li><a href="global.html#wireFeatureFlagToggle">wireFeatureFlagToggle</a></li><li><a href="global.html#wireStorageToggle">wireStorageToggle</a></li><li><a href="global.html#xhrLoadJSON">xhrLoadJSON</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.5</a> on Thu Feb 19 2026 02:57:08 GMT-0600 (Central Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
