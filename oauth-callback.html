<!DOCTYPE html>
<html lang="en">
<head><meta charset="UTF-8"><title>StakTrakr â€” OAuth</title></head>
<body>
<p>Authenticating&hellip;</p>
<script>
  var params = new URLSearchParams(location.search);
  var code = params.get('code');
  var state = params.get('state');

  if (code) {
    // Popup path: postMessage back to opener and close
    if (window.opener && !window.opener.closed) {
      window.opener.postMessage({ type: 'staktrakr-oauth', code: code, state: state }, location.origin);
      window.close();
    } else {
      // Main-window redirect fallback: relay via localStorage for the app to pick up
      try {
        localStorage.setItem('staktrakr_oauth_result', JSON.stringify({ code: code, state: state }));
      } catch (e) { /* ignore */ }
      window.location.replace(location.origin + '/');
    }
  } else {
    window.location.replace(location.origin + '/');
  }
</script>
</body>
</html>
