# StackTrackr Project Instructions

## CONTEXT
Precious metals inventory app (v3.04.57+). Client-side: JS modules + localStorage + CSS. Tracks Au/Ag/Pt/Pd.

## FILES
- `index.html` - main UI
- `js/inventory.js` - CRUD/data  
- `js/events.js` - handlers
- `js/theme.js` - dark/light/sepia toggle
- `js/constants.js` - APP_VERSION, config
- `css/styles.css` - theming
- `docs/agents/agents.ai` - session state
- `docs/roadmap.md` - available tasks
- `docs/functionstable.md` - function reference

## QUICK START
1. Read `agents/agents.ai` ‚Üí pick `roadmap.md` task ‚Üí check `functionstable.md` ‚Üí edit relevant files ‚Üí update version + docs

## VERSIONING
FORMAT: BRANCH.RELEASE.PATCH[state] (3.04.26)
BUMP_AFTER: task_completion + USER_CONFIRMATION
UPDATE: `js/constants.js` APP_VERSION, `docs/changelog.md`, `docs/roadmap.md` (mark complete)

## TOKEN EFFICIENCY RULES
- NO descriptive/informative messages
- NO explanations unless critical
- NO chit-chat or pleasantries
- PRIORITIZE code writing/editing tokens
- Direct implementation only
- Minimal confirmation text

## HYBRID AI WORKFLOW (NEW)
**FOR COMPLEX FEATURES**: Claude (planning/design/testing) + OpenAI (implementation)

### CLAUDE RESPONSIBILITIES
- **PLANNING**: Feature breakdown, phase design, risk assessment
- **PROMPTING**: Create detailed implementation prompts for OpenAI
- **INTEGRATION**: Review, test, and integrate OpenAI-delivered code
- **TESTING**: Comprehensive testing across browsers/themes/scenarios
- **DOCUMENTATION**: Update tracking, changelogs, roadmap status

### OPENAI DELEGATION CRITERIA
- ‚úÖ **Standalone modules** (no StackTrackr dependencies)
- ‚úÖ **Algorithm-heavy tasks** (fuzzy search, data processing)
- ‚úÖ **Pure implementation** (well-defined inputs/outputs)
- ‚úÖ **Foundation components** (other tasks depend on it)
- ‚ùå **Integration tasks** (require StackTrackr knowledge)
- ‚ùå **UI/UX work** (needs theme/style understanding)

### ACTIVE FEATURE: FUZZY AUTOCOMPLETE
**Status**: Phase 1 in progress  
**Tracking**: `docs/notes/Feature_Implementation_Checklist.md`  
**Task 1A**: ü§ñ Delegated to OpenAI (`docs/notes/openai-task-1a-prompt.md`)  
**Next**: Task 1B - Claude implementation (lookup table generation)  

### WORKFLOW STEPS
1. **ASSESS TASK**: Claude evaluates complexity/delegation potential
2. **CREATE PROMPT**: Detailed requirements + StackTrackr patterns + API specs
3. **DELEGATE**: OpenAI implements standalone components
4. **INTEGRATE**: Claude reviews code + tests + integrates with StackTrackr
5. **VALIDATE**: Comprehensive testing across all scenarios
6. **ITERATE**: Refine based on integration results

---

## MESSAGE_TRACKER
COUNT: 18
WARN_AT: 150,200,230
AUTO_WARN: "‚ö†Ô∏è Chat approaching limit. Start new conversation soon and reference docs/agents.ai"

## WORKFLOW (CONDENSED)
**PICK TASK**: `docs/roadmap.md` ‚Üí find unassigned patch
**CHECK FILES**: High-conflict = `index.html` `events.js` `styles.css` (coordinate)
**TEST**: Load sample.csv, CRUD, themes (dark/light/sepia), responsive
**UPDATE**: Version in constants.js, changelog.md, roadmap.md (mark done)

## KEY FUNCTIONS
`renderTable()` `filterInventory()` `addInventoryItem()` `editInventoryItem()` `loadInventory()` `saveInventory()` `toggleTheme()` `setTheme()` `updateThemeButton()`

## CURRENT THEMES
- **Dark**: data-theme="dark" 
- **Light**: default (no attribute)
- **Sepia**: data-theme="sepia"
- **Toggle order**: dark ‚Üí light ‚Üí sepia ‚Üí dark

## CRITICAL PATTERNS
- All user input: sanitize with `replace(/[<>]/g, '')`
- LocalStorage keys: Use constants from `js/constants.js`
- Event listeners: Use `safeAttachListener()` from `events.js`
- Theme changes: Call `updateThemeButton()` after `setTheme()`

## HIGH-CONFLICT FILES
`index.html` `events.js` `styles.css` - coordinate changes, minimal edits

## NOTES
- Current version: 3.04.57
- **THEME TOGGLE FIXED**: Button now shows current theme color/icon, removed system mode
- **THEME ROTATION**: dark ‚Üí light ‚Üí sepia ‚Üí dark (no system mode)
- **BUTTON STYLING**: Shows current theme with matching background color
- Search functionality working properly
- N# catalog integration complete
- CatalogManager class implemented
- localStorage persistence working
- All import/export formats support N#
- Multi-agent workflow established
- LOGO AND HEADER FIXES:
  * Fixed logo display by removing conflicting inline max-width style
  * Added proper header text styling for Notes, Edit, Delete, Collect columns
  * Implemented collection icon theming for enabled/disabled states
  * Added responsive header text sizing for mobile devices
  * Improved icon column width and alignment
  * Added theme-specific icon color adjustments for day/night/sepia modes
  * FIXED: Commented out branding routine that was overriding SVG logo in header
  * TEMP: Commented out filter button in search container (incomplete feature)
- COLUMN ORDER AND THEMING FIXES (v3.04.20):
  * FIXED: Column header order now matches table body (Collect, Notes, Edit, Delete)
  * FIXED: Collection icons properly themed for dark mode (no longer black)
  * IMPROVED: Light mode contrast with better background colors and shadows
  * ENHANCED: Better visual hierarchy with improved text and border contrast
- THEME AND COLOR UPDATES (latest):
  * IMPROVED: Headers in sepia and light mode darker for better logo contrast
  * ENHANCED: Type counter colors now unique and far apart on color wheel
    - Coin: Orange (#d97706), Round: Gray (#6b7280), Bar: Yellow (#eab308)
    - Note: Green (#059669), Other: Purple (#7c3aed)
  * REORDERED: Table columns - Notes now appears before Edit column